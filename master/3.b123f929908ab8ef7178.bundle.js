/*! For license information please see 3.b123f929908ab8ef7178.bundle.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{1363:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var dashjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1458),dashjs__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(dashjs__WEBPACK_IMPORTED_MODULE_0__),video_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(623),global_window__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(116),global_window__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(global_window__WEBPACK_IMPORTED_MODULE_2__),global_document__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1611),global_document__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(global_document__WEBPACK_IMPORTED_MODULE_3__);function handlePlaybackMetadataLoaded(player,tech){var mediaPlayer=player.dash.mediaPlayer,dashAudioTracks=mediaPlayer.getTracksFor("audio"),videojsAudioTracks=player.audioTracks();function generateIdFromTrackIndex(index){return"dash-audio-"+index}function findDashAudioTrack(subDashAudioTracks,videojsAudioTrack){return subDashAudioTracks.find((function(_ref){return generateIdFromTrackIndex(_ref.index)===videojsAudioTrack.id}))}videojsAudioTracks.length&&tech.clearTracks(["audio"]);var currentAudioTrack=mediaPlayer.getCurrentTrackFor("audio");dashAudioTracks.forEach((function(dashTrack){var localizedLabel,label;if(Array.isArray(dashTrack.labels))for(var i=0;i<dashTrack.labels.length;i++)if(dashTrack.labels[i].lang&&-1!==player.language().indexOf(dashTrack.labels[i].lang.toLowerCase())){localizedLabel=dashTrack.labels[i];break}localizedLabel?label=localizedLabel.text:Array.isArray(dashTrack.labels)&&1===dashTrack.labels.length?label=dashTrack.labels[0].text:(label=dashTrack.lang,dashTrack.roles&&dashTrack.roles.length&&(label+=" ("+dashTrack.roles.join(", ")+")")),videojsAudioTracks.addTrack(new video_js__WEBPACK_IMPORTED_MODULE_1__.a.AudioTrack({enabled:dashTrack===currentAudioTrack,id:generateIdFromTrackIndex(dashTrack.index),kind:dashTrack.kind||"main",label:label,language:dashTrack.lang}))}));var audioTracksChangeHandler=function audioTracksChangeHandler(){for(var i=0;i<videojsAudioTracks.length;i++){var track=videojsAudioTracks[i];if(track.enabled){var dashAudioTrack=findDashAudioTrack(dashAudioTracks,track);mediaPlayer.setCurrentTrack(dashAudioTrack)}else;}};videojsAudioTracks.addEventListener("change",audioTracksChangeHandler),player.dash.mediaPlayer.on(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.STREAM_TEARDOWN_COMPLETE,(function(){videojsAudioTracks.removeEventListener("change",audioTracksChangeHandler)}))}function setupAudioTracks(player,tech){player.dash.mediaPlayer.on(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.PLAYBACK_METADATA_LOADED,handlePlaybackMetadataLoaded.bind(null,player,tech))}function setupTextTracks(player,tech,options){global_window__WEBPACK_IMPORTED_MODULE_2___default.a.VTTCue&&!/\[native code\]/.test(global_window__WEBPACK_IMPORTED_MODULE_2___default.a.VTTCue.toString())&&(global_window__WEBPACK_IMPORTED_MODULE_2___default.a.VTTCue=!1);var dashTracksAttachedToVideoJs=[];if(tech.featuresNativeTextTracks)video_js__WEBPACK_IMPORTED_MODULE_1__.a.log.error("You must pass {html: {nativeCaptions: false}} in the videojs constructor to use text tracks in videojs-contrib-dash");else{var mediaPlayer=player.dash.mediaPlayer;mediaPlayer.on(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.TEXT_TRACKS_ADDED,handleTextTracksAdded),mediaPlayer.on(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.CAN_PLAY,(function(){mediaPlayer.off(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.TEXT_TRACKS_ADDED,handleTextTracksAdded)}))}function handleTextTracksAdded(_ref2){_ref2.index;var tracks=_ref2.tracks;mediaPlayer.off(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.TEXT_TRACKS_ADDED,handleTextTracksAdded),function clearDashTracks(){dashTracksAttachedToVideoJs.forEach(player.removeRemoteTextTrack.bind(player)),dashTracksAttachedToVideoJs=[]}(),tracks.length&&(dashTracksAttachedToVideoJs=function attachDashTextTracksToVideojs(player,tech,tracks){var trackDictionary=[],tracksAttached=tracks.map((function(track){var localizedLabel;if(Array.isArray(track.labels))for(var i=0;i<track.labels.length;i++)if(track.labels[i].lang&&-1!==player.language().indexOf(track.labels[i].lang.toLowerCase())){localizedLabel=track.labels[i];break}return{dashTrack:track,trackConfig:{label:localizedLabel?localizedLabel.text:Array.isArray(track.labels)&&1===track.labels.length?track.labels[0].text:track.lang||track.label,language:track.lang,srclang:track.lang,kind:track.kind}}})).map((function(_ref){var trackConfig=_ref.trackConfig,dashTrack=_ref.dashTrack,remoteTextTrack=player.addRemoteTextTrack(trackConfig,!1);return trackDictionary.push({textTrack:remoteTextTrack.track,dashTrack:dashTrack}),remoteTextTrack}));function updateActiveDashTextTrack(){for(var dashMediaPlayer=player.dash.mediaPlayer,textTracks=player.textTracks(),activeTextTrackIndex=-1,_loop=function _loop(i){var textTrack=textTracks[i];if("showing"===textTrack.mode){var dictionaryLookupResult=function find(l,f){for(var i=0;i<l.length;i++)if(f(l[i]))return l[i]}(trackDictionary,(function(track){return track.textTrack===textTrack})),dashTrackToActivate=dictionaryLookupResult?dictionaryLookupResult.dashTrack:null;dashTrackToActivate&&(activeTextTrackIndex=tracks.indexOf(dashTrackToActivate))}},i=0;i<textTracks.length;i+=1)_loop(i);activeTextTrackIndex!==dashMediaPlayer.getCurrentTextTrackIndex()&&dashMediaPlayer.setTextTrack(activeTextTrackIndex)}return player.textTracks().on("change",updateActiveDashTextTrack),player.dash.mediaPlayer.on(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.STREAM_TEARDOWN_COMPLETE,(function(){player.textTracks().off("change",updateActiveDashTextTrack)})),updateActiveDashTextTrack(),tracksAttached}(player,0,tracks))}}var Html5DashJS=function(){function Html5DashJS(source,tech,options){var _this=this;if(options=options||tech.options_,this.player=Object(video_js__WEBPACK_IMPORTED_MODULE_1__.a)(options.playerId),this.player.dash=this.player.dash||{},this.tech_=tech,this.el_=tech.el(),this.elParent_=this.el_.parentNode,this.hasFiniteDuration_=!1,source.src){tech.isReady_=!1,Html5DashJS.updateSourceData&&(video_js__WEBPACK_IMPORTED_MODULE_1__.a.log.warn('updateSourceData has been deprecated. Please switch to using hook("updatesource", callback).'),source=Html5DashJS.updateSourceData(source)),Html5DashJS.hooks("updatesource").forEach((function(hook){source=hook(source)}));var manifestSource=source.src;this.keySystemOptions_=Html5DashJS.buildDashJSProtData(source.keySystemOptions),this.player.dash.mediaPlayer=dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer().create(),this.mediaPlayer_=this.player.dash.mediaPlayer,this.mediaPlayer_.setTextDefaultEnabled(!1),Html5DashJS.useVideoJSDebug&&(video_js__WEBPACK_IMPORTED_MODULE_1__.a.log.warn('useVideoJSDebug has been deprecated. Please switch to using hook("beforeinitialize", callback).'),Html5DashJS.useVideoJSDebug(this.mediaPlayer_)),Html5DashJS.beforeInitialize&&(video_js__WEBPACK_IMPORTED_MODULE_1__.a.log.warn('beforeInitialize has been deprecated. Please switch to using hook("beforeinitialize", callback).'),Html5DashJS.beforeInitialize(this.player,this.mediaPlayer_)),Html5DashJS.hooks("beforeinitialize").forEach((function(hook){hook(_this.player,_this.mediaPlayer_)})),this.mediaPlayer_.initialize(),this.retriggerError_=function(event){if("capability"===event.error&&"mediasource"===event.event)_this.player.error({code:4,message:"The media cannot be played because it requires a feature that your browser does not support."});else if("manifestError"!==event.error||"createParser"!==event.event.id&&"codec"!==event.event.id&&"nostreams"!==event.event.id&&"nostreamscomposed"!==event.event.id&&"parse"!==event.event.id&&"multiplexedrep"!==event.event.id)if("mediasource"===event.error)event.event.match("MEDIA_ERR_ABORTED")?_this.player.error({code:1,message:event.event}):event.event.match("MEDIA_ERR_NETWORK")?_this.player.error({code:2,message:event.event}):event.event.match("MEDIA_ERR_DECODE")?_this.player.error({code:3,message:event.event}):event.event.match("MEDIA_ERR_SRC_NOT_SUPPORTED")?_this.player.error({code:4,message:event.event}):event.event.match("MEDIA_ERR_ENCRYPTED")?_this.player.error({code:5,message:event.event}):(event.event.match("UNKNOWN"),_this.player.error({code:4,message:event.event}));else if("capability"===event.error&&"encryptedmedia"===event.event)_this.player.error({code:5,message:"The media cannot be played because it requires encryption features that your browser does not support."});else if("key_session"===event.error)_this.player.error({code:5,message:event.event});else if("download"===event.error)_this.player.error({code:2,message:"The media playback was aborted because too many consecutive download errors occurred."});else{if("mssError"!==event.error)return;_this.player.error({code:3,message:event.event})}else _this.player.error({code:4,message:event.event.message});setTimeout((function(){_this.mediaPlayer_.reset()}),10)},this.mediaPlayer_.on(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.ERROR,this.retriggerError_),this.getDuration_=function(event){var periods=event.data.Period_asArray,oldHasFiniteDuration=_this.hasFiniteDuration_;event.data.mediaPresentationDuration||periods[periods.length-1].duration?_this.hasFiniteDuration_=!0:_this.hasFiniteDuration_=!1,_this.hasFiniteDuration_!==oldHasFiniteDuration&&_this.player.trigger("durationchange")},this.mediaPlayer_.on(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.MANIFEST_LOADED,this.getDuration_),options.dash&&Object.keys(options.dash).forEach((function(key){var _this$mediaPlayer_,dashOptionsKey="set"+key.charAt(0).toUpperCase()+key.slice(1),value=options.dash[key];_this.mediaPlayer_.hasOwnProperty(dashOptionsKey)&&(video_js__WEBPACK_IMPORTED_MODULE_1__.a.log.warn("Using dash options in videojs-contrib-dash without the set prefix has been deprecated. Change '"+key+"' to '"+dashOptionsKey+"'"),key=dashOptionsKey),_this.mediaPlayer_.hasOwnProperty(key)?(Array.isArray(value)||(value=[value]),(_this$mediaPlayer_=_this.mediaPlayer_)[key].apply(_this$mediaPlayer_,value)):video_js__WEBPACK_IMPORTED_MODULE_1__.a.log.warn("Warning: dash configuration option unrecognized: "+key)})),this.mediaPlayer_.attachView(this.el_),this.mediaPlayer_.setAutoPlay(!1),setupAudioTracks.call(null,this.player,tech),setupTextTracks.call(null,this.player,tech,options),this.mediaPlayer_.setProtectionData(this.keySystemOptions_),this.mediaPlayer_.attachSource(manifestSource),this.tech_.triggerReady()}}Html5DashJS.buildDashJSProtData=function buildDashJSProtData(keySystemOptions){var output={};if(!keySystemOptions||!Array.isArray(keySystemOptions))return null;for(var i=0;i<keySystemOptions.length;i++){var keySystem=keySystemOptions[i],options=video_js__WEBPACK_IMPORTED_MODULE_1__.a.mergeOptions({},keySystem.options);options.licenseUrl&&(options.serverURL=options.licenseUrl,delete options.licenseUrl),output[keySystem.name]=options}return output};var _proto=Html5DashJS.prototype;return _proto.dispose=function dispose(){this.mediaPlayer_&&(this.mediaPlayer_.off(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.ERROR,this.retriggerError_),this.mediaPlayer_.off(dashjs__WEBPACK_IMPORTED_MODULE_0___default.a.MediaPlayer.events.MANIFEST_LOADED,this.getDuration_),this.mediaPlayer_.reset()),this.player.dash&&delete this.player.dash},_proto.duration=function duration(){return this.mediaPlayer_.isDynamic()&&!this.hasFiniteDuration_?1/0:this.mediaPlayer_.duration()},Html5DashJS.hooks=function hooks(type,hook){return Html5DashJS.hooks_[type]=Html5DashJS.hooks_[type]||[],hook&&(Html5DashJS.hooks_[type]=Html5DashJS.hooks_[type].concat(hook)),Html5DashJS.hooks_[type]},Html5DashJS.hook=function hook(type,_hook){Html5DashJS.hooks(type,_hook)},Html5DashJS.removeHook=function removeHook(type,hook){var index=Html5DashJS.hooks(type).indexOf(hook);return-1!==index&&(Html5DashJS.hooks_[type]=Html5DashJS.hooks_[type].slice(),Html5DashJS.hooks_[type].splice(index,1),!0)},Html5DashJS}();Html5DashJS.hooks_={};video_js__WEBPACK_IMPORTED_MODULE_1__.a.DashSourceHandler=function(){return{canHandleSource:function canHandleSource(source){return function canHandleKeySystems(source){source=JSON.parse(JSON.stringify(source)),Html5DashJS.updateSourceData&&(video_js__WEBPACK_IMPORTED_MODULE_1__.a.log.warn('updateSourceData has been deprecated. Please switch to using hook("updatesource", callback).'),source=Html5DashJS.updateSourceData(source)),Html5DashJS.hooks("updatesource").forEach((function(hook){source=hook(source)}));var videoEl=global_document__WEBPACK_IMPORTED_MODULE_3___default.a.createElement("video");return!(source.keySystemOptions&&!global_window__WEBPACK_IMPORTED_MODULE_2___default.a.navigator.requestMediaKeySystemAccess&&!videoEl.msSetMediaKeys)}(source)?video_js__WEBPACK_IMPORTED_MODULE_1__.a.DashSourceHandler.canPlayType(source.type)?"probably":/\.mpd/i.test(source.src)?"maybe":"":""},handleSource:function handleSource(source,tech,options){return new Html5DashJS(source,tech,options)},canPlayType:function canPlayType(type){return video_js__WEBPACK_IMPORTED_MODULE_1__.a.DashSourceHandler.canPlayType(type)}}},video_js__WEBPACK_IMPORTED_MODULE_1__.a.DashSourceHandler.canPlayType=function(type){return/^application\/dash\+xml/i.test(type)?"probably":""},global_window__WEBPACK_IMPORTED_MODULE_2___default.a.MediaSource&&video_js__WEBPACK_IMPORTED_MODULE_1__.a.getTech("Html5").registerSourceHandler(video_js__WEBPACK_IMPORTED_MODULE_1__.a.DashSourceHandler(),0),video_js__WEBPACK_IMPORTED_MODULE_1__.a.Html5DashJS=Html5DashJS,__webpack_exports__.default=Html5DashJS},1366:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FactoryMaker=function(){var instance=void 0,singletonContexts=[],singletonFactories={},classFactories={};function getSingletonInstance(context,className){for(var i in singletonContexts){var obj=singletonContexts[i];if(obj.context===context&&obj.name===className)return obj.instance}return null}function getFactoryByName(name,factoriesArray){return factoriesArray[name]}function updateFactory(name,factory,factoriesArray){name in factoriesArray&&(factoriesArray[name]=factory)}function merge(classConstructor,context,args){var classInstance=void 0,className=classConstructor.__dashjs_factory_name,extensionObject=context[className];if(extensionObject){var extension=extensionObject.instance;if(!extensionObject.override)return extension.apply({context:context,factory:instance},args);for(var prop in classInstance=classConstructor.apply({context:context},args),extension=extension.apply({context:context,factory:instance,parent:classInstance},args))classInstance.hasOwnProperty(prop)&&(classInstance[prop]=extension[prop])}else classInstance=classConstructor.apply({context:context},args);return classInstance.getClassName=function(){return className},classInstance}return instance={extend:function extend(name,childInstance,override,context){!context[name]&&childInstance&&(context[name]={instance:childInstance,override:override})},getSingletonInstance:getSingletonInstance,setSingletonInstance:function setSingletonInstance(context,className,instance){for(var i in singletonContexts){var obj=singletonContexts[i];if(obj.context===context&&obj.name===className)return void(singletonContexts[i].instance=instance)}singletonContexts.push({name:className,context:context,instance:instance})},getSingletonFactory:function getSingletonFactory(classConstructor){var factory=getFactoryByName(classConstructor.__dashjs_factory_name,singletonFactories);return factory||(factory=function(context){var instance=void 0;return void 0===context&&(context={}),{getInstance:function getInstance(){return instance||(instance=getSingletonInstance(context,classConstructor.__dashjs_factory_name)),instance||(instance=merge(classConstructor,context,arguments),singletonContexts.push({name:classConstructor.__dashjs_factory_name,context:context,instance:instance})),instance}}},singletonFactories[classConstructor.__dashjs_factory_name]=factory),factory},getSingletonFactoryByName:function getSingletonFactoryByName(name){return getFactoryByName(name,singletonFactories)},updateSingletonFactory:function updateSingletonFactory(name,factory){updateFactory(name,factory,singletonFactories)},getClassFactory:function getClassFactory(classConstructor){var factory=getFactoryByName(classConstructor.__dashjs_factory_name,classFactories);return factory||(factory=function(context){return void 0===context&&(context={}),{create:function create(){return merge(classConstructor,context,arguments)}}},classFactories[classConstructor.__dashjs_factory_name]=factory),factory},getClassFactoryByName:function getClassFactoryByName(name){return getFactoryByName(name,classFactories)},updateClassFactory:function updateClassFactory(name,factory){updateFactory(name,factory,classFactories)}}}();exports.default=FactoryMaker,module.exports=exports.default},1367:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var constants=new(function(){function Constants(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Constants),this.init()}return _createClass(Constants,[{key:"init",value:function init(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.FRAGMENTED_TEXT="fragmentedText",this.EMBEDDED_TEXT="embeddedText",this.MUXED="muxed",this.IMAGE="image",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.UTF8="utf-8",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)"}}]),Constants}());exports.default=constants,module.exports=exports.default},1368:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _FactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function EventBus(){var handlers={};function getHandlerIdx(type,listener,scope){var idx=-1;return handlers[type]?(handlers[type].some((function(item,index){if(item&&item.callback===listener&&(!scope||scope===item.scope))return idx=index,!0})),idx):idx}return{on:function on(type,listener,scope){var priority=arguments.length<=3||void 0===arguments[3]?0:arguments[3];if(!type)throw new Error("event type cannot be null or undefined");if(!listener||"function"!=typeof listener)throw new Error("listener must be a function: "+listener);if(!(getHandlerIdx(type,listener,scope)>=0)){handlers[type]=handlers[type]||[];var handler={callback:listener,scope:scope,priority:priority},inserted=handlers[type].some((function(item,idx){if(item&&priority>item.priority)return handlers[type].splice(idx,0,handler),!0}));inserted||handlers[type].push(handler)}},off:function off(type,listener,scope){if(type&&listener&&handlers[type]){var idx=getHandlerIdx(type,listener,scope);idx<0||(handlers[type][idx]=null)}},trigger:function trigger(type,payload){if(type&&handlers[type]){if((payload=payload||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");payload.type=type,handlers[type]=handlers[type].filter((function(item){return item})),handlers[type].forEach((function(handler){return handler&&handler.callback.call(handler.scope,payload)}))}},reset:function reset(){handlers={}}}}EventBus.__dashjs_factory_name="EventBus";var factory=_FactoryMaker2.default.getSingletonFactory(EventBus);factory.EVENT_PRIORITY_LOW=0,factory.EVENT_PRIORITY_HIGH=5e3,_FactoryMaker2.default.updateSingletonFactory(EventBus.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1369:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _EventBus2=_interopRequireDefault(__webpack_require__(1368)),_eventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_FactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),LOG_LEVEL_FATAL=1,LOG_LEVEL_ERROR=2,LOG_LEVEL_WARNING=3,LOG_LEVEL_INFO=4,LOG_LEVEL_DEBUG=5;function Debug(){var instance,context=this.context,eventBus=(0,_EventBus2.default)(context).getInstance(),logFn=[],showLogTimestamp=void 0,showCalleeName=void 0,startTime=void 0,logLevel=void 0;function getLogFn(fn){return fn&&fn.bind?fn.bind(window.console):window.console.log.bind(window.console)}function fatal(){for(var _len=arguments.length,params=Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];doLog.apply(void 0,[LOG_LEVEL_FATAL,this].concat(params))}function error(){for(var _len2=arguments.length,params=Array(_len2),_key2=0;_key2<_len2;_key2++)params[_key2]=arguments[_key2];doLog.apply(void 0,[LOG_LEVEL_ERROR,this].concat(params))}function warn(){for(var _len3=arguments.length,params=Array(_len3),_key3=0;_key3<_len3;_key3++)params[_key3]=arguments[_key3];doLog.apply(void 0,[LOG_LEVEL_WARNING,this].concat(params))}function info(){for(var _len4=arguments.length,params=Array(_len4),_key4=0;_key4<_len4;_key4++)params[_key4]=arguments[_key4];doLog.apply(void 0,[LOG_LEVEL_INFO,this].concat(params))}function debug(){for(var _len5=arguments.length,params=Array(_len5),_key5=0;_key5<_len5;_key5++)params[_key5]=arguments[_key5];doLog.apply(void 0,[LOG_LEVEL_DEBUG,this].concat(params))}function doLog(level,_this){var message="",logTime=null;showLogTimestamp&&(logTime=(new Date).getTime(),message+="["+(logTime-startTime)+"]"),showCalleeName&&_this&&_this.getClassName&&(message+="["+_this.getClassName()+"]",_this.getType&&(message+="["+_this.getType()+"]")),message.length>0&&(message+=" ");for(var _len6=arguments.length,params=Array(_len6>2?_len6-2:0),_key6=2;_key6<_len6;_key6++)params[_key6-2]=arguments[_key6];Array.apply(null,params).forEach((function(item){message+=item+" "})),logFn[level]&&logLevel>=level&&logFn[level](message),eventBus.trigger(_eventsEvents2.default.LOG,{message:message,level:level})}return instance={getLogger:function getLogger(instance){return{fatal:fatal.bind(instance),error:error.bind(instance),warn:warn.bind(instance),info:info.bind(instance),debug:debug.bind(instance)}},setLogTimestampVisible:function setLogTimestampVisible(value){showLogTimestamp=value},setCalleeNameVisible:function setCalleeNameVisible(value){showCalleeName=value},setLogToBrowserConsole:function setLogToBrowserConsole(value){logLevel=value?LOG_LEVEL_DEBUG:0},getLogToBrowserConsole:function getLogToBrowserConsole(){return 0!==logLevel},setLogLevel:function setLogLevel(value){logLevel=value},getLogLevel:function getLogLevel(){return logLevel}},function setup(){showLogTimestamp=!0,showCalleeName=!0,logLevel=LOG_LEVEL_WARNING,startTime=(new Date).getTime(),"undefined"!=typeof window&&window.console&&(logFn[LOG_LEVEL_FATAL]=getLogFn(window.console.error),logFn[LOG_LEVEL_ERROR]=getLogFn(window.console.error),logFn[LOG_LEVEL_WARNING]=getLogFn(window.console.warn),logFn[LOG_LEVEL_INFO]=getLogFn(window.console.info),logFn[LOG_LEVEL_DEBUG]=getLogFn(window.console.debug))}(),instance}Debug.__dashjs_factory_name="Debug";var factory=_FactoryMaker2.default.getSingletonFactory(Debug);factory.LOG_LEVEL_NONE=0,factory.LOG_LEVEL_FATAL=LOG_LEVEL_FATAL,factory.LOG_LEVEL_ERROR=LOG_LEVEL_ERROR,factory.LOG_LEVEL_WARNING=LOG_LEVEL_WARNING,factory.LOG_LEVEL_INFO=LOG_LEVEL_INFO,factory.LOG_LEVEL_DEBUG=LOG_LEVEL_DEBUG,_FactoryMaker2.default.updateSingletonFactory(Debug.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1370:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _get=function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var events=new(function(_CoreEvents){function Events(){_classCallCheck(this,Events),_get(Object.getPrototypeOf(Events.prototype),"constructor",this).apply(this,arguments)}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Events,_CoreEvents),Events}(function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1461)).default));exports.default=events,module.exports=exports.default},1371:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function DashJSError(code,message,data){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DashJSError),this.code=code||null,this.message=message||null,this.data=data||null},module.exports=exports.default},1372:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var errors=new(function(_ErrorsBase){function Errors(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Errors),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(Errors.prototype),"constructor",this).call(this),this.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,this.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,this.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,this.SEGMENTS_UPDATE_FAILED_ERROR_CODE=13,this.SEGMENTS_UNAVAILABLE_ERROR_CODE=14,this.SEGMENT_BASE_LOADER_ERROR_CODE=15,this.TIME_SYNC_FAILED_ERROR_CODE=16,this.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,this.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,this.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,this.APPEND_ERROR_CODE=20,this.REMOVE_ERROR_CODE=21,this.DATA_UPDATE_FAILED_ERROR_CODE=22,this.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,this.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,this.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,this.DOWNLOAD_ERROR_ID_MANIFEST="manifest",this.DOWNLOAD_ERROR_ID_SIDX_CODE=26,this.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,this.DOWNLOAD_ERROR_ID_CONTENT="content",this.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,this.DOWNLOAD_ERROR_ID_INITIALIZATION="initialization",this.DOWNLOAD_ERROR_ID_XLINK_CODE=29,this.DOWNLOAD_ERROR_ID_XLINK="xlink",this.MANIFEST_ERROR_ID_CODEC_CODE=30,this.MANIFEST_ERROR_ID_PARSE_CODE=31,this.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,this.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,this.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,this.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,this.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",this.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",this.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",this.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",this.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",this.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segments",this.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize time",this.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",this.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",this.APPEND_ERROR_MESSAGE="chunk is not defined",this.REMOVE_ERROR_MESSAGE="buffer is not defined",this.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",this.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",this.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",this.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",this.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : "}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Errors,_ErrorsBase),Errors}(function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1432)).default));exports.default=errors,module.exports=exports.default},1373:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var HTTPRequest=function HTTPRequest(){_classCallCheck(this,HTTPRequest),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this._stream=null,this._tfinish=null,this._mediaduration=null,this._responseHeaders=null,this._serviceLocation=null};HTTPRequest.GET="GET",HTTPRequest.HEAD="HEAD",HTTPRequest.MPD_TYPE="MPD",HTTPRequest.XLINK_EXPANSION_TYPE="XLinkExpansion",HTTPRequest.INIT_SEGMENT_TYPE="InitializationSegment",HTTPRequest.INDEX_SEGMENT_TYPE="IndexSegment",HTTPRequest.MEDIA_SEGMENT_TYPE="MediaSegment",HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",HTTPRequest.OTHER_TYPE="other",exports.HTTPRequest=HTTPRequest,exports.HTTPRequestTrace=function HTTPRequestTrace(){_classCallCheck(this,HTTPRequestTrace),this.s=null,this.d=null,this.b=[]}},1374:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var constants=new(function(){function DashConstants(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DashConstants),this.init()}return _createClass(DashConstants,[{key:"init",value:function init(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight"}}]),DashConstants}());exports.default=constants,module.exports=exports.default},1375:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366)),PRIORITY={DEFAULT:.5,STRONG:1,WEAK:0};function SwitchRequest(q,r,p){return{quality:void 0===q?-1:q,reason:void 0===r?null:r,priority:function getPriority(p){var ret=PRIORITY.DEFAULT;return p!==PRIORITY.DEFAULT&&p!==PRIORITY.STRONG&&p!==PRIORITY.WEAK||(ret=p),ret}(p)}}SwitchRequest.__dashjs_factory_name="SwitchRequest";var factory=_coreFactoryMaker2.default.getClassFactory(SwitchRequest);factory.NO_CHANGE=-1,factory.PRIORITY=PRIORITY,_coreFactoryMaker2.default.updateClassFactory(SwitchRequest.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1376:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function URLUtils(){var resolveFunction=void 0,schemeRegex=/^[a-z][a-z0-9+\-.]*:/i,httpUrlRegex=/^https?:\/\//i,httpsUrlRegex=/^https:\/\//i,originRegex=/^([a-z][a-z0-9+\-.]*:\/\/[^\/]+)\/?/i,nativeURLResolver=function nativeURLResolver(url,baseUrl){try{return new window.URL(url,baseUrl).toString()}catch(e){return url}},dumbURLResolver=function dumbURLResolver(url,baseUrl){var baseUrlParseFunc=parseBaseUrl;if(!baseUrl)return url;if(!isRelative(url))return url;isPathAbsolute(url)&&(baseUrlParseFunc=parseOrigin),isSchemeRelative(url)&&(baseUrlParseFunc=parseScheme);var base=baseUrlParseFunc(baseUrl),joinChar="/"!==base.charAt(base.length-1)&&"/"!==url.charAt(0)?"/":"";return[base,url].join(joinChar)};function parseBaseUrl(url){var slashIndex=url.indexOf("/"),lastSlashIndex=url.lastIndexOf("/");return-1!==slashIndex?lastSlashIndex===slashIndex+1?url:(-1!==url.indexOf("?")&&(url=url.substring(0,url.indexOf("?"))),url.substring(0,lastSlashIndex+1)):""}function parseOrigin(url){var matches=url.match(originRegex);return matches?matches[1]:""}function parseScheme(url){var matches=url.match(schemeRegex);return matches?matches[0]:""}function isRelative(url){return!schemeRegex.test(url)}function isPathAbsolute(url){return isRelative(url)&&"/"===url.charAt(0)}function isSchemeRelative(url){return 0===url.indexOf("//")}return function setup(){try{new window.URL("x","http://y");resolveFunction=nativeURLResolver}catch(e){}finally{resolveFunction=resolveFunction||dumbURLResolver}}(),{parseBaseUrl:parseBaseUrl,parseOrigin:parseOrigin,parseScheme:parseScheme,isRelative:isRelative,isPathAbsolute:isPathAbsolute,isSchemeRelative:isSchemeRelative,isHTTPURL:function isHTTPURL(url){return httpUrlRegex.test(url)},isHTTPS:function isHTTPS(url){return httpsUrlRegex.test(url)},resolve:function resolve(url,baseUrl){return resolveFunction(url,baseUrl)}}}URLUtils.__dashjs_factory_name="URLUtils",exports.default=_coreFactoryMaker2.default.getSingletonFactory(URLUtils),module.exports=exports.default},1377:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_modelsFragmentModel2=_interopRequireDefault(__webpack_require__(1390)),_SourceBufferSink2=_interopRequireDefault(__webpack_require__(1423)),_PreBufferSink2=_interopRequireDefault(__webpack_require__(1486)),_AbrController2=_interopRequireDefault(__webpack_require__(1396)),_MediaController2=_interopRequireDefault(__webpack_require__(1410)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_utilsBoxParser2=_interopRequireDefault(__webpack_require__(1386)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_utilsInitCache2=_interopRequireDefault(__webpack_require__(1411)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_voMetricsHTTPRequest=__webpack_require__(1373);function BufferController(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),metricsModel=config.metricsModel,mediaPlayerModel=config.mediaPlayerModel,errHandler=config.errHandler,streamController=config.streamController,mediaController=config.mediaController,adapter=config.adapter,textController=config.textController,abrController=config.abrController,playbackController=config.playbackController,type=config.type,streamProcessor=config.streamProcessor,instance=void 0,logger=void 0,requiredQuality=void 0,isBufferingCompleted=void 0,bufferLevel=void 0,criticalBufferLevel=void 0,mediaSource=void 0,maxAppendedIndex=void 0,lastIndex=void 0,buffer=void 0,dischargeBuffer=void 0,bufferState=void 0,appendedBytesInfo=void 0,wallclockTicked=void 0,isPruningInProgress=void 0,initCache=void 0,seekStartTime=void 0,seekClearedBufferingCompleted=void 0,pendingPruningRanges=void 0,bufferResetInProgress=void 0,mediaChunk=void 0;function createBuffer(mediaInfo,oldBuffers){if(!initCache||!mediaInfo||!streamProcessor)return null;if(mediaSource)try{"function"==typeof(buffer=oldBuffers&&oldBuffers[type]?(0,_SourceBufferSink2.default)(context).create(mediaSource,mediaInfo,onAppended.bind(this),oldBuffers[type]):(0,_SourceBufferSink2.default)(context).create(mediaSource,mediaInfo,onAppended.bind(this))).getBuffer().initialize&&buffer.getBuffer().initialize(type,streamProcessor)}catch(e){logger.fatal("Caught error on create SourceBuffer: "+e),errHandler.mediaSourceError("Error creating "+type+" source buffer."),errHandler.error(new _voDashJSError2.default(_coreErrorsErrors2.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,_coreErrorsErrors2.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+type))}else buffer=(0,_PreBufferSink2.default)(context).create(onAppended.bind(this));return updateBufferTimestampOffset(streamProcessor.getRepresentationInfo(requiredQuality).MSETimeOffset),buffer}function onInitFragmentLoaded(e){e.fragmentModel===streamProcessor.getFragmentModel()&&(logger.info("Init fragment finished loading saving to",type+"'s init cache"),initCache.save(e.chunk),logger.debug("Append Init fragment",type," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality,", data size:",e.chunk.bytes.byteLength),appendToBuffer(e.chunk))}function onMediaFragmentLoaded(e){if(e.fragmentModel===streamProcessor.getFragmentModel()){var chunk=e.chunk,bytes=chunk.bytes,quality=chunk.quality,currentRepresentation=streamProcessor.getRepresentationInfo(quality),eventStreamMedia=adapter.getEventsFor(currentRepresentation.mediaInfo,streamProcessor),eventStreamTrack=adapter.getEventsFor(currentRepresentation,streamProcessor);if(eventStreamMedia&&eventStreamMedia.length>0||eventStreamTrack&&eventStreamTrack.length>0){var events=function handleInbandEvents(data,request,mediaInbandEvents,trackInbandEvents){for(var fragmentStartTime=Math.max(!request||isNaN(request.startTime)?0:request.startTime,0),eventStreams=[],events=[],inbandEvents=mediaInbandEvents.concat(trackInbandEvents),i=0,ln=inbandEvents.length;i<ln;i++)eventStreams[inbandEvents[i].schemeIdUri+"/"+inbandEvents[i].value]=inbandEvents[i];var eventBoxes=(0,_utilsBoxParser2.default)(context).getInstance().parse(data).getBoxes("emsg");for(i=0,ln=eventBoxes.length;i<ln;i++){var _event=adapter.getEvent(eventBoxes[i],eventStreams,fragmentStartTime);_event&&events.push(_event)}return events}(bytes,streamProcessor.getFragmentModel().getRequests({state:_modelsFragmentModel2.default.FRAGMENT_MODEL_EXECUTED,quality:quality,index:chunk.index})[0],eventStreamMedia,eventStreamTrack);streamProcessor.addInbandEvents(events)}if(bufferResetInProgress){mediaChunk=chunk;var ranges=buffer&&buffer.getAllBufferRanges();ranges&&ranges.length>0&&playbackController.getTimeToStreamEnd()>.5&&(logger.debug("Clearing buffer because track changed - "+(ranges.end(ranges.length-1)+.5)),clearBuffers([{start:0,end:ranges.end(ranges.length-1)+.5,force:!0}]))}else appendToBuffer(chunk)}}function appendToBuffer(chunk){buffer.append(chunk),chunk.mediaInfo.type===_constantsConstants2.default.VIDEO&&eventBus.trigger(_coreEventsEvents2.default.VIDEO_CHUNK_RECEIVED,{chunk:chunk})}function showBufferRanges(ranges){if(ranges&&ranges.length>0)for(var i=0,len=ranges.length;i<len;i++)logger.debug("Buffered Range for type:",type,":",ranges.start(i)," - ",ranges.end(i)," currentTime = ",playbackController.getTime())}function onAppended(e){if(e.error){if(22===e.error.code&&(criticalBufferLevel=.8*getTotalBufferedTime(),logger.warn("Quota exceeded for type: "+type+", Critical Buffer: "+criticalBufferLevel),criticalBufferLevel>0)){var bufferToKeep=Math.max(.2*criticalBufferLevel,1),bufferAhead=criticalBufferLevel-bufferToKeep;mediaPlayerModel.setBufferToKeep(parseFloat(bufferToKeep.toFixed(5))),mediaPlayerModel.setBufferAheadToKeep(parseFloat(bufferAhead.toFixed(5)))}22!==e.error.code&&hasEnoughSpaceToAppend()||(logger.warn("Clearing playback buffer to overcome quota exceed situation for type: "+type),eventBus.trigger(_coreEventsEvents2.default.QUOTA_EXCEEDED,{sender:instance,criticalBufferLevel:criticalBufferLevel}),pruneAllSafely())}else{(appendedBytesInfo=e.chunk)&&!isNaN(appendedBytesInfo.index)&&(maxAppendedIndex=Math.max(appendedBytesInfo.index,maxAppendedIndex),checkIfBufferingCompleted());var ranges=buffer.getAllBufferRanges();if(appendedBytesInfo.segmentType===_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE)showBufferRanges(ranges),onPlaybackProgression();else if(bufferResetInProgress){var currentTime=playbackController.getTime();logger.debug("AppendToBuffer seek target should be "+currentTime),streamProcessor.getScheduleController().setSeekTarget(currentTime),adapter.setIndexHandlerTime(streamProcessor,currentTime)}var dataEvent={sender:instance,quality:appendedBytesInfo.quality,startTime:appendedBytesInfo.start,index:appendedBytesInfo.index,bufferedRanges:ranges};appendedBytesInfo&&!appendedBytesInfo.endFragment?eventBus.trigger(_coreEventsEvents2.default.BYTES_APPENDED,dataEvent):appendedBytesInfo&&eventBus.trigger(_coreEventsEvents2.default.BYTES_APPENDED_END_FRAGMENT,dataEvent)}}function onQualityChanged(e){requiredQuality!==e.newQuality&&type===e.mediaType&&streamProcessor.getStreamInfo().id===e.streamInfo.id&&(updateBufferTimestampOffset(streamProcessor.getRepresentationInfo(e.newQuality).MSETimeOffset),requiredQuality=e.newQuality)}function onPlaybackSeeking(){isBufferingCompleted&&(seekClearedBufferingCompleted=!0,isBufferingCompleted=!1,lastIndex=Number.POSITIVE_INFINITY),type!==_constantsConstants2.default.FRAGMENTED_TEXT?pruneAllSafely():onPlaybackProgression()}function onPlaybackSeeked(){seekStartTime=void 0}function pruneAllSafely(){var ranges=function getAllRangesWithSafetyFactor(){var clearRanges=[],ranges=buffer.getAllBufferRanges();if(!ranges||0===ranges.length)return clearRanges;var currentTime=playbackController.getTime(),endOfBuffer=ranges.end(ranges.length-1)+.5,currentTimeRequest=streamProcessor.getFragmentModel().getRequests({state:_modelsFragmentModel2.default.FRAGMENT_MODEL_EXECUTED,time:currentTime,threshold:.01})[0];if(currentTimeRequest){var behindRange={start:0,end:currentTimeRequest.startTime-.5},prevReq=streamProcessor.getFragmentModel().getRequests({state:_modelsFragmentModel2.default.FRAGMENT_MODEL_EXECUTED,time:currentTimeRequest.startTime-currentTimeRequest.duration/2,threshold:.01})[0];prevReq&&prevReq.startTime!=currentTimeRequest.startTime&&(behindRange.end=prevReq.startTime),behindRange.start<behindRange.end&&behindRange.end>ranges.start(0)&&clearRanges.push(behindRange);var aheadRange={start:currentTimeRequest.startTime+currentTimeRequest.duration+.5,end:endOfBuffer},nextReq=streamProcessor.getFragmentModel().getRequests({state:_modelsFragmentModel2.default.FRAGMENT_MODEL_EXECUTED,time:currentTimeRequest.startTime+currentTimeRequest.duration+.5,threshold:.01})[0];nextReq&&nextReq.startTime!==currentTimeRequest.startTime&&(aheadRange.start=nextReq.startTime+nextReq.duration+.5),aheadRange.start<aheadRange.end&&aheadRange.start<endOfBuffer&&clearRanges.push(aheadRange)}else logger.debug("getAllRangesWithSafetyFactor for",type,"- No request found in current time position, removing full buffer 0 -",endOfBuffer),clearRanges.push({start:0,end:endOfBuffer});return clearRanges}();ranges&&0!==ranges.length||onPlaybackProgression(),clearBuffers(ranges)}function onPlaybackProgression(){(!bufferResetInProgress||type===_constantsConstants2.default.FRAGMENTED_TEXT&&textController.isTextEnabled())&&(updateBufferLevel(),addBufferMetrics())}function onPlaybackStalled(){checkIfSufficientBuffer()}function onPlaybackPlaying(){checkIfSufficientBuffer()}function getRangeAt(time,tolerance){var ranges=buffer.getAllBufferRanges(),start=0,end=0,firstStart=null,lastEnd=null,gap=0,len=void 0,i=void 0,toler=tolerance||.15;if(null!=ranges){for(i=0,len=ranges.length;i<len;i++)if(start=ranges.start(i),end=ranges.end(i),null===firstStart)gap=Math.abs(start-time),time>=start&&time<end?(firstStart=start,lastEnd=end):gap<=toler&&(firstStart=start,lastEnd=end);else{if(!((gap=start-lastEnd)<=toler))break;lastEnd=end}if(null!==firstStart)return{start:firstStart,end:lastEnd}}return null}function updateBufferLevel(){playbackController&&(bufferLevel=function getBufferLength(time,tolerance){var range;return null===(range=getRangeAt(time,tolerance))?0:range.end-time}(function getWorkingTime(){var ret=playbackController.getTime();if(seekStartTime){var ranges=buffer.getAllBufferRanges();ranges&&ranges.length&&(ret=Math.max(ranges.start(0),seekStartTime))}return ret}()||0),eventBus.trigger(_coreEventsEvents2.default.BUFFER_LEVEL_UPDATED,{sender:instance,bufferLevel:bufferLevel}),checkIfSufficientBuffer())}function addBufferMetrics(){(function isActive(){return streamProcessor&&streamController&&streamProcessor.getStreamInfo()})()&&(metricsModel.addBufferState(type,bufferState,streamProcessor.getScheduleController().getBufferTarget()),metricsModel.addBufferLevel(type,new Date,1e3*bufferLevel))}function checkIfBufferingCompleted(){maxAppendedIndex>=lastIndex-1&&!isBufferingCompleted&&void 0===buffer.discharge&&(isBufferingCompleted=!0,logger.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED"),eventBus.trigger(_coreEventsEvents2.default.BUFFERING_COMPLETED,{sender:instance,streamInfo:streamProcessor.getStreamInfo()}))}function checkIfSufficientBuffer(){"audio"!==type&&"video"!==type||(seekClearedBufferingCompleted&&!isBufferingCompleted&&playbackController&&playbackController.getTimeToStreamEnd()-bufferLevel<.5&&(seekClearedBufferingCompleted=!1,isBufferingCompleted=!0,logger.debug("checkIfSufficientBuffer trigger BUFFERING_COMPLETED"),eventBus.trigger(_coreEventsEvents2.default.BUFFERING_COMPLETED,{sender:instance,streamInfo:streamProcessor.getStreamInfo()})),(!mediaPlayerModel.getLowLatencyEnabled()&&bufferLevel<.5||0===bufferLevel)&&!isBufferingCompleted?notifyBufferStateChanged("bufferStalled"):(isBufferingCompleted||bufferLevel>=mediaPlayerModel.getStableBufferTime())&&notifyBufferStateChanged("bufferLoaded"))}function notifyBufferStateChanged(state){bufferState===state||"bufferStalled"===state&&0===playbackController.getTime()||type===_constantsConstants2.default.FRAGMENTED_TEXT&&!textController.isTextEnabled()||(bufferState=state,addBufferMetrics(),eventBus.trigger(_coreEventsEvents2.default.BUFFER_LEVEL_STATE_CHANGED,{sender:instance,state:state,mediaType:type,streamInfo:streamProcessor.getStreamInfo()}),eventBus.trigger("bufferLoaded"===state?_coreEventsEvents2.default.BUFFER_LOADED:_coreEventsEvents2.default.BUFFER_EMPTY,{mediaType:type}),logger.debug("bufferLoaded"===state?"Got enough buffer to start for "+type:"Waiting for more buffer before starting playback for "+type))}function pruneBuffer(){buffer&&type!==_constantsConstants2.default.FRAGMENTED_TEXT&&(isBufferingCompleted||clearBuffers(function getClearRanges(){var clearRanges=[],ranges=buffer.getAllBufferRanges();if(!ranges||0===ranges.length)return clearRanges;var currentTime=playbackController.getTime(),rangeToKeep={start:Math.max(0,currentTime-mediaPlayerModel.getBufferToKeep()),end:currentTime+mediaPlayerModel.getBufferAheadToKeep()},currentTimeRequest=streamProcessor.getFragmentModel().getRequests({state:_modelsFragmentModel2.default.FRAGMENT_MODEL_EXECUTED,time:currentTime,threshold:.01})[0];if(currentTimeRequest)rangeToKeep.start=Math.min(currentTimeRequest.startTime,rangeToKeep.start),rangeToKeep.end=Math.max(currentTimeRequest.startTime+currentTimeRequest.duration,rangeToKeep.end);else if(0===currentTime&&playbackController.getIsDynamic())return[];if(ranges.start(0)<=rangeToKeep.start){for(var behindRange={start:0,end:rangeToKeep.start},i=0;i<ranges.length&&ranges.end(i)<=rangeToKeep.start;i++)behindRange.end=ranges.end(i);behindRange.start<behindRange.end&&clearRanges.push(behindRange)}if(ranges.end(ranges.length-1)>=rangeToKeep.end){var aheadRange={start:rangeToKeep.end,end:ranges.end(ranges.length-1)+.01};aheadRange.start<aheadRange.end&&clearRanges.push(aheadRange)}return clearRanges}()))}function clearBuffers(ranges){ranges&&buffer&&0!==ranges.length&&(pendingPruningRanges.push.apply(pendingPruningRanges,ranges),isPruningInProgress||clearNextRange())}function clearNextRange(){if(0===pendingPruningRanges.length||!buffer)return logger.debug("Nothing to prune, halt pruning"),pendingPruningRanges=[],void(isPruningInProgress=!1);var sourceBuffer=buffer.getBuffer();if(!sourceBuffer||!sourceBuffer.buffered||0===sourceBuffer.buffered.length)return logger.debug("SourceBuffer is empty (or does not exist), halt pruning"),pendingPruningRanges=[],void(isPruningInProgress=!1);var range=pendingPruningRanges.shift();logger.debug("Removing",type,"buffer from:",range.start,"to",range.end),isPruningInProgress=!0;var currentTime=playbackController.getTime();currentTime<range.end&&(isBufferingCompleted=!1,maxAppendedIndex=0,bufferResetInProgress||(streamProcessor.getScheduleController().setSeekTarget(currentTime),adapter.setIndexHandlerTime(streamProcessor,currentTime))),buffer.remove(range.start,range.end,range.force)}function onRemoved(e){buffer===e.buffer&&(logger.debug("onRemoved buffer from:",e.from,"to",e.to),showBufferRanges(buffer.getAllBufferRanges()),0===pendingPruningRanges.length&&(isPruningInProgress=!1),e.unintended&&(logger.warn("Detected unintended removal from:",e.from,"to",e.to,"setting index handler time to",e.from),adapter.setIndexHandlerTime(streamProcessor,e.from)),isPruningInProgress?clearNextRange():(bufferResetInProgress?(bufferResetInProgress=!1,mediaChunk&&appendToBuffer(mediaChunk)):(logger.debug("onRemoved : call updateBufferLevel"),updateBufferLevel()),eventBus.trigger(_coreEventsEvents2.default.BUFFER_CLEARED,{sender:instance,from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:hasEnoughSpaceToAppend()})))}function updateBufferTimestampOffset(MSETimeOffset){buffer&&buffer.updateTimestampOffset&&buffer.updateTimestampOffset(MSETimeOffset)}function onDataUpdateCompleted(e){e.sender.getStreamProcessor()!==streamProcessor||e.error||updateBufferTimestampOffset(e.currentRepresentation.MSETimeOffset)}function onStreamCompleted(e){e.fragmentModel===streamProcessor.getFragmentModel()&&(lastIndex=e.request.index,checkIfBufferingCompleted())}function onCurrentTrackChanged(e){var ranges=buffer&&buffer.getAllBufferRanges();ranges&&e.newMediaInfo.type===type&&e.newMediaInfo.streamInfo.id===streamProcessor.getStreamInfo().id&&(logger.info("Track change asked"),mediaController.getSwitchMode(type)===_MediaController2.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&ranges&&ranges.length>0&&playbackController.getTimeToStreamEnd()>.5&&(isBufferingCompleted=!1,lastIndex=Number.POSITIVE_INFINITY))}function onWallclockTimeUpdated(){++wallclockTicked*(mediaPlayerModel.getWallclockTimeUpdateInterval()/1e3)>=mediaPlayerModel.getBufferPruningInterval()&&(wallclockTicked=0,pruneBuffer())}function onPlaybackRateChanged(){checkIfSufficientBuffer()}function setMediaSource(value,mediaInfo){mediaSource=value,buffer&&mediaInfo&&"function"==typeof buffer.discharge&&(dischargeBuffer=buffer,createBuffer(mediaInfo))}function getTotalBufferedTime(){var ln,ranges=buffer.getAllBufferRanges(),totalBufferedTime=0,i=void 0;if(!ranges)return totalBufferedTime;for(i=0,ln=ranges.length;i<ln;i++)totalBufferedTime+=ranges.end(i)-ranges.start(i);return totalBufferedTime}function hasEnoughSpaceToAppend(){return getTotalBufferedTime()<criticalBufferLevel}function resetInitialSettings(errored,keepBuffers){criticalBufferLevel=Number.POSITIVE_INFINITY,bufferState=void 0,requiredQuality=_AbrController2.default.QUALITY_DEFAULT,lastIndex=Number.POSITIVE_INFINITY,maxAppendedIndex=0,appendedBytesInfo=null,isBufferingCompleted=!1,isPruningInProgress=!1,seekClearedBufferingCompleted=!1,bufferLevel=0,wallclockTicked=0,pendingPruningRanges=[],buffer&&(errored||buffer.abort(),buffer.reset(keepBuffers),buffer=null),bufferResetInProgress=!1}return instance={getBufferControllerType:function getBufferControllerType(){return"BufferController"},initialize:function initialize(Source){setMediaSource(Source),requiredQuality=abrController.getQualityFor(type,streamProcessor.getStreamInfo()),eventBus.on(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,onDataUpdateCompleted,this),eventBus.on(_coreEventsEvents2.default.INIT_FRAGMENT_LOADED,onInitFragmentLoaded,this),eventBus.on(_coreEventsEvents2.default.MEDIA_FRAGMENT_LOADED,onMediaFragmentLoaded,this),eventBus.on(_coreEventsEvents2.default.QUALITY_CHANGE_REQUESTED,onQualityChanged,this),eventBus.on(_coreEventsEvents2.default.STREAM_COMPLETED,onStreamCompleted,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_PLAYING,onPlaybackPlaying,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_PROGRESS,onPlaybackProgression,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_TIME_UPDATED,onPlaybackProgression,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_RATE_CHANGED,onPlaybackRateChanged,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_SEEKING,onPlaybackSeeking,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_SEEKED,onPlaybackSeeked,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_STALLED,onPlaybackStalled,this),eventBus.on(_coreEventsEvents2.default.WALLCLOCK_TIME_UPDATED,onWallclockTimeUpdated,this),eventBus.on(_coreEventsEvents2.default.CURRENT_TRACK_CHANGED,onCurrentTrackChanged,this,_coreEventBus2.default.EVENT_PRIORITY_HIGH),eventBus.on(_coreEventsEvents2.default.SOURCEBUFFER_REMOVE_COMPLETED,onRemoved,this)},createBuffer:createBuffer,dischargePreBuffer:function dischargePreBuffer(){if(buffer&&dischargeBuffer&&"function"==typeof dischargeBuffer.discharge){var ranges=dischargeBuffer.getAllBufferRanges();if(ranges.length>0){for(var rangeStr="Beginning "+type+"PreBuffer discharge, adding buffer for:",i=0;i<ranges.length;i++)rangeStr+=" start: "+ranges.start(i)+", end: "+ranges.end(i)+";";logger.debug(rangeStr)}else logger.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");for(var chunks=dischargeBuffer.discharge(),lastInit=null,j=0;j<chunks.length;j++){var chunk=chunks[j],initChunk=initCache.extract(chunk.streamId,chunk.representationId);initChunk&&(lastInit!==initChunk&&(buffer.append(initChunk),lastInit=initChunk),buffer.append(chunk))}dischargeBuffer.reset(),dischargeBuffer=null}},getType:function getType(){return type},getStreamProcessor:function getStreamProcessor(){return streamProcessor},setSeekStartTime:function setSeekStartTime(value){seekStartTime=value},getBuffer:function getBuffer(){return buffer},setBuffer:function setBuffer(newBuffer){buffer=newBuffer},getBufferLevel:function getBufferLevel(){return bufferLevel},getRangeAt:getRangeAt,setMediaSource:setMediaSource,getMediaSource:function getMediaSource(){return mediaSource},getIsBufferingCompleted:function getIsBufferingCompleted(){return isBufferingCompleted},switchInitData:function switchInitData(streamId,representationId,bufferResetEnabled){var chunk=initCache.extract(streamId,representationId);bufferResetInProgress=!0===bufferResetEnabled&&bufferResetEnabled,chunk?(logger.info("Append Init fragment",type," with representationId:",chunk.representationId," and quality:",chunk.quality,", data size:",chunk.bytes.byteLength),appendToBuffer(chunk)):eventBus.trigger(_coreEventsEvents2.default.INIT_REQUESTED,{sender:instance})},getIsPruningInProgress:function getIsPruningInProgress(){return isPruningInProgress},reset:function reset(errored,keepBuffers){eventBus.off(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,onDataUpdateCompleted,this),eventBus.off(_coreEventsEvents2.default.QUALITY_CHANGE_REQUESTED,onQualityChanged,this),eventBus.off(_coreEventsEvents2.default.INIT_FRAGMENT_LOADED,onInitFragmentLoaded,this),eventBus.off(_coreEventsEvents2.default.MEDIA_FRAGMENT_LOADED,onMediaFragmentLoaded,this),eventBus.off(_coreEventsEvents2.default.STREAM_COMPLETED,onStreamCompleted,this),eventBus.off(_coreEventsEvents2.default.CURRENT_TRACK_CHANGED,onCurrentTrackChanged,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_PLAYING,onPlaybackPlaying,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_PROGRESS,onPlaybackProgression,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_TIME_UPDATED,onPlaybackProgression,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_RATE_CHANGED,onPlaybackRateChanged,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_SEEKING,onPlaybackSeeking,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_SEEKED,onPlaybackSeeked,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_STALLED,onPlaybackStalled,this),eventBus.off(_coreEventsEvents2.default.WALLCLOCK_TIME_UPDATED,onWallclockTimeUpdated,this),eventBus.off(_coreEventsEvents2.default.SOURCEBUFFER_REMOVE_COMPLETED,onRemoved,this),resetInitialSettings(errored,keepBuffers)}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),initCache=(0,_utilsInitCache2.default)(context).getInstance(),resetInitialSettings()}(),instance}BufferController.__dashjs_factory_name="BufferController";var factory=_coreFactoryMaker2.default.getClassFactory(BufferController);factory.BUFFER_LOADED="bufferLoaded",factory.BUFFER_EMPTY="bufferStalled",_coreFactoryMaker2.default.updateClassFactory(BufferController.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1378:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FragmentRequest=function FragmentRequest(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FragmentRequest),this.action=FragmentRequest.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null};FragmentRequest.ACTION_DOWNLOAD="download",FragmentRequest.ACTION_COMPLETE="complete",exports.default=FragmentRequest,module.exports=exports.default},1379:function(module,exports,__webpack_require__){"use strict";var pna=__webpack_require__(1395),objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var util=Object.create(__webpack_require__(1387));util.inherits=__webpack_require__(1384);var Readable=__webpack_require__(1427),Writable=__webpack_require__(1408);util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),options&&!1===options.readable&&(this.readable=!1),options&&!1===options.writable&&(this.writable=!1),this.allowHalfOpen=!0,options&&!1===options.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||pna.nextTick(onEndNT,this)}function onEndNT(self){self.end()}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(value){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=value,this._writableState.destroyed=value)}}),Duplex.prototype._destroy=function(err,cb){this.push(null),this.end(),pna.nextTick(cb,err)}},1380:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unescapeDollarsInTemplate=function unescapeDollarsInTemplate(url){return url?url.split("$$").join("$"):url},exports.replaceIDForTemplate=function replaceIDForTemplate(url,value){if(!value||!url||-1===url.indexOf("$RepresentationID$"))return url;var v=value.toString();return url.split("$RepresentationID$").join(v)},exports.replaceTokenForTemplate=replaceTokenForTemplate,exports.getIndexBasedSegment=function getIndexBasedSegment(timelineConverter,isDynamic,representation,index){var presentationStartTime,presentationEndTime,seg=void 0,duration=void 0;duration=representation.segmentDuration,isNaN(duration)&&(duration=representation.adaptation.period.duration);return presentationStartTime=parseFloat((representation.adaptation.period.start+index*duration).toFixed(5)),presentationEndTime=parseFloat((presentationStartTime+duration).toFixed(5)),(seg=new _voSegment2.default).representation=representation,seg.duration=duration,seg.presentationStartTime=presentationStartTime,seg.mediaStartTime=timelineConverter.calcMediaTimeFromPresentationTime(seg.presentationStartTime,representation),seg.availabilityStartTime=timelineConverter.calcAvailabilityStartTimeFromPresentationTime(seg.presentationStartTime,representation.adaptation.period.mpd,isDynamic),seg.availabilityEndTime=timelineConverter.calcAvailabilityEndTimeFromPresentationTime(presentationEndTime,representation.adaptation.period.mpd,isDynamic),seg.wallStartTime=timelineConverter.calcWallTimeForSegment(seg,isDynamic),seg.replacementNumber=getNumberForSegment(seg,index),seg.availabilityIdx=index,seg},exports.getTimeBasedSegment=function getTimeBasedSegment(timelineConverter,isDynamic,representation,time,duration,fTimescale,url,range,index,tManifest){var presentationStartTime,presentationEndTime,scaledTime=time/fTimescale,scaledDuration=Math.min(duration/fTimescale,representation.adaptation.period.mpd.maxSegmentDuration),seg=void 0;return presentationStartTime=timelineConverter.calcPresentationTimeFromMediaTime(scaledTime,representation),presentationEndTime=presentationStartTime+scaledDuration,(seg=new _voSegment2.default).representation=representation,seg.duration=scaledDuration,seg.mediaStartTime=scaledTime,seg.presentationStartTime=presentationStartTime,seg.availabilityStartTime=representation.adaptation.period.mpd.manifest.loadedTime,seg.availabilityEndTime=timelineConverter.calcAvailabilityEndTimeFromPresentationTime(presentationEndTime,representation.adaptation.period.mpd,isDynamic),seg.wallStartTime=timelineConverter.calcWallTimeForSegment(seg,isDynamic),seg.replacementTime=tManifest||time,seg.replacementNumber=getNumberForSegment(seg,index),url=replaceTokenForTemplate(url,"Number",seg.replacementNumber),url=replaceTokenForTemplate(url,"Time",seg.replacementTime),seg.media=url,seg.mediaRange=range,seg.availabilityIdx=index,seg},exports.getSegmentByIndex=getSegmentByIndex,exports.decideSegmentListRangeForTemplate=function decideSegmentListRangeForTemplate(timelineConverter,isDynamic,representation,requestedTime,index,givenAvailabilityUpperLimit){var duration=representation.segmentDuration,minBufferTime=representation.adaptation.period.mpd.manifest.minBufferTime,availabilityWindow=representation.segmentAvailabilityRange,periodRelativeRange={start:timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(representation,availabilityWindow?availabilityWindow.start:NaN),end:timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(representation,availabilityWindow?availabilityWindow.end:NaN)},currentSegmentList=representation.segments,availabilityLowerLimit=2*duration,availabilityUpperLimit=givenAvailabilityUpperLimit||Math.max(2*minBufferTime,10*duration),originAvailabilityTime=NaN,originSegment=null,start=void 0,end=void 0;if(periodRelativeRange.start=Math.max(periodRelativeRange.start,0),isDynamic&&!timelineConverter.isTimeSyncCompleted())return start=Math.floor(periodRelativeRange.start/duration),end=Math.floor(periodRelativeRange.end/duration),{start:start,end:end};currentSegmentList&&currentSegmentList.length>0?(originSegment=getSegmentByIndex(index,representation),originAvailabilityTime=originSegment?timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(representation,originSegment.presentationStartTime):index>0?index*duration:timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(representation,requestedTime)):originAvailabilityTime=index>0?index*duration:isDynamic?periodRelativeRange.end:periodRelativeRange.start;return start=Math.floor(Math.max(originAvailabilityTime-availabilityLowerLimit,periodRelativeRange.start)/duration),end=Math.floor(Math.min(start+availabilityUpperLimit/duration,periodRelativeRange.end/duration)),{start:start,end:end}};var _voSegment2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1412));function zeroPadToLength(numStr,minStrLength){for(;numStr.length<minStrLength;)numStr="0"+numStr;return numStr}function getNumberForSegment(segment,segmentIndex){return segment.representation.startNumber+segmentIndex}function replaceTokenForTemplate(url,token,value){var startPos=void 0,endPos=void 0,formatTagPos=void 0,specifier=void 0,width=void 0,paddedValue=void 0,tokenLen=token.length,formatTagLen="%0".length;if(!url)return url;for(;;){if((startPos=url.indexOf("$"+token))<0)return url;if((endPos=url.indexOf("$",startPos+tokenLen))<0)return url;if((formatTagPos=url.indexOf("%0",startPos+tokenLen))>startPos&&formatTagPos<endPos)switch(specifier=url.charAt(endPos-1),width=parseInt(url.substring(formatTagPos+formatTagLen,endPos-1),10),specifier){case"d":case"i":case"u":paddedValue=zeroPadToLength(value.toString(),width);break;case"x":paddedValue=zeroPadToLength(value.toString(16),width);break;case"X":paddedValue=zeroPadToLength(value.toString(16),width).toUpperCase();break;case"o":paddedValue=zeroPadToLength(value.toString(8),width);break;default:return url}else paddedValue=value;url=url.substring(0,startPos)+paddedValue+url.substring(endPos+1)}}function getSegmentByIndex(index,representation){if(!representation||!representation.segments)return null;var ln=representation.segments.length,seg=void 0,i=void 0;if(index<ln&&(seg=representation.segments[index])&&seg.availabilityIdx===index)return seg;for(i=0;i<ln;i++)if((seg=representation.segments[i])&&seg.availabilityIdx===index)return seg;return null}},1381:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var constants=new(function(){function ProtectionConstants(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ProtectionConstants),this.init()}return _createClass(ProtectionConstants,[{key:"init",value:function init(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready"}}]),ProtectionConstants}());exports.default=constants,module.exports=exports.default},1382:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var constants=new(function(){function MetricsConstants(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MetricsConstants),this.init()}return _createClass(MetricsConstants,[{key:"init",value:function init(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors"}}]),MetricsConstants}());exports.default=constants,module.exports=exports.default},1383:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkParameterType=function checkParameterType(parameter,type){if(typeof parameter!==type)throw _constantsConstants2.default.BAD_ARGUMENT_ERROR},exports.checkInteger=function checkInteger(parameter){if(null===parameter||isNaN(parameter)||parameter%1!=0)throw _constantsConstants2.default.BAD_ARGUMENT_ERROR+" : argument is not an integer"},exports.checkRange=function checkRange(parameter,min,max){if(parameter<min||parameter>max)throw _constantsConstants2.default.BAD_ARGUMENT_ERROR+" : argument out of range"},exports.checkIsVideoOrAudioType=function checkIsVideoOrAudioType(type){if("string"!=typeof type||type!==_constantsConstants2.default.AUDIO&&type!==_constantsConstants2.default.VIDEO)throw _constantsConstants2.default.BAD_ARGUMENT_ERROR};var _constantsConstants2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1367))},1384:function(module,exports){"function"==typeof Object.create?module.exports=function inherits(ctor,superCtor){superCtor&&(ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}}))}:module.exports=function inherits(ctor,superCtor){if(superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}}},1385:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var CommonEncryption=function(){function CommonEncryption(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CommonEncryption)}return _createClass(CommonEncryption,null,[{key:"findCencContentProtection",value:function findCencContentProtection(cpArray){for(var retVal=null,i=0;i<cpArray.length;++i){var cp=cpArray[i];"urn:mpeg:dash:mp4protection:2011"===cp.schemeIdUri.toLowerCase()&&"cenc"===cp.value.toLowerCase()&&(retVal=cp)}return retVal}},{key:"getPSSHData",value:function getPSSHData(pssh){var offset=8,view=new DataView(pssh),version=view.getUint8(offset);return offset+=20,version>0&&(offset+=4+16*view.getUint32(offset)),offset+=4,pssh.slice(offset)}},{key:"getPSSHForKeySystem",value:function getPSSHForKeySystem(keySystem,initData){var psshList=CommonEncryption.parsePSSHList(initData);return psshList.hasOwnProperty(keySystem.uuid.toLowerCase())?psshList[keySystem.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function parseInitDataFromContentProtection(cpData,BASE64){return"pssh"in cpData?BASE64.decodeArray(cpData.pssh.__text).buffer:null}},{key:"parsePSSHList",value:function parsePSSHList(data){if(null===data)return[];for(var dv=new DataView(data.buffer||data),pssh={},byteCursor=0;;){var nextBox,version,systemID=void 0,boxStart=byteCursor;if(byteCursor>=dv.buffer.byteLength)break;if(nextBox=byteCursor+dv.getUint32(byteCursor),byteCursor+=4,1886614376===dv.getUint32(byteCursor))if(byteCursor+=4,0===(version=dv.getUint8(byteCursor))||1===version){byteCursor++,byteCursor+=3,systemID="";var i=void 0,val=void 0;for(i=0;i<4;i++)systemID+=1===(val=dv.getUint8(byteCursor+i).toString(16)).length?"0"+val:val;for(byteCursor+=4,systemID+="-",i=0;i<2;i++)systemID+=1===(val=dv.getUint8(byteCursor+i).toString(16)).length?"0"+val:val;for(byteCursor+=2,systemID+="-",i=0;i<2;i++)systemID+=1===(val=dv.getUint8(byteCursor+i).toString(16)).length?"0"+val:val;for(byteCursor+=2,systemID+="-",i=0;i<2;i++)systemID+=1===(val=dv.getUint8(byteCursor+i).toString(16)).length?"0"+val:val;for(byteCursor+=2,systemID+="-",i=0;i<6;i++)systemID+=1===(val=dv.getUint8(byteCursor+i).toString(16)).length?"0"+val:val;byteCursor+=6,systemID=systemID.toLowerCase(),dv.getUint32(byteCursor),byteCursor+=4,pssh[systemID]=dv.buffer.slice(boxStart,nextBox),byteCursor=nextBox}else byteCursor=nextBox;else byteCursor=nextBox}return pssh}}]),CommonEncryption}();exports.default=CommonEncryption,module.exports=exports.default},1386:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_IsoFile2=_interopRequireDefault(__webpack_require__(1464)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_codemIsoboxer2=_interopRequireDefault(__webpack_require__(1402)),_voIsoBoxSearchInfo2=_interopRequireDefault(__webpack_require__(1466));function BoxParser(){var logger=void 0,instance=void 0,context=this.context;function parse(data){if(!data)return null;void 0===data.fileStart&&(data.fileStart=0);var parsedFile=_codemIsoboxer2.default.parseBuffer(data),dashIsoFile=(0,_IsoFile2.default)(context).create();return dashIsoFile.setData(parsedFile),dashIsoFile}function parseUint32(data,offset){return data[offset+3]>>>0|data[offset+2]<<8>>>0|data[offset+1]<<16>>>0|data[offset]<<24>>>0}function parseIsoBoxType(data,offset){return String.fromCharCode(data[offset++])+String.fromCharCode(data[offset++])+String.fromCharCode(data[offset++])+String.fromCharCode(data[offset])}return instance={parse:parse,findLastTopIsoBoxCompleted:function findLastTopIsoBoxCompleted(types,buffer,offset){if(void 0===offset&&(offset=0),!buffer||offset+8>=buffer.byteLength)return new _voIsoBoxSearchInfo2.default(0,!1);for(var data=buffer instanceof ArrayBuffer?new Uint8Array(buffer):buffer,boxInfo=void 0,lastCompletedOffset=0;offset<data.byteLength;){var boxSize=parseUint32(data,offset),boxType=parseIsoBoxType(data,offset+4);if(0===boxSize)break;offset+boxSize<=data.byteLength&&(types.indexOf(boxType)>=0?boxInfo=new _voIsoBoxSearchInfo2.default(offset,!0,boxSize):lastCompletedOffset=offset+boxSize),offset+=boxSize}return boxInfo||new _voIsoBoxSearchInfo2.default(lastCompletedOffset,!1)},getMediaTimescaleFromMoov:function getMediaTimescaleFromMoov(ab){var isoFile=parse(ab),mdhdBox=isoFile?isoFile.getBox("mdhd"):void 0;return mdhdBox?mdhdBox.timescale:NaN},getSamplesInfo:function getSamplesInfo(ab){if(!ab||0===ab.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var lastSequenceNumber,numSequences,isoFile=parse(ab),moofBoxes=isoFile.getBoxes("moof"),mfhdBoxes=isoFile.getBoxes("mfhd"),sampleDuration=void 0,sampleCount=void 0,sampleSize=void 0,sampleDts=void 0,sampleList=void 0,sample=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,dataOffset=void 0,totalDuration=void 0;numSequences=isoFile.getBoxes("moof").length,lastSequenceNumber=mfhdBoxes[mfhdBoxes.length-1].sequence_number,sampleCount=0,sampleList=[];var subsIndex=-1,nextSubsSample=-1;for(l=0;l<moofBoxes.length;l++){var moofBox=moofBoxes[l],trafBoxes=moofBox.getChildBoxes("traf");for(j=0;j<trafBoxes.length;j++){var trafBox=trafBoxes[j],tfhdBox=trafBox.getChildBox("tfhd"),tfdtBox=trafBox.getChildBox("tfdt");sampleDts=tfdtBox.baseMediaDecodeTime;var trunBoxes=trafBox.getChildBoxes("trun"),subsBoxes=trafBox.getChildBoxes("subs");for(k=0;k<trunBoxes.length;k++){var trunBox=trunBoxes[k];for(sampleCount=trunBox.sample_count,dataOffset=(tfhdBox.base_data_offset||0)+(trunBox.data_offset||0),i=0;i<sampleCount;i++){sampleDuration=void 0!==(sample=trunBox.samples[i]).sample_duration?sample.sample_duration:tfhdBox.default_sample_duration,sampleSize=void 0!==sample.sample_size?sample.sample_size:tfhdBox.default_sample_size;var sampleData={dts:sampleDts,cts:sampleDts+(void 0!==sample.sample_composition_time_offset?sample.sample_composition_time_offset:0),duration:sampleDuration,offset:moofBox.offset+dataOffset,size:sampleSize,subSizes:[sampleSize]};if(subsBoxes)for(m=0;m<subsBoxes.length;m++){var subsBox=subsBoxes[m];if(subsIndex<subsBox.entry_count-1&&i>nextSubsSample&&(subsIndex++,nextSubsSample+=subsBox.entries[subsIndex].sample_delta),i==nextSubsSample){sampleData.subSizes=[];var entry=subsBox.entries[subsIndex];for(n=0;n<entry.subsample_count;n++)sampleData.subSizes.push(entry.subsamples[n].subsample_size)}}sampleList.push(sampleData),dataOffset+=sampleSize,sampleDts+=sampleDuration}}totalDuration=sampleDts-tfdtBox.baseMediaDecodeTime}}return{sampleList:sampleList,lastSequenceNumber:lastSequenceNumber,totalDuration:totalDuration,numSequences:numSequences}},findInitRange:function findInitRange(data){var initRange=null,isoFile=parse(data);if(!isoFile)return initRange;var ftyp=isoFile.getBox("ftyp"),moov=isoFile.getBox("moov");return logger.debug("Searching for initialization."),moov&&moov.isComplete&&(initRange=(ftyp?ftyp.offset:moov.offset)+"-"+(moov.offset+moov.size-1),logger.debug("Found the initialization.  Range: "+initRange)),initRange}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}BoxParser.__dashjs_factory_name="BoxParser",exports.default=_coreFactoryMaker2.default.getSingletonFactory(BoxParser),module.exports=exports.default},1387:function(module,exports,__webpack_require__){(function(Buffer){function objectToString(o){return Object.prototype.toString.call(o)}exports.isArray=function isArray(arg){return Array.isArray?Array.isArray(arg):"[object Array]"===objectToString(arg)},exports.isBoolean=function isBoolean(arg){return"boolean"==typeof arg},exports.isNull=function isNull(arg){return null===arg},exports.isNullOrUndefined=function isNullOrUndefined(arg){return null==arg},exports.isNumber=function isNumber(arg){return"number"==typeof arg},exports.isString=function isString(arg){return"string"==typeof arg},exports.isSymbol=function isSymbol(arg){return"symbol"==typeof arg},exports.isUndefined=function isUndefined(arg){return void 0===arg},exports.isRegExp=function isRegExp(re){return"[object RegExp]"===objectToString(re)},exports.isObject=function isObject(arg){return"object"==typeof arg&&null!==arg},exports.isDate=function isDate(d){return"[object Date]"===objectToString(d)},exports.isError=function isError(e){return"[object Error]"===objectToString(e)||e instanceof Error},exports.isFunction=function isFunction(arg){return"function"==typeof arg},exports.isPrimitive=function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg},exports.isBuffer=Buffer.isBuffer}).call(this,__webpack_require__(1394).Buffer)},1388:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(exports,"__esModule",{value:!0});var _XHRLoader2=_interopRequireDefault(__webpack_require__(1414)),_FetchLoader2=_interopRequireDefault(__webpack_require__(1512)),_voMetricsHTTPRequest=__webpack_require__(1373),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371));function HTTPLoader(cfg){cfg=cfg||{};var instance,context=this.context,errHandler=cfg.errHandler,metricsModel=cfg.metricsModel,mediaPlayerModel=cfg.mediaPlayerModel,requestModifier=cfg.requestModifier,boxParser=cfg.boxParser,useFetch=cfg.useFetch||!1,requests=void 0,delayedRequests=void 0,retryRequests=void 0,downloadErrorToRequestTypeMap=void 0,newDownloadErrorToRequestTypeMap=void 0;return instance={load:function load(config){config.request&&function internalLoad(config,remainingAttempts){var request=config.request,traces=[],firstProgress=!0,needFailureReport=!0,requestStartTime=new Date,lastTraceTime=requestStartTime,lastTraceReceivedCount=0,httpRequest=void 0;if(!requestModifier||!metricsModel||!errHandler)throw new Error("config object is not correct or missing");var handleLoaded=function handleLoaded(success){needFailureReport=!1,request.requestStartDate=requestStartTime,request.requestEndDate=new Date,request.firstByteDate=request.firstByteDate||requestStartTime,request.checkExistenceOnly||(metricsModel.addHttpRequest(request.mediaType,null,request.type,request.url,httpRequest.response?httpRequest.response.responseURL:null,request.serviceLocation||null,request.range||null,request.requestStartDate,request.firstByteDate,request.requestEndDate,httpRequest.response?httpRequest.response.status:null,request.duration,httpRequest.response&&httpRequest.response.getAllResponseHeaders?httpRequest.response.getAllResponseHeaders():httpRequest.response?httpRequest.response.responseHeaders:[],success?traces:null),request.type===_voMetricsHTTPRequest.HTTPRequest.MPD_TYPE&&metricsModel.addManifestUpdate("stream",request.type,request.requestStartDate,request.requestEndDate))},onloadend=function onloadend(){-1!==requests.indexOf(httpRequest)&&(requests.splice(requests.indexOf(httpRequest),1),needFailureReport&&(handleLoaded(!1),remainingAttempts>0?function(){remainingAttempts--;var retryRequest={config:config};retryRequests.push(retryRequest),retryRequest.timeout=setTimeout((function(){-1!==retryRequests.indexOf(retryRequest)&&(retryRequests.splice(retryRequests.indexOf(retryRequest),1),internalLoad(config,remainingAttempts))}),mediaPlayerModel.getRetryIntervalForType(request.type))}():(errHandler.downloadError(downloadErrorToRequestTypeMap[request.type],request.url,request),errHandler.error(new _voDashJSError2.default(newDownloadErrorToRequestTypeMap[request.type],request.url+" is not available",{request:request,response:httpRequest.response})),config.error&&config.error(request,"error",httpRequest.response.statusText),config.complete&&config.complete(request,httpRequest.response.statusText))))},loader=void 0;loader=useFetch&&window.fetch&&"arraybuffer"===request.responseType&&request.type===_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE?(0,_FetchLoader2.default)(context).create({requestModifier:requestModifier,boxParser:boxParser}):(0,_XHRLoader2.default)(context).create({requestModifier:requestModifier,boxParser:boxParser});var modifiedUrl=requestModifier.modifyRequestURL(request.url),verb=request.checkExistenceOnly?_voMetricsHTTPRequest.HTTPRequest.HEAD:_voMetricsHTTPRequest.HTTPRequest.GET,withCredentials=mediaPlayerModel.getXHRWithCredentialsForType(request.type);httpRequest={url:modifiedUrl,method:verb,withCredentials:withCredentials,request:request,onload:function onload(){httpRequest.response.status>=200&&httpRequest.response.status<=299&&(handleLoaded(!0),config.success&&config.success(httpRequest.response.response,httpRequest.response.statusText,httpRequest.response.responseURL),config.complete&&config.complete(request,httpRequest.response.statusText))},onend:onloadend,onerror:onloadend,progress:function progress(event){var currentTime=new Date;firstProgress&&(firstProgress=!1,(!event.lengthComputable||event.lengthComputable&&event.total!==event.loaded)&&(request.firstByteDate=currentTime)),event.lengthComputable&&(request.bytesLoaded=event.loaded,request.bytesTotal=event.total),event.noTrace||(traces.push({s:lastTraceTime,d:event.time?event.time:currentTime.getTime()-lastTraceTime.getTime(),b:[event.loaded?event.loaded-lastTraceReceivedCount:0]}),lastTraceTime=currentTime,lastTraceReceivedCount=event.loaded),config.progress&&event&&config.progress(event)},onabort:function onabort(){config.abort&&config.abort(request)},loader:loader};var delayedRequest,now=(new Date).getTime();isNaN(request.delayLoadingTime)||now>=request.delayLoadingTime?(requests.push(httpRequest),loader.load(httpRequest)):(delayedRequest={httpRequest:httpRequest},delayedRequests.push(delayedRequest),delayedRequest.delayTimeout=setTimeout((function(){if(-1!==delayedRequests.indexOf(delayedRequest)){delayedRequests.splice(delayedRequests.indexOf(delayedRequest),1);try{requestStartTime=new Date,lastTraceTime=requestStartTime,requests.push(delayedRequest.httpRequest),loader.load(delayedRequest.httpRequest)}catch(e){delayedRequest.httpRequest.onerror()}}}),request.delayLoadingTime-now))}(config,mediaPlayerModel.getRetryAttemptsForType(config.request.type))},abort:function abort(){retryRequests.forEach((function(t){clearTimeout(t.timeout),t.config.request&&t.config.abort&&t.config.abort(t.config.request)})),retryRequests=[],delayedRequests.forEach((function(x){return clearTimeout(x.delayTimeout)})),delayedRequests=[],requests.forEach((function(x){x.onloadend=x.onerror=x.onprogress=void 0,x.loader.abort(x),x.onabort()})),requests=[]}},function setup(){var _downloadErrorToRequestTypeMap,_newDownloadErrorToRequestTypeMap;requests=[],delayedRequests=[],retryRequests=[],_defineProperty(_downloadErrorToRequestTypeMap={},_voMetricsHTTPRequest.HTTPRequest.MPD_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_MANIFEST),_defineProperty(_downloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.XLINK_EXPANSION_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_XLINK),_defineProperty(_downloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.INIT_SEGMENT_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_INITIALIZATION),_defineProperty(_downloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_CONTENT),_defineProperty(_downloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.INDEX_SEGMENT_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_CONTENT),_defineProperty(_downloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_CONTENT),_defineProperty(_downloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.OTHER_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_CONTENT),downloadErrorToRequestTypeMap=_downloadErrorToRequestTypeMap,_defineProperty(_newDownloadErrorToRequestTypeMap={},_voMetricsHTTPRequest.HTTPRequest.MPD_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_MANIFEST_CODE),_defineProperty(_newDownloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.XLINK_EXPANSION_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_XLINK_CODE),_defineProperty(_newDownloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.INIT_SEGMENT_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),_defineProperty(_newDownloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_CONTENT_CODE),_defineProperty(_newDownloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.INDEX_SEGMENT_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_CONTENT_CODE),_defineProperty(_newDownloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_CONTENT_CODE),_defineProperty(_newDownloadErrorToRequestTypeMap,_voMetricsHTTPRequest.HTTPRequest.OTHER_TYPE,_coreErrorsErrors2.default.DOWNLOAD_ERROR_ID_CONTENT_CODE),newDownloadErrorToRequestTypeMap=_newDownloadErrorToRequestTypeMap}(),instance}HTTPLoader.__dashjs_factory_name="HTTPLoader";var factory=_coreFactoryMaker2.default.getClassFactory(HTTPLoader);exports.default=factory,module.exports=exports.default},1389:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var protectionErrors=new(function(_ErrorsBase){function ProtectionErrors(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ProtectionErrors),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(ProtectionErrors.prototype),"constructor",this).call(this),this.MEDIA_KEYERR_CODE=100,this.MEDIA_KEYERR_UNKNOWN_CODE=101,this.MEDIA_KEYERR_CLIENT_CODE=102,this.MEDIA_KEYERR_SERVICE_CODE=103,this.MEDIA_KEYERR_OUTPUT_CODE=104,this.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,this.MEDIA_KEYERR_DOMAIN_CODE=106,this.MEDIA_KEY_MESSAGE_ERROR_CODE=107,this.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,this.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,this.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,this.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,this.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,this.KEY_SESSION_CREATED_ERROR_CODE=113,this.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,this.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",this.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",this.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",this.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",this.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",this.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",this.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",this.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",this.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",this.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",this.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",this.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",this.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",this.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --"}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ProtectionErrors,_ErrorsBase),ProtectionErrors}(function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1432)).default));exports.default=protectionErrors,module.exports=exports.default},1390:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_voFragmentRequest2=_interopRequireDefault(__webpack_require__(1378)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function FragmentModel(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),metricsModel=config.metricsModel,fragmentLoader=config.fragmentLoader,instance=void 0,logger=void 0,streamProcessor=void 0,executedRequests=void 0,loadingRequests=void 0;function isFragmentLoaded(request){return!!request&&function check(requests){var isLoaded=!1;return requests.some((function(req){if(function isEqualMedia(req1,req2){return!isNaN(req1.index)&&req1.startTime===req2.startTime&&req1.adaptationIndex===req2.adaptationIndex&&req1.type===req2.type}(request,req)||function isEqualInit(req1,req2){return isNaN(req1.index)&&isNaN(req2.index)&&req1.quality===req2.quality}(request,req)||function isEqualComplete(req1,req2){return req1.action===_voFragmentRequest2.default.ACTION_COMPLETE&&req1.action===req2.action}(request,req))return isLoaded=!0})),isLoaded}(executedRequests)}function getRequestThreshold(req){return isNaN(req.duration)?.25:Math.min(req.duration/8,.5)}function removeExecutedRequestsBeforeTime(time){executedRequests=executedRequests.filter((function(req){var threshold=getRequestThreshold(req);return isNaN(req.startTime)||void 0!==time&&req.startTime>=time-threshold}))}function removeExecutedRequestsInTimeRange(start,end){end<=start+.5||(executedRequests=executedRequests.filter((function(req){var threshold=getRequestThreshold(req);return isNaN(req.startTime)||req.startTime>=end-threshold||isNaN(req.duration)||req.startTime+req.duration<=start+threshold})))}function getRequestForTime(arr,time,threshold){for(var i=arr.length-1;i>=0;i--){var req=arr[i],start=req.startTime,end=start+req.duration;if(threshold=isNaN(threshold)?getRequestThreshold(req):threshold,!isNaN(start)&&!isNaN(end)&&time+threshold>=start&&time-threshold<end||isNaN(start)&&isNaN(time))return req}return null}function addSchedulingInfoMetrics(request,state){metricsModel.addSchedulingInfo(request.mediaType,new Date,request.type,request.startTime,request.availabilityStartTime,request.duration,request.quality,request.range,state),metricsModel.addRequestsQueue(request.mediaType,loadingRequests,executedRequests)}function onLoadingCompleted(e){e.sender===fragmentLoader&&(loadingRequests.splice(loadingRequests.indexOf(e.request),1),e.response&&!e.error&&executedRequests.push(e.request),addSchedulingInfoMetrics(e.request,e.error?"failed":"executed"),eventBus.trigger(_coreEventsEvents2.default.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this}))}function onLoadingInProgress(e){e.sender===fragmentLoader&&eventBus.trigger(_coreEventsEvents2.default.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this})}function onLoadingAborted(e){e.sender===fragmentLoader&&eventBus.trigger(_coreEventsEvents2.default.FRAGMENT_LOADING_ABANDONED,{streamProcessor:this.getStreamProcessor(),request:e.request,mediaType:e.mediaType})}function resetInitialSettings(){executedRequests=[],loadingRequests=[]}return instance={setStreamProcessor:function setStreamProcessor(value){streamProcessor=value},getStreamProcessor:function getStreamProcessor(){return streamProcessor},getRequests:function getRequests(filter){var states=filter?filter.state instanceof Array?filter.state:[filter.state]:[],filteredRequests=[];return states.forEach((function(state){var requests=function getRequestsForState(state){var requests=void 0;switch(state){case"loading":requests=loadingRequests;break;case"executed":requests=executedRequests;break;default:requests=[]}return requests}(state);filteredRequests=filteredRequests.concat(function filterRequests(arr,filter){if(filter.hasOwnProperty("time"))return[getRequestForTime(arr,filter.time,filter.threshold)];return arr.filter((function(request){for(var prop in filter)if("state"!==prop&&filter.hasOwnProperty(prop)&&request[prop]!=filter[prop])return!1;return!0}))}(requests,filter))})),filteredRequests},isFragmentLoaded:isFragmentLoaded,isFragmentLoadedOrPending:function isFragmentLoadedOrPending(request){var isLoaded=!1,i=0,req=void 0;if(!(isLoaded=isFragmentLoaded(request)))for(i=0;i<loadingRequests.length;i++)req=loadingRequests[i],request.url===req.url&&request.startTime===req.startTime&&(isLoaded=!0);return isLoaded},removeExecutedRequestsBeforeTime:removeExecutedRequestsBeforeTime,removeExecutedRequestsAfterTime:function removeExecutedRequestsAfterTime(time){executedRequests=executedRequests.filter((function(req){return isNaN(req.startTime)||void 0!==time&&req.startTime+req.duration<time}))},syncExecutedRequestsWithBufferedRange:function syncExecutedRequestsWithBufferedRange(bufferedRanges,streamDuration){if(bufferedRanges&&0!==bufferedRanges.length){for(var start=0,i=0,ln=bufferedRanges.length;i<ln;i++)removeExecutedRequestsInTimeRange(start,bufferedRanges.start(i)),start=bufferedRanges.end(i);streamDuration>0&&removeExecutedRequestsInTimeRange(start,streamDuration)}else removeExecutedRequestsBeforeTime()},abortRequests:function abortRequests(){fragmentLoader.abort(),loadingRequests=[]},executeRequest:function executeRequest(request){switch(request.action){case _voFragmentRequest2.default.ACTION_COMPLETE:executedRequests.push(request),addSchedulingInfoMetrics(request,"executed"),logger.debug("executeRequest trigger STREAM_COMPLETED"),eventBus.trigger(_coreEventsEvents2.default.STREAM_COMPLETED,{request:request,fragmentModel:this});break;case _voFragmentRequest2.default.ACTION_DOWNLOAD:addSchedulingInfoMetrics(request,"loading"),loadingRequests.push(request),function loadCurrentFragment(request){eventBus.trigger(_coreEventsEvents2.default.FRAGMENT_LOADING_STARTED,{sender:instance,request:request}),fragmentLoader.load(request)}(request);break;default:logger.warn("Unknown request action.")}},reset:function reset(){eventBus.off(_coreEventsEvents2.default.LOADING_COMPLETED,onLoadingCompleted,this),eventBus.off(_coreEventsEvents2.default.LOADING_DATA_PROGRESS,onLoadingInProgress,this),eventBus.off(_coreEventsEvents2.default.LOADING_ABANDONED,onLoadingAborted,this),fragmentLoader&&fragmentLoader.reset(),resetInitialSettings()},addExecutedRequest:function addExecutedRequest(request){executedRequests.push(request)}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),resetInitialSettings(),eventBus.on(_coreEventsEvents2.default.LOADING_COMPLETED,onLoadingCompleted,instance),eventBus.on(_coreEventsEvents2.default.LOADING_DATA_PROGRESS,onLoadingInProgress,instance),eventBus.on(_coreEventsEvents2.default.LOADING_ABANDONED,onLoadingAborted,instance)}(),instance}FragmentModel.__dashjs_factory_name="FragmentModel";var factory=_coreFactoryMaker2.default.getClassFactory(FragmentModel);factory.FRAGMENT_MODEL_LOADING="loading",factory.FRAGMENT_MODEL_EXECUTED="executed",factory.FRAGMENT_MODEL_CANCELED="canceled",factory.FRAGMENT_MODEL_FAILED="failed",_coreFactoryMaker2.default.updateClassFactory(FragmentModel.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1391:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var EventsBase=function(){function EventsBase(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EventsBase)}return _createClass(EventsBase,[{key:"extend",value:function extend(events,config){if(events){var override=!!config&&config.override,publicOnly=!!config&&config.publicOnly;for(var evt in events)!events.hasOwnProperty(evt)||this[evt]&&!override||publicOnly&&-1===events[evt].indexOf("public_")||(this[evt]=events[evt])}}}]),EventsBase}();exports.default=EventsBase,module.exports=exports.default},1392:function(module,exports,__webpack_require__){!function(imscNames){imscNames.ns_tt="http://www.w3.org/ns/ttml",imscNames.ns_tts="http://www.w3.org/ns/ttml#styling",imscNames.ns_ttp="http://www.w3.org/ns/ttml#parameter",imscNames.ns_xml="http://www.w3.org/XML/1998/namespace",imscNames.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",imscNames.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",imscNames.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",imscNames.ns_ebutts="urn:ebu:tt:style"}(exports)},1393:function(module,exports,__webpack_require__){!function(imscUtils){var HEX_COLOR_RE=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,DEC_COLOR_RE=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,DEC_COLORA_RE=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,NAMED_COLOR={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};imscUtils.parseColor=function(str){var m,r=null,nc=NAMED_COLOR[str.toLowerCase()];return void 0!==nc?r=nc:null!==(m=HEX_COLOR_RE.exec(str))?r=[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16),void 0!==m[4]?parseInt(m[4],16):255]:null!==(m=DEC_COLOR_RE.exec(str))?r=[parseInt(m[1]),parseInt(m[2]),parseInt(m[3]),255]:null!==(m=DEC_COLORA_RE.exec(str))&&(r=[parseInt(m[1]),parseInt(m[2]),parseInt(m[3]),parseInt(m[4])]),r};var LENGTH_RE=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;imscUtils.parseLength=function(str){var m,r=null;return null!==(m=LENGTH_RE.exec(str))&&(r={value:parseFloat(m[1]),unit:m[2]}),r},imscUtils.parseTextShadow=function(str){var shadows=str.split(","),r=[];for(var i in shadows){var shadow=shadows[i].split(" ");if(1===shadow.length&&"none"===shadow[0])return"none";if(shadow.length>1&&shadow.length<5){var out_shadow=[null,null,null,null],l=imscUtils.parseLength(shadow.shift());if(null===l)return null;if(out_shadow[0]=l,null===(l=imscUtils.parseLength(shadow.shift())))return null;if(out_shadow[1]=l,0===shadow.length){r.push(out_shadow);continue}if(null!==(l=imscUtils.parseLength(shadow[0]))&&(out_shadow[2]=l,shadow.shift()),0===shadow.length){r.push(out_shadow);continue}var c=imscUtils.parseColor(shadow[0]);if(null===c)return null;out_shadow[3]=c,r.push(out_shadow)}}return r},imscUtils.parsePosition=function(str){var s=str.split(" "),isKeyword=function(str){return"center"===str||"left"===str||"top"===str||"bottom"===str||"right"===str};if(s.length>4)return null;for(var j in s)if(!isKeyword(s[j])){var l=imscUtils.parseLength(s[j]);if(null===l)return null;s[j]=l}for(var pos={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}},i=0;i<s.length;){var comp=s[i++];if(isKeyword(comp)){var offset={value:0,unit:"%"};2!==s.length&&i<s.length&&!isKeyword(s[i])&&(offset=s[i++]),"right"===comp?(pos.h.edge=comp,pos.h.offset=offset):"bottom"===comp?(pos.v.edge=comp,pos.v.offset=offset):"left"===comp?pos.h.offset=offset:"top"===comp&&(pos.v.offset=offset)}else{if(1!==s.length&&2!==s.length)return null;1===i?pos.h.offset=comp:pos.v.offset=comp}}return pos},imscUtils.ComputedLength=function(rw,rh){this.rw=rw,this.rh=rh},imscUtils.ComputedLength.prototype.toUsedLength=function(width,height){return width*this.rw+height*this.rh},imscUtils.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh},imscUtils.toComputedLength=function(lengthVal,lengthUnit,emLength,percentLength,cellLength,pxLength){return"%"===lengthUnit&&percentLength?new imscUtils.ComputedLength(percentLength.rw*lengthVal/100,percentLength.rh*lengthVal/100):"em"===lengthUnit&&emLength?new imscUtils.ComputedLength(emLength.rw*lengthVal,emLength.rh*lengthVal):"c"===lengthUnit&&cellLength?new imscUtils.ComputedLength(lengthVal*cellLength.rw,lengthVal*cellLength.rh):"px"===lengthUnit&&pxLength?new imscUtils.ComputedLength(lengthVal*pxLength.rw,lengthVal*pxLength.rh):"rh"===lengthUnit?new imscUtils.ComputedLength(0,lengthVal/100):"rw"===lengthUnit?new imscUtils.ComputedLength(lengthVal/100,0):null}}(exports)},1394:function(module,exports,__webpack_require__){"use strict";(function(global){var base64=__webpack_require__(1470),ieee754=__webpack_require__(1471),isArray=__webpack_require__(1426);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length)).__proto__=Buffer.prototype:(null===that&&(that=new Buffer(length)),that.length=length),that}function Buffer(arg,encodingOrOffset,length){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(arg,encodingOrOffset,length);if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}function from(that,value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer?function fromArrayBuffer(that,array,byteOffset,length){if(array.byteLength,byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);Buffer.TYPED_ARRAY_SUPPORT?(that=array).__proto__=Buffer.prototype:that=fromArrayLike(that,array);return that}(that,value,encodingOrOffset,length):"string"==typeof value?function fromString(that,string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding),actual=(that=createBuffer(that,length)).write(string,encoding);actual!==length&&(that=that.slice(0,actual));return that}(that,value,encodingOrOffset):function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);return 0===(that=createBuffer(that,len)).length?that:(obj.copy(that,0,0,len),that)}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||function isnan(val){return val!=val}(obj.length)?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&isArray(obj.data))return fromArrayLike(that,obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(that,value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(that,size){if(assertSize(size),that=createBuffer(that,size<0?0:0|checked(size)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)that[i]=0;return that}function fromArrayLike(that,array){var length=array.length<0?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,isNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var i,indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new TypeError("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=4096)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=4096));return res}(res)}exports.Buffer=Buffer,exports.SlowBuffer=function SlowBuffer(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:function typedArraySupport(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}(),exports.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(arr){return arr.__proto__=Buffer.prototype,arr},Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(size,fill,encoding){return function alloc(that,size,fill,encoding){return assertSize(size),size<=0?createBuffer(that,size):void 0!==fill?"string"==typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill):createBuffer(that,size)}(null,size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)},Buffer.isBuffer=function isBuffer(b){return!(null==b||!b._isBuffer)},Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function toString(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function inspect(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function includes(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function write(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset|=0,isFinite(length)?(length|=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function slice(start,end){var newBuf,len=this.length;if((start=~~start)<0?(start+=len)<0&&(start=0):start>len&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start),Buffer.TYPED_ARRAY_SUPPORT)(newBuf=this.subarray(start,end)).__proto__=Buffer.prototype;else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;i<sliceLen;++i)newBuf[i]=this[i+start]}return newBuf},Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function readInt8(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){(value=+value,offset|=0,byteLength|=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){(value=+value,offset|=0,byteLength|=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function copy(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function fill(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),"number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString()),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function base64clean(str){if((str=function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}(str).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}}).call(this,__webpack_require__(54))},1395:function(module,exports,__webpack_require__){"use strict";(function(process){void 0===process||!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports={nextTick:function nextTick(fn,arg1,arg2,arg3){if("function"!=typeof fn)throw new TypeError('"callback" argument must be a function');var args,i,len=arguments.length;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick((function afterTickOne(){fn.call(null,arg1)}));case 3:return process.nextTick((function afterTickTwo(){fn.call(null,arg1,arg2)}));case 4:return process.nextTick((function afterTickThree(){fn.call(null,arg1,arg2,arg3)}));default:for(args=new Array(len-1),i=0;i<args.length;)args[i++]=arguments[i];return process.nextTick((function afterTick(){fn.apply(null,args)}))}}}:module.exports=process}).call(this,__webpack_require__(260))},1396:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _rulesAbrABRRulesCollection2=_interopRequireDefault(__webpack_require__(1433)),_constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_constantsMetricsConstants2=_interopRequireDefault(__webpack_require__(1382)),_voBitrateInfo2=_interopRequireDefault(__webpack_require__(1434)),_modelsFragmentModel2=_interopRequireDefault(__webpack_require__(1390)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_rulesRulesContext2=_interopRequireDefault(__webpack_require__(1493)),_rulesSwitchRequest2=_interopRequireDefault(__webpack_require__(1375)),_rulesSwitchRequestHistory2=_interopRequireDefault(__webpack_require__(1494)),_rulesDroppedFramesHistory2=_interopRequireDefault(__webpack_require__(1495)),_rulesThroughputHistory2=_interopRequireDefault(__webpack_require__(1496)),_voMetricsHTTPRequest=__webpack_require__(1373),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_utilsSupervisorTools=__webpack_require__(1383);function AbrController(){var context=this.context,debug=(0,_coreDebug2.default)(context).getInstance(),eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,abrRulesCollection=void 0,streamController=void 0,autoSwitchBitrate=void 0,topQualities=void 0,qualityDict=void 0,bitrateDict=void 0,ratioDict=void 0,streamProcessorDict=void 0,abandonmentStateDict=void 0,abandonmentTimeout=void 0,limitBitrateByPortal=void 0,usePixelRatioInLimitBitrateByPortal=void 0,windowResizeEventCalled=void 0,elementWidth=void 0,elementHeight=void 0,manifestModel=void 0,adapter=void 0,videoModel=void 0,mediaPlayerModel=void 0,domStorage=void 0,playbackIndex=void 0,switchHistoryDict=void 0,droppedFramesHistory=void 0,throughputHistory=void 0,isUsingBufferOccupancyABRDict=void 0,metricsModel=void 0,dashMetrics=void 0,useDeadTimeLatency=void 0;function createAbrRulesCollection(){(abrRulesCollection=(0,_rulesAbrABRRulesCollection2.default)(context).create({metricsModel:metricsModel,dashMetrics:dashMetrics,mediaPlayerModel:mediaPlayerModel,adapter:adapter})).initialize()}function resetInitialSettings(){autoSwitchBitrate={video:!0,audio:!0},topQualities={},qualityDict={},bitrateDict={},ratioDict={},abandonmentStateDict={},streamProcessorDict={},switchHistoryDict={},isUsingBufferOccupancyABRDict={},limitBitrateByPortal=!1,useDeadTimeLatency=!0,usePixelRatioInLimitBitrateByPortal=!1,void 0===windowResizeEventCalled&&(windowResizeEventCalled=!1),playbackIndex=void 0,droppedFramesHistory=void 0,throughputHistory=void 0,clearTimeout(abandonmentTimeout),abandonmentTimeout=null}function onQualityChangeRendered(e){e.mediaType===_constantsConstants2.default.VIDEO&&(playbackIndex=e.oldQuality,droppedFramesHistory.push(playbackIndex,videoModel.getPlaybackQuality()))}function onMetricAdded(e){e.metric!==_constantsMetricsConstants2.default.HTTP_REQUEST||!e.value||e.value.type!==_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE||e.mediaType!==_constantsConstants2.default.AUDIO&&e.mediaType!==_constantsConstants2.default.VIDEO||throughputHistory.push(e.mediaType,e.value,useDeadTimeLatency),e.metric!==_constantsMetricsConstants2.default.BUFFER_LEVEL||e.mediaType!==_constantsConstants2.default.AUDIO&&e.mediaType!==_constantsConstants2.default.VIDEO||function updateIsUsingBufferOccupancyABR(mediaType,bufferLevel){var strategy=mediaPlayerModel.getABRStrategy();if(strategy===_constantsConstants2.default.ABR_STRATEGY_BOLA)return void(isUsingBufferOccupancyABRDict[mediaType]=!0);if(strategy===_constantsConstants2.default.ABR_STRATEGY_THROUGHPUT)return void(isUsingBufferOccupancyABRDict[mediaType]=!1);var stableBufferTime=mediaPlayerModel.getStableBufferTime(),switchOnThreshold=stableBufferTime,switchOffThreshold=.5*stableBufferTime,useBufferABR=isUsingBufferOccupancyABRDict[mediaType],newUseBufferABR=bufferLevel>(useBufferABR?switchOffThreshold:switchOnThreshold);isUsingBufferOccupancyABRDict[mediaType]=newUseBufferABR,newUseBufferABR!==useBufferABR&&(newUseBufferABR?logger.info("AbrController ("+mediaType+") switching from throughput to buffer occupancy ABR rule (buffer: "+bufferLevel.toFixed(3)+")."):logger.info("AbrController ("+mediaType+") switching from buffer occupancy to throughput ABR rule (buffer: "+bufferLevel.toFixed(3)+")."))}(e.mediaType,.001*e.value.level)}function getTopQualityIndexFor(type,id){return topQualities[id]=topQualities[id]||{},topQualities[id].hasOwnProperty(type)||(topQualities[id][type]=0),function checkPortalSize(idx,type){if(type!==_constantsConstants2.default.VIDEO||!limitBitrateByPortal||!streamProcessorDict[type])return idx;windowResizeEventCalled||setElementSize();var manifest=manifestModel.getValue(),representation=adapter.getAdaptationForType(manifest,0,type).Representation,newIdx=idx;if(elementWidth>0&&elementHeight>0){for(;newIdx>0&&representation[newIdx]&&elementWidth<representation[newIdx].width&&elementWidth-representation[newIdx-1].width<representation[newIdx].width-elementWidth;)newIdx-=1;representation.length-2>=newIdx&&representation[newIdx].width===representation[newIdx+1].width&&(newIdx=Math.min(idx,newIdx+1))}return newIdx}(function checkMaxRepresentationRatio(idx,type,maxIdx){var maxRepresentationRatio=getMaxAllowedRepresentationRatioFor(type);if(isNaN(maxRepresentationRatio)||maxRepresentationRatio>=1||maxRepresentationRatio<0)return idx;return Math.min(idx,Math.round(maxIdx*maxRepresentationRatio))}(function checkMaxBitrate(idx,type){var newIdx=idx;if(!streamProcessorDict[type])return newIdx;var minIdx=getMinAllowedIndexFor(type);void 0!==minIdx&&(newIdx=Math.max(idx,minIdx));var maxIdx=getMaxAllowedIndexFor(type);void 0!==maxIdx&&(newIdx=Math.min(newIdx,maxIdx));return newIdx}(topQualities[id][type],type),type,topQualities[id][type]),type)}function getMaxAllowedBitrateFor(type){return bitrateDict.hasOwnProperty("max")&&bitrateDict.max.hasOwnProperty(type)?bitrateDict.max[type]:NaN}function getMinAllowedBitrateFor(type){return bitrateDict.hasOwnProperty("min")&&bitrateDict.min.hasOwnProperty(type)?bitrateDict.min[type]:NaN}function getMaxAllowedIndexFor(type){var maxBitrate=getMaxAllowedBitrateFor(type);return maxBitrate?getQualityForBitrate(streamProcessorDict[type].getMediaInfo(),maxBitrate):void 0}function getMinAllowedIndexFor(type){var minBitrate=getMinAllowedBitrateFor(type);if(minBitrate){var mediaInfo=streamProcessorDict[type].getMediaInfo(),bitrateList=getBitrateList(mediaInfo),minIdx=getQualityForBitrate(mediaInfo,minBitrate);return bitrateList[minIdx]&&minIdx<bitrateList.length-1&&bitrateList[minIdx].bitrate<1e3*minBitrate&&minIdx++,minIdx}}function getMaxAllowedRepresentationRatioFor(type){return ratioDict.hasOwnProperty("max")&&ratioDict.max.hasOwnProperty(type)?ratioDict.max[type]:1}function getAutoSwitchBitrateFor(type){return autoSwitchBitrate[type]}function setPlaybackQuality(type,streamInfo,newQuality,reason){var id=streamInfo.id,oldQuality=getQualityFor(type);(0,_utilsSupervisorTools.checkInteger)(newQuality);var topQualityIdx=getTopQualityIndexFor(type,id);newQuality!==oldQuality&&newQuality>=0&&newQuality<=topQualityIdx&&changeQuality(type,oldQuality,newQuality,topQualityIdx,reason)}function changeQuality(type,oldQuality,newQuality,topQualityIdx,reason){if(type&&streamProcessorDict[type]){var streamInfo=streamProcessorDict[type].getStreamInfo(),id=streamInfo?streamInfo.id:null;if(debug.getLogToBrowserConsole()){var bufferLevel=dashMetrics.getCurrentBufferLevel(metricsModel.getReadOnlyMetricsFor(type));logger.info("AbrController ("+type+") switch from "+oldQuality+" to "+newQuality+"/"+topQualityIdx+" (buffer: "+bufferLevel+") "+(reason?JSON.stringify(reason):"."))}!function setQualityFor(type,id,value){qualityDict[id]=qualityDict[id]||{},qualityDict[id][type]=value}(type,id,newQuality),eventBus.trigger(_coreEventsEvents2.default.QUALITY_CHANGE_REQUESTED,{mediaType:type,streamInfo:streamInfo,oldQuality:oldQuality,newQuality:newQuality,reason:reason})}}function setAbandonmentStateFor(type,state){abandonmentStateDict[type].state=state}function getQualityForBitrate(mediaInfo,bitrate,latency){var voRepresentation=mediaInfo&&mediaInfo.type?streamProcessorDict[mediaInfo.type].getRepresentationInfo():null;if(useDeadTimeLatency&&latency&&voRepresentation&&voRepresentation.fragmentDuration){latency/=1e3;var fragmentDuration=voRepresentation.fragmentDuration;if(latency>fragmentDuration)return 0;bitrate*=1-latency/fragmentDuration}for(var bitrateList=getBitrateList(mediaInfo),i=bitrateList.length-1;i>=0;i--){if(1e3*bitrate>=bitrateList[i].bitrate)return i}return 0}function getBitrateList(mediaInfo){var infoList=[];if(!mediaInfo||!mediaInfo.bitrateList)return infoList;for(var bitrateList=mediaInfo.bitrateList,type=mediaInfo.type,bitrateInfo=void 0,i=0,ln=bitrateList.length;i<ln;i++)(bitrateInfo=new _voBitrateInfo2.default).mediaType=type,bitrateInfo.qualityIndex=i,bitrateInfo.bitrate=bitrateList[i].bandwidth,bitrateInfo.width=bitrateList[i].width,bitrateInfo.height=bitrateList[i].height,bitrateInfo.scanType=bitrateList[i].scanType,infoList.push(bitrateInfo);return infoList}function useBufferOccupancyABR(mediaType){return isUsingBufferOccupancyABRDict[mediaType]}function getQualityFor(type){if(type&&streamProcessorDict[type]){var streamInfo=streamProcessorDict[type].getStreamInfo(),id=streamInfo?streamInfo.id:null;if(id)return qualityDict[id]=qualityDict[id]||{},qualityDict[id].hasOwnProperty(type)||(qualityDict[id][type]=0),qualityDict[id][type]}return 0}function setElementSize(){if(videoModel){var pixelRatio=usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;elementWidth=videoModel.getClientWidth()*pixelRatio,elementHeight=videoModel.getClientHeight()*pixelRatio}}function onFragmentLoadProgress(e){var type=e.request.mediaType;if(getAutoSwitchBitrateFor(type)){var streamProcessor=streamProcessorDict[type];if(!streamProcessor)return;var rulesContext=(0,_rulesRulesContext2.default)(context).create({abrController:instance,streamProcessor:streamProcessor,currentRequest:e.request,useBufferOccupancyABR:useBufferOccupancyABR(type)}),switchRequest=abrRulesCollection.shouldAbandonFragment(rulesContext);if(switchRequest.quality>_rulesSwitchRequest2.default.NO_CHANGE){var fragmentModel=streamProcessor.getFragmentModel();fragmentModel.getRequests({state:_modelsFragmentModel2.default.FRAGMENT_MODEL_LOADING,index:e.request.index})[0]&&(fragmentModel.abortRequests(),setAbandonmentStateFor(type,"abandonload"),switchHistoryDict[type].reset(),switchHistoryDict[type].push({oldValue:getQualityFor(type,streamController.getActiveStreamInfo()),newValue:switchRequest.quality,confidence:1,reason:switchRequest.reason}),setPlaybackQuality(type,streamController.getActiveStreamInfo(),switchRequest.quality,switchRequest.reason),clearTimeout(abandonmentTimeout),abandonmentTimeout=setTimeout((function(){setAbandonmentStateFor(type,"allowload"),abandonmentTimeout=null}),mediaPlayerModel.getAbandonLoadTimeout()))}}}return instance={isPlayingAtTopQuality:function isPlayingAtTopQuality(streamInfo){var streamId=streamInfo?streamInfo.id:null,audioQuality=getQualityFor(_constantsConstants2.default.AUDIO),videoQuality=getQualityFor(_constantsConstants2.default.VIDEO);return audioQuality===getTopQualityIndexFor(_constantsConstants2.default.AUDIO,streamId)&&videoQuality===getTopQualityIndexFor(_constantsConstants2.default.VIDEO,streamId)},updateTopQualityIndex:function updateTopQualityIndex(mediaInfo){var type=mediaInfo.type,streamId=mediaInfo.streamInfo.id,max=mediaInfo.representationCount-1;return function setTopQualityIndex(type,id,value){topQualities[id]=topQualities[id]||{},topQualities[id][type]=value}(type,streamId,max),max},getThroughputHistory:function getThroughputHistory(){return throughputHistory},getBitrateList:getBitrateList,getQualityForBitrate:getQualityForBitrate,getMaxAllowedBitrateFor:getMaxAllowedBitrateFor,getTopBitrateInfoFor:function getTopBitrateInfoFor(type){if(type&&streamProcessorDict&&streamProcessorDict[type]){var streamInfo=streamProcessorDict[type].getStreamInfo();if(streamInfo&&streamInfo.id){var idx=getTopQualityIndexFor(type,streamInfo.id),bitrates=getBitrateList(streamProcessorDict[type].getMediaInfo());return bitrates[idx]?bitrates[idx]:null}}return null},getMinAllowedBitrateFor:getMinAllowedBitrateFor,setMaxAllowedBitrateFor:function setMaxAllowedBitrateFor(type,value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),(0,_utilsSupervisorTools.checkIsVideoOrAudioType)(type),bitrateDict.max=bitrateDict.max||{},bitrateDict.max[type]=value},setMinAllowedBitrateFor:function setMinAllowedBitrateFor(type,value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),(0,_utilsSupervisorTools.checkIsVideoOrAudioType)(type),bitrateDict.min=bitrateDict.min||{},bitrateDict.min[type]=value},getMaxAllowedIndexFor:getMaxAllowedIndexFor,getMinAllowedIndexFor:getMinAllowedIndexFor,getMaxAllowedRepresentationRatioFor:getMaxAllowedRepresentationRatioFor,setMaxAllowedRepresentationRatioFor:function setMaxAllowedRepresentationRatioFor(type,value){ratioDict.max=ratioDict.max||{},ratioDict.max[type]=value},getInitialBitrateFor:function getInitialBitrateFor(type){!function checkConfig(){if(!domStorage||!domStorage.hasOwnProperty("getSavedBitrateSettings"))throw new Error(_constantsConstants2.default.MISSING_CONFIG_ERROR)}();var savedBitrate=domStorage.getSavedBitrateSettings(type);if(!bitrateDict.hasOwnProperty(type))if(ratioDict.hasOwnProperty(type)){var manifest=manifestModel.getValue(),representation=adapter.getAdaptationForType(manifest,0,type).Representation;if(Array.isArray(representation)){var repIdx=Math.max(Math.round(representation.length*ratioDict[type])-1,0);bitrateDict[type]=representation[repIdx].bandwidth}else bitrateDict[type]=0}else isNaN(savedBitrate)?bitrateDict[type]=type===_constantsConstants2.default.VIDEO?1e3:100:bitrateDict[type]=savedBitrate;return bitrateDict[type]},setInitialBitrateFor:function setInitialBitrateFor(type,value){(0,_utilsSupervisorTools.checkIsVideoOrAudioType)(type),(0,_utilsSupervisorTools.checkParameterType)(value,"number"),bitrateDict[type]=value},getInitialRepresentationRatioFor:function getInitialRepresentationRatioFor(type){return ratioDict.hasOwnProperty(type)?ratioDict[type]:null},setInitialRepresentationRatioFor:function setInitialRepresentationRatioFor(type,value){ratioDict[type]=value},setAutoSwitchBitrateFor:function setAutoSwitchBitrateFor(type,value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),(0,_utilsSupervisorTools.checkIsVideoOrAudioType)(type),autoSwitchBitrate[type]=value},getAutoSwitchBitrateFor:getAutoSwitchBitrateFor,getUseDeadTimeLatency:function getUseDeadTimeLatency(){return useDeadTimeLatency},setUseDeadTimeLatency:function setUseDeadTimeLatency(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),useDeadTimeLatency=value},setLimitBitrateByPortal:function setLimitBitrateByPortal(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),limitBitrateByPortal=value},getLimitBitrateByPortal:function getLimitBitrateByPortal(){return limitBitrateByPortal},getUsePixelRatioInLimitBitrateByPortal:function getUsePixelRatioInLimitBitrateByPortal(){return usePixelRatioInLimitBitrateByPortal},setUsePixelRatioInLimitBitrateByPortal:function setUsePixelRatioInLimitBitrateByPortal(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),usePixelRatioInLimitBitrateByPortal=value},getQualityFor:getQualityFor,getAbandonmentStateFor:function getAbandonmentStateFor(type){return abandonmentStateDict[type]?abandonmentStateDict[type].state:null},setPlaybackQuality:setPlaybackQuality,checkPlaybackQuality:function checkPlaybackQuality(type){if(type&&streamProcessorDict&&streamProcessorDict[type]){var streamInfo=streamProcessorDict[type].getStreamInfo(),streamId=streamInfo?streamInfo.id:null,oldQuality=getQualityFor(type),rulesContext=(0,_rulesRulesContext2.default)(context).create({abrController:instance,streamProcessor:streamProcessorDict[type],currentValue:oldQuality,switchHistory:switchHistoryDict[type],droppedFramesHistory:droppedFramesHistory,useBufferOccupancyABR:useBufferOccupancyABR(type)});if(droppedFramesHistory){var playbackQuality=videoModel.getPlaybackQuality();playbackQuality&&droppedFramesHistory.push(playbackIndex,playbackQuality)}if(getAutoSwitchBitrateFor(type)){var minIdx=getMinAllowedIndexFor(type),topQualityIdx=getTopQualityIndexFor(type,streamId),switchRequest=abrRulesCollection.getMaxQuality(rulesContext),newQuality=switchRequest.quality;if(void 0!==minIdx&&newQuality<minIdx&&(newQuality=minIdx),newQuality>topQualityIdx&&(newQuality=topQualityIdx),switchHistoryDict[type].push({oldValue:oldQuality,newValue:newQuality}),newQuality>_rulesSwitchRequest2.default.NO_CHANGE&&newQuality!=oldQuality)("allowload"===abandonmentStateDict[type].state||newQuality>oldQuality)&&changeQuality(type,oldQuality,newQuality,topQualityIdx,switchRequest.reason);else if(debug.getLogToBrowserConsole()){var bufferLevel=dashMetrics.getCurrentBufferLevel(metricsModel.getReadOnlyMetricsFor(type));logger.debug("AbrController ("+type+") stay on "+oldQuality+"/"+topQualityIdx+" (buffer: "+bufferLevel+")")}}}},getTopQualityIndexFor:getTopQualityIndexFor,setElementSize:setElementSize,setWindowResizeEventCalled:function setWindowResizeEventCalled(value){windowResizeEventCalled=value},createAbrRulesCollection:createAbrRulesCollection,registerStreamType:function registerStreamType(type,streamProcessor){switchHistoryDict[type]=(0,_rulesSwitchRequestHistory2.default)(context).create(),streamProcessorDict[type]=streamProcessor,abandonmentStateDict[type]=abandonmentStateDict[type]||{},abandonmentStateDict[type].state="allowload",isUsingBufferOccupancyABRDict[type]=!1,eventBus.on(_coreEventsEvents2.default.LOADING_PROGRESS,onFragmentLoadProgress,this),type==_constantsConstants2.default.VIDEO&&(eventBus.on(_coreEventsEvents2.default.QUALITY_CHANGE_RENDERED,onQualityChangeRendered,this),droppedFramesHistory=(0,_rulesDroppedFramesHistory2.default)(context).create(),setElementSize()),eventBus.on(_coreEventsEvents2.default.METRIC_ADDED,onMetricAdded,this),eventBus.on(_coreEventsEvents2.default.PERIOD_SWITCH_COMPLETED,createAbrRulesCollection,this),throughputHistory=(0,_rulesThroughputHistory2.default)(context).create({mediaPlayerModel:mediaPlayerModel})},unRegisterStreamType:function unRegisterStreamType(type){delete streamProcessorDict[type]},setConfig:function setConfig(config){config&&(config.streamController&&(streamController=config.streamController),config.domStorage&&(domStorage=config.domStorage),config.mediaPlayerModel&&(mediaPlayerModel=config.mediaPlayerModel),config.metricsModel&&(metricsModel=config.metricsModel),config.dashMetrics&&(dashMetrics=config.dashMetrics),config.adapter&&(adapter=config.adapter),config.manifestModel&&(manifestModel=config.manifestModel),config.videoModel&&(videoModel=config.videoModel))},reset:function reset(){resetInitialSettings(),eventBus.off(_coreEventsEvents2.default.LOADING_PROGRESS,onFragmentLoadProgress,this),eventBus.off(_coreEventsEvents2.default.QUALITY_CHANGE_RENDERED,onQualityChangeRendered,this),eventBus.off(_coreEventsEvents2.default.METRIC_ADDED,onMetricAdded,this),eventBus.off(_coreEventsEvents2.default.PERIOD_SWITCH_COMPLETED,createAbrRulesCollection,this),abrRulesCollection&&abrRulesCollection.reset()}},function setup(){logger=debug.getLogger(instance),resetInitialSettings()}(),instance}AbrController.__dashjs_factory_name="AbrController";var factory=_coreFactoryMaker2.default.getSingletonFactory(AbrController);factory.ABANDON_LOAD="abandonload",factory.QUALITY_DEFAULT=0,_coreFactoryMaker2.default.updateSingletonFactory(AbrController.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1397:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function RequestModifier(){return{modifyRequestURL:function modifyRequestURL(url){return url},modifyRequestHeader:function modifyRequestHeader(request){return request}}}RequestModifier.__dashjs_factory_name="RequestModifier",exports.default=_coreFactoryMaker2.default.getSingletonFactory(RequestModifier),module.exports=exports.default},1398:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var BaseMatcher=function(){function BaseMatcher(test,converter){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BaseMatcher),this._test=test,this._converter=converter}return _createClass(BaseMatcher,[{key:"test",get:function get(){return this._test}},{key:"converter",get:function get(){return this._converter}}]),BaseMatcher}();exports.default=BaseMatcher,module.exports=exports.default},1399:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var metricsReportingEvents=new(function(_EventsBase){function MetricsReportingEvents(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MetricsReportingEvents),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(MetricsReportingEvents.prototype),"constructor",this).call(this),this.METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",this.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer"}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(MetricsReportingEvents,_EventsBase),MetricsReportingEvents}(function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1391)).default));exports.default=metricsReportingEvents,module.exports=exports.default},1400:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _CommonEncryption2=_interopRequireDefault(__webpack_require__(1385)),_drmKeySystemClearKey2=_interopRequireDefault(__webpack_require__(1598)),_drmKeySystemW3CClearKey2=_interopRequireDefault(__webpack_require__(1599)),_drmKeySystemWidevine2=_interopRequireDefault(__webpack_require__(1600)),_drmKeySystemPlayReady2=_interopRequireDefault(__webpack_require__(1601)),_serversDRMToday2=_interopRequireDefault(__webpack_require__(1602)),_serversPlayReady2=_interopRequireDefault(__webpack_require__(1603)),_serversWidevine2=_interopRequireDefault(__webpack_require__(1604)),_serversClearKey2=_interopRequireDefault(__webpack_require__(1605)),_constantsProtectionConstants2=_interopRequireDefault(__webpack_require__(1381));function ProtectionKeyController(){var context=this.context,instance=void 0,debug=void 0,logger=void 0,keySystems=void 0,BASE64=void 0,clearkeyKeySystem=void 0,clearkeyW3CKeySystem=void 0;return instance={initialize:function initialize(){keySystems=[];var keySystem=void 0;keySystem=(0,_drmKeySystemPlayReady2.default)(context).getInstance({BASE64:BASE64}),keySystems.push(keySystem),keySystem=(0,_drmKeySystemWidevine2.default)(context).getInstance({BASE64:BASE64}),keySystems.push(keySystem),keySystem=(0,_drmKeySystemClearKey2.default)(context).getInstance({BASE64:BASE64}),keySystems.push(keySystem),clearkeyKeySystem=keySystem,keySystem=(0,_drmKeySystemW3CClearKey2.default)(context).getInstance({BASE64:BASE64,debug:debug}),keySystems.push(keySystem),clearkeyW3CKeySystem=keySystem},setProtectionData:function setProtectionData(protectionDataSet){for(var getProtectionData=function getProtectionData(keySystemString){var protData=null;return protectionDataSet&&(protData=keySystemString in protectionDataSet?protectionDataSet[keySystemString]:null),protData},i=0;i<keySystems.length;i++){var keySystem=keySystems[i];keySystem.hasOwnProperty("init")&&keySystem.init(getProtectionData(keySystem.systemString))}},isClearKey:function isClearKey(keySystem){return keySystem===clearkeyKeySystem||keySystem===clearkeyW3CKeySystem},initDataEquals:function initDataEquals(initData1,initData2){if(initData1.byteLength===initData2.byteLength){for(var data1=new Uint8Array(initData1),data2=new Uint8Array(initData2),j=0;j<data1.length;j++)if(data1[j]!==data2[j])return!1;return!0}return!1},getKeySystems:function getKeySystems(){return keySystems},getKeySystemBySystemString:function getKeySystemBySystemString(systemString){for(var i=0;i<keySystems.length;i++)if(keySystems[i].systemString===systemString)return keySystems[i];return null},getSupportedKeySystemsFromContentProtection:function getSupportedKeySystemsFromContentProtection(cps){var cp=void 0,ks=void 0,ksIdx=void 0,cpIdx=void 0,supportedKS=[];if(cps)for(ksIdx=0;ksIdx<keySystems.length;++ksIdx)for(ks=keySystems[ksIdx],cpIdx=0;cpIdx<cps.length;++cpIdx)if((cp=cps[cpIdx]).schemeIdUri.toLowerCase()===ks.schemeIdURI){var initData=ks.getInitData(cp);initData?supportedKS.push({ks:keySystems[ksIdx],initData:initData,cdmData:ks.getCDMData(),sessionId:ks.getSessionId(cp)}):this.isClearKey(ks)&&supportedKS.push({ks:ks,initData:null})}return supportedKS},getSupportedKeySystems:function getSupportedKeySystems(initData,protDataSet){for(var supportedKS=[],pssh=_CommonEncryption2.default.parsePSSHList(initData),ks=void 0,keySystemString=void 0,shouldNotFilterOutKeySystem=void 0,ksIdx=0;ksIdx<keySystems.length;++ksIdx)keySystemString=(ks=keySystems[ksIdx]).systemString,shouldNotFilterOutKeySystem=!protDataSet||keySystemString in protDataSet,ks.uuid in pssh&&shouldNotFilterOutKeySystem&&supportedKS.push({ks:ks,initData:pssh[ks.uuid],cdmData:ks.getCDMData(),sessionId:ks.getSessionId()});return supportedKS},getLicenseServer:function getLicenseServer(keySystem,protData,messageType){if("license-release"===messageType||"individualization-request"===messageType)return null;var licenseServerData=null;return protData&&protData.hasOwnProperty("drmtoday")?licenseServerData=(0,_serversDRMToday2.default)(context).getInstance({BASE64:BASE64}):keySystem.systemString===_constantsProtectionConstants2.default.WIDEVINE_KEYSTEM_STRING?licenseServerData=(0,_serversWidevine2.default)(context).getInstance():keySystem.systemString===_constantsProtectionConstants2.default.PLAYREADY_KEYSTEM_STRING?licenseServerData=(0,_serversPlayReady2.default)(context).getInstance():keySystem.systemString===_constantsProtectionConstants2.default.CLEARKEY_KEYSTEM_STRING&&(licenseServerData=(0,_serversClearKey2.default)(context).getInstance()),licenseServerData},processClearKeyLicenseRequest:function processClearKeyLicenseRequest(clearkeyKeySystem,protData,message){try{return clearkeyKeySystem.getClearKeysFromProtectionData(protData,message)}catch(error){return logger.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function setConfig(config){config&&(config.debug&&(debug=config.debug,logger=debug.getLogger(instance)),config.BASE64&&(BASE64=config.BASE64))}}}ProtectionKeyController.__dashjs_factory_name="ProtectionKeyController",exports.default=dashjs.FactoryMaker.getSingletonFactory(ProtectionKeyController),module.exports=exports.default},1401:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_TextSourceBuffer2=_interopRequireDefault(__webpack_require__(1462)),_TextTracks2=_interopRequireDefault(__webpack_require__(1403)),_utilsVTTParser2=_interopRequireDefault(__webpack_require__(1484)),_utilsTTMLParser2=_interopRequireDefault(__webpack_require__(1485)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_utilsSupervisorTools=__webpack_require__(1383);function TextController(){var context=this.context,instance=void 0,textSourceBuffer=void 0,errHandler=void 0,dashManifestModel=void 0,manifestModel=void 0,mediaController=void 0,videoModel=void 0,streamController=void 0,textTracks=void 0,vttParser=void 0,ttmlParser=void 0,eventBus=void 0,defaultLanguage=void 0,lastEnabledIndex=void 0,textDefaultEnabled=void 0,allTracksAreDisabled=void 0,forceTextStreaming=void 0;function onTextTracksAdded(e){var _this=this,tracks=e.tracks,index=e.index;tracks.some((function(item,idx){if(item.lang===defaultLanguage)return _this.setTextTrack(idx),index=idx,!0})),textDefaultEnabled||this.setTextTrack(-1),lastEnabledIndex=index,eventBus.trigger(_coreEventsEvents2.default.TEXT_TRACKS_ADDED,{enabled:isTextEnabled(),index:index,tracks:tracks})}function isTextEnabled(){var enabled=!0;return allTracksAreDisabled&&!forceTextStreaming&&(enabled=!1),enabled}function resetInitialSettings(){allTracksAreDisabled=!1}return instance={setConfig:function setConfig(config){config&&(config.errHandler&&(errHandler=config.errHandler),config.dashManifestModel&&(dashManifestModel=config.dashManifestModel),config.manifestModel&&(manifestModel=config.manifestModel),config.mediaController&&(mediaController=config.mediaController),config.videoModel&&(videoModel=config.videoModel),config.streamController&&(streamController=config.streamController),config.textTracks&&(textTracks=config.textTracks),config.vttParser&&(vttParser=config.vttParser),config.ttmlParser&&(ttmlParser=config.ttmlParser),textSourceBuffer.setConfig({errHandler:errHandler,dashManifestModel:dashManifestModel,manifestModel:manifestModel,mediaController:mediaController,videoModel:videoModel,streamController:streamController,textTracks:textTracks,vttParser:vttParser,ttmlParser:ttmlParser}))},getTextSourceBuffer:function getTextSourceBuffer(){return textSourceBuffer},getAllTracksAreDisabled:function getAllTracksAreDisabled(){return allTracksAreDisabled},addEmbeddedTrack:function addEmbeddedTrack(mediaInfo){textSourceBuffer.addEmbeddedTrack(mediaInfo)},getTextDefaultLanguage:function getTextDefaultLanguage(){return defaultLanguage},setTextDefaultLanguage:function setTextDefaultLanguage(lang){(0,_utilsSupervisorTools.checkParameterType)(lang,"string"),defaultLanguage=lang},setTextDefaultEnabled:function setTextDefaultEnabled(enable){(0,_utilsSupervisorTools.checkParameterType)(enable,"boolean"),(textDefaultEnabled=enable)||this.setTextTrack(-1)},getTextDefaultEnabled:function getTextDefaultEnabled(){return textDefaultEnabled},enableText:function enableText(enable){(0,_utilsSupervisorTools.checkParameterType)(enable,"boolean"),isTextEnabled()!==enable&&(enable&&this.setTextTrack(lastEnabledIndex),enable||(lastEnabledIndex=this.getCurrentTrackIdx(),this.setTextTrack(-1)))},isTextEnabled:isTextEnabled,setTextTrack:function setTextTrack(idx){var config=textSourceBuffer.getConfig(),fragmentModel=config.fragmentModel,fragmentedTracks=config.fragmentedTracks,videoModel=config.videoModel,mediaInfosArr=void 0,streamProcessor=void 0;allTracksAreDisabled=-1===idx;var oldTrackIdx=textTracks.getCurrentTrackIdx();if(oldTrackIdx!==idx){textTracks.setModeForTrackIdx(oldTrackIdx,_constantsConstants2.default.TEXT_HIDDEN),textTracks.setCurrentTrackIdx(idx),textTracks.setModeForTrackIdx(idx,_constantsConstants2.default.TEXT_SHOWING);var currentTrackInfo=textTracks.getCurrentTrackInfo();if(currentTrackInfo&&currentTrackInfo.isFragmented&&!currentTrackInfo.isEmbedded)for(var i=0;i<fragmentedTracks.length;i++){var mediaInfo=fragmentedTracks[i];if(currentTrackInfo.lang===mediaInfo.lang&&currentTrackInfo.index===mediaInfo.index&&(mediaInfo.id?currentTrackInfo.id===mediaInfo.id:currentTrackInfo.id===mediaInfo.index))if(mediaInfo!==mediaController.getCurrentTrackFor(_constantsConstants2.default.FRAGMENTED_TEXT,streamController.getActiveStreamInfo()))fragmentModel.abortRequests(),fragmentModel.removeExecutedRequestsBeforeTime(),textSourceBuffer.remove(),textTracks.deleteCuesFromTrackIdx(oldTrackIdx),mediaController.setTrack(mediaInfo),textSourceBuffer.setCurrentFragmentedTrackIdx(i);else if(-1===oldTrackIdx){for(var streamProcessors=streamController.getActiveStreamProcessors(),_i=0;_i<streamProcessors.length;_i++)if(streamProcessors[_i].getType()===_constantsConstants2.default.FRAGMENTED_TEXT){streamProcessor=streamProcessors[_i];break}streamProcessor.getIndexHandler().setCurrentTime(videoModel.getTime()),streamProcessor.getScheduleController().start()}}else if(currentTrackInfo&&!currentTrackInfo.isFragmented){for(streamProcessors=streamController.getActiveStreamProcessors(),i=0;i<streamProcessors.length;i++)if(streamProcessors[i].getType()===_constantsConstants2.default.TEXT){mediaInfosArr=(streamProcessor=streamProcessors[i]).getMediaInfoArr();break}if(streamProcessor&&mediaInfosArr)for(i=0;i<mediaInfosArr.length;i++)if(mediaInfosArr[i].index===currentTrackInfo.index&&mediaInfosArr[i].lang===currentTrackInfo.lang){streamProcessor.selectMediaInfo(mediaInfosArr[i]);break}}}},getCurrentTrackIdx:function getCurrentTrackIdx(){return textTracks.getCurrentTrackIdx()},enableForcedTextStreaming:function enableForcedTextStreaming(enable){(0,_utilsSupervisorTools.checkParameterType)(enable,"boolean"),forceTextStreaming=enable},reset:function reset(){resetInitialSettings(),textSourceBuffer.resetEmbedded(),textSourceBuffer.reset()}},function setup(){defaultLanguage="",lastEnabledIndex=-1,textDefaultEnabled=!0,forceTextStreaming=!1,textTracks=(0,_TextTracks2.default)(context).getInstance(),vttParser=(0,_utilsVTTParser2.default)(context).getInstance(),ttmlParser=(0,_utilsTTMLParser2.default)(context).getInstance(),textSourceBuffer=(0,_TextSourceBuffer2.default)(context).getInstance(),eventBus=(0,_coreEventBus2.default)(context).getInstance(),textTracks.initialize(),eventBus.on(_coreEventsEvents2.default.TEXT_TRACKS_QUEUE_INITIALIZED,onTextTracksAdded,instance),resetInitialSettings()}(),instance}TextController.__dashjs_factory_name="TextController",exports.default=_coreFactoryMaker2.default.getSingletonFactory(TextController),module.exports=exports.default},1402:function(module,exports,__webpack_require__){var ISOBoxer={parseBuffer:function(arrayBuffer){return new ISOFile(arrayBuffer).parse()},addBoxProcessor:function(type,parser){"string"==typeof type&&"function"==typeof parser&&(ISOBox.prototype._boxProcessors[type]=parser)},createFile:function(){return new ISOFile},createBox:function(type,parent,pos){var newBox=ISOBox.create(type);return parent&&parent.append(newBox,pos),newBox},createFullBox:function(type,parent,pos){var newBox=ISOBoxer.createBox(type,parent,pos);return newBox.version=0,newBox.flags=0,newBox},Utils:{}};ISOBoxer.Utils.dataViewToString=function(dataView,encoding){var impliedEncoding=encoding||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(impliedEncoding).decode(dataView);var a=[],i=0;if("utf-8"===impliedEncoding)for(;i<dataView.byteLength;){var c=dataView.getUint8(i++);c<128||(c<224?(c=(31&c)<<6,c|=63&dataView.getUint8(i++)):c<240?(c=(15&c)<<12,c|=(63&dataView.getUint8(i++))<<6,c|=63&dataView.getUint8(i++)):(c=(7&c)<<18,c|=(63&dataView.getUint8(i++))<<12,c|=(63&dataView.getUint8(i++))<<6,c|=63&dataView.getUint8(i++))),a.push(String.fromCharCode(c))}else for(;i<dataView.byteLength;)a.push(String.fromCharCode(dataView.getUint8(i++)));return a.join("")},ISOBoxer.Utils.utf8ToByteArray=function(string){var u,i;if("undefined"!=typeof TextEncoder)u=(new TextEncoder).encode(string);else for(u=[],i=0;i<string.length;++i){var c=string.charCodeAt(i);c<128?u.push(c):c<2048?(u.push(192|c>>6),u.push(128|63&c)):c<65536?(u.push(224|c>>12),u.push(128|63&c>>6),u.push(128|63&c)):(u.push(240|c>>18),u.push(128|63&c>>12),u.push(128|63&c>>6),u.push(128|63&c))}return u},ISOBoxer.Utils.appendBox=function(parent,box,pos){if(box._offset=parent._cursor.offset,box._root=parent._root?parent._root:parent,box._raw=parent._raw,box._parent=parent,-1!==pos)if(null!=pos){var type,index=-1;if("number"==typeof pos)index=pos;else{if("string"==typeof pos)type=pos;else{if("object"!=typeof pos||!pos.type)return void parent.boxes.push(box);type=pos.type}for(var i=0;i<parent.boxes.length;i++)if(type===parent.boxes[i].type){index=i+1;break}}parent.boxes.splice(index,0,box)}else parent.boxes.push(box)},exports.parseBuffer=ISOBoxer.parseBuffer,exports.addBoxProcessor=ISOBoxer.addBoxProcessor,exports.createFile=ISOBoxer.createFile,exports.createBox=ISOBoxer.createBox,exports.createFullBox=ISOBoxer.createFullBox,exports.Utils=ISOBoxer.Utils,ISOBoxer.Cursor=function(initialOffset){this.offset=void 0===initialOffset?0:initialOffset};var ISOFile=function(arrayBuffer){this._cursor=new ISOBoxer.Cursor,this.boxes=[],arrayBuffer&&(this._raw=new DataView(arrayBuffer))};ISOFile.prototype.fetch=function(type){var result=this.fetchAll(type,!0);return result.length?result[0]:null},ISOFile.prototype.fetchAll=function(type,returnEarly){var result=[];return ISOFile._sweep.call(this,type,result,returnEarly),result},ISOFile.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var box=ISOBox.parse(this);if(void 0===box.type)break;this.boxes.push(box)}return this},ISOFile._sweep=function(type,result,returnEarly){for(var box in this.type&&this.type==type&&result.push(this),this.boxes){if(result.length&&returnEarly)return;ISOFile._sweep.call(this.boxes[box],type,result,returnEarly)}},ISOFile.prototype.write=function(){var i,length=0;for(i=0;i<this.boxes.length;i++)length+=this.boxes[i].getLength(!1);var bytes=new Uint8Array(length);for(this._rawo=new DataView(bytes.buffer),this.bytes=bytes,this._cursor.offset=0,i=0;i<this.boxes.length;i++)this.boxes[i].write();return bytes.buffer},ISOFile.prototype.append=function(box,pos){ISOBoxer.Utils.appendBox(this,box,pos)};var ISOBox=function(){this._cursor=new ISOBoxer.Cursor};ISOBox.parse=function(parent){var newBox=new ISOBox;return newBox._offset=parent._cursor.offset,newBox._root=parent._root?parent._root:parent,newBox._raw=parent._raw,newBox._parent=parent,newBox._parseBox(),parent._cursor.offset=newBox._raw.byteOffset+newBox._raw.byteLength,newBox},ISOBox.create=function(type){var newBox=new ISOBox;return newBox.type=type,newBox.boxes=[],newBox},ISOBox.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],ISOBox.prototype._boxProcessors={},ISOBox.prototype._procField=function(name,type,size){this._parsing?this[name]=this._readField(type,size):this._writeField(type,size,this[name])},ISOBox.prototype._procFieldArray=function(name,length,type,size){var i;if(this._parsing)for(this[name]=[],i=0;i<length;i++)this[name][i]=this._readField(type,size);else for(i=0;i<this[name].length;i++)this._writeField(type,size,this[name][i])},ISOBox.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},ISOBox.prototype._procEntries=function(name,length,fn){var i;if(this._parsing)for(this[name]=[],i=0;i<length;i++)this[name].push({}),fn.call(this,this[name][i]);else for(i=0;i<length;i++)fn.call(this,this[name][i])},ISOBox.prototype._procSubEntries=function(entry,name,length,fn){var i;if(this._parsing)for(entry[name]=[],i=0;i<length;i++)entry[name].push({}),fn.call(this,entry[name][i]);else for(i=0;i<length;i++)fn.call(this,entry[name][i])},ISOBox.prototype._procEntryField=function(entry,name,type,size){this._parsing?entry[name]=this._readField(type,size):this._writeField(type,size,entry[name])},ISOBox.prototype._procSubBoxes=function(name,length){var i;if(this._parsing)for(this[name]=[],i=0;i<length;i++)this[name].push(ISOBox.parse(this));else for(i=0;i<length;i++)this._rawo?this[name][i].write():this.size+=this[name][i].getLength()},ISOBox.prototype._readField=function(type,size){switch(type){case"uint":return this._readUint(size);case"int":return this._readInt(size);case"template":return this._readTemplate(size);case"string":return-1===size?this._readTerminatedString():this._readString(size);case"data":return this._readData(size);case"utf8":return this._readUTF8String();default:return-1}},ISOBox.prototype._readInt=function(size){var result=null,offset=this._cursor.offset-this._raw.byteOffset;switch(size){case 8:result=this._raw.getInt8(offset);break;case 16:result=this._raw.getInt16(offset);break;case 32:result=this._raw.getInt32(offset);break;case 64:var s1=this._raw.getInt32(offset),s2=this._raw.getInt32(offset+4);result=s1*Math.pow(2,32)+s2}return this._cursor.offset+=size>>3,result},ISOBox.prototype._readUint=function(size){var s1,s2,result=null,offset=this._cursor.offset-this._raw.byteOffset;switch(size){case 8:result=this._raw.getUint8(offset);break;case 16:result=this._raw.getUint16(offset);break;case 24:result=((s1=this._raw.getUint16(offset))<<8)+(s2=this._raw.getUint8(offset+2));break;case 32:result=this._raw.getUint32(offset);break;case 64:s1=this._raw.getUint32(offset),s2=this._raw.getUint32(offset+4),result=s1*Math.pow(2,32)+s2}return this._cursor.offset+=size>>3,result},ISOBox.prototype._readString=function(length){for(var str="",c=0;c<length;c++){var char=this._readUint(8);str+=String.fromCharCode(char)}return str},ISOBox.prototype._readTemplate=function(size){return this._readUint(size/2)+this._readUint(size/2)/Math.pow(2,size/2)},ISOBox.prototype._readTerminatedString=function(){for(var str="";this._cursor.offset-this._offset<this._raw.byteLength;){var char=this._readUint(8);if(0===char)break;str+=String.fromCharCode(char)}return str},ISOBox.prototype._readData=function(size){var length=size>0?size:this._raw.byteLength-(this._cursor.offset-this._offset);if(length>0){var data=new Uint8Array(this._raw.buffer,this._cursor.offset,length);return this._cursor.offset+=length,data}return null},ISOBox.prototype._readUTF8String=function(){var length=this._raw.byteLength-(this._cursor.offset-this._offset),data=null;return length>0&&(data=new DataView(this._raw.buffer,this._cursor.offset,length),this._cursor.offset+=length),data?ISOBoxer.Utils.dataViewToString(data):data},ISOBox.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},ISOBox.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},ISOBox.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(ISOBox.parse(this))},ISOBox.prototype.append=function(box,pos){ISOBoxer.Utils.appendBox(this,box,pos)},ISOBox.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var i=0;i<this.boxes.length;i++)this.size+=this.boxes[i].getLength();return this._data&&this._writeData(this._data),this.size},ISOBox.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var i=0;i<this.boxes.length;i++)this.boxes[i].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},ISOBox.prototype._writeInt=function(size,value){if(this._rawo){var offset=this._cursor.offset-this._rawo.byteOffset;switch(size){case 8:this._rawo.setInt8(offset,value);break;case 16:this._rawo.setInt16(offset,value);break;case 32:this._rawo.setInt32(offset,value);break;case 64:var s1=Math.floor(value/Math.pow(2,32)),s2=value-s1*Math.pow(2,32);this._rawo.setUint32(offset,s1),this._rawo.setUint32(offset+4,s2)}this._cursor.offset+=size>>3}else this.size+=size>>3},ISOBox.prototype._writeUint=function(size,value){if(this._rawo){var s1,s2,offset=this._cursor.offset-this._rawo.byteOffset;switch(size){case 8:this._rawo.setUint8(offset,value);break;case 16:this._rawo.setUint16(offset,value);break;case 24:s1=(16776960&value)>>8,s2=255&value,this._rawo.setUint16(offset,s1),this._rawo.setUint8(offset+2,s2);break;case 32:this._rawo.setUint32(offset,value);break;case 64:s2=value-(s1=Math.floor(value/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(offset,s1),this._rawo.setUint32(offset+4,s2)}this._cursor.offset+=size>>3}else this.size+=size>>3},ISOBox.prototype._writeString=function(size,str){for(var c=0;c<size;c++)this._writeUint(8,str.charCodeAt(c))},ISOBox.prototype._writeTerminatedString=function(str){if(0!==str.length){for(var c=0;c<str.length;c++)this._writeUint(8,str.charCodeAt(c));this._writeUint(8,0)}},ISOBox.prototype._writeTemplate=function(size,value){var pre=Math.floor(value),post=(value-pre)*Math.pow(2,size/2);this._writeUint(size/2,pre),this._writeUint(size/2,post)},ISOBox.prototype._writeData=function(data){if(data)if(this._rawo){if(data instanceof Array){for(var offset=this._cursor.offset-this._rawo.byteOffset,i=0;i<data.length;i++)this._rawo.setInt8(offset+i,data[i]);this._cursor.offset+=data.length}data instanceof Uint8Array&&(this._root.bytes.set(data,this._cursor.offset),this._cursor.offset+=data.length)}else this.size+=data.length},ISOBox.prototype._writeUTF8String=function(string){var u=ISOBoxer.Utils.utf8ToByteArray(string);if(this._rawo)for(var dataView=new DataView(this._rawo.buffer,this._cursor.offset,u.length),i=0;i<u.length;i++)dataView.setUint8(i,u[i]);else this.size+=u.length},ISOBox.prototype._writeField=function(type,size,value){switch(type){case"uint":this._writeUint(size,value);break;case"int":this._writeInt(size,value);break;case"template":this._writeTemplate(size,value);break;case"string":-1==size?this._writeTerminatedString(value):this._writeString(size,value);break;case"data":this._writeData(value);break;case"utf8":this._writeUTF8String(value)}},ISOBox.prototype._boxProcessors.avc1=ISOBox.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},ISOBox.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},ISOBox.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(entry){this._procEntryField(entry,"segment_duration","uint",1===this.version?64:32),this._procEntryField(entry,"media_time","int",1===this.version?64:32),this._procEntryField(entry,"media_rate_integer","int",16),this._procEntryField(entry,"media_rate_fraction","int",16)}))},ISOBox.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},ISOBox.prototype._boxProcessors.free=ISOBox.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},ISOBox.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},ISOBox.prototype._boxProcessors.ftyp=ISOBox.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var nbCompatibleBrands=-1;this._parsing&&(nbCompatibleBrands=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",nbCompatibleBrands,"string",4)},ISOBox.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},ISOBox.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},ISOBox.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},ISOBox.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},ISOBox.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},ISOBox.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},ISOBox.prototype._boxProcessors.mp4a=ISOBox.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},ISOBox.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},ISOBox.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},ISOBox.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},ISOBox.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},ISOBox.prototype._boxProcessors.sdtp=function(){this._procFullBox();var sample_count=-1;this._parsing&&(sample_count=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",sample_count,"uint",8)},ISOBox.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(entry){this._parsing||(entry.reference=(1&entry.reference_type)<<31,entry.reference|=2147483647&entry.referenced_size,entry.sap=(1&entry.starts_with_SAP)<<31,entry.sap|=(3&entry.SAP_type)<<28,entry.sap|=268435455&entry.SAP_delta_time),this._procEntryField(entry,"reference","uint",32),this._procEntryField(entry,"subsegment_duration","uint",32),this._procEntryField(entry,"sap","uint",32),this._parsing&&(entry.reference_type=entry.reference>>31&1,entry.referenced_size=2147483647&entry.reference,entry.starts_with_SAP=entry.sap>>31&1,entry.SAP_type=entry.sap>>28&7,entry.SAP_delta_time=268435455&entry.sap)}))},ISOBox.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},ISOBox.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(subsegment){this._procEntryField(subsegment,"ranges_count","uint",32),this._procSubEntries(subsegment,"ranges",subsegment.ranges_count,(function(range){this._procEntryField(range,"level","uint",8),this._procEntryField(range,"range_size","uint",24)}))}))},ISOBox.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},ISOBox.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(entry){this._procEntryField(entry,"sample_delta","uint",32),this._procEntryField(entry,"subsample_count","uint",16),this._procSubEntries(entry,"subsamples",entry.subsample_count,(function(subsample){this._procEntryField(subsample,"subsample_size","uint",1===this.version?32:16),this._procEntryField(subsample,"subsample_priority","uint",8),this._procEntryField(subsample,"discardable","uint",8),this._procEntryField(subsample,"codec_specific_parameters","uint",32)}))}))},ISOBox.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},ISOBox.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},ISOBox.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},ISOBox.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(entry){this._procEntryField(entry,"time","uint",1===this.version?64:32),this._procEntryField(entry,"moof_offset","uint",1===this.version?64:32),this._procEntryField(entry,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(entry,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(entry,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},ISOBox.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},ISOBox.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},ISOBox.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(sample){256&this.flags&&this._procEntryField(sample,"sample_duration","uint",32),512&this.flags&&this._procEntryField(sample,"sample_size","uint",32),1024&this.flags&&this._procEntryField(sample,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(sample,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))},ISOBox.prototype._boxProcessors["url "]=ISOBox.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},ISOBox.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},ISOBox.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},ISOBox.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},ISOBox.prototype._boxProcessors.vtte=function(){}},1403:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_imsc=__webpack_require__(1425);function TextTracks(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,Cue=void 0,videoModel=void 0,textTrackQueue=void 0,trackElementArr=void 0,currentTrackIdx=void 0,actualVideoLeft=void 0,actualVideoTop=void 0,actualVideoWidth=void 0,actualVideoHeight=void 0,captionContainer=void 0,videoSizeCheckInterval=void 0,fullscreenAttribute=void 0,displayCCOnTop=void 0,previousISDState=void 0,topZIndex=void 0;function createTrackForUserAgent(i){var kind=textTrackQueue[i].kind,label=void 0!==textTrackQueue[i].id?textTrackQueue[i].id:textTrackQueue[i].lang,lang=textTrackQueue[i].lang,isTTML=textTrackQueue[i].isTTML,isEmbedded=textTrackQueue[i].isEmbedded,track=videoModel.addTextTrack(kind,label,lang);return track.isEmbedded=isEmbedded,track.isTTML=isTTML,track}function getVideoVisibleVideoSize(viewWidth,viewHeight,videoWidth,videoHeight,aspectRatio,use80Percent){var videoPictureWidth=0,videoPictureHeight=0;viewWidth/viewHeight>videoWidth/videoHeight?videoPictureWidth=(videoPictureHeight=viewHeight)/videoHeight*videoWidth:videoPictureHeight=(videoPictureWidth=viewWidth)/videoWidth*videoHeight;var videoPictureXAspect,videoPictureYAspect,videoPictureWidthAspect=0,videoPictureHeightAspect=0;return videoPictureWidth/videoPictureHeight>aspectRatio?(videoPictureHeightAspect=videoPictureHeight,videoPictureWidthAspect=videoPictureHeight*aspectRatio):(videoPictureWidthAspect=videoPictureWidth,videoPictureHeightAspect=videoPictureWidth/aspectRatio),videoPictureXAspect=(viewWidth-videoPictureWidthAspect)/2,videoPictureYAspect=(viewHeight-videoPictureHeightAspect)/2,use80Percent?{x:videoPictureXAspect+.1*videoPictureWidthAspect,y:videoPictureYAspect+.1*videoPictureHeightAspect,w:.8*videoPictureWidthAspect,h:.8*videoPictureHeightAspect}:{x:videoPictureXAspect,y:videoPictureYAspect,w:videoPictureWidthAspect,h:videoPictureHeightAspect}}function checkVideoSize(track,forceDrawing){var clientWidth=videoModel.getClientWidth(),clientHeight=videoModel.getClientHeight(),videoWidth=videoModel.getVideoWidth(),videoHeight=videoModel.getVideoHeight(),videoOffsetTop=videoModel.getVideoRelativeOffsetTop(),videoOffsetLeft=videoModel.getVideoRelativeOffsetLeft(),aspectRatio=videoWidth/videoHeight,use80Percent=!1;track.isFromCEA608&&(aspectRatio=3.5/3,use80Percent=!0);var realVideoSize=getVideoVisibleVideoSize.call(this,clientWidth,clientHeight,videoWidth,videoHeight,aspectRatio,use80Percent),newVideoWidth=realVideoSize.w,newVideoHeight=realVideoSize.h,newVideoLeft=realVideoSize.x,newVideoTop=realVideoSize.y;if(newVideoWidth!=actualVideoWidth||newVideoHeight!=actualVideoHeight||newVideoLeft!=actualVideoLeft||newVideoTop!=actualVideoTop||forceDrawing){if(actualVideoLeft=newVideoLeft+videoOffsetLeft,actualVideoTop=newVideoTop+videoOffsetTop,actualVideoWidth=newVideoWidth,actualVideoHeight=newVideoHeight,captionContainer){var containerStyle=captionContainer.style;containerStyle.left=actualVideoLeft+"px",containerStyle.top=actualVideoTop+"px",containerStyle.width=actualVideoWidth+"px",containerStyle.height=actualVideoHeight+"px",containerStyle.zIndex=fullscreenAttribute&&document[fullscreenAttribute]||displayCCOnTop?topZIndex:null,eventBus.trigger(_coreEventsEvents2.default.CAPTION_CONTAINER_RESIZE,{})}var activeCues=track.activeCues;if(activeCues)for(var len=activeCues.length,i=0;i<len;++i){var cue=activeCues[i];cue.scaleCue(cue)}}}function scaleCue(activeCue){var videoWidth=actualVideoWidth,videoHeight=actualVideoHeight,key=void 0,replaceValue=void 0,valueFontSize=void 0,valueLineHeight=void 0,elements=void 0;if(activeCue.cellResolution){var cellUnit=[videoWidth/activeCue.cellResolution[0],videoHeight/activeCue.cellResolution[1]];if(activeCue.linePadding)for(key in activeCue.linePadding)if(activeCue.linePadding.hasOwnProperty(key)){replaceValue=(activeCue.linePadding[key]*cellUnit[0]).toString();for(var elementsSpan=document.getElementsByClassName("spanPadding"),i=0;i<elementsSpan.length;i++)elementsSpan[i].style.cssText=elementsSpan[i].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+replaceValue),elementsSpan[i].style.cssText=elementsSpan[i].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+replaceValue)}if(activeCue.fontSize){for(key in activeCue.fontSize)if(activeCue.fontSize.hasOwnProperty(key)){"%"===activeCue.fontSize[key][0]?valueFontSize=activeCue.fontSize[key][1]/100:"c"===activeCue.fontSize[key][0]&&(valueFontSize=activeCue.fontSize[key][1]),replaceValue=(valueFontSize*cellUnit[1]).toString(),elements="defaultFontSize"!==key?document.getElementsByClassName(key):document.getElementsByClassName("paragraph");for(var j=0;j<elements.length;j++)elements[j].style.cssText=elements[j].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+replaceValue)}if(activeCue.lineHeight)for(key in activeCue.lineHeight)if(activeCue.lineHeight.hasOwnProperty(key)){"%"===activeCue.lineHeight[key][0]?valueLineHeight=activeCue.lineHeight[key][1]/100:"c"===activeCue.fontSize[key][0]&&(valueLineHeight=activeCue.lineHeight[key][1]),replaceValue=(valueLineHeight*cellUnit[1]).toString(),elements=document.getElementsByClassName(key);for(var k=0;k<elements.length;k++)elements[k].style.cssText=elements[k].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+replaceValue)}}}if(activeCue.isd){var htmlCaptionDiv=document.getElementById(activeCue.cueID);htmlCaptionDiv&&captionContainer.removeChild(htmlCaptionDiv),renderCaption(activeCue)}}function renderCaption(cue){if(captionContainer){var finalCue=document.createElement("div");captionContainer.appendChild(finalCue),previousISDState=(0,_imsc.renderHTML)(cue.isd,finalCue,(function(uri){var imsc1ImgUrnTester=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,smpteImgUrnTester=/^#(.*)$/;if(imsc1ImgUrnTester.test(uri)){var match=imsc1ImgUrnTester.exec(uri),imageId=parseInt(match[4],10)-1;return"data:image/png;base64,"+btoa(cue.images[imageId])}if(smpteImgUrnTester.test(uri)){imageId=(match=smpteImgUrnTester.exec(uri))[1];return"data:image/png;base64,"+cue.embeddedImages[imageId]}return null}),captionContainer.clientHeight,captionContainer.clientWidth,!1,(function(err){logger.info("renderCaption :",err)}),previousISDState,!0),finalCue.id=cue.cueID,eventBus.trigger(_coreEventsEvents2.default.CAPTION_RENDERED,{captionDiv:finalCue,currentTrackIdx:currentTrackIdx})}}function getTrackByIdx(idx){return idx>=0&&textTrackQueue[idx]?videoModel.getTextTrack(textTrackQueue[idx].kind,textTrackQueue[idx].id,textTrackQueue[idx].lang,textTrackQueue[idx].isTTML,textTrackQueue[idx].isEmbedded):null}function setCurrentTrackIdx(idx){if(idx!==currentTrackIdx){var track=getTrackByIdx(currentTrackIdx=idx);setCueStyleOnTrack.call(this,track),videoSizeCheckInterval&&(clearInterval(videoSizeCheckInterval),videoSizeCheckInterval=null),track&&"html"===track.renderingType&&(checkVideoSize.call(this,track,!0),videoSizeCheckInterval=setInterval(checkVideoSize.bind(this,track),500))}}function setCueStyleOnTrack(track){clearCaptionContainer.call(this),track&&"html"===track.renderingType?setNativeCueStyle.call(this):removeNativeCueStyle.call(this)}function deleteTrackCues(track){if(track.cues)for(var cues=track.cues,r=cues.length-1;r>=0;r--)track.removeCue(cues[r])}function setNativeCueStyle(){var styleElement=document.getElementById("native-cue-style");if(!styleElement){(styleElement=document.createElement("style")).id="native-cue-style",document.head.appendChild(styleElement);var stylesheet=styleElement.sheet,video=videoModel.getElement();try{video&&(video.id?stylesheet.insertRule("#"+video.id+"::cue {background: transparent}",0):0!==video.classList.length?stylesheet.insertRule("."+video.className+"::cue {background: transparent}",0):stylesheet.insertRule("video::cue {background: transparent}",0))}catch(e){logger.info(""+e.message)}}}function removeNativeCueStyle(){var styleElement=document.getElementById("native-cue-style");styleElement&&document.head.removeChild(styleElement)}function clearCaptionContainer(){if(captionContainer)for(;captionContainer.firstChild;)captionContainer.removeChild(captionContainer.firstChild)}return instance={initialize:function initialize(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(Cue=window.VTTCue||window.TextTrackCue,textTrackQueue=[],trackElementArr=[],currentTrackIdx=-1,actualVideoLeft=0,actualVideoTop=0,actualVideoWidth=0,actualVideoHeight=0,captionContainer=null,videoSizeCheckInterval=null,displayCCOnTop=!1,topZIndex=2147483647,previousISDState=null,void 0!==document.fullscreenElement?fullscreenAttribute="fullscreenElement":void 0!==document.webkitIsFullScreen?fullscreenAttribute="webkitIsFullScreen":document.msFullscreenElement?fullscreenAttribute="msFullscreenElement":document.mozFullScreen&&(fullscreenAttribute="mozFullScreen"))},displayCConTop:function displayCConTop(value){displayCCOnTop=value,captionContainer&&!document[fullscreenAttribute]&&(captionContainer.style.zIndex=value?topZIndex:null)},addTextTrack:function addTextTrack(textTrackInfoVO,totalTextTracks){if(textTrackQueue.length!==totalTextTracks){if(textTrackQueue.push(textTrackInfoVO),textTrackQueue.length===totalTextTracks){textTrackQueue.sort((function(a,b){return a.index-b.index})),captionContainer=videoModel.getTTMLRenderingDiv();for(var defaultIndex=-1,i=0;i<textTrackQueue.length;i++){var track=createTrackForUserAgent.call(this,i);trackElementArr.push(track),textTrackQueue[i].defaultTrack&&(track.default=!0,defaultIndex=i);var textTrack=getTrackByIdx(i);textTrack&&(textTrack.mode=_constantsConstants2.default.TEXT_SHOWING,captionContainer&&(textTrackQueue[i].isTTML||textTrackQueue[i].isEmbedded)?textTrack.renderingType="html":textTrack.renderingType="default"),this.addCaptions(i,0,textTrackQueue[i].captionData),eventBus.trigger(_coreEventsEvents2.default.TEXT_TRACK_ADDED)}if(setCurrentTrackIdx.call(this,defaultIndex),defaultIndex>=0)for(var idx=0;idx<textTrackQueue.length;idx++){var videoTextTrack=getTrackByIdx(idx);videoTextTrack&&(videoTextTrack.mode=idx===defaultIndex?_constantsConstants2.default.TEXT_SHOWING:_constantsConstants2.default.TEXT_HIDDEN)}eventBus.trigger(_coreEventsEvents2.default.TEXT_TRACKS_QUEUE_INITIALIZED,{index:currentTrackIdx,tracks:textTrackQueue})}}else logger.error("Trying to add too many tracks.")},addCaptions:function addCaptions(trackIdx,timeOffset,captionData){var track=getTrackByIdx(trackIdx),self=this;if(track&&captionData&&0!==captionData.length)for(var item=0;item<captionData.length;item++){var cue=void 0,currentItem=captionData[item];track.cellResolution=currentItem.cellResolution,track.isFromCEA608=currentItem.isFromCEA608,"html"===currentItem.type&&captionContainer?((cue=new Cue(currentItem.start-timeOffset,currentItem.end-timeOffset,"")).cueHTMLElement=currentItem.cueHTMLElement,cue.isd=currentItem.isd,cue.images=currentItem.images,cue.embeddedImages=currentItem.embeddedImages,cue.cueID=currentItem.cueID,cue.scaleCue=scaleCue.bind(self),cue.cellResolution=currentItem.cellResolution,cue.lineHeight=currentItem.lineHeight,cue.linePadding=currentItem.linePadding,cue.fontSize=currentItem.fontSize,captionContainer.style.left=actualVideoLeft+"px",captionContainer.style.top=actualVideoTop+"px",captionContainer.style.width=actualVideoWidth+"px",captionContainer.style.height=actualVideoHeight+"px",cue.onenter=function(){track.mode===_constantsConstants2.default.TEXT_SHOWING&&(this.isd?(renderCaption(this),logger.debug("Cue enter id:"+this.cueID)):(captionContainer.appendChild(this.cueHTMLElement),scaleCue.call(self,this),eventBus.trigger(_coreEventsEvents2.default.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:currentTrackIdx})))},cue.onexit=function(){if(captionContainer)for(var divs=captionContainer.childNodes,i=0;i<divs.length;++i)divs[i].id===this.cueID&&(logger.debug("Cue exit id:"+divs[i].id),captionContainer.removeChild(divs[i]))}):currentItem.data&&(cue=new Cue(currentItem.start-timeOffset,currentItem.end-timeOffset,currentItem.data),currentItem.styles&&(void 0!==currentItem.styles.align&&"align"in cue&&(cue.align=currentItem.styles.align),void 0!==currentItem.styles.line&&"line"in cue&&(cue.line=currentItem.styles.line),void 0!==currentItem.styles.position&&"position"in cue&&(cue.position=currentItem.styles.position),void 0!==currentItem.styles.size&&"size"in cue&&(cue.size=currentItem.styles.size)),cue.onenter=function(){track.mode===_constantsConstants2.default.TEXT_SHOWING&&eventBus.trigger(_coreEventsEvents2.default.CAPTION_RENDERED,{currentTrackIdx:currentTrackIdx})});try{cue?track.addCue(cue):logger.error("impossible to display subtitles.")}catch(e){throw deleteTrackCues(track),track.addCue(cue),e}}},getCurrentTrackIdx:function getCurrentTrackIdx(){return currentTrackIdx},setCurrentTrackIdx:setCurrentTrackIdx,getTrackIdxForId:function getTrackIdxForId(trackId){for(var idx=-1,i=0;i<textTrackQueue.length;i++)if(textTrackQueue[i].id===trackId){idx=i;break}return idx},getCurrentTrackInfo:function getCurrentTrackInfo(){return textTrackQueue[currentTrackIdx]},setModeForTrackIdx:function setModeForTrackIdx(idx,mode){var track=getTrackByIdx(idx);track&&track.mode!==mode&&(track.mode=mode)},deleteCuesFromTrackIdx:function deleteCuesFromTrackIdx(trackIdx){var track=getTrackByIdx(trackIdx);track&&deleteTrackCues(track)},deleteAllTextTracks:function deleteAllTextTracks(){for(var ln=trackElementArr?trackElementArr.length:0,i=0;i<ln;i++){var track=getTrackByIdx(i);track&&(deleteTrackCues.call(this,track),track.mode="disabled")}trackElementArr=[],textTrackQueue=[],videoSizeCheckInterval&&(clearInterval(videoSizeCheckInterval),videoSizeCheckInterval=null),currentTrackIdx=-1,clearCaptionContainer.call(this)},deleteTextTrack:function deleteTextTrack(idx){videoModel.removeChild(trackElementArr[idx]),trackElementArr.splice(idx,1)},setConfig:function setConfig(config){config&&config.videoModel&&(videoModel=config.videoModel)}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}TextTracks.__dashjs_factory_name="TextTracks",exports.default=_coreFactoryMaker2.default.getSingletonFactory(TextTracks),module.exports=exports.default},1404:function(module,exports,__webpack_require__){!function(imscStyles,imscNames,imscUtils){function StylingAttributeDefinition(ns,name,initialValue,appliesTo,isInherit,isAnimatable,parseFunc,computeFunc){this.name=name,this.ns=ns,this.qname=ns+" "+name,this.inherit=isInherit,this.animatable=isAnimatable,this.initial=initialValue,this.applies=appliesTo,this.parse=parseFunc,this.compute=computeFunc}for(var i in imscStyles.all=[new StylingAttributeDefinition(imscNames.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,imscUtils.parseColor,null),new StylingAttributeDefinition(imscNames.ns_tts,"color","white",["span"],!0,!0,imscUtils.parseColor,null),new StylingAttributeDefinition(imscNames.ns_tts,"direction","ltr",["p","span"],!0,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"displayAlign","before",["region"],!1,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"extent","auto",["tt","region"],!1,!0,(function(str){if("auto"===str)return str;var s=str.split(" ");if(2!==s.length)return null;var w=imscUtils.parseLength(s[0]),h=imscUtils.parseLength(s[1]);return h&&w?{h:h,w:w}:null}),(function(doc,parent,element,attr,context){var h,w;if("auto"===attr)h=new imscUtils.ComputedLength(0,1);else if(null===(h=imscUtils.toComputedLength(attr.h.value,attr.h.unit,null,doc.dimensions.h,null,doc.pxLength.h)))return null;if("auto"===attr)w=new imscUtils.ComputedLength(1,0);else if(null===(w=imscUtils.toComputedLength(attr.w.value,attr.w.unit,null,doc.dimensions.w,null,doc.pxLength.w)))return null;return{h:h,w:w}})),new StylingAttributeDefinition(imscNames.ns_tts,"fontFamily","default",["span"],!0,!0,(function(str){var ffs=str.split(","),rslt=[];for(var i in ffs)"'"!==ffs[i].charAt(0)&&'"'!==ffs[i].charAt(0)&&"default"===ffs[i]?rslt.push("monospaceSerif"):rslt.push(ffs[i]);return rslt}),null),new StylingAttributeDefinition(imscNames.ns_tts,"shear","0%",["p"],!0,!0,imscUtils.parseLength,(function(doc,parent,element,attr){return"%"!==attr.unit?null:Math.abs(attr.value)>100?100*Math.sign(attr.value):attr.value})),new StylingAttributeDefinition(imscNames.ns_tts,"fontSize","1c",["span"],!0,!0,imscUtils.parseLength,(function(doc,parent,element,attr,context){return imscUtils.toComputedLength(attr.value,attr.unit,null!==parent?parent.styleAttrs[imscStyles.byName.fontSize.qname]:doc.cellLength.h,null!==parent?parent.styleAttrs[imscStyles.byName.fontSize.qname]:doc.cellLength.h,doc.cellLength.h,doc.pxLength.h)})),new StylingAttributeDefinition(imscNames.ns_tts,"fontStyle","normal",["span"],!0,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"fontWeight","normal",["span"],!0,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"lineHeight","normal",["p"],!0,!0,(function(str){return"normal"===str?str:imscUtils.parseLength(str)}),(function(doc,parent,element,attr,context){var lh;if("normal"===attr)lh=attr;else if(null===(lh=imscUtils.toComputedLength(attr.value,attr.unit,element.styleAttrs[imscStyles.byName.fontSize.qname],element.styleAttrs[imscStyles.byName.fontSize.qname],doc.cellLength.h,doc.pxLength.h)))return null;return lh})),new StylingAttributeDefinition(imscNames.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new StylingAttributeDefinition(imscNames.ns_tts,"origin","auto",["region"],!1,!0,(function(str){if("auto"===str)return str;var s=str.split(" ");if(2!==s.length)return null;var w=imscUtils.parseLength(s[0]),h=imscUtils.parseLength(s[1]);return h&&w?{h:h,w:w}:null}),(function(doc,parent,element,attr,context){var h,w;if("auto"===attr)h=new imscUtils.ComputedLength(0,0);else if(null===(h=imscUtils.toComputedLength(attr.h.value,attr.h.unit,null,doc.dimensions.h,null,doc.pxLength.h)))return null;if("auto"===attr)w=new imscUtils.ComputedLength(0,0);else if(null===(w=imscUtils.toComputedLength(attr.w.value,attr.w.unit,null,doc.dimensions.w,null,doc.pxLength.w)))return null;return{h:h,w:w}})),new StylingAttributeDefinition(imscNames.ns_tts,"overflow","hidden",["region"],!1,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"padding","0px",["region"],!1,!0,(function(str){var s=str.split(" ");if(s.length>4)return null;var r=[];for(var i in s){var l=imscUtils.parseLength(s[i]);if(!l)return null;r.push(l)}return r}),(function(doc,parent,element,attr,context){var padding;if(1===attr.length)padding=[attr[0],attr[0],attr[0],attr[0]];else if(2===attr.length)padding=[attr[0],attr[1],attr[0],attr[1]];else if(3===attr.length)padding=[attr[0],attr[1],attr[2],attr[1]];else{if(4!==attr.length)return null;padding=[attr[0],attr[1],attr[2],attr[3]]}var dir=element.styleAttrs[imscStyles.byName.writingMode.qname];if("lrtb"===dir||"lr"===dir)padding=[padding[0],padding[3],padding[2],padding[1]];else if("rltb"===dir||"rl"===dir)padding=[padding[0],padding[1],padding[2],padding[3]];else if("tblr"===dir)padding=[padding[3],padding[0],padding[1],padding[2]];else{if("tbrl"!==dir&&"tb"!==dir)return null;padding=[padding[3],padding[2],padding[1],padding[0]]}var out=[];for(var i in padding)if(0===padding[i].value)out[i]=new imscUtils.ComputedLength(0,0);else if(out[i]=imscUtils.toComputedLength(padding[i].value,padding[i].unit,element.styleAttrs[imscStyles.byName.fontSize.qname],"0"===i||"2"===i?element.styleAttrs[imscStyles.byName.extent.qname].h:element.styleAttrs[imscStyles.byName.extent.qname].w,"0"===i||"2"===i?doc.cellLength.h:doc.cellLength.w,"0"===i||"2"===i?doc.pxLength.h:doc.pxLength.w),null===out[i])return null;return out})),new StylingAttributeDefinition(imscNames.ns_tts,"position","top left",["region"],!1,!0,(function(str){return imscUtils.parsePosition(str)}),(function(doc,parent,element,attr){var h,w;return null===(h=imscUtils.toComputedLength(attr.v.offset.value,attr.v.offset.unit,null,new imscUtils.ComputedLength(-element.styleAttrs[imscStyles.byName.extent.qname].h.rw,doc.dimensions.h.rh-element.styleAttrs[imscStyles.byName.extent.qname].h.rh),null,doc.pxLength.h))?null:("bottom"===attr.v.edge&&(h=new imscUtils.ComputedLength(-h.rw-element.styleAttrs[imscStyles.byName.extent.qname].h.rw,doc.dimensions.h.rh-h.rh-element.styleAttrs[imscStyles.byName.extent.qname].h.rh)),w=imscUtils.toComputedLength(attr.h.offset.value,attr.h.offset.unit,null,new imscUtils.ComputedLength(doc.dimensions.w.rw-element.styleAttrs[imscStyles.byName.extent.qname].w.rw,-element.styleAttrs[imscStyles.byName.extent.qname].w.rh),null,doc.pxLength.w),null===h?null:("right"===attr.h.edge&&(w=new imscUtils.ComputedLength(doc.dimensions.w.rw-w.rw-element.styleAttrs[imscStyles.byName.extent.qname].w.rw,-w.rh-element.styleAttrs[imscStyles.byName.extent.qname].w.rh)),{h:h,w:w}))})),new StylingAttributeDefinition(imscNames.ns_tts,"ruby","none",["span"],!1,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"rubyAlign","center",["span"],!0,!0,(function(str){return"center"!==str&&"spaceAround"!==str?null:str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"rubyPosition","outside",["span"],!0,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"rubyReserve","none",["p"],!0,!0,(function(str){var s=str.split(" "),r=[null,null];if(0===s.length||s.length>2)return null;if("none"!==s[0]&&"both"!==s[0]&&"after"!==s[0]&&"before"!==s[0]&&"outside"!==s[0])return null;if(r[0]=s[0],2===s.length&&"none"!==s[0]){var l=imscUtils.parseLength(s[1]);if(!l)return null;r[1]=l}return r}),(function(doc,parent,element,attr,context){if("none"===attr[0])return attr;var fs=null;return null===(fs=null===attr[1]?new imscUtils.ComputedLength(.5*element.styleAttrs[imscStyles.byName.fontSize.qname].rw,.5*element.styleAttrs[imscStyles.byName.fontSize.qname].rh):imscUtils.toComputedLength(attr[1].value,attr[1].unit,element.styleAttrs[imscStyles.byName.fontSize.qname],element.styleAttrs[imscStyles.byName.fontSize.qname],doc.cellLength.h,doc.pxLength.h))?null:[attr[0],fs]})),new StylingAttributeDefinition(imscNames.ns_tts,"showBackground","always",["region"],!1,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"textAlign","start",["p"],!0,!0,(function(str){return str}),(function(doc,parent,element,attr,context){return"left"===attr?"start":"right"===attr?"end":attr})),new StylingAttributeDefinition(imscNames.ns_tts,"textCombine","none",["span"],!0,!0,(function(str){var s=str.split(" ");return 1!==s.length||"none"!==s[0]&&"all"!==s[0]?null:[s[0]]}),null),new StylingAttributeDefinition(imscNames.ns_tts,"textDecoration","none",["span"],!0,!0,(function(str){return str.split(" ")}),null),new StylingAttributeDefinition(imscNames.ns_tts,"textEmphasis","none",["span"],!0,!0,(function(str){var e=str.split(" "),rslt={style:null,symbol:null,color:null,position:null};for(var i in e)if("none"===e[i]||"auto"===e[i])rslt.style=e[i];else if("filled"===e[i]||"open"===e[i])rslt.style=e[i];else if("circle"===e[i]||"dot"===e[i]||"sesame"===e[i])rslt.symbol=e[i];else if("current"===e[i])rslt.color=e[i];else if("outside"===e[i]||"before"===e[i]||"after"===e[i])rslt.position=e[i];else if(rslt.color=imscUtils.parseColor(e[i]),null===rslt.color)return null;return null==rslt.style&&null==rslt.symbol?rslt.style="auto":(rslt.symbol=rslt.symbol||"circle",rslt.style=rslt.style||"filled"),rslt.position=rslt.position||"outside",rslt.color=rslt.color||"current",rslt}),null),new StylingAttributeDefinition(imscNames.ns_tts,"textOutline","none",["span"],!0,!0,(function(str){if("none"===str)return str;var r={},s=str.split(" ");if(0===s.length||s.length>2)return null;var c=imscUtils.parseColor(s[0]);if(r.color=c,null!==c&&s.shift(),1!==s.length)return null;var l=imscUtils.parseLength(s[0]);return l?(r.thickness=l,r):null}),(function(doc,parent,element,attr,context){if("none"===attr)return attr;var rslt={};return null===attr.color?rslt.color=element.styleAttrs[imscStyles.byName.color.qname]:rslt.color=attr.color,rslt.thickness=imscUtils.toComputedLength(attr.thickness.value,attr.thickness.unit,element.styleAttrs[imscStyles.byName.fontSize.qname],element.styleAttrs[imscStyles.byName.fontSize.qname],doc.cellLength.h,doc.pxLength.h),null===rslt.thickness?null:rslt})),new StylingAttributeDefinition(imscNames.ns_tts,"textShadow","none",["span"],!0,!0,imscUtils.parseTextShadow,(function(doc,parent,element,attr){if("none"===attr)return attr;var r=[];for(var i in attr){var shadow={};if(shadow.x_off=imscUtils.toComputedLength(attr[i][0].value,attr[i][0].unit,null,element.styleAttrs[imscStyles.byName.fontSize.qname],null,doc.pxLength.w),null===shadow.x_off)return null;if(shadow.y_off=imscUtils.toComputedLength(attr[i][1].value,attr[i][1].unit,null,element.styleAttrs[imscStyles.byName.fontSize.qname],null,doc.pxLength.h),null===shadow.y_off)return null;if(null===attr[i][2])shadow.b_radius=0;else if(shadow.b_radius=imscUtils.toComputedLength(attr[i][2].value,attr[i][2].unit,null,element.styleAttrs[imscStyles.byName.fontSize.qname],null,doc.pxLength.h),null===shadow.b_radius)return null;null===attr[i][3]?shadow.color=element.styleAttrs[imscStyles.byName.color.qname]:shadow.color=attr[i][3],r.push(shadow)}return r})),new StylingAttributeDefinition(imscNames.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"wrapOption","wrap",["span"],!0,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"writingMode","lrtb",["region"],!1,!0,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_tts,"zIndex","auto",["region"],!1,!0,(function(str){var rslt;return"auto"===str?rslt=str:(rslt=parseInt(str),isNaN(rslt)&&(rslt=null)),rslt}),null),new StylingAttributeDefinition(imscNames.ns_ebutts,"linePadding","0c",["p"],!0,!1,imscUtils.parseLength,(function(doc,parent,element,attr,context){return imscUtils.toComputedLength(attr.value,attr.unit,null,null,doc.cellLength.w,null)})),new StylingAttributeDefinition(imscNames.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_smpte,"backgroundImage",null,["div"],!1,!1,(function(str){return str}),null),new StylingAttributeDefinition(imscNames.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,(function(str){return"true"===str}),null),new StylingAttributeDefinition(imscNames.ns_itts,"fillLineGap","false",["p"],!0,!0,(function(str){return"true"===str}),null)],imscStyles.byQName={},imscStyles.all)imscStyles.byQName[imscStyles.all[i].qname]=imscStyles.all[i];for(var j in imscStyles.byName={},imscStyles.all)imscStyles.byName[imscStyles.all[j].name]=imscStyles.all[j]}(exports,"undefined"==typeof imscNames?__webpack_require__(1392):imscNames,"undefined"==typeof imscUtils?__webpack_require__(1393):imscUtils)},1405:function(module,exports,__webpack_require__){"use strict";var ReflectOwnKeys,R="object"==typeof Reflect?Reflect:null,ReflectApply=R&&"function"==typeof R.apply?R.apply:function ReflectApply(target,receiver,args){return Function.prototype.apply.call(target,receiver,args)};ReflectOwnKeys=R&&"function"==typeof R.ownKeys?R.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))}:function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target)};var NumberIsNaN=Number.isNaN||function NumberIsNaN(value){return value!=value};function EventEmitter(){EventEmitter.init.call(this)}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(listener){if("function"!=typeof listener)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener)}function _getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var m,events,existing;if(checkListener(listener),void 0===(events=target._events)?(events=target._events=Object.create(null),target._eventsCount=0):(void 0!==events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]),void 0===existing)existing=events[type]=listener,++target._eventsCount;else if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),(m=_getMaxListeners(target))>0&&existing.length>m&&!existing.warned){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+String(type)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,function ProcessEmitWarning(warning){console&&console.warn&&console.warn(warning)}(w)}return target}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(target,type,listener){var state={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},wrapped=onceWrapper.bind(state);return wrapped.listener=listener,state.wrapFn=wrapped,wrapped}function _listeners(target,type,unwrap){var events=target._events;if(void 0===events)return[];var evlistener=events[type];return void 0===evlistener?[]:"function"==typeof evlistener?unwrap?[evlistener.listener||evlistener]:[evlistener]:unwrap?function unwrapListeners(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}(evlistener):arrayClone(evlistener,evlistener.length)}function listenerCount(type){var events=this._events;if(void 0!==events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(void 0!==evlistener)return evlistener.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||NumberIsNaN(arg))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+arg+".");defaultMaxListeners=arg}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if("number"!=typeof n||n<0||NumberIsNaN(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function emit(type){for(var args=[],i=1;i<arguments.length;i++)args.push(arguments[i]);var doError="error"===type,events=this._events;if(void 0!==events)doError=doError&&void 0===events.error;else if(!doError)return!1;if(doError){var er;if(args.length>0&&(er=args[0]),er instanceof Error)throw er;var err=new Error("Unhandled error."+(er?" ("+er.message+")":""));throw err.context=er,err}var handler=events[type];if(void 0===handler)return!1;if("function"==typeof handler)ReflectApply(handler,this,args);else{var len=handler.length,listeners=arrayClone(handler,len);for(i=0;i<len;++i)ReflectApply(listeners[i],this,args)}return!0},EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function once(type,listener){return checkListener(listener),this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){return checkListener(listener),this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(checkListener(listener),void 0===(events=this._events))return this;if(void 0===(list=events[type]))return this;if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=Object.create(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;i>=0;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():function spliceOne(list,index){for(;index+1<list.length;index++)list[index]=list[index+1];list.pop()}(list,position),1===list.length&&(events[type]=list[0]),void 0!==events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;if(void 0===(events=this._events))return this;if(void 0===events.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==events[type]&&(0==--this._eventsCount?this._events=Object.create(null):delete events[type]),this;if(0===arguments.length){var key,keys=Object.keys(events);for(i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(void 0!==listeners)for(i=listeners.length-1;i>=0;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]}},1406:function(module,exports,__webpack_require__){(exports=module.exports=__webpack_require__(1427)).Stream=exports,exports.Readable=exports,exports.Writable=__webpack_require__(1408),exports.Duplex=__webpack_require__(1379),exports.Transform=__webpack_require__(1430),exports.PassThrough=__webpack_require__(1477)},1407:function(module,exports,__webpack_require__){var buffer=__webpack_require__(1394),Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src)dst[key]=src[key]}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow?module.exports=buffer:(copyProps(buffer,exports),exports.Buffer=SafeBuffer),copyProps(Buffer,SafeBuffer),SafeBuffer.from=function(arg,encodingOrOffset,length){if("number"==typeof arg)throw new TypeError("Argument must not be a number");return Buffer(arg,encodingOrOffset,length)},SafeBuffer.alloc=function(size,fill,encoding){if("number"!=typeof size)throw new TypeError("Argument must be a number");var buf=Buffer(size);return void 0!==fill?"string"==typeof encoding?buf.fill(fill,encoding):buf.fill(fill):buf.fill(0),buf},SafeBuffer.allocUnsafe=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return Buffer(size)},SafeBuffer.allocUnsafeSlow=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return buffer.SlowBuffer(size)}},1408:function(module,exports,__webpack_require__){"use strict";(function(process,setImmediate,global){var pna=__webpack_require__(1395);function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(){!function onCorkedFinish(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;for(;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree?state.corkedRequestsFree.next=corkReq:state.corkedRequestsFree=corkReq}(_this,state)}}module.exports=Writable;var Duplex,asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:pna.nextTick;Writable.WritableState=WritableState;var util=Object.create(__webpack_require__(1387));util.inherits=__webpack_require__(1384);var internalUtil={deprecate:__webpack_require__(262)},Stream=__webpack_require__(1428),Buffer=__webpack_require__(1407).Buffer,OurUint8Array=global.Uint8Array||function(){};var realHasInstance,destroyImpl=__webpack_require__(1429);function nop(){}function WritableState(options,stream){Duplex=Duplex||__webpack_require__(1379),options=options||{};var isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode,isDuplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,writableHwm=options.writableHighWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:isDuplex&&(writableHwm||0===writableHwm)?writableHwm:defaultHwm,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var noDecode=!1===options.decodeStrings;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){!function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}(state),er)!function onwriteError(stream,state,sync,er,cb){--state.pendingcb,sync?(pna.nextTick(cb,er),pna.nextTick(finishMaybe,stream,state),stream._writableState.errorEmitted=!0,stream.emit("error",er)):(cb(er),stream._writableState.errorEmitted=!0,stream.emit("error",er),finishMaybe(stream,state))}(stream,state,sync,er,cb);else{var finished=needFinish(state);finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?asyncWrite(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(options){if(Duplex=Duplex||__webpack_require__(1379),!(realHasInstance.call(Writable,this)||this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev),"function"==typeof options.destroy&&(this._destroy=options.destroy),"function"==typeof options.final&&(this._final=options.final)),Stream.call(this)}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function afterWrite(stream,state,finished,cb){finished||function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount,buffer=new Array(l),holder=state.corkedRequestsFree;holder.entry=entry;for(var count=0,allBuffers=!0;entry;)buffer[count]=entry,entry.isBuf||(allBuffers=!1),entry=entry.next,count+=1;buffer.allBuffers=allBuffers,doWrite(stream,state,!0,state.length,buffer,"",holder.finish),state.pendingcb++,state.lastBufferedRequest=null,holder.next?(state.corkedRequestsFree=holder.next,holder.next=null):state.corkedRequestsFree=new CorkedRequest(state),state.bufferedRequestCount=0}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.bufferedRequestCount--,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function callFinal(stream,state){stream._final((function(err){state.pendingcb--,err&&stream.emit("error",err),state.prefinished=!0,stream.emit("prefinish"),finishMaybe(stream,state)}))}function finishMaybe(stream,state){var need=needFinish(state);return need&&(!function prefinish(stream,state){state.prefinished||state.finalCalled||("function"==typeof stream._final?(state.pendingcb++,state.finalCalled=!0,pna.nextTick(callFinal,stream,state)):(state.prefinished=!0,stream.emit("prefinish")))}(stream,state),0===state.pendingcb&&(state.finished=!0,stream.emit("finish"))),need}util.inherits(Writable,Stream),WritableState.prototype.getBuffer=function getBuffer(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(_){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(realHasInstance=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){return!!realHasInstance.call(this,object)||this===Writable&&(object&&object._writableState instanceof WritableState)}})):realHasInstance=function(object){return object instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1,isBuf=!state.objectMode&&function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}(chunk);return isBuf&&!Buffer.isBuffer(chunk)&&(chunk=function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}(chunk)),"function"==typeof encoding&&(cb=encoding,encoding=null),isBuf?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=nop),state.ended?function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er),pna.nextTick(cb,er)}(this,cb):(isBuf||function validChunk(stream,state,chunk,cb){var valid=!0,er=!1;return null===chunk?er=new TypeError("May not write null values to stream"):"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er&&(stream.emit("error",er),pna.nextTick(cb,er),valid=!1),valid}(this,state,chunk,cb))&&(state.pendingcb++,ret=function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=function decodeChunk(state,chunk,encoding){state.objectMode||!1===state.decodeStrings||"string"!=typeof chunk||(chunk=Buffer.from(chunk,encoding));return chunk}(state,chunk,encoding);chunk!==newChunk&&(isBuf=!0,encoding="buffer",chunk=newChunk)}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;ret||(state.needDrain=!0);if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null},last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}(this,state,isBuf,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);return this._writableState.defaultEncoding=encoding,this},Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!=chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?pna.nextTick(cb):stream.once("finish",cb));state.ended=!0,stream.writable=!1}(this,state,cb)},Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(value){this._writableState&&(this._writableState.destroyed=value)}}),Writable.prototype.destroy=destroyImpl.destroy,Writable.prototype._undestroy=destroyImpl.undestroy,Writable.prototype._destroy=function(err,cb){this.end(),cb(err)}}).call(this,__webpack_require__(260),__webpack_require__(694).setImmediate,__webpack_require__(54))},1409:function(module,exports,__webpack_require__){"use strict";var Buffer=__webpack_require__(1476).Buffer,isEncoding=Buffer.isEncoding||function(encoding){switch((encoding=""+encoding)&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function StringDecoder(encoding){var nb;switch(this.encoding=function normalizeEncoding(enc){var nenc=function _normalizeEncoding(enc){if(!enc)return"utf8";for(var retried;;)switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase(),retried=!0}}(enc);if("string"!=typeof nenc&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}(encoding),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,nb=4;break;case"utf8":this.fillLast=utf8FillLast,nb=4;break;case"base64":this.text=base64Text,this.end=base64End,nb=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(nb)}function utf8CheckByte(byte){return byte<=127?0:byte>>5==6?2:byte>>4==14?3:byte>>3==30?4:byte>>6==2?-1:-2}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed,r=function utf8CheckExtraBytes(self,buf,p){if(128!=(192&buf[0]))return self.lastNeed=0,"�";if(self.lastNeed>1&&buf.length>1){if(128!=(192&buf[1]))return self.lastNeed=1,"�";if(self.lastNeed>2&&buf.length>2&&128!=(192&buf[2]))return self.lastNeed=2,"�"}}(this,buf);return void 0!==r?r:this.lastNeed<=buf.length?(buf.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(buf.copy(this.lastChar,p,0,buf.length),void(this.lastNeed-=buf.length))}function utf16Text(buf,i){if((buf.length-i)%2==0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=buf[buf.length-1],buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;return 0===n?buf.toString("base64",i):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=buf[buf.length-1]:(this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1]),buf.toString("base64",i,buf.length-n))}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+this.lastChar.toString("base64",0,3-this.lastNeed):r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}exports.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(buf){if(0===buf.length)return"";var r,i;if(this.lastNeed){if(void 0===(r=this.fillLast(buf)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<buf.length?r?r+this.text(buf,i):this.text(buf,i):r||""},StringDecoder.prototype.end=function utf8End(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+"�":r},StringDecoder.prototype.text=function utf8Text(buf,i){var total=function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0)return nb>0&&(self.lastNeed=nb-1),nb;if(--j<i||-2===nb)return 0;if((nb=utf8CheckByte(buf[j]))>=0)return nb>0&&(self.lastNeed=nb-2),nb;if(--j<i||-2===nb)return 0;if((nb=utf8CheckByte(buf[j]))>=0)return nb>0&&(2===nb?nb=0:self.lastNeed=nb-3),nb;return 0}(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);return buf.copy(this.lastChar,0,end),buf.toString("utf8",i,end)},StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length)return buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length),this.lastNeed-=buf.length}},1410:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function MediaController(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,tracks=void 0,initialSettings=void 0,selectionMode=void 0,switchMode=void 0,domStorage=void 0,validTrackSwitchModes=["alwaysReplace","neverReplace"],validTrackSelectionModes=["highestBitrate","widestRange"];function getTracksFor(type,streamInfo){if(!type||!streamInfo)return[];var id=streamInfo.id;return tracks[id]&&tracks[id][type]?tracks[id][type].list:[]}function getCurrentTrackFor(type,streamInfo){return!type||!streamInfo||streamInfo&&!tracks[streamInfo.id]?null:tracks[streamInfo.id][type].current}function setTrack(track){if(track&&track.streamInfo){var type=track.type,streamInfo=track.streamInfo,id=streamInfo.id,current=getCurrentTrackFor(type,streamInfo);if(tracks[id]&&tracks[id][type]&&!isTracksEqual(track,current)){tracks[id][type].current=track,tracks[id][type].current&&eventBus.trigger(_coreEventsEvents2.default.CURRENT_TRACK_CHANGED,{oldMediaInfo:current,newMediaInfo:track,switchMode:switchMode[type]});var settings=function extractSettings(mediaInfo){var settings={lang:mediaInfo.lang,viewpoint:mediaInfo.viewpoint,roles:mediaInfo.roles,accessibility:mediaInfo.accessibility,audioChannelConfiguration:mediaInfo.audioChannelConfiguration};return settings.lang||settings.viewpoint||settings.role&&settings.role.length>0||settings.accessibility&&settings.accessibility.length>0||settings.audioChannelConfiguration&&settings.audioChannelConfiguration.length>0?settings:null}(track);settings&&tracks[id][type].storeLastSettings&&(settings.roles&&(settings.role=settings.roles[0],delete settings.roles),settings.accessibility&&(settings.accessibility=settings.accessibility[0]),settings.audioChannelConfiguration&&(settings.audioChannelConfiguration=settings.audioChannelConfiguration[0]),domStorage.setSavedMediaSettings(type,settings))}}}function setInitialSettings(type,value){type&&value&&(initialSettings[type]=value)}function getInitialSettings(type){return type?initialSettings[type]:null}function getSelectionModeForInitialTrack(){return selectionMode||"highestBitrate"}function isMultiTrackSupportedByType(type){return type===_constantsConstants2.default.AUDIO||type===_constantsConstants2.default.VIDEO||type===_constantsConstants2.default.TEXT||type===_constantsConstants2.default.FRAGMENTED_TEXT||type===_constantsConstants2.default.IMAGE}function isTracksEqual(t1,t2){if(!t1&&!t2)return!0;if(!t1||!t2)return!1;var sameId=t1.id===t2.id,sameViewpoint=t1.viewpoint===t2.viewpoint,sameLang=t1.lang===t2.lang,sameRoles=t1.roles.toString()===t2.roles.toString(),sameAccessibility=t1.accessibility.toString()===t2.accessibility.toString(),sameAudioChannelConfiguration=t1.audioChannelConfiguration.toString()===t2.audioChannelConfiguration.toString();return sameId&&sameViewpoint&&sameLang&&sameRoles&&sameAccessibility&&sameAudioChannelConfiguration}function reset(){tracks={},function resetInitialSettings(){initialSettings={audio:null,video:null}}(),function resetSwitchMode(){switchMode={audio:"alwaysReplace",video:"neverReplace"}}()}function matchSettings(settings,track){var matchLang=!settings.lang||settings.lang===track.lang,matchViewPoint=!settings.viewpoint||settings.viewpoint===track.viewpoint,matchRole=!settings.role||!!track.roles.filter((function(item){return item===settings.role}))[0],matchAccessibility=!settings.accessibility||!!track.accessibility.filter((function(item){return item===settings.accessibility}))[0],matchAudioChannelConfiguration=!settings.audioChannelConfiguration||!!track.audioChannelConfiguration.filter((function(item){return item===settings.audioChannelConfiguration}))[0];return matchLang&&matchViewPoint&&matchRole&&matchAccessibility&&matchAudioChannelConfiguration}function selectInitialTrack(tracks){var mode=getSelectionModeForInitialTrack(),tmpArr=[],getTracksWithHighestBitrate=function getTracksWithHighestBitrate(trackArr){var max=0,result=[],tmp=void 0;return trackArr.forEach((function(track){(tmp=Math.max.apply(Math,track.bitrateList.map((function(obj){return obj.bandwidth}))))>max?(max=tmp,result=[track]):tmp===max&&result.push(track)})),result},getTracksWithWidestRange=function getTracksWithWidestRange(trackArr){var max=0,result=[],tmp=void 0;return trackArr.forEach((function(track){(tmp=track.representationCount)>max?(max=tmp,result=[track]):tmp===max&&result.push(track)})),result};switch(mode){case"highestBitrate":(tmpArr=getTracksWithHighestBitrate(tracks)).length>1&&(tmpArr=getTracksWithWidestRange(tmpArr));break;case"widestRange":(tmpArr=getTracksWithWidestRange(tracks)).length>1&&(tmpArr=getTracksWithHighestBitrate(tracks));break;default:logger.warn("Track selection mode is not supported: "+mode)}return tmpArr[0]}return instance={checkInitialMediaSettingsForType:function checkInitialMediaSettingsForType(type,streamInfo){var settings=getInitialSettings(type),tracksForType=getTracksFor(type,streamInfo),tracks=[];type!==_constantsConstants2.default.FRAGMENTED_TEXT?(settings||setInitialSettings(type,settings=domStorage.getSavedMediaSettings(type)),tracksForType&&0!==tracksForType.length&&(settings&&tracksForType.forEach((function(track){matchSettings(settings,track)&&tracks.push(track)})),0===tracks.length?setTrack(selectInitialTrack(tracksForType)):tracks.length>1?setTrack(selectInitialTrack(tracks)):setTrack(tracks[0]))):setTrack(tracksForType[0])},addTrack:function addTrack(track){if(track){var mediaType=track.type;if(isMultiTrackSupportedByType(mediaType)){var streamId=track.streamInfo.id;tracks[streamId]||(tracks[streamId]={audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}});for(var mediaTracks=tracks[streamId][mediaType].list,i=0,len=mediaTracks.length;i<len;++i)if(isTracksEqual(mediaTracks[i],track))return;mediaTracks.push(track);var initSettings=getInitialSettings(mediaType);initSettings&&matchSettings(initSettings,track)&&!getCurrentTrackFor(mediaType,track.streamInfo)&&setTrack(track)}}},getTracksFor:getTracksFor,getCurrentTrackFor:getCurrentTrackFor,isCurrentTrack:function isCurrentTrack(track){if(!track)return!1;var type=track.type,id=track.streamInfo.id;return tracks[id]&&tracks[id][type]&&isTracksEqual(tracks[id][type].current,track)},setTrack:setTrack,setInitialSettings:setInitialSettings,getInitialSettings:getInitialSettings,setSwitchMode:function setSwitchMode(type,mode){-1!==validTrackSwitchModes.indexOf(mode)?switchMode[type]=mode:logger.warn("Track switch mode is not supported: "+mode)},getSwitchMode:function getSwitchMode(type){return switchMode[type]},setSelectionModeForInitialTrack:function setSelectionModeForInitialTrack(mode){-1!==validTrackSelectionModes.indexOf(mode)?selectionMode=mode:logger.warn("Track selection mode is not supported: "+mode)},getSelectionModeForInitialTrack:getSelectionModeForInitialTrack,isMultiTrackSupportedByType:isMultiTrackSupportedByType,isTracksEqual:isTracksEqual,setConfig:function setConfig(config){config&&config.domStorage&&(domStorage=config.domStorage)},reset:reset},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),reset()}(),instance}MediaController.__dashjs_factory_name="MediaController";var factory=_coreFactoryMaker2.default.getSingletonFactory(MediaController);factory.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",factory.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",factory.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",factory.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",factory.DEFAULT_INIT_TRACK_SELECTION_MODE="highestBitrate",_coreFactoryMaker2.default.updateSingletonFactory(MediaController.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1411:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function InitCache(){var data={};return{save:function save(chunk){var id=chunk.streamId,representationId=chunk.representationId;data[id]=data[id]||{},data[id][representationId]=chunk},extract:function extract(streamId,representationId){return data&&data[streamId]&&data[streamId][representationId]?data[streamId][representationId]:null},reset:function reset(){data={}}}}InitCache.__dashjs_factory_name="InitCache",exports.default=_coreFactoryMaker2.default.getSingletonFactory(InitCache),module.exports=exports.default},1412:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function Segment(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Segment),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null},module.exports=exports.default},1413:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _constantsDashConstants2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1374)),Representation=function(){function Representation(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Representation),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0,this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}return _createClass(Representation,null,[{key:"hasInitialization",value:function hasInitialization(r){return null!==r.initialization||null!==r.range}},{key:"hasSegments",value:function hasSegments(r){return r.segmentInfoType!==_constantsDashConstants2.default.BASE_URL&&r.segmentInfoType!==_constantsDashConstants2.default.SEGMENT_BASE&&!r.indexRange}}]),Representation}();exports.default=Representation,module.exports=exports.default},1414:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function XHRLoader(cfg){var requestModifier=(cfg=cfg||{}).requestModifier;return{load:function load(httpRequest){var requestStartTime=new Date,request=httpRequest.request,xhr=new XMLHttpRequest;xhr.open(httpRequest.method,httpRequest.url,!0),request.responseType&&(xhr.responseType=request.responseType),request.range&&xhr.setRequestHeader("Range","bytes="+request.range),request.requestStartDate||(request.requestStartDate=requestStartTime),requestModifier&&(xhr=requestModifier.modifyRequestHeader(xhr)),xhr.withCredentials=httpRequest.withCredentials,xhr.onload=httpRequest.onload,xhr.onloadend=httpRequest.onend,xhr.onerror=httpRequest.onerror,xhr.onprogress=httpRequest.progress,xhr.onabort=httpRequest.onabort,xhr.send(),httpRequest.response=xhr},abort:function abort(request){var x=request.response;x.onloadend=x.onerror=x.onprogress=void 0,x.abort()}}}XHRLoader.__dashjs_factory_name="XHRLoader";var factory=_coreFactoryMaker2.default.getClassFactory(XHRLoader);exports.default=factory,module.exports=exports.default},1415:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function KeySystemConfiguration(audioCapabilities,videoCapabilities,distinctiveIdentifier,persistentState,sessionTypes){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,KeySystemConfiguration),this.initDataTypes=["cenc"],audioCapabilities&&audioCapabilities.length&&(this.audioCapabilities=audioCapabilities),videoCapabilities&&videoCapabilities.length&&(this.videoCapabilities=videoCapabilities),this.distinctiveIdentifier=distinctiveIdentifier,this.persistentState=persistentState,this.sessionTypes=sessionTypes},module.exports=exports.default},1416:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function KeyPair(keyID,key){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,KeyPair),this.keyID=keyID,this.key=key},module.exports=exports.default},1417:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var ClearKeyKeySet=function(){function ClearKeyKeySet(keyPairs,type){if(function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ClearKeyKeySet),type&&"persistent"!==type&&"temporary"!==type)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=keyPairs,this.type=type}return _createClass(ClearKeyKeySet,[{key:"toJWK",value:function toJWK(){var i=void 0,numKeys=this.keyPairs.length,jwk={keys:[]};for(i=0;i<numKeys;i++){var key={kty:"oct",alg:"A128KW",kid:this.keyPairs[i].keyID,k:this.keyPairs[i].key};jwk.keys.push(key)}this.type&&(jwk.type=this.type);var jwkString=JSON.stringify(jwk),len=jwkString.length,buf=new ArrayBuffer(len),bView=new Uint8Array(buf);for(i=0;i<len;i++)bView[i]=jwkString.charCodeAt(i);return buf}}]),ClearKeyKeySet}();exports.default=ClearKeyKeySet,module.exports=exports.default},1418:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function NeedKey(initData,initDataType){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NeedKey),this.initData=initData,this.initDataType=initDataType},module.exports=exports.default},1419:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function KeyMessage(sessionToken,message,defaultURL,messageType){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,KeyMessage),this.sessionToken=sessionToken,this.message=message,this.defaultURL=defaultURL,this.messageType=messageType||"license-request"},module.exports=exports.default},1420:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function KeySystemAccess(keySystem,ksConfiguration){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,KeySystemAccess),this.keySystem=keySystem,this.ksConfiguration=ksConfiguration},module.exports=exports.default},1422:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_constantsMetricsConstants2=_interopRequireDefault(__webpack_require__(1382)),_controllersPlaybackController2=_interopRequireDefault(__webpack_require__(1460)),_controllersStreamController2=_interopRequireDefault(__webpack_require__(1497)),_controllersMediaController2=_interopRequireDefault(__webpack_require__(1410)),_controllersBaseURLController2=_interopRequireDefault(__webpack_require__(1439)),_ManifestLoader2=_interopRequireDefault(__webpack_require__(1532)),_utilsErrorHandler2=_interopRequireDefault(__webpack_require__(1544)),_utilsCapabilities2=_interopRequireDefault(__webpack_require__(1545)),_textTextTracks2=_interopRequireDefault(__webpack_require__(1403)),_utilsRequestModifier2=_interopRequireDefault(__webpack_require__(1397)),_textTextController2=_interopRequireDefault(__webpack_require__(1401)),_modelsURIFragmentModel2=_interopRequireDefault(__webpack_require__(1546)),_modelsManifestModel2=_interopRequireDefault(__webpack_require__(1548)),_modelsMediaPlayerModel2=_interopRequireDefault(__webpack_require__(1549)),_modelsMetricsModel2=_interopRequireDefault(__webpack_require__(1550)),_controllersAbrController2=_interopRequireDefault(__webpack_require__(1396)),_modelsVideoModel2=_interopRequireDefault(__webpack_require__(1560)),_utilsDOMStorage2=_interopRequireDefault(__webpack_require__(1561)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_MediaPlayerEvents2=_interopRequireDefault(__webpack_require__(1438)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreVersion=__webpack_require__(1446),_dashDashAdapter2=_interopRequireDefault(__webpack_require__(1562)),_dashModelsDashManifestModel2=_interopRequireDefault(__webpack_require__(1567)),_dashDashMetrics2=_interopRequireDefault(__webpack_require__(1572)),_dashUtilsTimelineConverter2=_interopRequireDefault(__webpack_require__(1574)),_voMetricsHTTPRequest=__webpack_require__(1373),_externalsBase642=_interopRequireDefault(__webpack_require__(1575)),_codemIsoboxer2=_interopRequireDefault(__webpack_require__(1402)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_utilsSupervisorTools=__webpack_require__(1383);function MediaPlayer(){var STREAMING_NOT_INITIALIZED_ERROR="You must first call initialize() and set a source before calling this method",PLAYBACK_NOT_INITIALIZED_ERROR="You must first call initialize() and set a valid source and view before calling this method",ELEMENT_NOT_ATTACHED_ERROR="You must first call attachView() to set the video element before calling this method",SOURCE_NOT_ATTACHED_ERROR="You must first call attachSource() with a valid source before calling this method",context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),debug=(0,_coreDebug2.default)(context).getInstance(),instance=void 0,logger=void 0,source=void 0,protectionData=void 0,mediaPlayerInitialized=void 0,streamingInitialized=void 0,playbackInitialized=void 0,autoPlay=void 0,abrController=void 0,timelineConverter=void 0,mediaController=void 0,protectionController=void 0,metricsReportingController=void 0,mssHandler=void 0,adapter=void 0,metricsModel=void 0,mediaPlayerModel=void 0,errHandler=void 0,capabilities=void 0,streamController=void 0,playbackController=void 0,dashMetrics=void 0,dashManifestModel=void 0,manifestModel=void 0,videoModel=void 0,textController=void 0,uriFragmentModel=void 0,domStorage=void 0;function isReady(){return!!source&&!!videoModel.getElement()}function getVersion(){return(0,_coreVersion.getVersionString)()}function isPaused(){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;return playbackController.isPaused()}function getDVRSeekOffset(value){var metric=getDVRInfoMetric();if(!metric)return 0;var liveDelay=playbackController.getLiveDelay(),val=metric.range.start+value;return val>metric.range.end-liveDelay&&(val=metric.range.end-liveDelay),val}function time(streamId){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;var t=getVideoElement().currentTime;if(void 0!==streamId)t=streamController.getTimeRelativeToStreamId(t,streamId);else if(playbackController.getIsDynamic()){var metric=getDVRInfoMetric();t=null===metric?0:duration()-(metric.range.end-metric.time)}return t}function duration(){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;var d=getVideoElement().duration;if(playbackController.getIsDynamic()){var range,metric=getDVRInfoMetric();if(!metric)return 0;d=(range=metric.range.end-metric.range.start)<metric.manifestInfo.DVRWindowSize?range:metric.manifestInfo.DVRWindowSize}return d}function setAutoPlay(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),autoPlay=value}function restoreDefaultUTCTimingSources(){mediaPlayerModel.restoreDefaultUTCTimingSources()}function getDashMetrics(){return dashMetrics}function getMetricsFor(type){return metricsModel.getReadOnlyMetricsFor(type)}function getVideoElement(){if(!videoModel.getElement())throw ELEMENT_NOT_ATTACHED_ERROR;return videoModel.getElement()}function attachView(element){if(!mediaPlayerInitialized)throw"MediaPlayer not initialized!";videoModel.setElement(element),element&&(detectProtection(),function detectMetricsReporting(){if(metricsReportingController)return;var MetricsReporting=dashjs.MetricsReporting;if("function"==typeof MetricsReporting){var metricsReporting=MetricsReporting(context).create();metricsReportingController=metricsReporting.createMetricsReporting({debug:debug,eventBus:eventBus,mediaElement:getVideoElement(),dashManifestModel:dashManifestModel,metricsModel:metricsModel,events:_coreEventsEvents2.default,constants:_constantsConstants2.default,metricsConstants:_constantsMetricsConstants2.default})}}(),function detectMss(){if(mssHandler)return;var MssHandler=dashjs.MssHandler;"function"==typeof MssHandler&&(_coreErrorsErrors2.default.extend(MssHandler.errors),mssHandler=MssHandler(context).create({eventBus:eventBus,mediaPlayerModel:mediaPlayerModel,metricsModel:metricsModel,manifestModel:manifestModel,playbackController:playbackController,protectionController:protectionController,baseURLController:(0,_controllersBaseURLController2.default)(context).getInstance(),errHandler:errHandler,events:_coreEventsEvents2.default,constants:_constantsConstants2.default,debug:debug,initSegmentType:_voMetricsHTTPRequest.HTTPRequest.INIT_SEGMENT_TYPE,BASE64:_externalsBase642.default,ISOBoxer:_codemIsoboxer2.default}))}(),streamController&&streamController.switchToVideoElement()),playbackInitialized&&resetPlaybackControllers(),initializePlayback()}function getTracksFor(type){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;var streamInfo=streamController.getActiveStreamInfo();return mediaController.getTracksFor(type,streamInfo)}function attachSource(urlOrManifest){if(!mediaPlayerInitialized)throw"MediaPlayer not initialized!";"string"==typeof urlOrManifest&&uriFragmentModel.initialize(urlOrManifest),source=urlOrManifest,(streamingInitialized||playbackInitialized)&&resetPlaybackControllers(),isReady()&&initializePlayback()}function getActiveStream(){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;var streamInfo=streamController.getActiveStreamInfo();return streamInfo?streamController.getStreamById(streamInfo.id):null}function resetPlaybackControllers(){playbackInitialized=!1,streamingInitialized=!1,adapter.reset(),streamController.reset(),playbackController.reset(),abrController.reset(),mediaController.reset(),textController.reset(),protectionController&&(mediaPlayerModel.getKeepProtectionMediaKeys()?protectionController.stop():(protectionController.reset(),protectionController=null,detectProtection()))}function createManifestLoader(){return(0,_ManifestLoader2.default)(context).create({errHandler:errHandler,metricsModel:metricsModel,mediaPlayerModel:mediaPlayerModel,requestModifier:(0,_utilsRequestModifier2.default)(context).getInstance(),mssHandler:mssHandler})}function detectProtection(){if(protectionController)return protectionController;var Protection=dashjs.Protection;if("function"==typeof Protection){var protection=Protection(context).create();return _coreEventsEvents2.default.extend(Protection.events),_MediaPlayerEvents2.default.extend(Protection.events,{publicOnly:!0}),_coreErrorsErrors2.default.extend(Protection.errors),capabilities||(capabilities=(0,_utilsCapabilities2.default)(context).getInstance()),protectionController=protection.createProtectionSystem({debug:debug,errHandler:errHandler,videoModel:videoModel,capabilities:capabilities,eventBus:eventBus,events:_coreEventsEvents2.default,BASE64:_externalsBase642.default,constants:_constantsConstants2.default})}return null}function getDVRInfoMetric(){var metric=metricsModel.getReadOnlyMetricsFor(_constantsConstants2.default.VIDEO)||metricsModel.getReadOnlyMetricsFor(_constantsConstants2.default.AUDIO);return dashMetrics.getCurrentDVRInfo(metric)}function getAsUTC(valToConvert){var metric=getDVRInfoMetric();return metric?valToConvert+(metric.manifestInfo.availableFrom.getTime()/1e3+metric.range.start):0}function initializePlayback(){!streamingInitialized&&source&&(streamingInitialized=!0,logger.info("Streaming Initialized"),function createPlaybackControllers(){var manifestLoader=createManifestLoader();streamController||(streamController=(0,_controllersStreamController2.default)(context).getInstance()),mediaController.setConfig({domStorage:domStorage}),streamController.setConfig({capabilities:capabilities,manifestLoader:manifestLoader,manifestModel:manifestModel,dashManifestModel:dashManifestModel,mediaPlayerModel:mediaPlayerModel,protectionController:protectionController,adapter:adapter,metricsModel:metricsModel,dashMetrics:dashMetrics,errHandler:errHandler,timelineConverter:timelineConverter,videoModel:videoModel,playbackController:playbackController,domStorage:domStorage,abrController:abrController,mediaController:mediaController,textController:textController}),playbackController.setConfig({streamController:streamController,metricsModel:metricsModel,dashMetrics:dashMetrics,manifestModel:manifestModel,mediaPlayerModel:mediaPlayerModel,dashManifestModel:dashManifestModel,adapter:adapter,videoModel:videoModel,timelineConverter:timelineConverter,uriFragmentModel:uriFragmentModel}),abrController.setConfig({streamController:streamController,domStorage:domStorage,mediaPlayerModel:mediaPlayerModel,metricsModel:metricsModel,dashMetrics:dashMetrics,manifestModel:manifestModel,videoModel:videoModel,adapter:adapter}),abrController.createAbrRulesCollection(),textController.setConfig({errHandler:errHandler,manifestModel:manifestModel,dashManifestModel:dashManifestModel,mediaController:mediaController,streamController:streamController,videoModel:videoModel}),streamController.initialize(autoPlay,protectionData)}(),"string"==typeof source?streamController.load(source):streamController.loadWithManifest(source)),!playbackInitialized&&isReady()&&(playbackInitialized=!0,logger.info("Playback Initialized"))}return instance={initialize:function initialize(view,source,AutoPlay){if(capabilities||(capabilities=(0,_utilsCapabilities2.default)(context).getInstance()),errHandler=(0,_utilsErrorHandler2.default)(context).getInstance(),!capabilities.supportsMediaSource())return errHandler.capabilityError("mediasource"),void errHandler.error(new _voDashJSError2.default(_coreErrorsErrors2.default.CAPABILITY_MEDIASOURCE_ERROR_CODE,_coreErrorsErrors2.default.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE));mediaPlayerInitialized||(mediaPlayerInitialized=!0,timelineConverter=(0,_dashUtilsTimelineConverter2.default)(context).getInstance(),abrController||(abrController=(0,_controllersAbrController2.default)(context).getInstance()),playbackController||(playbackController=(0,_controllersPlaybackController2.default)(context).getInstance()),mediaController||(mediaController=(0,_controllersMediaController2.default)(context).getInstance()),adapter=(0,_dashDashAdapter2.default)(context).getInstance(),dashManifestModel=(0,_dashModelsDashManifestModel2.default)(context).getInstance({timelineConverter:timelineConverter,errHandler:errHandler,BASE64:_externalsBase642.default}),manifestModel=(0,_modelsManifestModel2.default)(context).getInstance(),dashMetrics=(0,_dashDashMetrics2.default)(context).getInstance({manifestModel:manifestModel,dashManifestModel:dashManifestModel}),metricsModel=(0,_modelsMetricsModel2.default)(context).getInstance(),textController=(0,_textTextController2.default)(context).getInstance(),domStorage=(0,_utilsDOMStorage2.default)(context).getInstance({mediaPlayerModel:mediaPlayerModel}),adapter.setConfig({dashManifestModel:dashManifestModel}),restoreDefaultUTCTimingSources(),setAutoPlay(void 0===AutoPlay||AutoPlay),view&&attachView(view),source&&attachSource(source),logger.info("[dash.js "+getVersion()+"] MediaPlayer has been initialized"))},setConfig:function setConfig(config){config&&(config.capabilities&&(capabilities=config.capabilities),config.streamController&&(streamController=config.streamController),config.playbackController&&(playbackController=config.playbackController),config.mediaPlayerModel&&(mediaPlayerModel=config.mediaPlayerModel),config.abrController&&(abrController=config.abrController),config.mediaController&&(mediaController=config.mediaController))},on:function on(type,listener,scope){eventBus.on(type,listener,scope)},off:function off(type,listener,scope){eventBus.off(type,listener,scope)},extend:function extend(parentNameString,childInstance,override){_coreFactoryMaker2.default.extend(parentNameString,childInstance,override,context)},attachView:attachView,attachSource:attachSource,isReady:isReady,preload:function preload(){if(videoModel.getElement()||streamingInitialized)return!1;if(!source)throw SOURCE_NOT_ATTACHED_ERROR;initializePlayback()},play:function play(){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;(!autoPlay||isPaused()&&playbackInitialized)&&playbackController.play()},isPaused:isPaused,pause:function pause(){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;playbackController.pause()},isSeeking:function isSeeking(){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;return playbackController.isSeeking()},isDynamic:function isDynamic(){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;return playbackController.getIsDynamic()},seek:function seek(value){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;if((0,_utilsSupervisorTools.checkParameterType)(value,"number"),isNaN(value))throw _constantsConstants2.default.BAD_ARGUMENT_ERROR;var s=playbackController.getIsDynamic()?getDVRSeekOffset(value):value;playbackController.seek(s)},setPlaybackRate:function setPlaybackRate(value){getVideoElement().playbackRate=value},getPlaybackRate:function getPlaybackRate(){return getVideoElement().playbackRate},setMute:function setMute(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),getVideoElement().muted=value},isMuted:function isMuted(){return getVideoElement().muted},setVolume:function setVolume(value){if("number"!=typeof value||isNaN(value)||value<0||value>1)throw _constantsConstants2.default.BAD_ARGUMENT_ERROR;getVideoElement().volume=value},getVolume:function getVolume(){return getVideoElement().volume},time:time,duration:duration,timeAsUTC:function timeAsUTC(){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;return time()<0?NaN:getAsUTC(time())},durationAsUTC:function durationAsUTC(){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;return getAsUTC(duration())},getActiveStream:getActiveStream,getDVRWindowSize:function getDVRWindowSize(){var metric=getDVRInfoMetric();return metric?metric.manifestInfo.DVRWindowSize:0},getDVRSeekOffset:getDVRSeekOffset,convertToTimeCode:function convertToTimeCode(value){value=Math.max(value,0);var h=Math.floor(value/3600),m=Math.floor(value%3600/60),s=Math.floor(value%3600%60);return(0===h?"":h<10?"0"+h.toString()+":":h.toString()+":")+(m<10?"0"+m.toString():m.toString())+":"+(s<10?"0"+s.toString():s.toString())},formatUTC:function formatUTC(time,locales,hour12){var withDate=!(arguments.length<=3||void 0===arguments[3])&&arguments[3],dt=new Date(1e3*time),d=dt.toLocaleDateString(locales),t=dt.toLocaleTimeString(locales,{hour12:hour12});return withDate?t+" "+d:t},getVersion:getVersion,getDebug:function getDebug(){return debug},getBufferLength:function getBufferLength(type){var buffer,types=[_constantsConstants2.default.VIDEO,_constantsConstants2.default.AUDIO,_constantsConstants2.default.FRAGMENTED_TEXT];return type?-1!==types.indexOf(type)?(buffer=getDashMetrics().getCurrentBufferLevel(getMetricsFor(type)))||NaN:(logger.warn("getBufferLength requested for invalid type"),NaN):(buffer=types.map((function(t){return getTracksFor(t).length>0?getDashMetrics().getCurrentBufferLevel(getMetricsFor(t)):Number.MAX_VALUE})).reduce((function(p,c){return Math.min(p,c)})))===Number.MAX_VALUE?NaN:buffer},getTTMLRenderingDiv:function getTTMLRenderingDiv(){return videoModel?videoModel.getTTMLRenderingDiv():null},getVideoElement:getVideoElement,getSource:function getSource(){if(!source)throw SOURCE_NOT_ATTACHED_ERROR;return source},setLiveDelayFragmentCount:function setLiveDelayFragmentCount(value){mediaPlayerModel.setLiveDelayFragmentCount(value)},setLiveDelay:function setLiveDelay(value){mediaPlayerModel.setLiveDelay(value)},getLiveDelay:function getLiveDelay(){return mediaPlayerModel.getLiveDelay()},getCurrentLiveLatency:function getCurrentLiveLatency(){if(!mediaPlayerInitialized)throw"MediaPlayer not initialized!";return playbackInitialized?playbackController.getCurrentLiveLatency():NaN},useSuggestedPresentationDelay:function useSuggestedPresentationDelay(value){mediaPlayerModel.setUseSuggestedPresentationDelay(value)},enableLastBitrateCaching:function enableLastBitrateCaching(enable,ttl){mediaPlayerModel.setLastBitrateCachingInfo(enable,ttl)},enableLastMediaSettingsCaching:function enableLastMediaSettingsCaching(enable,ttl){mediaPlayerModel.setLastMediaSettingsCachingInfo(enable,ttl)},setMaxAllowedBitrateFor:function setMaxAllowedBitrateFor(type,value){abrController.setMaxAllowedBitrateFor(type,value)},getMaxAllowedBitrateFor:function getMaxAllowedBitrateFor(type){return abrController.getMaxAllowedBitrateFor(type)},getTopBitrateInfoFor:function getTopBitrateInfoFor(type){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;return abrController.getTopBitrateInfoFor(type)},setMinAllowedBitrateFor:function setMinAllowedBitrateFor(type,value){abrController.setMinAllowedBitrateFor(type,value)},getMinAllowedBitrateFor:function getMinAllowedBitrateFor(type){return abrController.getMinAllowedBitrateFor(type)},setMaxAllowedRepresentationRatioFor:function setMaxAllowedRepresentationRatioFor(type,value){abrController.setMaxAllowedRepresentationRatioFor(type,value)},getMaxAllowedRepresentationRatioFor:function getMaxAllowedRepresentationRatioFor(type){return abrController.getMaxAllowedRepresentationRatioFor(type)},setAutoPlay:setAutoPlay,getAutoPlay:function getAutoPlay(){return autoPlay},setScheduleWhilePaused:function setScheduleWhilePaused(value){mediaPlayerModel.setScheduleWhilePaused(value)},getScheduleWhilePaused:function getScheduleWhilePaused(){return mediaPlayerModel.getScheduleWhilePaused()},getDashMetrics:getDashMetrics,getMetricsFor:getMetricsFor,getQualityFor:function getQualityFor(type){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;if(type===_constantsConstants2.default.IMAGE){var activeStream=getActiveStream();if(!activeStream)return-1;var thumbnailController=activeStream.getThumbnailController();return thumbnailController?thumbnailController.getCurrentTrackIndex():-1}return abrController.getQualityFor(type,streamController.getActiveStreamInfo())},setQualityFor:function setQualityFor(type,value){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;if(type===_constantsConstants2.default.IMAGE){var activeStream=getActiveStream();if(!activeStream)return;var thumbnailController=activeStream.getThumbnailController();thumbnailController&&thumbnailController.setTrackByIndex(value)}abrController.setPlaybackQuality(type,streamController.getActiveStreamInfo(),value)},updatePortalSize:function updatePortalSize(){abrController.setElementSize(),abrController.setWindowResizeEventCalled(!0)},getLimitBitrateByPortal:function getLimitBitrateByPortal(){return abrController.getLimitBitrateByPortal()},setLimitBitrateByPortal:function setLimitBitrateByPortal(value){abrController.setLimitBitrateByPortal(value)},getUsePixelRatioInLimitBitrateByPortal:function getUsePixelRatioInLimitBitrateByPortal(){return abrController.getUsePixelRatioInLimitBitrateByPortal()},setUsePixelRatioInLimitBitrateByPortal:function setUsePixelRatioInLimitBitrateByPortal(value){abrController.setUsePixelRatioInLimitBitrateByPortal(value)},setTextDefaultLanguage:function setTextDefaultLanguage(lang){void 0===textController&&(textController=(0,_textTextController2.default)(context).getInstance()),textController.setTextDefaultLanguage(lang)},getTextDefaultLanguage:function getTextDefaultLanguage(){return void 0===textController&&(textController=(0,_textTextController2.default)(context).getInstance()),textController.getTextDefaultLanguage()},setTextDefaultEnabled:function setTextDefaultEnabled(enable){void 0===textController&&(textController=(0,_textTextController2.default)(context).getInstance()),textController.setTextDefaultEnabled(enable)},getTextDefaultEnabled:function getTextDefaultEnabled(){return void 0===textController&&(textController=(0,_textTextController2.default)(context).getInstance()),textController.getTextDefaultEnabled()},enableText:function enableText(enable){void 0===textController&&(textController=(0,_textTextController2.default)(context).getInstance()),textController.enableText(enable)},enableForcedTextStreaming:function enableForcedTextStreaming(enable){void 0===textController&&(textController=(0,_textTextController2.default)(context).getInstance()),textController.enableForcedTextStreaming(enable)},isTextEnabled:function isTextEnabled(){return void 0===textController&&(textController=(0,_textTextController2.default)(context).getInstance()),textController.isTextEnabled()},setTextTrack:function setTextTrack(idx){if(!playbackInitialized)throw PLAYBACK_NOT_INITIALIZED_ERROR;void 0===textController&&(textController=(0,_textTextController2.default)(context).getInstance()),textController.setTextTrack(idx)},getBitrateInfoListFor:function getBitrateInfoListFor(type){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;var stream=getActiveStream();return stream?stream.getBitrateListFor(type):[]},setInitialBitrateFor:function setInitialBitrateFor(type,value){abrController.setInitialBitrateFor(type,value)},getInitialBitrateFor:function getInitialBitrateFor(type){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;return abrController.getInitialBitrateFor(type)},setInitialRepresentationRatioFor:function setInitialRepresentationRatioFor(type,value){abrController.setInitialRepresentationRatioFor(type,value)},getInitialRepresentationRatioFor:function getInitialRepresentationRatioFor(type){return abrController.getInitialRepresentationRatioFor(type)},getStreamsFromManifest:function getStreamsFromManifest(manifest){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;return adapter.getStreamsInfo(manifest)},getTracksFor:getTracksFor,getTracksForTypeFromManifest:function getTracksForTypeFromManifest(type,manifest,streamInfo){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;return(streamInfo=streamInfo||adapter.getStreamsInfo(manifest,1)[0])?adapter.getAllMediaInfoForType(streamInfo,type,manifest):[]},getCurrentTrackFor:function getCurrentTrackFor(type){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;var streamInfo=streamController.getActiveStreamInfo();return mediaController.getCurrentTrackFor(type,streamInfo)},setInitialMediaSettingsFor:function setInitialMediaSettingsFor(type,value){if(!mediaPlayerInitialized)throw"MediaPlayer not initialized!";mediaController.setInitialSettings(type,value)},getInitialMediaSettingsFor:function getInitialMediaSettingsFor(type){if(!mediaPlayerInitialized)throw"MediaPlayer not initialized!";return mediaController.getInitialSettings(type)},setCurrentTrack:function setCurrentTrack(track){if(!streamingInitialized)throw STREAMING_NOT_INITIALIZED_ERROR;mediaController.setTrack(track)},getTrackSwitchModeFor:function getTrackSwitchModeFor(type){if(!mediaPlayerInitialized)throw"MediaPlayer not initialized!";return mediaController.getSwitchMode(type)},setTrackSwitchModeFor:function setTrackSwitchModeFor(type,mode){if(!mediaPlayerInitialized)throw"MediaPlayer not initialized!";mediaController.setSwitchMode(type,mode)},setSelectionModeForInitialTrack:function setSelectionModeForInitialTrack(mode){if(!mediaPlayerInitialized)throw"MediaPlayer not initialized!";mediaController.setSelectionModeForInitialTrack(mode)},getSelectionModeForInitialTrack:function getSelectionModeForInitialTrack(){if(!mediaPlayerInitialized)throw"MediaPlayer not initialized!";return mediaController.getSelectionModeForInitialTrack()},setFastSwitchEnabled:function setFastSwitchEnabled(value){mediaPlayerModel.setFastSwitchEnabled(value)},getFastSwitchEnabled:function getFastSwitchEnabled(){return mediaPlayerModel.getFastSwitchEnabled()},setMovingAverageMethod:function setMovingAverageMethod(value){mediaPlayerModel.setMovingAverageMethod(value)},getMovingAverageMethod:function getMovingAverageMethod(){return mediaPlayerModel.getMovingAverageMethod()},getAutoSwitchQualityFor:function getAutoSwitchQualityFor(type){return abrController.getAutoSwitchBitrateFor(type)},setAutoSwitchQualityFor:function setAutoSwitchQualityFor(type,value){abrController.setAutoSwitchBitrateFor(type,value)},setABRStrategy:function setABRStrategy(value){mediaPlayerModel.setABRStrategy(value)},getABRStrategy:function getABRStrategy(){return mediaPlayerModel.getABRStrategy()},useDefaultABRRules:function useDefaultABRRules(value){mediaPlayerModel.setUseDefaultABRRules(value)},addABRCustomRule:function addABRCustomRule(type,rulename,rule){mediaPlayerModel.addABRCustomRule(type,rulename,rule)},removeABRCustomRule:function removeABRCustomRule(rulename){mediaPlayerModel.removeABRCustomRule(rulename)},removeAllABRCustomRule:function removeAllABRCustomRule(){mediaPlayerModel.removeABRCustomRule()},setBandwidthSafetyFactor:function setBandwidthSafetyFactor(value){mediaPlayerModel.setBandwidthSafetyFactor(value)},getBandwidthSafetyFactor:function getBandwidthSafetyFactor(){return mediaPlayerModel.getBandwidthSafetyFactor()},getAverageThroughput:function getAverageThroughput(type){var throughputHistory=abrController.getThroughputHistory();return throughputHistory?throughputHistory.getAverageThroughput(type):0},setAbandonLoadTimeout:function setAbandonLoadTimeout(value){mediaPlayerModel.setAbandonLoadTimeout(value)},retrieveManifest:function retrieveManifest(url,callback){var manifestLoader=createManifestLoader(),self=this;eventBus.on(_coreEventsEvents2.default.INTERNAL_MANIFEST_LOADED,(function handler(e){e.error?callback(null,e.error):callback(e.manifest),eventBus.off(_coreEventsEvents2.default.INTERNAL_MANIFEST_LOADED,handler,self),manifestLoader.reset()}),self),uriFragmentModel.initialize(url),manifestLoader.load(url)},addUTCTimingSource:function addUTCTimingSource(schemeIdUri,value){mediaPlayerModel.addUTCTimingSource(schemeIdUri,value)},removeUTCTimingSource:function removeUTCTimingSource(schemeIdUri,value){mediaPlayerModel.removeUTCTimingSource(schemeIdUri,value)},clearDefaultUTCTimingSources:function clearDefaultUTCTimingSources(){mediaPlayerModel.clearDefaultUTCTimingSources()},restoreDefaultUTCTimingSources:restoreDefaultUTCTimingSources,setBufferToKeep:function setBufferToKeep(value){mediaPlayerModel.setBufferToKeep(value)},setBufferAheadToKeep:function setBufferAheadToKeep(value){mediaPlayerModel.setBufferAheadToKeep(value)},setBufferPruningInterval:function setBufferPruningInterval(value){mediaPlayerModel.setBufferPruningInterval(value)},setStableBufferTime:function setStableBufferTime(value){mediaPlayerModel.setStableBufferTime(value)},getStableBufferTime:function getStableBufferTime(){return mediaPlayerModel.getStableBufferTime()},setBufferTimeAtTopQuality:function setBufferTimeAtTopQuality(value){mediaPlayerModel.setBufferTimeAtTopQuality(value)},getBufferTimeAtTopQuality:function getBufferTimeAtTopQuality(){return mediaPlayerModel.getBufferTimeAtTopQuality()},setBufferTimeAtTopQualityLongForm:function setBufferTimeAtTopQualityLongForm(value){mediaPlayerModel.setBufferTimeAtTopQualityLongForm(value)},getBufferTimeAtTopQualityLongForm:function getBufferTimeAtTopQualityLongForm(){return mediaPlayerModel.getBufferTimeAtTopQualityLongForm()},setFragmentLoaderRetryAttempts:function setFragmentLoaderRetryAttempts(value){mediaPlayerModel.setRetryAttemptsForType(_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE,value)},setFragmentLoaderRetryInterval:function setFragmentLoaderRetryInterval(value){mediaPlayerModel.setRetryIntervalForType(_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE,value)},setManifestLoaderRetryAttempts:function setManifestLoaderRetryAttempts(value){mediaPlayerModel.setRetryAttemptsForType(_voMetricsHTTPRequest.HTTPRequest.MPD_TYPE,value)},setManifestLoaderRetryInterval:function setManifestLoaderRetryInterval(value){mediaPlayerModel.setRetryIntervalForType(_voMetricsHTTPRequest.HTTPRequest.MPD_TYPE,value)},setXHRWithCredentialsForType:function setXHRWithCredentialsForType(type,value){mediaPlayerModel.setXHRWithCredentialsForType(type,value)},getXHRWithCredentialsForType:function getXHRWithCredentialsForType(type){return mediaPlayerModel.getXHRWithCredentialsForType(type)},setJumpGaps:function setJumpGaps(value){mediaPlayerModel.setJumpGaps(value)},getJumpGaps:function getJumpGaps(){return mediaPlayerModel.getJumpGaps()},setSmallGapLimit:function setSmallGapLimit(value){mediaPlayerModel.setSmallGapLimit(value)},getSmallGapLimit:function getSmallGapLimit(){return mediaPlayerModel.getSmallGapLimit()},setLowLatencyEnabled:function setLowLatencyEnabled(value){mediaPlayerModel.setLowLatencyEnabled(value)},getLowLatencyEnabled:function getLowLatencyEnabled(){return mediaPlayerModel.getLowLatencyEnabled()},setCatchUpPlaybackRate:function setCatchUpPlaybackRate(value){mediaPlayerModel.setCatchUpPlaybackRate(value)},getCatchUpPlaybackRate:function getCatchUpPlaybackRate(){return mediaPlayerModel.getCatchUpPlaybackRate()},setLowLatencyMinDrift:function setLowLatencyMinDrift(value){if("number"!=typeof value||isNaN(value)||value<0||value>.5)throw"Playback minimum drift has an invalid value! Use a number from 0 to 0.5";mediaPlayerModel.setLowLatencyMinDrift(value)},getLowLatencyMinDrift:function getLowLatencyMinDrift(){return mediaPlayerModel.getLowLatencyMinDrift()},setLowLatencyMaxDriftBeforeSeeking:function setLowLatencyMaxDriftBeforeSeeking(value){if("number"!=typeof value||isNaN(value)||value<0)throw"Playback maximum drift has an invalid value! Use a number greater or equal to 0";mediaPlayerModel.setLowLatencyMaxDriftBeforeSeeking(value)},getLowLatencyMaxDriftBeforeSeeking:function getLowLatencyMaxDriftBeforeSeeking(){return mediaPlayerModel.getLowLatencyMaxDriftBeforeSeeking()},setManifestUpdateRetryInterval:function setManifestUpdateRetryInterval(value){mediaPlayerModel.setManifestUpdateRetryInterval(value)},getManifestUpdateRetryInterval:function getManifestUpdateRetryInterval(){return mediaPlayerModel.getManifestUpdateRetryInterval()},setLongFormContentDurationThreshold:function setLongFormContentDurationThreshold(value){mediaPlayerModel.setLongFormContentDurationThreshold(value)},setSegmentOverlapToleranceTime:function setSegmentOverlapToleranceTime(value){mediaPlayerModel.setSegmentOverlapToleranceTime(value)},setCacheLoadThresholdForType:function setCacheLoadThresholdForType(type,value){mediaPlayerModel.setCacheLoadThresholdForType(type,value)},getProtectionController:function getProtectionController(){return detectProtection()},attachProtectionController:function attachProtectionController(value){protectionController=value},setProtectionData:function setProtectionData(value){protectionData=value,streamController&&streamController.setProtectionData(protectionData)},enableManifestDateHeaderTimeSource:function enableManifestDateHeaderTimeSource(value){mediaPlayerModel.setUseManifestDateHeaderTimeSource(value)},displayCaptionsOnTop:function displayCaptionsOnTop(value){var textTracks=(0,_textTextTracks2.default)(context).getInstance();textTracks.setConfig({videoModel:videoModel}),textTracks.initialize(),textTracks.displayCConTop(value)},attachVideoContainer:function attachVideoContainer(container){logger.warn("attachVideoContainer method has been deprecated and will be removed in dash.js v3.0.0")},attachTTMLRenderingDiv:function attachTTMLRenderingDiv(div){if(!videoModel.getElement())throw ELEMENT_NOT_ATTACHED_ERROR;videoModel.setTTMLRenderingDiv(div)},getCurrentTextTrackIndex:function getCurrentTextTrackIndex(){var idx=NaN;return textController&&(idx=textController.getCurrentTrackIdx()),idx},getUseDeadTimeLatencyForAbr:function getUseDeadTimeLatencyForAbr(){return abrController.getUseDeadTimeLatency()},setUseDeadTimeLatencyForAbr:function setUseDeadTimeLatencyForAbr(useDeadTimeLatency){abrController.setUseDeadTimeLatency(useDeadTimeLatency)},getThumbnail:function getThumbnail(time,callback){if(time<0)return null;var s=playbackController.getIsDynamic()?getDVRSeekOffset(time):time,stream=streamController.getStreamForTime(s);if(null===stream)return null;var thumbnailController=stream.getThumbnailController();if(!thumbnailController)return null;var timeInPeriod=streamController.getTimeRelativeToStreamId(s,stream.getId());return thumbnailController.get(timeInPeriod,callback)},keepProtectionMediaKeys:function keepProtectionMediaKeys(value){mediaPlayerModel.setKeepProtectionMediaKeys(value)},reset:function reset(){attachSource(null),attachView(null),protectionData=null,protectionController&&(protectionController.reset(),protectionController=null),metricsReportingController&&(metricsReportingController.reset(),metricsReportingController=null)}},function setup(){logger=debug.getLogger(instance),mediaPlayerInitialized=!1,playbackInitialized=!1,streamingInitialized=!1,autoPlay=!0,protectionController=null,protectionData=null,adapter=null,_coreEventsEvents2.default.extend(_MediaPlayerEvents2.default),mediaPlayerModel=(0,_modelsMediaPlayerModel2.default)(context).getInstance(),videoModel=(0,_modelsVideoModel2.default)(context).getInstance(),uriFragmentModel=(0,_modelsURIFragmentModel2.default)(context).getInstance()}(),instance}MediaPlayer.__dashjs_factory_name="MediaPlayer";var factory=_coreFactoryMaker2.default.getClassFactory(MediaPlayer);factory.events=_MediaPlayerEvents2.default,factory.errors=_coreErrorsErrors2.default,_coreFactoryMaker2.default.updateClassFactory(MediaPlayer.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1423:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_textTextController2=_interopRequireDefault(__webpack_require__(1401)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372));function SourceBufferSink(mediaSource,mediaInfo,onAppendedCallback,oldBuffer){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,buffer=void 0,isAppendingInProgress=void 0,intervalId=void 0,callbacks=[],appendQueue=[],onAppended=onAppendedCallback;function getAllBufferRanges(){try{return buffer.buffered}catch(e){return logger.error("getAllBufferRanges exception: "+e.message),null}}function appendNextInQueue(){var _this=this,sourceBufferSink=this;appendQueue.length>0&&function(){isAppendingInProgress=!0;var nextChunk=appendQueue[0];appendQueue.splice(0,1);var oldRanges=[],afterSuccess=function afterSuccess(){var newRanges=getAllBufferRanges();!function checkBufferGapsAfterAppend(buffer,oldRanges,newRanges,chunk){oldRanges&&oldRanges.length>0&&oldRanges.length<newRanges.length&&function isChunkAlignedWithRange(oldRanges,chunk){for(var i=0;i<oldRanges.length;i++){var start=Math.round(oldRanges.start(i)),end=Math.round(oldRanges.end(i));if(end===chunk.start||start===chunk.end||chunk.start>=start&&chunk.end<=end)return!0}return!1}(oldRanges,chunk)&&eventBus.trigger(_coreEventsEvents2.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:buffer,from:newRanges.end(newRanges.length-2),to:newRanges.start(newRanges.length-1),unintended:!0})}(sourceBufferSink,oldRanges,newRanges,nextChunk),appendQueue.length>0?appendNextInQueue.call(this):(isAppendingInProgress=!1,onAppended&&onAppended({chunk:nextChunk}))};try{0===nextChunk.bytes.length?afterSuccess.call(_this):(oldRanges=getAllBufferRanges(),buffer.appendBuffer?buffer.appendBuffer(nextChunk.bytes):buffer.append(nextChunk.bytes,nextChunk),waitForUpdateEnd(buffer,afterSuccess.bind(_this)))}catch(err){logger.fatal('SourceBuffer append failed "'+err+'"'),appendQueue.length>0?appendNextInQueue():isAppendingInProgress=!1,onAppended&&onAppended({chunk:nextChunk,error:new _voDashJSError2.default(err.code,err.message)})}}()}function executeCallback(){if(callbacks.length>0){var cb=callbacks.shift();buffer.updating?waitForUpdateEnd(buffer,cb):(cb(),executeCallback())}}function checkIsUpdateEnded(){buffer.updating||executeCallback()}function updateEndHandler(){buffer.updating||executeCallback()}function errHandler(){logger.error("SourceBufferSink error",mediaInfo.type)}function waitForUpdateEnd(buffer,callback){callbacks.push(callback),buffer.updating||executeCallback()}return instance={getAllBufferRanges:getAllBufferRanges,getBuffer:function getBuffer(){return buffer},append:function append(chunk){chunk?(appendQueue.push(chunk),isAppendingInProgress||waitForUpdateEnd(buffer,appendNextInQueue.bind(this))):onAppended({chunk:chunk,error:new _voDashJSError2.default(_coreErrorsErrors2.default.APPEND_ERROR_CODE,_coreErrorsErrors2.default.APPEND_ERROR_MESSAGE)})},remove:function remove(start,end,forceRemoval){var sourceBufferSink=this;waitForUpdateEnd(buffer,(function(){try{start>=0&&end>start&&(forceRemoval||"ended"!==mediaSource.readyState)&&buffer.remove(start,end),waitForUpdateEnd(buffer,(function(){eventBus.trigger(_coreEventsEvents2.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:sourceBufferSink,from:start,to:end,unintended:!1})}))}catch(err){eventBus.trigger(_coreEventsEvents2.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:sourceBufferSink,from:start,to:end,unintended:!1,error:new _voDashJSError2.default(err.code,err.message)})}}))},abort:function abort(){try{"open"===mediaSource.readyState?buffer.abort():buffer.setTextTrack&&"ended"===mediaSource.readyState&&buffer.abort()}catch(ex){logger.error('SourceBuffer append abort failed: "'+ex+'"')}appendQueue=[]},reset:function reset(keepBuffer){if(buffer){if("function"==typeof buffer.removeEventListener&&(buffer.removeEventListener("updateend",updateEndHandler,!1),buffer.removeEventListener("error",errHandler,!1),buffer.removeEventListener("abort",errHandler,!1)),clearInterval(intervalId),!keepBuffer){try{buffer.getClassName&&"TextSourceBuffer"===buffer.getClassName()||mediaSource.removeSourceBuffer(buffer)}catch(e){logger.error("Failed to remove source buffer from media source.")}buffer=null}isAppendingInProgress=!1}appendQueue=[],onAppended=null},updateTimestampOffset:function updateTimestampOffset(MSETimeOffset){buffer.timestampOffset===MSETimeOffset||isNaN(MSETimeOffset)||waitForUpdateEnd(buffer,(function(){buffer.timestampOffset=MSETimeOffset}))},hasDiscontinuitiesAfter:function hasDiscontinuitiesAfter(time){try{var ranges=getAllBufferRanges();if(ranges&&ranges.length>1)for(var i=0,len=ranges.length;i<len;i++)if(i>0&&time<ranges.start(i)&&ranges.start(i)>ranges.end(i-1)+.1)return!0}catch(e){logger.error("hasDiscontinuities exception: "+e.message)}return!1}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),isAppendingInProgress=!1;var codec=mediaInfo.codec;try{if(codec.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))throw new Error("not really supported");(buffer=oldBuffer||mediaSource.addSourceBuffer(codec)).changeType&&oldBuffer&&(logger.debug("Doing period transition with changeType"),buffer.changeType(codec));if("function"==typeof buffer.addEventListener)try{buffer.addEventListener("updateend",updateEndHandler,!1),buffer.addEventListener("error",errHandler,!1),buffer.addEventListener("abort",errHandler,!1)}catch(err){intervalId=setInterval(checkIsUpdateEnded,50)}else intervalId=setInterval(checkIsUpdateEnded,50)}catch(ex){if(!mediaInfo.isText&&-1===codec.indexOf('codecs="stpp')&&-1===codec.indexOf('codecs="wvtt'))throw ex;var textController=(0,_textTextController2.default)(context).getInstance();buffer=textController.getTextSourceBuffer()}}(),instance}SourceBufferSink.__dashjs_factory_name="SourceBufferSink";var factory=_coreFactoryMaker2.default.getClassFactory(SourceBufferSink);exports.default=factory,module.exports=exports.default},1424:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366)),_utilsSupervisorTools=__webpack_require__(1383);function CustomTimeRanges(){return{customTimeRangeArray:[],length:0,add:function add(start,end){var i=0;for(i=0;i<this.customTimeRangeArray.length&&start>this.customTimeRangeArray[i].start;i++);for(this.customTimeRangeArray.splice(i,0,{start:start,end:end}),i=0;i<this.customTimeRangeArray.length-1;i++)this.mergeRanges(i,i+1)&&i--;this.length=this.customTimeRangeArray.length},clear:function clear(){this.customTimeRangeArray=[],this.length=0},remove:function remove(start,end){for(var i=0;i<this.customTimeRangeArray.length;i++)if(start<=this.customTimeRangeArray[i].start&&end>=this.customTimeRangeArray[i].end)this.customTimeRangeArray.splice(i,1),i--;else{if(start>this.customTimeRangeArray[i].start&&end<this.customTimeRangeArray[i].end){this.customTimeRangeArray.splice(i+1,0,{start:end,end:this.customTimeRangeArray[i].end}),this.customTimeRangeArray[i].end=start;break}start>this.customTimeRangeArray[i].start&&start<this.customTimeRangeArray[i].end?this.customTimeRangeArray[i].end=start:end>this.customTimeRangeArray[i].start&&end<this.customTimeRangeArray[i].end&&(this.customTimeRangeArray[i].start=end)}this.length=this.customTimeRangeArray.length},mergeRanges:function mergeRanges(rangeIndex1,rangeIndex2){var range1=this.customTimeRangeArray[rangeIndex1],range2=this.customTimeRangeArray[rangeIndex2];return range1.start<=range2.start&&range2.start<=range1.end&&range1.end<=range2.end?(range1.end=range2.end,this.customTimeRangeArray.splice(rangeIndex2,1),!0):range2.start<=range1.start&&range1.start<=range2.end&&range2.end<=range1.end?(range1.start=range2.start,this.customTimeRangeArray.splice(rangeIndex2,1),!0):range2.start<=range1.start&&range1.start<=range2.end&&range1.end<=range2.end?(this.customTimeRangeArray.splice(rangeIndex1,1),!0):range1.start<=range2.start&&range2.start<=range1.end&&range2.end<=range1.end&&(this.customTimeRangeArray.splice(rangeIndex2,1),!0)},start:function start(index){return(0,_utilsSupervisorTools.checkInteger)(index),index>=this.customTimeRangeArray.length||index<0?NaN:this.customTimeRangeArray[index].start},end:function end(index){return(0,_utilsSupervisorTools.checkInteger)(index),index>=this.customTimeRangeArray.length||index<0?NaN:this.customTimeRangeArray[index].end}}}CustomTimeRanges.__dashjs_factory_name="CustomTimeRanges",exports.default=_coreFactoryMaker2.default.getClassFactory(CustomTimeRanges),module.exports=exports.default},1425:function(module,exports,__webpack_require__){exports.generateISD=__webpack_require__(1467).generateISD,exports.fromXML=__webpack_require__(1468).fromXML,exports.renderHTML=__webpack_require__(1482).render},1426:function(module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},1427:function(module,exports,__webpack_require__){"use strict";(function(global,process){var pna=__webpack_require__(1395);module.exports=Readable;var Duplex,isArray=__webpack_require__(1426);Readable.ReadableState=ReadableState;__webpack_require__(1405).EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length},Stream=__webpack_require__(1428),Buffer=__webpack_require__(1407).Buffer,OurUint8Array=global.Uint8Array||function(){};var util=Object.create(__webpack_require__(1387));util.inherits=__webpack_require__(1384);var debugUtil=__webpack_require__(1473),debug=void 0;debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){};var StringDecoder,BufferList=__webpack_require__(1474),destroyImpl=__webpack_require__(1429);util.inherits(Readable,Stream);var kProxyEvents=["error","close","destroy","pause","resume"];function ReadableState(options,stream){options=options||{};var isDuplex=stream instanceof(Duplex=Duplex||__webpack_require__(1379));this.objectMode=!!options.objectMode,isDuplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,readableHwm=options.readableHighWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:isDuplex&&(readableHwm||0===readableHwm)?readableHwm:defaultHwm,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=__webpack_require__(1409).StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(Duplex=Duplex||__webpack_require__(1379),!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this),this.readable=!0,options&&("function"==typeof options.read&&(this._read=options.read),"function"==typeof options.destroy&&(this._destroy=options.destroy)),Stream.call(this)}function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){var er,state=stream._readableState;null===chunk?(state.reading=!1,function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}(stream,state)):(skipChunkCheck||(er=function chunkInvalid(state,chunk){var er;(function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array})(chunk)||"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk"));return er}(state,chunk)),er?stream.emit("error",er):state.objectMode||chunk&&chunk.length>0?("string"==typeof chunk||state.objectMode||Object.getPrototypeOf(chunk)===Buffer.prototype||(chunk=function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}(chunk)),addToFront?state.endEmitted?stream.emit("error",new Error("stream.unshift() after end event")):addChunk(stream,state,chunk,!0):state.ended?stream.emit("error",new Error("stream.push() after EOF")):(state.reading=!1,state.decoder&&!encoding?(chunk=state.decoder.write(chunk),state.objectMode||0!==chunk.length?addChunk(stream,state,chunk,!1):maybeReadMore(stream,state)):addChunk(stream,state,chunk,!1))):addToFront||(state.reading=!1));return function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}(state)}function addChunk(stream,state,chunk,addToFront){state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream)),maybeReadMore(stream,state)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(value){this._readableState&&(this._readableState.destroyed=value)}}),Readable.prototype.destroy=destroyImpl.destroy,Readable.prototype._undestroy=destroyImpl.undestroy,Readable.prototype._destroy=function(err,cb){this.push(null),cb(err)},Readable.prototype.push=function(chunk,encoding){var skipChunkCheck,state=this._readableState;return state.objectMode?skipChunkCheck=!0:"string"==typeof chunk&&((encoding=encoding||state.defaultEncoding)!==state.encoding&&(chunk=Buffer.from(chunk,encoding),encoding=""),skipChunkCheck=!0),readableAddChunk(this,chunk,encoding,!1,skipChunkCheck)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=__webpack_require__(1409).StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!=n?state.flowing&&state.length?state.buffer.head.data.length:state.length:(n>state.highWaterMark&&(state.highWaterMark=function computeNewHighWaterMark(n){return n>=8388608?n=8388608:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?pna.nextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,pna.nextTick(maybeReadMore_,stream,state))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,state.awaitDrain=0,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;for(debug("flow",state.flowing);state.flowing&&null!==stream.read(););}function fromList(n,state){return 0===state.length?null:(state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(""):1===state.buffer.length?state.buffer.head.data:state.buffer.concat(state.length),state.buffer.clear()):ret=function fromListPartial(n,list,hasStrings){var ret;n<list.head.data.length?(ret=list.head.data.slice(0,n),list.head.data=list.head.data.slice(n)):ret=n===list.head.data.length?list.shift():hasStrings?function copyFromBufferString(n,list){var p=list.head,c=1,ret=p.data;n-=ret.length;for(;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=str.slice(nb));break}++c}return list.length-=c,ret}(n,list):function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n),p=list.head,c=1;p.data.copy(ret),n-=p.data.length;for(;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=buf.slice(nb));break}++c}return list.length-=c,ret}(n,list);return ret}(n,state.buffer,state.decoder),ret);var ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');state.endEmitted||(state.ended=!0,pna.nextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}Readable.prototype.read=function(n){debug("read",n),n=parseInt(n,10);var state=this._readableState,nOrig=n;if(0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(0===(n=howMuchToRead(n,state))&&state.ended)return 0===state.length&&endReadable(this),null;var ret,doRead=state.needReadable;return debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&debug("length less than watermark",doRead=!0),state.ended||state.reading?debug("reading or ended",doRead=!1):doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state))),null===(ret=n>0?fromList(n,state):null)?(state.needReadable=!0,n=0):state.length-=n,0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&endReadable(this)),null!==ret&&this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var endFn=(!pipeOpts||!1!==pipeOpts.end)&&dest!==process.stdout&&dest!==process.stderr?onend:unpipe;function onunpipe(readable,unpipeInfo){debug("onunpipe"),readable===src&&unpipeInfo&&!1===unpipeInfo.hasUnpiped&&(unpipeInfo.hasUnpiped=!0,function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",unpipe),src.removeListener("data",ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}())}function onend(){debug("onend"),dest.end()}state.endEmitted?pna.nextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EElistenerCount(src,"data")&&(state.flowing=!0,flow(src))}}(src);dest.on("drain",ondrain);var cleanedUp=!1;var increasedAwaitDrain=!1;function ondata(chunk){debug("ondata"),increasedAwaitDrain=!1,!1!==dest.write(chunk)||increasedAwaitDrain||((1===state.pipesCount&&state.pipes===dest||state.pipesCount>1&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,increasedAwaitDrain=!0),src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EElistenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}return src.on("data",ondata),function prependListener(emitter,event,fn){if("function"==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}(dest,"error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState,unpipeInfo={hasUnpiped:!1};if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this,unpipeInfo),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;i<len;i++)dests[i].emit("unpipe",this,unpipeInfo);return this}var index=indexOf(state.pipes,dest);return-1===index?this:(state.pipes.splice(index,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this,unpipeInfo),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev)!1!==this._readableState.flowing&&this.resume();else if("readable"===ev){var state=this._readableState;state.endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.emittedReadable=!1,state.reading?state.length&&emitReadable(this):pna.nextTick(nReadingNextTick,this))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,function resume(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,pna.nextTick(resume_,stream,state))}(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var _this=this,state=this._readableState,paused=!1;for(var i in stream.on("end",(function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&_this.push(chunk)}_this.push(null)})),stream.on("data",(function(chunk){(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),state.objectMode&&null==chunk)||(state.objectMode||chunk&&chunk.length)&&(_this.push(chunk)||(paused=!0,stream.pause()))})),stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));for(var n=0;n<kProxyEvents.length;n++)stream.on(kProxyEvents[n],this.emit.bind(this,kProxyEvents[n]));return this._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},this},Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Readable._fromList=fromList}).call(this,__webpack_require__(54),__webpack_require__(260))},1428:function(module,exports,__webpack_require__){module.exports=__webpack_require__(1405).EventEmitter},1429:function(module,exports,__webpack_require__){"use strict";var pna=__webpack_require__(1395);function emitErrorNT(self,err){self.emit("error",err)}module.exports={destroy:function destroy(err,cb){var _this=this,readableDestroyed=this._readableState&&this._readableState.destroyed,writableDestroyed=this._writableState&&this._writableState.destroyed;return readableDestroyed||writableDestroyed?(cb?cb(err):!err||this._writableState&&this._writableState.errorEmitted||pna.nextTick(emitErrorNT,this,err),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(err||null,(function(err){!cb&&err?(pna.nextTick(emitErrorNT,_this,err),_this._writableState&&(_this._writableState.errorEmitted=!0)):cb&&cb(err)})),this)},undestroy:function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},1430:function(module,exports,__webpack_require__){"use strict";module.exports=Transform;var Duplex=__webpack_require__(1379),util=Object.create(__webpack_require__(1387));function afterTransform(er,data){var ts=this._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return this.emit("error",new Error("write callback called multiple times"));ts.writechunk=null,ts.writecb=null,null!=data&&this.push(data),cb(er);var rs=this._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.on("prefinish",prefinish)}function prefinish(){var _this=this;"function"==typeof this._flush?this._flush((function(er,data){done(_this,er,data)})):done(this,null,null)}function done(stream,er,data){if(er)return stream.emit("error",er);if(null!=data&&stream.push(data),stream._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(stream._transformState.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}util.inherits=__webpack_require__(1384),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0},Transform.prototype._destroy=function(err,cb){var _this2=this;Duplex.prototype._destroy.call(this,err,(function(err2){cb(err2),_this2.emit("close")}))}},1431:function(module,exports,__webpack_require__){"use strict";!function(exports){var specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function getCharForByte(byte){var charCode=byte;return specialCea608CharsCodes.hasOwnProperty(byte)&&(charCode=specialCea608CharsCodes[byte]),String.fromCharCode(charCode)},rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],logger={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function setTime(newTime){this.time=newTime},log:function log(severity,msg){var minLevel=this.verboseFilter[severity];this.verboseLevel>=minLevel&&console.log(this.time+" ["+severity+"] "+msg)}},numArrayToHexArray=function numArrayToHexArray(numArray){for(var hexArray=[],j=0;j<numArray.length;j++)hexArray.push(numArray[j].toString(16));return hexArray},PenState=function PenState(foreground,underline,italics,background,flash){this.foreground=foreground||"white",this.underline=underline||!1,this.italics=italics||!1,this.background=background||"black",this.flash=flash||!1};PenState.prototype={reset:function reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function setStyles(styles){for(var attribs=["foreground","underline","italics","background","flash"],i=0;i<attribs.length;i++){var style=attribs[i];styles.hasOwnProperty(style)&&(this[style]=styles[style])}},isDefault:function isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function equals(other){return this.foreground===other.foreground&&this.underline===other.underline&&this.italics===other.italics&&this.background===other.background&&this.flash===other.flash},copy:function copy(newPenState){this.foreground=newPenState.foreground,this.underline=newPenState.underline,this.italics=newPenState.italics,this.background=newPenState.background,this.flash=newPenState.flash},toString:function toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var StyledUnicodeChar=function StyledUnicodeChar(uchar,foreground,underline,italics,background,flash){this.uchar=uchar||" ",this.penState=new PenState(foreground,underline,italics,background,flash)};StyledUnicodeChar.prototype={reset:function reset(){this.uchar=" ",this.penState.reset()},setChar:function setChar(uchar,newPenState){this.uchar=uchar,this.penState.copy(newPenState)},setPenState:function setPenState(newPenState){this.penState.copy(newPenState)},equals:function equals(other){return this.uchar===other.uchar&&this.penState.equals(other.penState)},copy:function copy(newChar){this.uchar=newChar.uchar,this.penState.copy(newChar.penState)},isEmpty:function isEmpty(){return" "===this.uchar&&this.penState.isDefault()}};var Row=function Row(){this.chars=[];for(var i=0;i<32;i++)this.chars.push(new StyledUnicodeChar);this.pos=0,this.currPenState=new PenState};Row.prototype={equals:function equals(other){for(var equal=!0,i=0;i<32;i++)if(!this.chars[i].equals(other.chars[i])){equal=!1;break}return equal},copy:function copy(other){for(var i=0;i<32;i++)this.chars[i].copy(other.chars[i])},isEmpty:function isEmpty(){for(var empty=!0,i=0;i<32;i++)if(!this.chars[i].isEmpty()){empty=!1;break}return empty},setCursor:function setCursor(absPos){this.pos!==absPos&&(this.pos=absPos),this.pos<0?(logger.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>32&&(logger.log("ERROR","Too large cursor position "+this.pos),this.pos=32)},moveCursor:function moveCursor(relPos){var newPos=this.pos+relPos;if(relPos>1)for(var i=this.pos+1;i<newPos+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(newPos)},backSpace:function backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function insertChar(byte){byte>=144&&this.backSpace();var char=getCharForByte(byte);this.pos>=32?logger.log("ERROR","Cannot insert "+byte.toString(16)+" ("+char+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(char,this.currPenState),this.moveCursor(1))},clearFromPos:function clearFromPos(startPos){var i;for(i=startPos;i<32;i++)this.chars[i].reset()},clear:function clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function clearToEndOfRow(){this.clearFromPos(this.pos)},getTextString:function getTextString(){for(var chars=[],empty=!0,i=0;i<32;i++){var char=this.chars[i].uchar;" "!==char&&(empty=!1),chars.push(char)}return empty?"":chars.join("")},setPenStyles:function setPenStyles(styles){this.currPenState.setStyles(styles),this.chars[this.pos].setPenState(this.currPenState)}};var CaptionScreen=function CaptionScreen(){this.rows=[];for(var i=0;i<15;i++)this.rows.push(new Row);this.currRow=14,this.nrRollUpRows=null,this.reset()};CaptionScreen.prototype={reset:function reset(){for(var i=0;i<15;i++)this.rows[i].clear();this.currRow=14},equals:function equals(other){for(var equal=!0,i=0;i<15;i++)if(!this.rows[i].equals(other.rows[i])){equal=!1;break}return equal},copy:function copy(other){for(var i=0;i<15;i++)this.rows[i].copy(other.rows[i])},isEmpty:function isEmpty(){for(var empty=!0,i=0;i<15;i++)if(!this.rows[i].isEmpty()){empty=!1;break}return empty},backSpace:function backSpace(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function insertChar(char){this.rows[this.currRow].insertChar(char)},setPen:function setPen(styles){this.rows[this.currRow].setPenStyles(styles)},moveCursor:function moveCursor(relPos){this.rows[this.currRow].moveCursor(relPos)},setCursor:function setCursor(absPos){logger.log("INFO","setCursor: "+absPos),this.rows[this.currRow].setCursor(absPos)},setPAC:function setPAC(pacData){logger.log("INFO","pacData = "+JSON.stringify(pacData));var newRow=pacData.row-1;this.nrRollUpRows&&newRow<this.nrRollUpRows-1&&(newRow=this.nrRollUpRows-1),this.currRow=newRow;var row=this.rows[this.currRow];if(null!==pacData.indent){var indent=pacData.indent,prevPos=Math.max(indent-1,0);row.setCursor(pacData.indent),pacData.color=row.chars[prevPos].penState.foreground}var styles={foreground:pacData.color,underline:pacData.underline,italics:pacData.italics,background:"black",flash:!1};this.setPen(styles)},setBkgData:function setBkgData(bkgData){logger.log("INFO","bkgData = "+JSON.stringify(bkgData)),this.backSpace(),this.setPen(bkgData),this.insertChar(32)},setRollUpRows:function setRollUpRows(nrRows){this.nrRollUpRows=nrRows},rollUp:function rollUp(){if(null!==this.nrRollUpRows){logger.log("TEXT",this.getDisplayText());var topRowIndex=this.currRow+1-this.nrRollUpRows,topRow=this.rows.splice(topRowIndex,1)[0];topRow.clear(),this.rows.splice(this.currRow,0,topRow),logger.log("INFO","Rolling up")}else logger.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function getDisplayText(asOneRow){asOneRow=asOneRow||!1;for(var displayText=[],text="",rowNr=-1,i=0;i<15;i++){var rowText=this.rows[i].getTextString();rowText&&(rowNr=i+1,asOneRow?displayText.push("Row "+rowNr+': "'+rowText+'"'):displayText.push(rowText.trim()))}return displayText.length>0&&(text=asOneRow?"["+displayText.join(" | ")+"]":displayText.join("\n")),text},getTextAndFormat:function getTextAndFormat(){return this.rows}};var Cea608Channel=function Cea608Channel(channelNumber,outputFilter){this.chNr=channelNumber,this.outputFilter=outputFilter,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen,this.nonDisplayedMemory=new CaptionScreen,this.lastOutputScreen=new CaptionScreen,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};Cea608Channel.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function getHandler(){return this.outputFilter},setHandler:function setHandler(newHandler){this.outputFilter=newHandler},setPAC:function setPAC(pacData){this.writeScreen.setPAC(pacData)},setBkgData:function setBkgData(bkgData){this.writeScreen.setBkgData(bkgData)},setMode:function setMode(newMode){newMode!==this.mode&&(this.mode=newMode,logger.log("INFO","MODE="+newMode),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=newMode)},insertChars:function insertChars(chars){for(var i=0;i<chars.length;i++)this.writeScreen.insertChar(chars[i]);var screen=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";logger.log("INFO",screen+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(logger.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function cc_RCL(){logger.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function cc_BS(){logger.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function cc_AOF(){},cc_AON:function cc_AON(){},cc_DER:function cc_DER(){logger.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function cc_RU(nrRows){logger.log("INFO","RU("+nrRows+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(nrRows)},cc_FON:function cc_FON(){logger.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function cc_RDC(){logger.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function cc_TR(){logger.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function cc_RTD(){logger.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function cc_EDM(){logger.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function cc_CR(){logger.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function cc_ENM(){logger.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function cc_EOC(){if(logger.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var tmp=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=tmp,this.writeScreen=this.nonDisplayedMemory,logger.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function cc_TO(nrCols){logger.log("INFO","TO("+nrCols+") - Tab Offset"),this.writeScreen.moveCursor(nrCols)},cc_MIDROW:function cc_MIDROW(secondByte){var styles={flash:!1};if(styles.underline=secondByte%2==1,styles.italics=secondByte>=46,styles.italics)styles.foreground="white";else{var colorIndex=Math.floor(secondByte/2)-16;styles.foreground=["white","green","blue","cyan","red","yellow","magenta"][colorIndex]}logger.log("INFO","MIDROW: "+JSON.stringify(styles)),this.writeScreen.setPen(styles)},outputDataUpdate:function outputDataUpdate(){var t=logger.time;null!==t&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(t,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}};var Cea608Parser=function Cea608Parser(field,out1,out2){this.field=field||1,this.outputs=[out1,out2],this.channels=[new Cea608Channel(1,out1),new Cea608Channel(2,out2)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};Cea608Parser.prototype={getHandler:function getHandler(index){return this.channels[index].getHandler()},setHandler:function setHandler(index,newHandler){this.channels[index].setHandler(newHandler)},addData:function addData(t,byteList){var cmdFound,a,b,charsFound=!1;this.lastTime=t,logger.setTime(t);for(var i=0;i<byteList.length;i+=2)if(a=127&byteList[i],b=127&byteList[i+1],a>=16&&a<=31&&a===this.lastCmdA&&b===this.lastCmdB)this.lastCmdA=null,this.lastCmdB=null,logger.log("DEBUG","Repeated command ("+numArrayToHexArray([a,b])+") is dropped");else if(0!==a||0!==b){if(logger.log("DATA","["+numArrayToHexArray([byteList[i],byteList[i+1]])+"] -> ("+numArrayToHexArray([a,b])+")"),(cmdFound=this.parseCmd(a,b))||(cmdFound=this.parseMidrow(a,b)),cmdFound||(cmdFound=this.parsePAC(a,b)),cmdFound||(cmdFound=this.parseBackgroundAttributes(a,b)),!cmdFound)if(charsFound=this.parseChars(a,b))if(this.currChNr&&this.currChNr>=0)this.channels[this.currChNr-1].insertChars(charsFound);else logger.log("WARNING","No channel found yet. TEXT-MODE?");cmdFound?this.dataCounters.cmd+=2:charsFound?this.dataCounters.char+=2:(this.dataCounters.other+=2,logger.log("WARNING","Couldn't parse cleaned data "+numArrayToHexArray([a,b])+" orig: "+numArrayToHexArray([byteList[i],byteList[i+1]])))}else this.dataCounters.padding+=2},parseCmd:function parseCmd(a,b){var chNr=null;if(!((20===a||21===a||28===a||29===a)&&32<=b&&b<=47)&&!((23===a||31===a)&&33<=b&&b<=35))return!1;chNr=20===a||21===a||23===a?1:2;var channel=this.channels[chNr-1];return 20===a||21===a||28===a||29===a?32===b?channel.cc_RCL():33===b?channel.cc_BS():34===b?channel.cc_AOF():35===b?channel.cc_AON():36===b?channel.cc_DER():37===b?channel.cc_RU(2):38===b?channel.cc_RU(3):39===b?channel.cc_RU(4):40===b?channel.cc_FON():41===b?channel.cc_RDC():42===b?channel.cc_TR():43===b?channel.cc_RTD():44===b?channel.cc_EDM():45===b?channel.cc_CR():46===b?channel.cc_ENM():47===b&&channel.cc_EOC():channel.cc_TO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=chNr,!0},parseMidrow:function parseMidrow(a,b){var chNr=null;if((17===a||25===a)&&32<=b&&b<=47){if((chNr=17===a?1:2)!==this.currChNr)return logger.log("ERROR","Mismatch channel in midrow parsing"),!1;var channel=this.channels[chNr-1];return channel.insertChars([32]),channel.cc_MIDROW(b),logger.log("DEBUG","MIDROW ("+numArrayToHexArray([a,b])+")"),this.lastCmdA=a,this.lastCmdB=b,!0}return!1},parsePAC:function parsePAC(a,b){var chNr,row=null;if(!((17<=a&&a<=23||25<=a&&a<=31)&&64<=b&&b<=127)&&!((16===a||24===a)&&64<=b&&b<=95))return!1;chNr=a<=23?1:2,row=64<=b&&b<=95?1===chNr?rowsLowCh1[a]:rowsLowCh2[a]:1===chNr?rowsHighCh1[a]:rowsHighCh2[a];var pacData=this.interpretPAC(row,b);return this.channels[chNr-1].setPAC(pacData),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=chNr,!0},interpretPAC:function interpretPAC(row,byte){var pacIndex=byte,pacData={color:null,italics:!1,indent:null,underline:!1,row:row};return pacIndex=byte>95?byte-96:byte-64,pacData.underline=1==(1&pacIndex),pacIndex<=13?pacData.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(pacIndex/2)]:pacIndex<=15?(pacData.italics=!0,pacData.color="white"):pacData.indent=4*Math.floor((pacIndex-16)/2),pacData},parseChars:function parseChars(a,b){var channelNr=null,charCodes=null,charCode1=null;if(a>=25?(channelNr=2,charCode1=a-8):(channelNr=1,charCode1=a),17<=charCode1&&charCode1<=19){var oneCode=b;oneCode=17===charCode1?b+80:18===charCode1?b+112:b+144,logger.log("INFO","Special char '"+getCharForByte(oneCode)+"' in channel "+channelNr),charCodes=[oneCode],this.lastCmdA=a,this.lastCmdB=b}else 32<=a&&a<=127&&(charCodes=0===b?[a]:[a,b],this.lastCmdA=null,this.lastCmdB=null);if(charCodes){var hexCodes=numArrayToHexArray(charCodes);logger.log("DEBUG","Char codes =  "+hexCodes.join(","))}return charCodes},parseBackgroundAttributes:function parseBackgroundAttributes(a,b){var bkgData,index,chNr;return((16===a||24===a)&&32<=b&&b<=47||(23===a||31===a)&&45<=b&&b<=47)&&(bkgData={},16===a||24===a?(index=Math.floor((b-32)/2),bkgData.background=backgroundColors[index],b%2==1&&(bkgData.background=bkgData.background+"_semi")):45===b?bkgData.background="transparent":(bkgData.foreground="black",47===b&&(bkgData.underline=!0)),chNr=a<24?1:2,this.channels[chNr-1].setBkgData(bkgData),this.lastCmdA=a,this.lastCmdB=b,!0)},reset:function reset(){for(var i=0;i<this.channels.length;i++)this.channels[i]&&this.channels[i].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function cueSplitAtTime(t){for(var i=0;i<this.channels.length;i++)this.channels[i]&&this.channels[i].cueSplitAtTime(t)}};exports.logger=logger,exports.PenState=PenState,exports.CaptionScreen=CaptionScreen,exports.Cea608Parser=Cea608Parser,exports.findCea608Nalus=function findCea608Nalus(raw,startPos,size){for(var nalSize=0,cursor=startPos,cea608NaluRanges=[],isCEA608SEI=function isCEA608SEI(payloadType,payloadSize,raw,pos){if(4!==payloadType||payloadSize<8)return null;var countryCode=raw.getUint8(pos),providerCode=raw.getUint16(pos+1),userIdentifier=raw.getUint32(pos+3),userDataTypeCode=raw.getUint8(pos+7);return 181==countryCode&&49==providerCode&&1195456820==userIdentifier&&3==userDataTypeCode};cursor<startPos+size;){if(nalSize=raw.getUint32(cursor),6===(31&raw.getUint8(cursor+4)))for(var pos=cursor+5,payloadType=-1;pos<cursor+4+nalSize-1;){payloadType=0;for(var b=255;255===b;)payloadType+=b=raw.getUint8(pos),pos++;var payloadSize=0;for(b=255;255===b;)payloadSize+=b=raw.getUint8(pos),pos++;isCEA608SEI(payloadType,payloadSize,raw,pos)&&cea608NaluRanges.push([pos,payloadSize]),pos+=payloadSize}cursor+=nalSize+4}return cea608NaluRanges},exports.extractCea608DataFromRange=function extractCea608DataFromRange(raw,cea608Range){var pos=cea608Range[0],fieldData=[[],[]];pos+=8;var ccCount=31&raw.getUint8(pos);pos+=2;for(var i=0;i<ccCount;i++){var byte=raw.getUint8(pos),ccValid=4&byte,ccType=3&byte;pos++;var ccData1=raw.getUint8(pos);pos++;var ccData2=raw.getUint8(pos);pos++,ccValid&&(127&ccData1)+(127&ccData2)!=0&&(0===ccType?(fieldData[0].push(ccData1),fieldData[0].push(ccData2)):1===ccType&&(fieldData[1].push(ccData1),fieldData[1].push(ccData2)))}return fieldData}}(exports)},1432:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var ErrorsBase=function(){function ErrorsBase(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ErrorsBase)}return _createClass(ErrorsBase,[{key:"extend",value:function extend(errors,config){if(errors){var override=!!config&&config.override,publicOnly=!!config&&config.publicOnly;for(var err in errors)!errors.hasOwnProperty(err)||this[err]&&!override||publicOnly&&-1===errors[err].indexOf("public_")||(this[err]=errors[err])}}}]),ErrorsBase}();exports.default=ErrorsBase,module.exports=exports.default},1433:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _ThroughputRule2=_interopRequireDefault(__webpack_require__(1487)),_InsufficientBufferRule2=_interopRequireDefault(__webpack_require__(1488)),_AbandonRequestsRule2=_interopRequireDefault(__webpack_require__(1489)),_DroppedFramesRule2=_interopRequireDefault(__webpack_require__(1490)),_SwitchHistoryRule2=_interopRequireDefault(__webpack_require__(1491)),_BolaRule2=_interopRequireDefault(__webpack_require__(1492)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_SwitchRequest2=_interopRequireDefault(__webpack_require__(1375));function ABRRulesCollection(config){config=config||{};var context=this.context,mediaPlayerModel=config.mediaPlayerModel,metricsModel=config.metricsModel,dashMetrics=config.dashMetrics,qualitySwitchRules=void 0,abandonFragmentRules=void 0;function getActiveRules(srArray){return srArray.filter((function(sr){return sr.quality>_SwitchRequest2.default.NO_CHANGE}))}function getMinSwitchRequest(srArray){var len,values={},i=void 0,req=void 0,newQuality=void 0,quality=void 0;if(0!==srArray.length){for(values[_SwitchRequest2.default.PRIORITY.STRONG]=_SwitchRequest2.default.NO_CHANGE,values[_SwitchRequest2.default.PRIORITY.WEAK]=_SwitchRequest2.default.NO_CHANGE,values[_SwitchRequest2.default.PRIORITY.DEFAULT]=_SwitchRequest2.default.NO_CHANGE,i=0,len=srArray.length;i<len;i+=1)(req=srArray[i]).quality!==_SwitchRequest2.default.NO_CHANGE&&(values[req.priority]=values[req.priority]>_SwitchRequest2.default.NO_CHANGE?Math.min(values[req.priority],req.quality):req.quality);return values[_SwitchRequest2.default.PRIORITY.WEAK]!==_SwitchRequest2.default.NO_CHANGE&&(newQuality=values[_SwitchRequest2.default.PRIORITY.WEAK]),values[_SwitchRequest2.default.PRIORITY.DEFAULT]!==_SwitchRequest2.default.NO_CHANGE&&(newQuality=values[_SwitchRequest2.default.PRIORITY.DEFAULT]),values[_SwitchRequest2.default.PRIORITY.STRONG]!==_SwitchRequest2.default.NO_CHANGE&&(newQuality=values[_SwitchRequest2.default.PRIORITY.STRONG]),newQuality!==_SwitchRequest2.default.NO_CHANGE&&(quality=newQuality),(0,_SwitchRequest2.default)(context).create(quality)}}return{initialize:function initialize(){qualitySwitchRules=[],abandonFragmentRules=[],mediaPlayerModel.getUseDefaultABRRules()&&(qualitySwitchRules.push((0,_BolaRule2.default)(context).create({metricsModel:metricsModel,dashMetrics:dashMetrics,mediaPlayerModel:mediaPlayerModel})),qualitySwitchRules.push((0,_ThroughputRule2.default)(context).create({metricsModel:metricsModel,dashMetrics:dashMetrics})),qualitySwitchRules.push((0,_InsufficientBufferRule2.default)(context).create({metricsModel:metricsModel,dashMetrics:dashMetrics})),qualitySwitchRules.push((0,_SwitchHistoryRule2.default)(context).create()),qualitySwitchRules.push((0,_DroppedFramesRule2.default)(context).create()),abandonFragmentRules.push((0,_AbandonRequestsRule2.default)(context).create({metricsModel:metricsModel,dashMetrics:dashMetrics,mediaPlayerModel:mediaPlayerModel}))),mediaPlayerModel.getABRCustomRules().forEach((function(rule){"qualitySwitchRules"===rule.type&&qualitySwitchRules.push(rule.rule(context).create()),"abandonFragmentRules"===rule.type&&abandonFragmentRules.push(rule.rule(context).create())}))},reset:function reset(){[qualitySwitchRules,abandonFragmentRules].forEach((function(rules){rules&&rules.length&&rules.forEach((function(rule){return rule.reset&&rule.reset()}))})),qualitySwitchRules=[],abandonFragmentRules=[]},getMaxQuality:function getMaxQuality(rulesContext){return getMinSwitchRequest(getActiveRules(qualitySwitchRules.map((function(rule){return rule.getMaxIndex(rulesContext)}))))||(0,_SwitchRequest2.default)(context).create()},shouldAbandonFragment:function shouldAbandonFragment(rulesContext){return getMinSwitchRequest(getActiveRules(abandonFragmentRules.map((function(rule){return rule.shouldAbandon(rulesContext)}))))||(0,_SwitchRequest2.default)(context).create()}}}ABRRulesCollection.__dashjs_factory_name="ABRRulesCollection";var factory=_coreFactoryMaker2.default.getClassFactory(ABRRulesCollection);factory.QUALITY_SWITCH_RULES="qualitySwitchRules",factory.ABANDON_FRAGMENT_RULES="abandonFragmentRules",_coreFactoryMaker2.default.updateSingletonFactory(ABRRulesCollection.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1434:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function BitrateInfo(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BitrateInfo),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN},module.exports=exports.default},1435:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var PlayList=function PlayList(){_classCallCheck(this,PlayList),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};PlayList.INITIAL_PLAYOUT_START_REASON="initial_playout",PlayList.SEEK_START_REASON="seek",PlayList.RESUME_FROM_PAUSE_START_REASON="resume",PlayList.METRICS_COLLECTION_START_REASON="metrics_collection_start";var PlayListTrace=function PlayListTrace(){_classCallCheck(this,PlayListTrace),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};PlayListTrace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",PlayListTrace.REBUFFERING_REASON="rebuffering",PlayListTrace.USER_REQUEST_STOP_REASON="user_request",PlayListTrace.END_OF_PERIOD_STOP_REASON="end_of_period",PlayListTrace.END_OF_CONTENT_STOP_REASON="end_of_content",PlayListTrace.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",PlayListTrace.FAILURE_STOP_REASON="failure",exports.PlayList=PlayList,exports.PlayListTrace=PlayListTrace},1436:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _streamingUtilsRequestModifier2=_interopRequireDefault(__webpack_require__(1397)),_voSegment2=_interopRequireDefault(__webpack_require__(1412)),_streamingVoDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_streamingUtilsBoxParser2=_interopRequireDefault(__webpack_require__(1386)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_streamingVoMetricsHTTPRequest=__webpack_require__(1373),_streamingVoFragmentRequest2=_interopRequireDefault(__webpack_require__(1378)),_streamingNetHTTPLoader2=_interopRequireDefault(__webpack_require__(1388)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372));function SegmentBaseLoader(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,errHandler=void 0,boxParser=void 0,requestModifier=void 0,metricsModel=void 0,mediaPlayerModel=void 0,httpLoader=void 0,baseURLController=void 0;function checkSetConfigCall(){if(!baseURLController||!baseURLController.hasOwnProperty("resolve"))throw new Error("setConfig function has to be called previously")}function getFragmentRequest(info){if(info.url){var request=new _streamingVoFragmentRequest2.default;return request.type=info.init?_streamingVoMetricsHTTPRequest.HTTPRequest.INIT_SEGMENT_TYPE:_streamingVoMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE,request.url=info.url,request.range=info.range.start+"-"+info.range.end,request}}function onLoaded(segments,representation,type){segments?eventBus.trigger(_coreEventsEvents2.default.SEGMENTS_LOADED,{segments:segments,representation:representation,mediaType:type}):eventBus.trigger(_coreEventsEvents2.default.SEGMENTS_LOADED,{segments:null,representation:representation,mediaType:type,error:new _streamingVoDashJSError2.default(_coreErrorsErrors2.default.SEGMENT_BASE_LOADER_ERROR_CODE,_coreErrorsErrors2.default.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}return instance={setConfig:function setConfig(config){config.baseURLController&&(baseURLController=config.baseURLController),config.metricsModel&&(metricsModel=config.metricsModel),config.mediaPlayerModel&&(mediaPlayerModel=config.mediaPlayerModel),config.errHandler&&(errHandler=config.errHandler)},initialize:function initialize(){boxParser=(0,_streamingUtilsBoxParser2.default)(context).getInstance(),requestModifier=(0,_streamingUtilsRequestModifier2.default)(context).getInstance(),httpLoader=(0,_streamingNetHTTPLoader2.default)(context).create({errHandler:errHandler,metricsModel:metricsModel,mediaPlayerModel:mediaPlayerModel,requestModifier:requestModifier})},loadInitialization:function loadInitialization(representation,loadingInfo){checkSetConfigCall();var initRange=null,baseUrl=baseURLController.resolve(representation.path),info=loadingInfo||{init:!0,url:baseUrl?baseUrl.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500};logger.debug("Start searching for initialization.");var request=getFragmentRequest(info);httpLoader.load({request:request,success:function onload(response){info.bytesLoaded=info.range.end,(initRange=boxParser.findInitRange(response))?(representation.range=initRange,eventBus.trigger(_coreEventsEvents2.default.INITIALIZATION_LOADED,{representation:representation})):(info.range.end=info.bytesLoaded+info.bytesToLoad,loadInitialization(representation,info))},error:function onerror(){eventBus.trigger(_coreEventsEvents2.default.INITIALIZATION_LOADED,{representation:representation})}}),logger.debug("Perform init search: "+info.url)},loadSegments:function loadSegments(representation,type,range,loadingInfo,callback){if(checkSetConfigCall(),range&&(void 0===range.start||void 0===range.end)){var parts=range?range.toString().split("-"):null;range=parts?{start:parseFloat(parts[0]),end:parseFloat(parts[1])}:null}callback=callback||onLoaded;var isoFile=null,sidx=null,hasRange=!!range,baseUrl=baseURLController.resolve(representation.path),info={init:!1,url:baseUrl?baseUrl.url:void 0,range:hasRange?range:{start:0,end:1500},searching:!hasRange,bytesLoaded:loadingInfo?loadingInfo.bytesLoaded:0,bytesToLoad:1500},request=getFragmentRequest(info);httpLoader.load({request:request,success:function onload(response){var extraBytes=info.bytesToLoad,loadedLength=response.byteLength;if(info.bytesLoaded=info.range.end-info.range.start,isoFile=boxParser.parse(response),(sidx=isoFile.getBox("sidx"))&&sidx.isComplete){var ref=sidx.references,loadMultiSidx=void 0,segments=void 0;null!=ref&&ref.length>0&&(loadMultiSidx=1===ref[0].reference_type),loadMultiSidx?function(){logger.debug("Initiate multiple SIDX load."),info.range.end=info.range.start+sidx.size;var j=void 0,len=void 0,ss=void 0,se=void 0,segs=[],count=0,offset=(sidx.offset||info.range.start)+sidx.size,tmpCallback=function tmpCallback(result){result?(segs=segs.concat(result),++count>=len&&callback(segs,representation,type)):callback(null,representation,type)};for(j=0,len=ref.length;j<len;j++)ss=offset,se=offset+ref[j].referenced_size-1,offset+=ref[j].referenced_size,loadSegments(representation,null,{start:ss,end:se},info,tmpCallback)}():(logger.debug("Parsing segments from SIDX."),segments=function getSegmentsForSidx(sidx,info){for(var refs=sidx.references,len=refs.length,timescale=sidx.timescale,time=sidx.earliest_presentation_time,start=info.range.start+sidx.offset+sidx.first_offset+sidx.size,segments=[],segment=void 0,end=void 0,duration=void 0,size=void 0,i=0;i<len;i++)duration=refs[i].subsegment_duration,size=refs[i].referenced_size,(segment=new _voSegment2.default).duration=duration,segment.startTime=time,segment.timescale=timescale,end=start+size-1,segment.mediaRange=start+"-"+end,segments.push(segment),time+=duration,start+=size;return segments}(sidx,info),callback(segments,representation,type))}else{if(sidx)info.range.start=sidx.offset||info.range.start,info.range.end=info.range.start+(sidx.size||extraBytes);else{if(loadedLength<info.bytesLoaded)return void callback(null,representation,type);var lastBox=isoFile.getLastBox();lastBox&&lastBox.size?(info.range.start=lastBox.offset+lastBox.size,info.range.end=info.range.start+extraBytes):info.range.end+=extraBytes}loadSegments(representation,type,info.range,info,callback)}},error:function onerror(){callback(null,representation,type)}}),logger.debug("Perform SIDX load: "+info.url)},reset:function reset(){httpLoader.abort(),httpLoader=null,errHandler=null,boxParser=null,requestModifier=null}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}SegmentBaseLoader.__dashjs_factory_name="SegmentBaseLoader",exports.default=_coreFactoryMaker2.default.getSingletonFactory(SegmentBaseLoader),module.exports=exports.default},1437:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_dashConstantsDashConstants2=_interopRequireDefault(__webpack_require__(1374)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_voThumbnailTrackInfo2=_interopRequireDefault(__webpack_require__(1522)),_streamingUtilsURLUtils2=_interopRequireDefault(__webpack_require__(1376)),_dashUtilsSegmentsUtils=__webpack_require__(1380),_dashSegmentBaseLoader2=_interopRequireDefault(__webpack_require__(1436)),_streamingUtilsBoxParser2=_interopRequireDefault(__webpack_require__(1386)),_streamingNetXHRLoader2=_interopRequireDefault(__webpack_require__(1414)),THUMBNAILS_SCHEME_ID_URIS=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function ThumbnailTracks(config){var instance,context=this.context,dashManifestModel=config.dashManifestModel,adapter=config.adapter,baseURLController=config.baseURLController,stream=config.stream,timelineConverter=config.timelineConverter,metricsModel=config.metricsModel,mediaPlayerModel=config.mediaPlayerModel,errHandler=config.errHandler,urlUtils=(0,_streamingUtilsURLUtils2.default)(context).getInstance(),tracks=void 0,currentTrackIndex=void 0,loader=void 0,segmentBaseLoader=void 0,boxParser=void 0;function initialize(){reset(),loader=(0,_streamingNetXHRLoader2.default)(context).create({}),boxParser=(0,_streamingUtilsBoxParser2.default)(context).getInstance(),(segmentBaseLoader=(0,_dashSegmentBaseLoader2.default)(context).getInstance()).setConfig({baseURLController:baseURLController,metricsModel:metricsModel,mediaPlayerModel:mediaPlayerModel,errHandler:errHandler}),function addTracks(){if(!stream||!dashManifestModel||!adapter)return;var streamInfo=stream.getStreamInfo();if(!streamInfo)return;var mediaInfo=adapter.getMediaInfoForType(streamInfo,_constantsConstants2.default.IMAGE);if(!mediaInfo)return;var voAdaptation=adapter.getDataForMedia(mediaInfo);if(!voAdaptation)return;var voReps=dashManifestModel.getRepresentationsForAdaptation(voAdaptation);voReps&&voReps.length>0&&voReps.forEach((function(rep){rep.segmentInfoType===_dashConstantsDashConstants2.default.SEGMENT_TEMPLATE&&rep.segmentDuration>0&&rep.media&&createTrack(rep),rep.segmentInfoType===_dashConstantsDashConstants2.default.SEGMENT_BASE&&createTrack(rep,!0)}));tracks.length>0&&(tracks.sort((function(a,b){return a.bitrate-b.bitrate})),currentTrackIndex=tracks.length-1)}()}function createTrack(representation,useSegmentBase){var track=new _voThumbnailTrackInfo2.default;track.id=representation.id,track.bitrate=representation.bandwidth,track.width=representation.width,track.height=representation.height,track.tilesHor=1,track.tilesVert=1,representation.essentialProperties&&representation.essentialProperties.forEach((function(p){if(THUMBNAILS_SCHEME_ID_URIS.indexOf(p.schemeIdUri)>=0&&p.value){var vars=p.value.split("x");2!==vars.length||isNaN(vars[0])||isNaN(vars[1])||(track.tilesHor=parseInt(vars[0],10),track.tilesVert=parseInt(vars[1],10))}})),useSegmentBase?segmentBaseLoader.loadSegments(representation,_constantsConstants2.default.IMAGE,representation.indexRange,{},(function(segments,representation){var cache=[];segments=function normalizeSegments(fragments,representation){var len,segments=[],count=0,i=void 0,s=void 0,seg=void 0;for(i=0,len=fragments.length;i<len;i++)s=fragments[i],seg=(0,_dashUtilsSegmentsUtils.getTimeBasedSegment)(timelineConverter,dashManifestModel.getIsDynamic(),representation,s.startTime,s.duration,s.timescale,s.media,s.mediaRange,count),segments.push(seg),seg=null,count++;return segments}(segments,representation),track.segmentDuration=segments[0].duration,track.readThumbnail=function(time,callback){var cached=null;cache.some((function(el){if(el.start<=time&&el.end>time)return cached=el.url,!0})),cached?callback(cached):segments.some((function(ss){if(ss.mediaStartTime<=time&&ss.mediaStartTime+ss.duration>time){var baseURL=baseURLController.resolve(representation.path);return loader.load({method:"get",url:baseURL.url,request:{range:ss.mediaRange,responseType:"arraybuffer"},onload:function onload(e){var info=boxParser.getSamplesInfo(e.target.response),blob=new Blob([e.target.response.slice(info.sampleList[0].offset,info.sampleList[0].offset+info.sampleList[0].size)],{type:"image/jpeg"}),imageUrl=window.URL.createObjectURL(blob);cache.push({start:ss.mediaStartTime,end:ss.mediaStartTime+ss.duration,url:imageUrl}),callback&&callback(imageUrl)}}),!0}}))}})):(track.startNumber=representation.startNumber,track.segmentDuration=representation.segmentDuration,track.timescale=representation.timescale,track.templateUrl=function buildTemplateUrl(representation){var templateUrl=urlUtils.isRelative(representation.media)?urlUtils.resolve(representation.media,baseURLController.resolve(representation.path).url):representation.media;if(!templateUrl)return"";return(0,_dashUtilsSegmentsUtils.replaceIDForTemplate)(templateUrl,representation.id)}(representation)),track.tilesHor>0&&track.tilesVert>0&&(track.widthPerTile=track.width/track.tilesHor,track.heightPerTile=track.height/track.tilesVert,tracks.push(track))}function reset(){tracks=[],currentTrackIndex=-1}return instance={initialize:initialize,getTracks:function getTracks(){return tracks},reset:reset,setTrackByIndex:function setTrackByIndex(index){tracks&&0!==tracks.length&&(index>=tracks.length&&(index=tracks.length-1),currentTrackIndex=index)},getCurrentTrack:function getCurrentTrack(){return currentTrackIndex<0?null:tracks[currentTrackIndex]},getCurrentTrackIndex:function getCurrentTrackIndex(){return currentTrackIndex}},initialize(),instance}exports.THUMBNAILS_SCHEME_ID_URIS=THUMBNAILS_SCHEME_ID_URIS,ThumbnailTracks.__dashjs_factory_name="ThumbnailTracks",exports.default=_coreFactoryMaker2.default.getClassFactory(ThumbnailTracks)},1438:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var mediaPlayerEvents=new(function(_EventsBase){function MediaPlayerEvents(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MediaPlayerEvents),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(MediaPlayerEvents.prototype),"constructor",this).call(this),this.AST_IN_FUTURE="astInFuture",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_LOADED="bufferLoaded",this.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",this.ERROR="error",this.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",this.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",this.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",this.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",this.LOG="log",this.MANIFEST_LOADED="manifestLoaded",this.METRICS_CHANGED="metricsChanged",this.METRIC_CHANGED="metricChanged",this.METRIC_ADDED="metricAdded",this.METRIC_UPDATED="metricUpdated",this.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",this.PERIOD_SWITCH_STARTED="periodSwitchStarted",this.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",this.QUALITY_CHANGE_RENDERED="qualityChangeRendered",this.TRACK_CHANGE_RENDERED="trackChangeRendered",this.SOURCE_INITIALIZED="sourceInitialized",this.STREAM_INITIALIZED="streamInitialized",this.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",this.TEXT_TRACKS_ADDED="allTextTracksAdded",this.TEXT_TRACK_ADDED="textTrackAdded",this.TTML_PARSED="ttmlParsed",this.TTML_TO_PARSE="ttmlToParse",this.CAPTION_RENDERED="captionRendered",this.CAPTION_CONTAINER_RESIZE="captionContainerResize",this.CAN_PLAY="canPlay",this.PLAYBACK_ENDED="playbackEnded",this.PLAYBACK_ERROR="playbackError",this.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",this.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",this.PLAYBACK_PAUSED="playbackPaused",this.PLAYBACK_PLAYING="playbackPlaying",this.PLAYBACK_PROGRESS="playbackProgress",this.PLAYBACK_RATE_CHANGED="playbackRateChanged",this.PLAYBACK_SEEKED="playbackSeeked",this.PLAYBACK_SEEKING="playbackSeeking",this.PLAYBACK_SEEK_ASKED="playbackSeekAsked",this.PLAYBACK_STALLED="playbackStalled",this.PLAYBACK_STARTED="playbackStarted",this.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",this.PLAYBACK_WAITING="playbackWaiting",this.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged"}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(MediaPlayerEvents,_EventsBase),MediaPlayerEvents}(function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1391)).default));exports.default=mediaPlayerEvents,module.exports=exports.default},1439:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _modelsBaseURLTreeModel2=_interopRequireDefault(__webpack_require__(1525)),_utilsBaseURLSelector2=_interopRequireDefault(__webpack_require__(1527)),_utilsURLUtils2=_interopRequireDefault(__webpack_require__(1376)),_dashVoBaseURL2=_interopRequireDefault(__webpack_require__(1441)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370));function BaseURLController(){var instance=void 0,dashManifestModel=void 0,context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),urlUtils=(0,_utilsURLUtils2.default)(context).getInstance(),baseURLTreeModel=void 0,baseURLSelector=void 0;function onBlackListChanged(e){baseURLTreeModel.invalidateSelectedIndexes(e.entry)}return instance={reset:function reset(){baseURLTreeModel.reset(),baseURLSelector.reset()},initialize:function initialize(data){baseURLTreeModel.setConfig({dashManifestModel:dashManifestModel}),baseURLSelector.setConfig({dashManifestModel:dashManifestModel}),function update(manifest){baseURLTreeModel.update(manifest),baseURLSelector.chooseSelectorFromManifest(manifest)}(data)},resolve:function resolve(path){var baseUrl=baseURLTreeModel.getForPath(path).reduce((function(p,c){var b=baseURLSelector.select(c);return b?(urlUtils.isRelative(b.url)?p.url=urlUtils.resolve(b.url,p.url):(p.url=b.url,p.serviceLocation=b.serviceLocation),p.availabilityTimeOffset=b.availabilityTimeOffset,p.availabilityTimeComplete=b.availabilityTimeComplete,p):new _dashVoBaseURL2.default}),new _dashVoBaseURL2.default);if(!urlUtils.isRelative(baseUrl.url))return baseUrl},setConfig:function setConfig(config){config.baseURLTreeModel&&(baseURLTreeModel=config.baseURLTreeModel),config.baseURLSelector&&(baseURLSelector=config.baseURLSelector),config.dashManifestModel&&(dashManifestModel=config.dashManifestModel)}},function setup(){baseURLTreeModel=(0,_modelsBaseURLTreeModel2.default)(context).create(),baseURLSelector=(0,_utilsBaseURLSelector2.default)(context).create(),eventBus.on(_coreEventsEvents2.default.SERVICE_LOCATION_BLACKLIST_CHANGED,onBlackListChanged,instance)}(),instance}BaseURLController.__dashjs_factory_name="BaseURLController",exports.default=_coreFactoryMaker2.default.getSingletonFactory(BaseURLController),module.exports=exports.default},1440:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_fastDeepEqual2=_interopRequireDefault(__webpack_require__(1526));function ObjectUtils(){return{areEqual:function areEqual(obj1,obj2){return(0,_fastDeepEqual2.default)(obj1,obj2)}}}ObjectUtils.__dashjs_factory_name="ObjectUtils",exports.default=_coreFactoryMaker2.default.getSingletonFactory(ObjectUtils),module.exports=exports.default},1441:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BaseURL=function BaseURL(url,serviceLocation,priority,weight){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BaseURL),this.url=url||"",this.serviceLocation=serviceLocation||url||"",this.dvb_priority=priority||1,this.dvb_weight=weight||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0};BaseURL.DEFAULT_DVB_PRIORITY=1,BaseURL.DEFAULT_DVB_WEIGHT=1,exports.default=BaseURL,module.exports=exports.default},1442:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),TextRequest=function(_FragmentRequest){function TextRequest(url,type){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextRequest),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(TextRequest.prototype),"constructor",this).call(this),this.url=url||null,this.type=type||null,this.mediaType=_constantsConstants2.default.STREAM,this.responseType=""}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(TextRequest,_FragmentRequest),TextRequest}(_interopRequireDefault(__webpack_require__(1378)).default);exports.default=TextRequest,module.exports=exports.default},1443:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function X2JS(config){config=config||{},function initConfigDefaults(){void 0===config.escapeMode&&(config.escapeMode=!0);void 0===config.attributePrefix&&(config.attributePrefix="_");config.arrayAccessForm=config.arrayAccessForm||"none",config.emptyNodeForm=config.emptyNodeForm||"text",void 0===config.enableToStringFunc&&(config.enableToStringFunc=!0);config.arrayAccessFormPaths=config.arrayAccessFormPaths||[],void 0===config.skipEmptyTextNodesForObj&&(config.skipEmptyTextNodesForObj=!0);void 0===config.stripWhitespaces&&(config.stripWhitespaces=!0);config.datetimeAccessFormPaths=config.datetimeAccessFormPaths||[],void 0===config.useDoubleQuotes&&(config.useDoubleQuotes=!1);config.xmlElementsFilter=config.xmlElementsFilter||[],config.jsonPropertiesFilter=config.jsonPropertiesFilter||[],void 0===config.keepCData&&(config.keepCData=!1);void 0===config.ignoreRoot&&(config.ignoreRoot=!1)}();var DOMNodeTypes_ELEMENT_NODE=1,DOMNodeTypes_TEXT_NODE=3,DOMNodeTypes_CDATA_SECTION_NODE=4,DOMNodeTypes_COMMENT_NODE=8,DOMNodeTypes_DOCUMENT_NODE=9;function getNodeLocalName(node){var nodeLocalName=node.localName;return null==nodeLocalName&&(nodeLocalName=node.baseName),null!=nodeLocalName&&""!=nodeLocalName||(nodeLocalName=node.nodeName),nodeLocalName}function escapeXmlChars(str){return"string"==typeof str?str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):str}function checkInStdFiltersArrayForm(stdFiltersArrayForm,obj,name,path){for(var idx=0;idx<stdFiltersArrayForm.length;idx++){var filterPath=stdFiltersArrayForm[idx];if("string"==typeof filterPath){if(filterPath==path)break}else if(filterPath instanceof RegExp){if(filterPath.test(path))break}else if("function"==typeof filterPath&&filterPath(obj,name,path))break}return idx!=stdFiltersArrayForm.length}function toArrayAccessForm(obj,childName,path){switch(config.arrayAccessForm){case"property":obj[childName]instanceof Array?obj[childName+"_asArray"]=obj[childName]:obj[childName+"_asArray"]=[obj[childName]]}!(obj[childName]instanceof Array)&&config.arrayAccessFormPaths.length>0&&checkInStdFiltersArrayForm(config.arrayAccessFormPaths,obj,childName,path)&&(obj[childName]=[obj[childName]])}function fromXmlDateTime(prop){var bits=prop.split(/[-T:+Z]/g),d=new Date(bits[0],bits[1]-1,bits[2]),secondBits=bits[5].split(".");if(d.setHours(bits[3],bits[4],secondBits[0]),secondBits.length>1&&d.setMilliseconds(secondBits[1]),bits[6]&&bits[7]){var offsetMinutes=60*bits[6]+Number(bits[7]);offsetMinutes=0+("-"==(/\d\d-\d\d:\d\d$/.test(prop)?"-":"+")?-1*offsetMinutes:offsetMinutes),d.setMinutes(d.getMinutes()-offsetMinutes-d.getTimezoneOffset())}else-1!==prop.indexOf("Z",prop.length-1)&&(d=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds())));return d}function checkXmlElementsFilter(obj,childType,childName,childPath){return!(childType==DOMNodeTypes_ELEMENT_NODE&&config.xmlElementsFilter.length>0)||checkInStdFiltersArrayForm(config.xmlElementsFilter,obj,childName,childPath)}function parseDOMChildren(node,path){if(node.nodeType==DOMNodeTypes_DOCUMENT_NODE){for(var result=new Object,nodeChildren=node.childNodes,cidx=0;cidx<nodeChildren.length;cidx++){if((child=nodeChildren[cidx]).nodeType==DOMNodeTypes_ELEMENT_NODE)if(config.ignoreRoot)result=parseDOMChildren(child);else(result={})[childName=getNodeLocalName(child)]=parseDOMChildren(child)}return result}if(node.nodeType==DOMNodeTypes_ELEMENT_NODE){(result=new Object).__cnt=0;var children=[];for(nodeChildren=node.childNodes,cidx=0;cidx<nodeChildren.length;cidx++){var child,childName=getNodeLocalName(child=nodeChildren[cidx]);if(child.nodeType!=DOMNodeTypes_COMMENT_NODE){var childPath=path+"."+childName;if(checkXmlElementsFilter(result,child.nodeType,childName,childPath))if(result.__cnt++,null==result[childName]){var c=parseDOMChildren(child,childPath);if("#text"!=childName||/[^\s]/.test(c))(o={})[childName]=c,children.push(o);result[childName]=c,toArrayAccessForm(result,childName,childPath)}else{null!=result[childName]&&(result[childName]instanceof Array||(result[childName]=[result[childName]],toArrayAccessForm(result,childName,childPath)));var o;c=parseDOMChildren(child,childPath);if("#text"!=childName||/[^\s]/.test(c))(o={})[childName]=c,children.push(o);result[childName][result[childName].length]=c}}}result.__children=children;for(var nodeLocalName=getNodeLocalName(node),aidx=0;aidx<node.attributes.length;aidx++){var attr=node.attributes[aidx];result.__cnt++;for(var value2=attr.value,m=0,ml=config.matchers.length;m<ml;m++){var matchobj=config.matchers[m];matchobj.test(attr,nodeLocalName)&&(value2=matchobj.converter(attr.value))}result[config.attributePrefix+attr.name]=value2}var nodePrefix=function getNodePrefix(node){return node.prefix}(node);return null!=nodePrefix&&""!=nodePrefix&&(result.__cnt++,result.__prefix=nodePrefix),null!=result["#text"]&&(result.__text=result["#text"],result.__text instanceof Array&&(result.__text=result.__text.join("\n")),config.stripWhitespaces&&(result.__text=result.__text.trim()),delete result["#text"],"property"==config.arrayAccessForm&&delete result["#text_asArray"],result.__text=function checkFromXmlDateTimePaths(value,childName,fullPath){if(config.datetimeAccessFormPaths.length>0){var path=fullPath.split(".#")[0];return checkInStdFiltersArrayForm(config.datetimeAccessFormPaths,value,childName,path)?fromXmlDateTime(value):value}return value}(result.__text,childName,path+"."+childName)),null!=result["#cdata-section"]&&(result.__cdata=result["#cdata-section"],delete result["#cdata-section"],"property"==config.arrayAccessForm&&delete result["#cdata-section_asArray"]),0==result.__cnt&&"text"==config.emptyNodeForm?result="":1==result.__cnt&&null!=result.__text?result=result.__text:1!=result.__cnt||null==result.__cdata||config.keepCData?result.__cnt>1&&null!=result.__text&&config.skipEmptyTextNodesForObj&&(config.stripWhitespaces&&""==result.__text||""==result.__text.trim())&&delete result.__text:result=result.__cdata,delete result.__cnt,!config.enableToStringFunc||null==result.__text&&null==result.__cdata||(result.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),result}if(node.nodeType==DOMNodeTypes_TEXT_NODE||node.nodeType==DOMNodeTypes_CDATA_SECTION_NODE)return node.nodeValue}function startTag(jsonObj,element,attrList,closed){var resultStr="<"+(null!=jsonObj&&null!=jsonObj.__prefix?jsonObj.__prefix+":":"")+element;if(null!=attrList)for(var aidx=0;aidx<attrList.length;aidx++){var attrName=attrList[aidx],attrVal=jsonObj[attrName];config.escapeMode&&(attrVal=escapeXmlChars(attrVal)),resultStr+=" "+attrName.substr(config.attributePrefix.length)+"=",config.useDoubleQuotes?resultStr+='"'+attrVal+'"':resultStr+="'"+attrVal+"'"}return resultStr+=closed?"/>":">"}function endTag(jsonObj,elementName){return"</"+(null!=jsonObj.__prefix?jsonObj.__prefix+":":"")+elementName+">"}function jsonXmlSpecialElem(jsonObj,jsonObjField){return!!("property"==config.arrayAccessForm&&function endsWith(str,suffix){return-1!==str.indexOf(suffix,str.length-suffix.length)}(jsonObjField.toString(),"_asArray")||0==jsonObjField.toString().indexOf(config.attributePrefix)||0==jsonObjField.toString().indexOf("__")||jsonObj[jsonObjField]instanceof Function)}function jsonXmlElemCount(jsonObj){var elementsCnt=0;if(jsonObj instanceof Object)for(var it in jsonObj)jsonXmlSpecialElem(jsonObj,it)||elementsCnt++;return elementsCnt}function checkJsonObjPropertiesFilter(jsonObj,propertyName,jsonObjPath){return 0==config.jsonPropertiesFilter.length||""==jsonObjPath||checkInStdFiltersArrayForm(config.jsonPropertiesFilter,jsonObj,propertyName,jsonObjPath)}function parseJSONAttributes(jsonObj){var attrList=[];if(jsonObj instanceof Object)for(var ait in jsonObj)-1==ait.toString().indexOf("__")&&0==ait.toString().indexOf(config.attributePrefix)&&attrList.push(ait);return attrList}function parseJSONTextObject(jsonTxtObj){var result="";return jsonTxtObj instanceof Object?result+=function parseJSONTextAttrs(jsonTxtObj){var result="";return null!=jsonTxtObj.__cdata&&(result+="<![CDATA["+jsonTxtObj.__cdata+"]]>"),null!=jsonTxtObj.__text&&(config.escapeMode?result+=escapeXmlChars(jsonTxtObj.__text):result+=jsonTxtObj.__text),result}(jsonTxtObj):null!=jsonTxtObj&&(config.escapeMode?result+=escapeXmlChars(jsonTxtObj):result+=jsonTxtObj),result}function getJsonPropertyPath(jsonObjPath,jsonPropName){return""===jsonObjPath?jsonPropName:jsonObjPath+"."+jsonPropName}function parseJSONArray(jsonArrRoot,jsonArrObj,attrList,jsonObjPath){var result="";if(0==jsonArrRoot.length)result+=startTag(jsonArrRoot,jsonArrObj,attrList,!0);else for(var arIdx=0;arIdx<jsonArrRoot.length;arIdx++)result+=startTag(jsonArrRoot[arIdx],jsonArrObj,parseJSONAttributes(jsonArrRoot[arIdx]),!1),result+=parseJSONObject(jsonArrRoot[arIdx],getJsonPropertyPath(jsonObjPath,jsonArrObj)),result+=endTag(jsonArrRoot[arIdx],jsonArrObj);return result}function parseJSONObject(jsonObj,jsonObjPath){var result="";if(jsonXmlElemCount(jsonObj)>0)for(var it in jsonObj)if(!jsonXmlSpecialElem(jsonObj,it)&&(""==jsonObjPath||checkJsonObjPropertiesFilter(jsonObj,it,getJsonPropertyPath(jsonObjPath,it)))){var subObj=jsonObj[it],attrList=parseJSONAttributes(subObj);if(null==subObj||null==subObj)result+=startTag(subObj,it,attrList,!0);else if(subObj instanceof Object)if(subObj instanceof Array)result+=parseJSONArray(subObj,it,attrList,jsonObjPath);else if(subObj instanceof Date)result+=startTag(subObj,it,attrList,!1),result+=subObj.toISOString(),result+=endTag(subObj,it);else{jsonXmlElemCount(subObj)>0||null!=subObj.__text||null!=subObj.__cdata?(result+=startTag(subObj,it,attrList,!1),result+=parseJSONObject(subObj,getJsonPropertyPath(jsonObjPath,it)),result+=endTag(subObj,it)):result+=startTag(subObj,it,attrList,!0)}else result+=startTag(subObj,it,attrList,!1),result+=parseJSONTextObject(subObj),result+=endTag(subObj,it)}return result+=parseJSONTextObject(jsonObj)}this.parseXmlString=function(xmlDocStr){var xmlDoc;window.ActiveXObject||window;if(void 0===xmlDocStr)return null;if(window.DOMParser){var parser=new window.DOMParser;try{(xmlDoc=parser.parseFromString(xmlDocStr,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(xmlDoc=null)}catch(err){xmlDoc=null}}else 0==xmlDocStr.indexOf("<?")&&(xmlDocStr=xmlDocStr.substr(xmlDocStr.indexOf("?>")+2)),(xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async="false",xmlDoc.loadXML(xmlDocStr);return xmlDoc},this.asArray=function(prop){return void 0===prop||null==prop?[]:prop instanceof Array?prop:[prop]},this.toXmlDateTime=function(dt){return dt instanceof Date?dt.toISOString():"number"==typeof dt?new Date(dt).toISOString():null},this.asDateTime=function(prop){return"string"==typeof prop?fromXmlDateTime(prop):prop},this.xml2json=function(xmlDoc){return parseDOMChildren(xmlDoc)},this.xml_str2json=function(xmlDocStr){var xmlDoc=this.parseXmlString(xmlDocStr);return null!=xmlDoc?this.xml2json(xmlDoc):null},this.json2xml_str=function(jsonObj){return parseJSONObject(jsonObj,"")},this.json2xml=function(jsonObj){var xmlDocStr=this.json2xml_str(jsonObj);return this.parseXmlString(xmlDocStr)},this.getVersion=function(){return"1.2.0"}},module.exports=exports.default},1444:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _CommonProperty2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1542)),MapNode=function(){function MapNode(name,properties,children){var _this=this;!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MapNode),this._name=name||"",this._properties=[],this._children=children||[],Array.isArray(properties)&&properties.forEach((function(p){_this._properties.push(new _CommonProperty2.default(p))}))}return _createClass(MapNode,[{key:"name",get:function get(){return this._name}},{key:"children",get:function get(){return this._children}},{key:"properties",get:function get(){return this._properties}}]),MapNode}();exports.default=MapNode,module.exports=exports.default},1445:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function UTCTiming(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UTCTiming),this.schemeIdUri="",this.value=""},module.exports=exports.default},1446:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getVersionString=function getVersionString(){return"2.9.3"}},1447:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function Event(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Event),this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},module.exports=exports.default},1448:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _reportersDVBReporting2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1583));function ReportingFactory(config){config=config||{};var knownReportingSchemeIdUris={"urn:dvb:dash:reporting:2014":_reportersDVBReporting2.default},context=this.context,debug=config.debug,metricsConstants=config.metricsConstants;return{create:function create(entry,rangeController){var reporting=void 0;try{(reporting=knownReportingSchemeIdUris[entry.schemeIdUri](context).create({metricsConstants:metricsConstants})).initialize(entry,rangeController)}catch(e){reporting=null,debug.error("ReportingFactory: could not create Reporting with schemeIdUri "+entry.schemeIdUri+" ("+e.message+")")}return reporting},register:function register(schemeIdUri,moduleName){knownReportingSchemeIdUris[schemeIdUri]=moduleName},unregister:function unregister(schemeIdUri){delete knownReportingSchemeIdUris[schemeIdUri]}}}ReportingFactory.__dashjs_factory_name="ReportingFactory",exports.default=dashjs.FactoryMaker.getSingletonFactory(ReportingFactory),module.exports=exports.default},1449:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _handlersBufferLevelHandler2=_interopRequireDefault(__webpack_require__(1587)),_handlersDVBErrorsHandler2=_interopRequireDefault(__webpack_require__(1588)),_handlersHttpListHandler2=_interopRequireDefault(__webpack_require__(1589)),_handlersGenericMetricHandler2=_interopRequireDefault(__webpack_require__(1590));function MetricsHandlerFactory(config){var debug=(config=config||{}).debug,keyRegex=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,context=this.context,knownFactoryProducts={BufferLevel:_handlersBufferLevelHandler2.default,DVBErrors:_handlersDVBErrorsHandler2.default,HttpList:_handlersHttpListHandler2.default,PlayList:_handlersGenericMetricHandler2.default,RepSwitchList:_handlersGenericMetricHandler2.default,TcpList:_handlersGenericMetricHandler2.default};return{create:function create(listType,reportingController){var handler,matches=listType.match(keyRegex);if(matches){try{(handler=knownFactoryProducts[matches[1]](context).create({eventBus:config.eventBus,metricsConstants:config.metricsConstants})).initialize(matches[1],reportingController,matches[3],matches[5])}catch(e){handler=null,debug.error("MetricsHandlerFactory: Could not create handler for type "+matches[1]+" with args "+matches[3]+", "+matches[5]+" ("+e.message+")")}return handler}},register:function register(key,handler){knownFactoryProducts[key]=handler},unregister:function unregister(key){delete knownFactoryProducts[key]}}}MetricsHandlerFactory.__dashjs_factory_name="MetricsHandlerFactory",exports.default=dashjs.FactoryMaker.getSingletonFactory(MetricsHandlerFactory),module.exports=exports.default},1450:function(module,exports,__webpack_require__){"use strict";function HandlerHelpers(){return{reconstructFullMetricName:function reconstructFullMetricName(key,n,type){var mn=key;return n&&(mn+="("+n,type&&type.length&&(mn+=","+type),mn+=")"),mn},validateN:function validateN(n_ms){if(!n_ms)throw new Error("missing n");if(isNaN(n_ms))throw new Error("n is NaN");if(n_ms<0)throw new Error("n must be positive");return n_ms}}}Object.defineProperty(exports,"__esModule",{value:!0}),HandlerHelpers.__dashjs_factory_name="HandlerHelpers",exports.default=dashjs.FactoryMaker.getSingletonFactory(HandlerHelpers),module.exports=exports.default},1458:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _index_mediaplayerOnly=__webpack_require__(1459),_srcStreamingMetricsMetricsReporting2=_interopRequireDefault(__webpack_require__(1576)),_srcStreamingProtectionProtection2=_interopRequireDefault(__webpack_require__(1595)),_srcStreamingMediaPlayerFactory2=_interopRequireDefault(__webpack_require__(1610)),_srcCoreDebug2=_interopRequireDefault(__webpack_require__(1369));dashjs.Protection=_srcStreamingProtectionProtection2.default,dashjs.MetricsReporting=_srcStreamingMetricsMetricsReporting2.default,dashjs.MediaPlayerFactory=_srcStreamingMediaPlayerFactory2.default,dashjs.Debug=_srcCoreDebug2.default,exports.default=dashjs,exports.MediaPlayer=_index_mediaplayerOnly.MediaPlayer,exports.Protection=_srcStreamingProtectionProtection2.default,exports.MetricsReporting=_srcStreamingMetricsMetricsReporting2.default,exports.MediaPlayerFactory=_srcStreamingMediaPlayerFactory2.default,exports.Debug=_srcCoreDebug2.default},1459:function(module,exports,__webpack_require__){"use strict";(function(global){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _srcStreamingMediaPlayer2=_interopRequireDefault(__webpack_require__(1422)),_srcCoreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_srcCoreDebug2=_interopRequireDefault(__webpack_require__(1369)),_srcCoreVersion=__webpack_require__(1446),context="undefined"!=typeof window&&window||global,dashjs=context.dashjs;dashjs||(dashjs=context.dashjs={}),dashjs.MediaPlayer=_srcStreamingMediaPlayer2.default,dashjs.FactoryMaker=_srcCoreFactoryMaker2.default,dashjs.Debug=_srcCoreDebug2.default,dashjs.Version=(0,_srcCoreVersion.getVersionString)(),exports.default=dashjs,exports.MediaPlayer=_srcStreamingMediaPlayer2.default,exports.FactoryMaker=_srcCoreFactoryMaker2.default,exports.Debug=_srcCoreDebug2.default}).call(this,__webpack_require__(54))},1460:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_BufferController2=_interopRequireDefault(__webpack_require__(1377)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function PlaybackController(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,streamController=void 0,metricsModel=void 0,dashMetrics=void 0,manifestModel=void 0,dashManifestModel=void 0,adapter=void 0,videoModel=void 0,timelineConverter=void 0,liveStartTime=void 0,wallclockTimeIntervalId=void 0,commonEarliestTime=void 0,liveDelay=void 0,bufferedRange=void 0,streamInfo=void 0,isDynamic=void 0,mediaPlayerModel=void 0,playOnceInitialized=void 0,lastLivePlaybackTime=void 0,availabilityStartTime=void 0,compatibleWithPreviousStream=void 0,isLowLatencySeekingInProgress=void 0,playbackStalled=void 0,minPlaybackRateChange=void 0,uriFragmentModel=void 0;function onPeriodSwitchStarted(e){!isDynamic&&e.fromStreamInfo&&void 0!==commonEarliestTime[e.fromStreamInfo.id]&&(delete bufferedRange[e.fromStreamInfo.id],delete commonEarliestTime[e.fromStreamInfo.id])}function getTimeToStreamEnd(){return parseFloat((getStreamEndTime()-getTime()).toFixed(5))}function getStreamEndTime(){var startTime=getStreamStartTime(!0),offset=isDynamic&&streamInfo?startTime-streamInfo.start:0;return startTime+(streamInfo?streamInfo.duration-offset:offset)}function play(){streamInfo&&videoModel&&videoModel.getElement()?videoModel.play():playOnceInitialized=!0}function isPaused(){return streamInfo&&videoModel?videoModel.isPaused():null}function pause(){streamInfo&&videoModel&&videoModel.pause()}function isSeeking(){return streamInfo&&videoModel?videoModel.isSeeking():null}function seek(time,stickToBuffered,internalSeek){streamInfo&&videoModel&&(!0===internalSeek?time!==videoModel.getTime()&&(videoModel.removeEventListener("seeking",onPlaybackSeeking),logger.info("Requesting seek to time: "+time),videoModel.setCurrentTime(time,stickToBuffered)):(eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_SEEK_ASKED),logger.info("Requesting seek to time: "+time),videoModel.setCurrentTime(time,stickToBuffered)))}function getTime(){return streamInfo&&videoModel?videoModel.getTime():null}function getNormalizedTime(){var t=getTime();if(isDynamic&&!isNaN(availabilityStartTime)){var timeOffset=availabilityStartTime/1e3;t>timeOffset&&(t-=timeOffset)}return t}function getPlaybackRate(){return streamInfo&&videoModel?videoModel.getPlaybackRate():null}function getEnded(){return streamInfo&&videoModel?videoModel.getEnded():null}function getIsDynamic(){return isDynamic}function getCurrentLiveLatency(){if(!isDynamic||isNaN(availabilityStartTime))return NaN;var currentTime=getNormalizedTime();if(isNaN(currentTime)||0===currentTime)return 0;var now=(new Date).getTime()+1e3*timelineConverter.getClientTimeOffset();return Math.max(((now-availabilityStartTime-1e3*currentTime)/1e3).toFixed(3),0)}function reset(){liveStartTime=NaN,playOnceInitialized=!1,commonEarliestTime={},liveDelay=0,availabilityStartTime=0,bufferedRange={},videoModel&&(eventBus.off(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,onDataUpdateCompleted,this),eventBus.off(_coreEventsEvents2.default.BUFFER_LEVEL_STATE_CHANGED,onBufferLevelStateChanged,this),eventBus.off(_coreEventsEvents2.default.BYTES_APPENDED_END_FRAGMENT,onBytesAppended,this),eventBus.off(_coreEventsEvents2.default.LOADING_PROGRESS,onFragmentLoadProgress,this),eventBus.off(_coreEventsEvents2.default.PERIOD_SWITCH_STARTED,onPeriodSwitchStarted,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_PROGRESS,onPlaybackProgression,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_TIME_UPDATED,onPlaybackProgression,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_ENDED,onPlaybackEnded,this),stopUpdatingWallclockTime(),function removeAllListeners(){videoModel.removeEventListener("canplay",onCanPlay),videoModel.removeEventListener("play",onPlaybackStart),videoModel.removeEventListener("waiting",onPlaybackWaiting),videoModel.removeEventListener("playing",onPlaybackPlaying),videoModel.removeEventListener("pause",onPlaybackPaused),videoModel.removeEventListener("error",onPlaybackError),videoModel.removeEventListener("seeking",onPlaybackSeeking),videoModel.removeEventListener("seeked",onPlaybackSeeked),videoModel.removeEventListener("timeupdate",onPlaybackTimeUpdated),videoModel.removeEventListener("progress",onPlaybackProgress),videoModel.removeEventListener("ratechange",onPlaybackRateChanged),videoModel.removeEventListener("loadedmetadata",onPlaybackMetaDataLoaded),videoModel.removeEventListener("stalled",onPlaybackStalled),videoModel.removeEventListener("ended",onNativePlaybackEnded)}()),wallclockTimeIntervalId=null,videoModel=null,streamInfo=null,isDynamic=null}function getStartTimeFromUriParameters(){var fragData=uriFragmentModel.getURIFragmentData(),uriParameters=void 0;if(fragData){uriParameters={};var r=parseInt(fragData.r,10);r>=0&&streamInfo&&r<streamInfo.manifestInfo.DVRWindowSize&&null===fragData.t&&(fragData.t=Math.max(Math.floor(Date.now()/1e3)-streamInfo.manifestInfo.DVRWindowSize,streamInfo.manifestInfo.availableFrom.getTime()/1e3+streamInfo.start)+r),uriParameters.fragS=parseFloat(fragData.s),uriParameters.fragT=parseFloat(fragData.t)}return uriParameters}function getStreamStartTime(ignoreStartOffset,liveEdge){var presentationStartTime=void 0,startTimeOffset=NaN;if(ignoreStartOffset)startTimeOffset=streamInfo?streamInfo.start:startTimeOffset;else{var uriParameters=getStartTimeFromUriParameters();startTimeOffset=uriParameters?isNaN(uriParameters.fragS)?uriParameters.fragT:uriParameters.fragS:0}if(isDynamic)!isNaN(startTimeOffset)&&streamInfo&&((presentationStartTime=startTimeOffset-streamInfo.manifestInfo.availableFrom.getTime()/1e3)>liveStartTime||presentationStartTime<(isNaN(liveEdge)?NaN:liveEdge-streamInfo.manifestInfo.DVRWindowSize))&&(presentationStartTime=null),presentationStartTime=presentationStartTime||liveStartTime;else if(streamInfo)if(!isNaN(startTimeOffset)&&startTimeOffset<Math.max(streamInfo.manifestInfo.duration,streamInfo.duration)&&startTimeOffset>=0)presentationStartTime=startTimeOffset;else{var earliestTime=commonEarliestTime[streamInfo.id];presentationStartTime=void 0!==earliestTime?Math.max(void 0!==earliestTime.audio?earliestTime.audio:0,void 0!==earliestTime.video?earliestTime.video:0,streamInfo.start):streamInfo.start}return presentationStartTime}function startUpdatingWallclockTime(){if(null===wallclockTimeIntervalId){wallclockTimeIntervalId=setInterval((function tick(){!function onWallclockTime(){eventBus.trigger(_coreEventsEvents2.default.WALLCLOCK_TIME_UPDATED,{isDynamic:isDynamic,time:new Date}),getIsDynamic()&&isPaused()&&function updateLivePlaybackTime(){var now=Date.now();(!lastLivePlaybackTime||now>lastLivePlaybackTime+500)&&(lastLivePlaybackTime=now,onPlaybackTimeUpdated())}()}()}),mediaPlayerModel.getWallclockTimeUpdateInterval())}}function stopUpdatingWallclockTime(){clearInterval(wallclockTimeIntervalId),wallclockTimeIntervalId=null}function updateCurrentTime(){if(!isPaused()&&isDynamic&&0!==videoModel.getReadyState()){var currentTime=getNormalizedTime(),actualTime=function getActualPresentationTime(currentTime){var metrics=metricsModel.getReadOnlyMetricsFor(_constantsConstants2.default.VIDEO)||metricsModel.getReadOnlyMetricsFor(_constantsConstants2.default.AUDIO),DVRMetrics=dashMetrics.getCurrentDVRInfo(metrics),DVRWindow=DVRMetrics?DVRMetrics.range:null,actualTime=void 0;if(!DVRWindow)return NaN;if(currentTime>DVRWindow.end)actualTime=Math.max(DVRWindow.end-2*streamInfo.manifestInfo.minBufferTime,DVRWindow.start);else{if(!(currentTime+.25<DVRWindow.start))return currentTime;actualTime=DVRWindow.start}return actualTime}(currentTime);!isNaN(actualTime)&&actualTime!==currentTime&&seek(actualTime)}}function onDataUpdateCompleted(e){if(!e.error){var info=adapter.convertDataToRepresentationInfo(e.currentRepresentation).mediaInfo.streamInfo;streamInfo.id===info.id&&(streamInfo=info,updateCurrentTime())}}function onCanPlay(){eventBus.trigger(_coreEventsEvents2.default.CAN_PLAY)}function onPlaybackStart(){logger.info("Native video element event: play"),updateCurrentTime(),startUpdatingWallclockTime(),eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_STARTED,{startTime:getTime()})}function onPlaybackWaiting(){logger.info("Native video element event: waiting"),eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_WAITING,{playingTime:getTime()})}function onPlaybackPlaying(){logger.info("Native video element event: playing"),eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_PLAYING,{playingTime:getTime()})}function onPlaybackPaused(){logger.info("Native video element event: pause"),eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_PAUSED,{ended:getEnded()})}function onPlaybackSeeking(){var seekTime=getTime();logger.info("Seeking to: "+seekTime),startUpdatingWallclockTime(),eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_SEEKING,{seekTime:seekTime})}function onPlaybackSeeked(){logger.info("Native video element event: seeked"),eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_SEEKED),videoModel.addEventListener("seeking",onPlaybackSeeking)}function onPlaybackTimeUpdated(){streamInfo&&eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_TIME_UPDATED,{timeToEnd:getTimeToStreamEnd(),time:getTime()})}function onPlaybackProgress(){eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_PROGRESS)}function onPlaybackRateChanged(){var rate=getPlaybackRate();logger.info("Native video element event: ratechange: ",rate),eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_RATE_CHANGED,{playbackRate:rate})}function onPlaybackMetaDataLoaded(){logger.info("Native video element event: loadedmetadata"),eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_METADATA_LOADED),startUpdatingWallclockTime()}function onNativePlaybackEnded(){logger.info("Native video element event: ended"),pause(),stopUpdatingWallclockTime(),eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_ENDED,{isLast:streamController.getActiveStreamInfo().isLast})}function onPlaybackEnded(e){wallclockTimeIntervalId&&e.isLast&&(logger.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended"),videoModel.setCurrentTime(getStreamEndTime()),pause(),stopUpdatingWallclockTime())}function onPlaybackError(event){var target=event.target||event.srcElement;eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_ERROR,{error:target.error})}function onPlaybackProgression(){isDynamic&&mediaPlayerModel.getLowLatencyEnabled()&&mediaPlayerModel.getCatchUpPlaybackRate()>0&&!isPaused()&&!isSeeking()&&(!function needToCatchUp(){return mediaPlayerModel.getCatchUpPlaybackRate()>0&&getTime()>0&&Math.abs(getCurrentLiveLatency()-mediaPlayerModel.getLiveDelay())>mediaPlayerModel.getLowLatencyMinDrift()}()?stopPlaybackCatchUp():function startPlaybackCatchUp(){if(videoModel){var cpr=mediaPlayerModel.getCatchUpPlaybackRate(),_liveDelay=mediaPlayerModel.getLiveDelay(),deltaLatency=getCurrentLiveLatency()-_liveDelay,d=5*deltaLatency,s=2*cpr/(1+Math.pow(Math.E,-d)),newRate=1-cpr+s;if(playbackStalled)(function getBufferLevel(){var bufferLevel=null;return streamController.getActiveStreamProcessors().forEach((function(p){var bl=p.getBufferLevel();bufferLevel=null===bufferLevel?bl:Math.min(bufferLevel,bl)})),bufferLevel})()>_liveDelay/2?playbackStalled=!1:deltaLatency>0&&(newRate=1);Math.abs(videoModel.getPlaybackRate()-newRate)>minPlaybackRateChange&&videoModel.setPlaybackRate(newRate),mediaPlayerModel.getLowLatencyMaxDriftBeforeSeeking()>0&&!isLowLatencySeekingInProgress&&deltaLatency>mediaPlayerModel.getLowLatencyMaxDriftBeforeSeeking()?(logger.info("Low Latency catchup mechanism. Latency too high, doing a seek to live point"),isLowLatencySeekingInProgress=!0,function seekToLive(){var metrics=metricsModel.getReadOnlyMetricsFor(_constantsConstants2.default.VIDEO)||metricsModel.getReadOnlyMetricsFor(_constantsConstants2.default.AUDIO),DVRMetrics=dashMetrics.getCurrentDVRInfo(metrics);seek((DVRMetrics?DVRMetrics.range:null).end-mediaPlayerModel.getLiveDelay(),!0,!1)}()):isLowLatencySeekingInProgress=!1}}())}function stopPlaybackCatchUp(){videoModel&&videoModel.setPlaybackRate(1)}function onBytesAppended(e){var initialStartTime,earliestTime=void 0,ranges=e.bufferedRanges;if(ranges&&ranges.length&&(!commonEarliestTime[streamInfo.id]||!0!==commonEarliestTime[streamInfo.id].started)){var type=e.sender.getType();void 0===bufferedRange[streamInfo.id]&&(bufferedRange[streamInfo.id]=[]),bufferedRange[streamInfo.id][type]=ranges,void 0===commonEarliestTime[streamInfo.id]&&(commonEarliestTime[streamInfo.id]=[],commonEarliestTime[streamInfo.id].started=!1),void 0===commonEarliestTime[streamInfo.id][type]&&(commonEarliestTime[streamInfo.id][type]=Math.max(ranges.start(0),streamInfo.start));var hasVideoTrack=streamController.isTrackTypePresent(_constantsConstants2.default.VIDEO),hasAudioTrack=streamController.isTrackTypePresent(_constantsConstants2.default.AUDIO);initialStartTime=getStreamStartTime(!1),hasAudioTrack&&hasVideoTrack?isNaN(commonEarliestTime[streamInfo.id].audio)||isNaN(commonEarliestTime[streamInfo.id].video)||(commonEarliestTime[streamInfo.id].audio<commonEarliestTime[streamInfo.id].video?(earliestTime=commonEarliestTime[streamInfo.id].video>initialStartTime?commonEarliestTime[streamInfo.id].video:initialStartTime,ranges=bufferedRange[streamInfo.id].audio):(earliestTime=commonEarliestTime[streamInfo.id].audio>initialStartTime?commonEarliestTime[streamInfo.id].audio:initialStartTime,ranges=bufferedRange[streamInfo.id].video),function checkTimeInRanges(time,ranges){if(ranges&&ranges.length>0)for(var i=0,len=ranges.length;i<len;i++)if(time>=ranges.start(i)&&time<ranges.end(i))return!0;return!1}(earliestTime,ranges)&&(isSeeking()||compatibleWithPreviousStream||0===earliestTime||seek(earliestTime,!0,!0),commonEarliestTime[streamInfo.id].started=!0)):commonEarliestTime[streamInfo.id][type]&&(earliestTime=commonEarliestTime[streamInfo.id][type]>initialStartTime?commonEarliestTime[streamInfo.id][type]:initialStartTime,isSeeking()||compatibleWithPreviousStream||seek(earliestTime,!1,!0),commonEarliestTime[streamInfo.id].started=!0)}}function onFragmentLoadProgress(e){if(!1===e.stream&&mediaPlayerModel.getLowLatencyEnabled()&&!isNaN(e.request.duration)){var minDelay=1.2*e.request.duration;minDelay>mediaPlayerModel.getLiveDelay()&&(logger.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",minDelay.toFixed(2)),mediaPlayerModel.setLiveDelay(minDelay))}}function onBufferLevelStateChanged(e){e.streamInfo.id===streamInfo.id&&(mediaPlayerModel.getLowLatencyEnabled()?e.state!==_BufferController2.default.BUFFER_EMPTY||isSeeking()||playbackStalled||(playbackStalled=!0,stopPlaybackCatchUp()):videoModel.setStallState(e.mediaType,e.state===_BufferController2.default.BUFFER_EMPTY))}function onPlaybackStalled(e){eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_STALLED,{e:e})}return instance={initialize:function initialize(StreamInfo,compatible){streamInfo=StreamInfo,function addAllListeners(){videoModel.addEventListener("canplay",onCanPlay),videoModel.addEventListener("play",onPlaybackStart),videoModel.addEventListener("waiting",onPlaybackWaiting),videoModel.addEventListener("playing",onPlaybackPlaying),videoModel.addEventListener("pause",onPlaybackPaused),videoModel.addEventListener("error",onPlaybackError),videoModel.addEventListener("seeking",onPlaybackSeeking),videoModel.addEventListener("seeked",onPlaybackSeeked),videoModel.addEventListener("timeupdate",onPlaybackTimeUpdated),videoModel.addEventListener("progress",onPlaybackProgress),videoModel.addEventListener("ratechange",onPlaybackRateChanged),videoModel.addEventListener("loadedmetadata",onPlaybackMetaDataLoaded),videoModel.addEventListener("stalled",onPlaybackStalled),videoModel.addEventListener("ended",onNativePlaybackEnded)}(),isDynamic=streamInfo.manifestInfo.isDynamic,isLowLatencySeekingInProgress=!1,playbackStalled=!1,liveStartTime=streamInfo.start,compatibleWithPreviousStream=compatible;var ua="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",isSafari=/safari/.test(ua)&&!/chrome/.test(ua);minPlaybackRateChange=isSafari?.25:.02,eventBus.on(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,onDataUpdateCompleted,this),eventBus.on(_coreEventsEvents2.default.BYTES_APPENDED_END_FRAGMENT,onBytesAppended,this),eventBus.on(_coreEventsEvents2.default.LOADING_PROGRESS,onFragmentLoadProgress,this),eventBus.on(_coreEventsEvents2.default.BUFFER_LEVEL_STATE_CHANGED,onBufferLevelStateChanged,this),eventBus.on(_coreEventsEvents2.default.PERIOD_SWITCH_STARTED,onPeriodSwitchStarted,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_PROGRESS,onPlaybackProgression,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_TIME_UPDATED,onPlaybackProgression,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_ENDED,onPlaybackEnded,this),playOnceInitialized&&(playOnceInitialized=!1,play())},setConfig:function setConfig(config){config&&(config.streamController&&(streamController=config.streamController),config.metricsModel&&(metricsModel=config.metricsModel),config.dashMetrics&&(dashMetrics=config.dashMetrics),config.manifestModel&&(manifestModel=config.manifestModel),config.dashManifestModel&&(dashManifestModel=config.dashManifestModel),config.mediaPlayerModel&&(mediaPlayerModel=config.mediaPlayerModel),config.adapter&&(adapter=config.adapter),config.videoModel&&(videoModel=config.videoModel),config.timelineConverter&&(timelineConverter=config.timelineConverter),config.uriFragmentModel&&(uriFragmentModel=config.uriFragmentModel))},getStartTimeFromUriParameters:getStartTimeFromUriParameters,getStreamStartTime:getStreamStartTime,getTimeToStreamEnd:getTimeToStreamEnd,getTime:getTime,getNormalizedTime:getNormalizedTime,getPlaybackRate:getPlaybackRate,getPlayedRanges:function getPlayedRanges(){return streamInfo&&videoModel?videoModel.getPlayedRanges():null},getEnded:getEnded,getIsDynamic:getIsDynamic,getStreamController:function getStreamController(){return streamController},setLiveStartTime:function setLiveStartTime(value){liveStartTime=value},getLiveStartTime:function getLiveStartTime(){return liveStartTime},computeLiveDelay:function computeLiveDelay(fragmentDuration,dvrWindowSize){var mpd=dashManifestModel.getMpd(manifestModel.getValue()),delay=void 0,ret=void 0;if(delay=mediaPlayerModel.getUseSuggestedPresentationDelay()&&mpd.hasOwnProperty(_constantsConstants2.default.SUGGESTED_PRESENTATION_DELAY)?mpd.suggestedPresentationDelay:mediaPlayerModel.getLowLatencyEnabled()?0:mediaPlayerModel.getLiveDelay()?mediaPlayerModel.getLiveDelay():isNaN(fragmentDuration)?2*streamInfo.manifestInfo.minBufferTime:fragmentDuration*mediaPlayerModel.getLiveDelayFragmentCount(),mpd.availabilityStartTime&&(availabilityStartTime=mpd.availabilityStartTime.getTime()),dvrWindowSize>0){var targetDelayCapping=Math.max(dvrWindowSize-10,dvrWindowSize/2);ret=Math.min(delay,targetDelayCapping)}else ret=delay;return liveDelay=ret,ret},getLiveDelay:function getLiveDelay(){return liveDelay},getCurrentLiveLatency:getCurrentLiveLatency,play:play,isPaused:isPaused,pause:pause,isSeeking:isSeeking,seek:seek,reset:reset},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),reset()}(),instance}PlaybackController.__dashjs_factory_name="PlaybackController",exports.default=_coreFactoryMaker2.default.getSingletonFactory(PlaybackController),module.exports=exports.default},1461:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CoreEvents=function(_EventsBase){function CoreEvents(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CoreEvents),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(CoreEvents.prototype),"constructor",this).call(this),this.BUFFERING_COMPLETED="bufferingCompleted",this.BUFFER_CLEARED="bufferCleared",this.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",this.BYTES_APPENDED="bytesAppended",this.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",this.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",this.CURRENT_TRACK_CHANGED="currentTrackChanged",this.DATA_UPDATE_COMPLETED="dataUpdateCompleted",this.DATA_UPDATE_STARTED="dataUpdateStarted",this.INITIALIZATION_LOADED="initializationLoaded",this.INIT_FRAGMENT_LOADED="initFragmentLoaded",this.INIT_REQUESTED="initRequested",this.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",this.LIVE_EDGE_SEARCH_COMPLETED="liveEdgeSearchCompleted",this.LOADING_COMPLETED="loadingCompleted",this.LOADING_PROGRESS="loadingProgress",this.LOADING_DATA_PROGRESS="loadingDataProgress",this.LOADING_ABANDONED="loadingAborted",this.MANIFEST_UPDATED="manifestUpdated",this.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",this.QUOTA_EXCEEDED="quotaExceeded",this.REPRESENTATION_UPDATED="representationUpdated",this.SEGMENTS_LOADED="segmentsLoaded",this.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",this.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",this.SOURCEBUFFER_REMOVE_COMPLETED="sourceBufferRemoveCompleted",this.STREAMS_COMPOSED="streamsComposed",this.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",this.STREAM_COMPLETED="streamCompleted",this.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",this.TIMED_TEXT_REQUESTED="timedTextRequested",this.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",this.URL_RESOLUTION_FAILED="urlResolutionFailed",this.VIDEO_CHUNK_RECEIVED="videoChunkReceived",this.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",this.XLINK_ELEMENT_LOADED="xlinkElementLoaded",this.XLINK_READY="xlinkReady"}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(CoreEvents,_EventsBase),CoreEvents}(function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1391)).default);exports.default=CoreEvents,module.exports=exports.default},1462:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_voMetricsHTTPRequest=__webpack_require__(1373),_voTextTrackInfo2=_interopRequireDefault(__webpack_require__(1463)),_utilsBoxParser2=_interopRequireDefault(__webpack_require__(1386)),_utilsCustomTimeRanges2=_interopRequireDefault(__webpack_require__(1424)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_TextTracks2=_interopRequireDefault(__webpack_require__(1403)),_EmbeddedTextHtmlRender2=_interopRequireDefault(__webpack_require__(1483)),_codemIsoboxer2=_interopRequireDefault(__webpack_require__(1402)),_externalsCea608Parser2=_interopRequireDefault(__webpack_require__(1431)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372));function TextSourceBuffer(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),embeddedInitialized=!1,instance=void 0,logger=void 0,boxParser=void 0,errHandler=void 0,dashManifestModel=void 0,manifestModel=void 0,mediaController=void 0,parser=void 0,vttParser=void 0,ttmlParser=void 0,mediaInfos=void 0,textTracks=void 0,fragmentedFragmentModel=void 0,initializationSegmentReceived=void 0,timescale=void 0,fragmentedTracks=void 0,videoModel=void 0,streamController=void 0,firstFragmentedSubtitleStart=void 0,currFragmentedTrackIdx=void 0,embeddedTracks=void 0,embeddedTimescale=void 0,embeddedLastSequenceNumber=void 0,embeddedSequenceNumbers=void 0,embeddedCea608FieldParsers=void 0,embeddedTextHtmlRender=void 0,mseTimeOffset=void 0;function resetInitialSettings(){!function resetFragmented(){fragmentedFragmentModel=null,timescale=NaN,fragmentedTracks=[],firstFragmentedSubtitleStart=null,initializationSegmentReceived=!1}(),mediaInfos=[],parser=null}function onVideoChunkReceived(e){var chunk=e.chunk;chunk.mediaInfo.embeddedCaptions&&append(chunk.bytes,chunk)}function initEmbedded(){embeddedTracks=[],(textTracks=(0,_TextTracks2.default)(context).getInstance()).setConfig({videoModel:videoModel}),textTracks.initialize(),boxParser=(0,_utilsBoxParser2.default)(context).getInstance(),currFragmentedTrackIdx=null,!1,embeddedTimescale=0,embeddedCea608FieldParsers=[],embeddedSequenceNumbers=[],embeddedLastSequenceNumber=null,embeddedInitialized=!0,embeddedTextHtmlRender=(0,_EmbeddedTextHtmlRender2.default)(context).getInstance();var streamProcessors=streamController.getActiveStreamProcessors();for(var i in streamProcessors)if("video"===streamProcessors[i].getType()){mseTimeOffset=streamProcessors[i].getRepresentationInfo().MSETimeOffset;break}eventBus.on(_coreEventsEvents2.default.VIDEO_CHUNK_RECEIVED,onVideoChunkReceived,this)}function setCurrentFragmentedTrackIdx(idx){currFragmentedTrackIdx=idx}function createTextTrackFromMediaInfo(captionData,mediaInfo){var textTrackInfo=new _voTextTrackInfo2.default,trackKindMap={subtitle:"subtitles",caption:"captions"};textTrackInfo.captionData=captionData,textTrackInfo.lang=mediaInfo.lang,textTrackInfo.labels=mediaInfo.labels,textTrackInfo.id=mediaInfo.id?mediaInfo.id:mediaInfo.index,textTrackInfo.index=mediaInfo.index,textTrackInfo.isTTML=function checkTTML(){var ttml=!1;return mediaInfo.codec&&mediaInfo.codec.search(_constantsConstants2.default.STPP)>=0&&(ttml=!0),mediaInfo.mimeType&&mediaInfo.mimeType.search(_constantsConstants2.default.TTML)>=0&&(ttml=!0),ttml}(),textTrackInfo.defaultTrack=function getIsDefault(mediaInfo){var isDefault=!1;embeddedTracks.length>1&&mediaInfo.isEmbedded?isDefault=mediaInfo.id&&mediaInfo.id===_constantsConstants2.default.CC1:1===embeddedTracks.length?mediaInfo.id&&"string"==typeof mediaInfo.id&&"CC"===mediaInfo.id.substring(0,2)&&(isDefault=!0):0===embeddedTracks.length&&(isDefault=mediaInfo.index===mediaInfos[0].index);return isDefault}(mediaInfo),textTrackInfo.isFragmented=!dashManifestModel.getIsTextTrack(mediaInfo.mimeType),textTrackInfo.isEmbedded=!!mediaInfo.isEmbedded,textTrackInfo.kind=function getKind(){var kind=mediaInfo.roles.length>0?trackKindMap[mediaInfo.roles[0]]:trackKindMap.caption;return kind=kind===trackKindMap.caption||kind===trackKindMap.subtitle?kind:trackKindMap.caption}(),textTrackInfo.roles=mediaInfo.roles,textTrackInfo.accessibility=mediaInfo.accessibility;var totalNrTracks=(mediaInfos?mediaInfos.length:0)+embeddedTracks.length;textTracks.addTextTrack(textTrackInfo,totalNrTracks)}function append(bytes,chunk){var result=void 0,sampleList=void 0,i=void 0,j=void 0,k=void 0,samplesInfo=void 0,ccContent=void 0,mediaInfo=chunk.mediaInfo,mediaType=mediaInfo.type,mimeType=mediaInfo.mimeType,codecType=mediaInfo.codec||mimeType;if(codecType){if(mediaType===_constantsConstants2.default.FRAGMENTED_TEXT)if(initializationSegmentReceived)if(sampleList=(samplesInfo=boxParser.getSamplesInfo(bytes)).sampleList,null===firstFragmentedSubtitleStart&&sampleList.length>0&&(firstFragmentedSubtitleStart=sampleList[0].cts-chunk.start*timescale),codecType.search(_constantsConstants2.default.STPP)>=0)for(parser=null!==parser?parser:getParser(codecType),i=0;i<sampleList.length;i++){var sampleStart=(sample=sampleList[i]).cts,sampleRelStart=sampleStart-firstFragmentedSubtitleStart;this.buffered.add(sampleRelStart/timescale,(sampleRelStart+sample.duration)/timescale);var dataView=new DataView(bytes,sample.offset,sample.subSizes[0]);ccContent=_codemIsoboxer2.default.Utils.dataViewToString(dataView,_constantsConstants2.default.UTF8);var images=[],subOffset=sample.offset+sample.subSizes[0];for(j=1;j<sample.subSizes.length;j++){var inData=new Uint8Array(bytes,subOffset,sample.subSizes[j]),raw=String.fromCharCode.apply(null,inData);images.push(raw),subOffset+=sample.subSizes[j]}try{var offsetTime=manifestModel.getValue().ttmlTimeIsRelative?sampleStart/timescale:0;result=parser.parse(ccContent,offsetTime,sampleStart/timescale,(sampleStart+sample.duration)/timescale,images),textTracks.addCaptions(currFragmentedTrackIdx,firstFragmentedSubtitleStart/timescale,result)}catch(e){fragmentedFragmentModel.removeExecutedRequestsBeforeTime(),this.remove(),logger.error("TTML parser error: "+e.message)}}else{var captionArray=[];for(i=0;i<sampleList.length;i++){var sample;(sample=sampleList[i]).cts-=firstFragmentedSubtitleStart,this.buffered.add(sample.cts/timescale,(sample.cts+sample.duration)/timescale);var sampleData=bytes.slice(sample.offset,sample.offset+sample.size),sampleBoxes=_codemIsoboxer2.default.parseBuffer(sampleData);for(j=0;j<sampleBoxes.boxes.length;j++){var box1=sampleBoxes.boxes[j];if(logger.debug("VTT box1: "+box1.type),"vtte"!==box1.type&&"vttc"===box1.type)for(logger.debug("VTT vttc boxes.length = "+box1.boxes.length),k=0;k<box1.boxes.length;k++){var box2=box1.boxes[k];if(logger.debug("VTT box2: "+box2.type),"payl"===box2.type){var cue_text=box2.cue_text;logger.debug("VTT cue_text = "+cue_text);var start_time=sample.cts/timescale,end_time=(sample.cts+sample.duration)/timescale;captionArray.push({start:start_time,end:end_time,data:cue_text,styles:{}}),logger.debug("VTT "+start_time+"-"+end_time+" : "+cue_text)}}}}captionArray.length>0&&textTracks.addCaptions(currFragmentedTrackIdx,0,captionArray)}else initializationSegmentReceived=!0,timescale=boxParser.getMediaTimescaleFromMoov(bytes);else if(mediaType===_constantsConstants2.default.TEXT){dataView=new DataView(bytes,0,bytes.byteLength);ccContent=_codemIsoboxer2.default.Utils.dataViewToString(dataView,_constantsConstants2.default.UTF8);try{result=getParser(codecType).parse(ccContent,0),textTracks.addCaptions(textTracks.getCurrentTrackIdx(),0,result)}catch(e){errHandler.timedTextError(e,"parse",ccContent),errHandler.error(new _voDashJSError2.default(_coreErrorsErrors2.default.TIMED_TEXT_ERROR_ID_PARSE_CODE,_coreErrorsErrors2.default.TIMED_TEXT_ERROR_MESSAGE_PARSE+e.message,ccContent))}}else if(mediaType===_constantsConstants2.default.VIDEO)if(chunk.segmentType===_voMetricsHTTPRequest.HTTPRequest.INIT_SEGMENT_TYPE){if(0===embeddedTimescale)for(embeddedTimescale=boxParser.getMediaTimescaleFromMoov(bytes),i=0;i<embeddedTracks.length;i++)createTextTrackFromMediaInfo(null,embeddedTracks[i])}else{if(0===embeddedTimescale)return void logger.warn("CEA-608: No timescale for embeddedTextTrack yet");var makeCueAdderForIndex=function makeCueAdderForIndex(self,trackIndex){return function newCue(startTime,endTime,captionScreen){var captionsArray=null;captionsArray=videoModel.getTTMLRenderingDiv()?embeddedTextHtmlRender.createHTMLCaptionsFromScreen(videoModel.getElement(),startTime,endTime,captionScreen):[{start:startTime,end:endTime,data:captionScreen.getDisplayText(),styles:{}}],captionsArray&&textTracks.addCaptions(trackIndex,0,captionsArray)}},sequenceNumber=(samplesInfo=boxParser.getSamplesInfo(bytes)).lastSequenceNumber;if(!embeddedCea608FieldParsers[0]&&!embeddedCea608FieldParsers[1]){var handler=void 0,trackIdx=void 0;for(i=0;i<embeddedTracks.length;i++){if(embeddedTracks[i].id===_constantsConstants2.default.CC1?(0,trackIdx=textTracks.getTrackIdxForId(_constantsConstants2.default.CC1)):embeddedTracks[i].id===_constantsConstants2.default.CC3&&(1,trackIdx=textTracks.getTrackIdxForId(_constantsConstants2.default.CC3)),-1===trackIdx)return void logger.warn("CEA-608: data before track is ready.");handler=makeCueAdderForIndex(0,trackIdx),embeddedCea608FieldParsers[i]=new _externalsCea608Parser2.default.Cea608Parser(i+1,{newCue:handler},null)}}if(embeddedTimescale&&-1==embeddedSequenceNumbers.indexOf(sequenceNumber)){if(null!==embeddedLastSequenceNumber&&sequenceNumber!==embeddedLastSequenceNumber+samplesInfo.numSequences)for(i=0;i<embeddedCea608FieldParsers.length;i++)embeddedCea608FieldParsers[i]&&embeddedCea608FieldParsers[i].reset();for(var allCcData=function extractCea608Data(data,samples){if(0===samples.length)return null;for(var allCcData={splits:[],fields:[[],[]]},raw=new DataView(data),i=0;i<samples.length;i++)for(var sample=samples[i],cea608Ranges=_externalsCea608Parser2.default.findCea608Nalus(raw,sample.offset,sample.size),lastSampleTime=null,idx=0,j=0;j<cea608Ranges.length;j++)for(var ccData=_externalsCea608Parser2.default.extractCea608DataFromRange(raw,cea608Ranges[j]),k=0;k<2;k++)ccData[k].length>0&&(sample.cts!==lastSampleTime?idx=0:idx+=1,allCcData.fields[k].push([sample.cts+mseTimeOffset*embeddedTimescale,ccData[k],idx]),lastSampleTime=sample.cts);return allCcData.fields.forEach((function sortField(field){field.sort((function(a,b){return a[0]===b[0]?a[2]-b[2]:a[0]-b[0]}))})),allCcData}(bytes,samplesInfo.sampleList),fieldNr=0;fieldNr<embeddedCea608FieldParsers.length;fieldNr++){var ccData=allCcData.fields[fieldNr],fieldParser=embeddedCea608FieldParsers[fieldNr];if(fieldParser)for(i=0;i<ccData.length;i++)fieldParser.addData(ccData[i][0]/embeddedTimescale,ccData[i][1])}embeddedLastSequenceNumber=sequenceNumber,embeddedSequenceNumbers.push(sequenceNumber)}}}else logger.error("No text type defined")}function getParser(codecType){var parser=void 0;return codecType.search(_constantsConstants2.default.VTT)>=0?parser=vttParser:(codecType.search(_constantsConstants2.default.TTML)>=0||codecType.search(_constantsConstants2.default.STPP)>=0)&&(parser=ttmlParser),parser}return instance={initialize:function initialize(mimeType,streamProcessor){embeddedInitialized||initEmbedded(),textTracks.setConfig({videoModel:videoModel}),textTracks.initialize(),boxParser||(boxParser=(0,_utilsBoxParser2.default)(context).getInstance()),function addMediaInfos(mimeType,streamProcessor){var isFragmented=!dashManifestModel.getIsTextTrack(mimeType);if(streamProcessor){if(mediaInfos=mediaInfos.concat(streamProcessor.getMediaInfoArr()),isFragmented){fragmentedFragmentModel=streamProcessor.getFragmentModel(),instance.buffered=(0,_utilsCustomTimeRanges2.default)(context).create(),fragmentedTracks=mediaController.getTracksFor(_constantsConstants2.default.FRAGMENTED_TEXT,streamController.getActiveStreamInfo());for(var currFragTrack=mediaController.getCurrentTrackFor(_constantsConstants2.default.FRAGMENTED_TEXT,streamController.getActiveStreamInfo()),i=0;i<fragmentedTracks.length;i++)if(fragmentedTracks[i]===currFragTrack){setCurrentFragmentedTrackIdx(i);break}}for(i=0;i<mediaInfos.length;i++)createTextTrackFromMediaInfo(null,mediaInfos[i])}}(mimeType,streamProcessor)},append:append,abort:function abort(){textTracks.deleteAllTextTracks(),boxParser=null,mediaInfos=[],fragmentedFragmentModel=null,initializationSegmentReceived=!1,fragmentedTracks=[]},addEmbeddedTrack:function addEmbeddedTrack(mediaInfo){if(embeddedInitialized||initEmbedded(),mediaInfo)if(mediaInfo.id===_constantsConstants2.default.CC1||mediaInfo.id===_constantsConstants2.default.CC3){for(var i=0;i<embeddedTracks.length;i++)if(embeddedTracks[i].id===mediaInfo.id)return;embeddedTracks.push(mediaInfo)}else logger.warn("Embedded track "+mediaInfo.id+" not supported!")},resetEmbedded:function resetEmbedded(){eventBus.off(_coreEventsEvents2.default.VIDEO_CHUNK_RECEIVED,onVideoChunkReceived,this),textTracks&&textTracks.deleteAllTextTracks(),embeddedInitialized=!1,embeddedTracks=[],embeddedCea608FieldParsers=[null,null],embeddedSequenceNumbers=[],embeddedLastSequenceNumber=null},setConfig:function setConfig(config){config&&(config.errHandler&&(errHandler=config.errHandler),config.dashManifestModel&&(dashManifestModel=config.dashManifestModel),config.manifestModel&&(manifestModel=config.manifestModel),config.mediaController&&(mediaController=config.mediaController),config.videoModel&&(videoModel=config.videoModel),config.streamController&&(streamController=config.streamController),config.textTracks&&(textTracks=config.textTracks),config.vttParser&&(vttParser=config.vttParser),config.ttmlParser&&(ttmlParser=config.ttmlParser))},getConfig:function getConfig(){return{fragmentModel:fragmentedFragmentModel,fragmentedTracks:fragmentedTracks,videoModel:videoModel}},setCurrentFragmentedTrackIdx:setCurrentFragmentedTrackIdx,remove:function remove(start,end){void 0===start&&start===end&&(start=this.buffered.start(0),end=this.buffered.end(this.buffered.length-1)),this.buffered.remove(start,end)},reset:function reset(){resetInitialSettings(),streamController=null,videoModel=null,textTracks=null}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),resetInitialSettings()}(),instance}TextSourceBuffer.__dashjs_factory_name="TextSourceBuffer",exports.default=_coreFactoryMaker2.default.getSingletonFactory(TextSourceBuffer),module.exports=exports.default},1463:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function TextTrackInfo(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextTrackInfo),this.captionData=null,this.label=null,this.lang=null,this.defaultTrack=!1,this.kind=null,this.isFragmented=!1,this.isEmbedded=!1},module.exports=exports.default},1464:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _voIsoBox2=_interopRequireDefault(__webpack_require__(1465)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366));function IsoFile(){var parsedIsoFile=void 0;function getBoxes(type){var boxes=[];if(!type||!parsedIsoFile||"function"!=typeof parsedIsoFile.fetchAll)return boxes;for(var boxData=parsedIsoFile.fetchAll(type),box=void 0,i=0,ln=boxData.length;i<ln;i++)(box=convertToDashIsoBox(boxData[i]))&&boxes.push(box);return boxes}function convertToDashIsoBox(boxData){if(!boxData)return null;var box=new _voIsoBox2.default(boxData);return boxData.hasOwnProperty("_incomplete")&&(box.isComplete=!boxData._incomplete),box}return{getBox:function getBox(type){return type&&parsedIsoFile&&parsedIsoFile.boxes&&0!==parsedIsoFile.boxes.length&&"function"==typeof parsedIsoFile.fetch?convertToDashIsoBox(parsedIsoFile.fetch(type)):null},getBoxes:getBoxes,setData:function setData(value){parsedIsoFile=value},getLastBox:function getLastBox(){if(!parsedIsoFile||!parsedIsoFile.boxes||!parsedIsoFile.boxes.length)return null;var boxes=getBoxes(parsedIsoFile.boxes[parsedIsoFile.boxes.length-1].type);return boxes.length>0?boxes[boxes.length-1]:null}}}IsoFile.__dashjs_factory_name="IsoFile",exports.default=_coreFactoryMaker2.default.getClassFactory(IsoFile),module.exports=exports.default},1465:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var IsoBox=function(){function IsoBox(boxData){if(function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,IsoBox),this.offset=boxData._offset,this.type=boxData.type,this.size=boxData.size,this.boxes=[],boxData.boxes)for(var i=0;i<boxData.boxes.length;i++)this.boxes.push(new IsoBox(boxData.boxes[i]));switch(this.isComplete=!0,boxData.type){case"sidx":if(this.timescale=boxData.timescale,this.earliest_presentation_time=boxData.earliest_presentation_time,this.first_offset=boxData.first_offset,this.references=boxData.references,boxData.references){this.references=[];for(i=0;i<boxData.references.length;i++){var reference={reference_type:boxData.references[i].reference_type,referenced_size:boxData.references[i].referenced_size,subsegment_duration:boxData.references[i].subsegment_duration};this.references.push(reference)}}break;case"emsg":this.id=boxData.id,this.value=boxData.value,this.timescale=boxData.timescale,this.scheme_id_uri=boxData.scheme_id_uri,this.presentation_time_delta=1===boxData.version?boxData.presentation_time:boxData.presentation_time_delta,this.event_duration=boxData.event_duration,this.message_data=boxData.message_data;break;case"mdhd":this.timescale=boxData.timescale;break;case"mfhd":this.sequence_number=boxData.sequence_number;break;case"subs":this.entry_count=boxData.entry_count,this.entries=boxData.entries;break;case"tfhd":this.base_data_offset=boxData.base_data_offset,this.sample_description_index=boxData.sample_description_index,this.default_sample_duration=boxData.default_sample_duration,this.default_sample_size=boxData.default_sample_size,this.default_sample_flags=boxData.default_sample_flags,this.flags=boxData.flags;break;case"tfdt":this.version=boxData.version,this.baseMediaDecodeTime=boxData.baseMediaDecodeTime,this.flags=boxData.flags;break;case"trun":if(this.sample_count=boxData.sample_count,this.first_sample_flags=boxData.first_sample_flags,this.data_offset=boxData.data_offset,this.flags=boxData.flags,this.samples=boxData.samples,boxData.samples){this.samples=[];i=0;for(var ln=boxData.samples.length;i<ln;i++){var sample={sample_size:boxData.samples[i].sample_size,sample_duration:boxData.samples[i].sample_duration,sample_composition_time_offset:boxData.samples[i].sample_composition_time_offset};this.samples.push(sample)}}}}return _createClass(IsoBox,[{key:"getChildBox",value:function getChildBox(type){for(var i=0;i<this.boxes.length;i++)if(this.boxes[i].type===type)return this.boxes[i]}},{key:"getChildBoxes",value:function getChildBoxes(type){for(var boxes=[],i=0;i<this.boxes.length;i++)this.boxes[i].type===type&&boxes.push(this.boxes[i]);return boxes}}]),IsoBox}();exports.default=IsoBox,module.exports=exports.default},1466:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function IsoBoxSearchInfo(lastCompletedOffset,found,size){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,IsoBoxSearchInfo),this.lastCompletedOffset=lastCompletedOffset,this.found=found,this.size=size},module.exports=exports.default},1467:function(module,exports,__webpack_require__){!function(imscISD,imscNames,imscStyles,imscUtils){imscISD.generateISD=function(tt,offset,errorHandler){var isd=new ISD(tt),context={};for(var r in tt.head.layout.regions){var c=isdProcessContentElement(tt,offset,tt.head.layout.regions[r],tt.body,null,"",tt.head.layout.regions[r],errorHandler,context);null!==c&&isd.contents.push(c.element)}return isd};var _rcs_na_styles=[imscStyles.byName.color.qname,imscStyles.byName.textCombine.qname,imscStyles.byName.textDecoration.qname,imscStyles.byName.textEmphasis.qname,imscStyles.byName.textOutline.qname,imscStyles.byName.textShadow.qname];function isdProcessContentElement(doc,offset,region,body,parent,inherited_region_id,elem,errorHandler,context){if(offset<elem.begin||offset>=elem.end)return null;var associated_region_id="regionID"in elem&&""!==elem.regionID?elem.regionID:inherited_region_id;if(null!==parent&&associated_region_id!==region.id&&(!("contents"in elem)||"contents"in elem&&0===elem.contents.length||""!==associated_region_id))return null;var isd_element=new ISDContentElement(elem);for(var i in elem.sets)offset<elem.sets[i].begin||offset>=elem.sets[i].end||(isd_element.styleAttrs[elem.sets[i].qname]=elem.sets[i].value);var contents,spec_attr={};for(var qname in isd_element.styleAttrs)if(spec_attr[qname]=!0,qname===imscStyles.byName.writingMode.qname&&!(imscStyles.byName.direction.qname in isd_element.styleAttrs)){var wm=isd_element.styleAttrs[qname];"lrtb"===wm||"lr"===wm?isd_element.styleAttrs[imscStyles.byName.direction.qname]="ltr":"rltb"!==wm&&"rl"!==wm||(isd_element.styleAttrs[imscStyles.byName.direction.qname]="rtl")}if(null!==parent)for(var j in imscStyles.all){var sa=imscStyles.all[j];if(sa.qname===imscStyles.byName.textDecoration.qname){var ps=parent.styleAttrs[sa.qname],es=isd_element.styleAttrs[sa.qname],outs=[];void 0===es?outs=ps:-1===es.indexOf("none")?((-1===es.indexOf("noUnderline")&&-1!==ps.indexOf("underline")||-1!==es.indexOf("underline"))&&outs.push("underline"),(-1===es.indexOf("noLineThrough")&&-1!==ps.indexOf("lineThrough")||-1!==es.indexOf("lineThrough"))&&outs.push("lineThrough"),(-1===es.indexOf("noOverline")&&-1!==ps.indexOf("overline")||-1!==es.indexOf("overline"))&&outs.push("overline")):outs.push("none"),isd_element.styleAttrs[sa.qname]=outs}else if(sa.qname!==imscStyles.byName.fontSize.qname||sa.qname in isd_element.styleAttrs||"span"!==isd_element.kind||"textContainer"!==isd_element.styleAttrs[imscStyles.byName.ruby.qname])if(sa.qname!==imscStyles.byName.fontSize.qname||sa.qname in isd_element.styleAttrs||"span"!==isd_element.kind||"text"!==isd_element.styleAttrs[imscStyles.byName.ruby.qname])sa.inherit&&sa.qname in parent.styleAttrs&&!(sa.qname in isd_element.styleAttrs)&&(isd_element.styleAttrs[sa.qname]=parent.styleAttrs[sa.qname]);else{var parent_fs=parent.styleAttrs[imscStyles.byName.fontSize.qname];"textContainer"===parent.styleAttrs[imscStyles.byName.ruby.qname]?isd_element.styleAttrs[sa.qname]=parent_fs:isd_element.styleAttrs[sa.qname]=new imscUtils.ComputedLength(.5*parent_fs.rw,.5*parent_fs.rh)}else{var ruby_fs=parent.styleAttrs[imscStyles.byName.fontSize.qname];isd_element.styleAttrs[sa.qname]=new imscUtils.ComputedLength(.5*ruby_fs.rw,.5*ruby_fs.rh)}}for(var k in imscStyles.all){var ivs=imscStyles.all[k];if(!(ivs.qname in isd_element.styleAttrs)&&!(ivs.qname===imscStyles.byName.position.qname&&imscStyles.byName.origin.qname in isd_element.styleAttrs||ivs.qname===imscStyles.byName.origin.qname&&imscStyles.byName.position.qname in isd_element.styleAttrs)){var iv=doc.head.styling.initials[ivs.qname]||ivs.initial;("region"===isd_element.kind||!1===ivs.inherit&&null!==iv)&&(isd_element.styleAttrs[ivs.qname]=ivs.parse(iv),spec_attr[ivs.qname]=!0)}}for(var z in imscStyles.all){var cs=imscStyles.all[z];if(cs.qname in spec_attr&&null!==cs.compute){var cstyle=cs.compute(doc,parent,isd_element,isd_element.styleAttrs[cs.qname],context);null!==cstyle?isd_element.styleAttrs[cs.qname]=cstyle:(isd_element.styleAttrs[cs.qname]=cs.compute(doc,parent,isd_element,cs.parse(cs.initial),context),reportError(errorHandler,"Style '"+cs.qname+"' on element '"+isd_element.kind+"' cannot be computed"))}}if("none"===isd_element.styleAttrs[imscStyles.byName.display.qname])return null;for(var x in null===parent?contents=null===body?[]:[body]:"contents"in elem&&(contents=elem.contents),contents){var c=isdProcessContentElement(doc,offset,region,body,isd_element,associated_region_id,contents[x],errorHandler,context);null!==c&&isd_element.contents.push(c.element)}for(var qnameb in isd_element.styleAttrs){var na=!1;if("span"===isd_element.kind){var rsp=isd_element.styleAttrs[imscStyles.byName.ruby.qname];(na=("container"===rsp||"textContainer"===rsp||"baseContainer"===rsp)&&-1!==_rcs_na_styles.indexOf(qnameb))||(na="container"!==rsp&&qnameb===imscStyles.byName.rubyAlign.qname),na||(na=!("textContainer"===rsp||"text"===rsp)&&qnameb===imscStyles.byName.rubyPosition.qname)}if(!na)na=-1===imscStyles.byQName[qnameb].applies.indexOf(isd_element.kind);na&&delete isd_element.styleAttrs[qnameb]}if("span"===isd_element.kind&&isd_element.text&&"default"===isd_element.space){var trimmedspan=isd_element.text.replace(/[\t\r\n ]+/g," ");isd_element.text=trimmedspan}if("p"===isd_element.kind){var elist=[];!function constructSpanList(element,elist){if("contents"in element)for(var i in element.contents)constructSpanList(element.contents[i],elist);else"span"!==element.kind&&"br"!==element.kind||elist.push(element)}(isd_element,elist);for(var l=0,state="after_br",br_pos=0;;)if("after_br"===state)l>=elist.length||"br"===elist[l].kind?(state="before_br",br_pos=l,l--):("preserve"!==elist[l].space&&(elist[l].text=elist[l].text.replace(/^[\t\r\n ]+/g,"")),elist[l].text.length>0?(state="looking_br",l++):elist.splice(l,1));else if("before_br"===state)if(l<0||"br"===elist[l].kind){if(state="after_br",(l=br_pos+1)>=elist.length)break}else if("preserve"!==elist[l].space&&(elist[l].text=elist[l].text.replace(/[\t\r\n ]+$/g,"")),elist[l].text.length>0){if(state="after_br",(l=br_pos+1)>=elist.length)break}else elist.splice(l,1),l--;else l>=elist.length||"br"===elist[l].kind?(state="before_br",br_pos=l,l--):l++;!function pruneEmptySpans(element){if("br"===element.kind)return!1;if("text"in element)return 0===element.text.length;if("contents"in element){for(var i=element.contents.length;i--;)pruneEmptySpans(element.contents[i])&&element.contents.splice(i,1);return 0===element.contents.length}}(isd_element)}return"div"===isd_element.kind&&imscStyles.byName.backgroundImage.qname in isd_element.styleAttrs||"br"===isd_element.kind||"image"===isd_element.kind||"contents"in isd_element&&isd_element.contents.length>0||"span"===isd_element.kind&&null!==isd_element.text||"region"===isd_element.kind&&"always"===isd_element.styleAttrs[imscStyles.byName.showBackground.qname]?{region_id:associated_region_id,element:isd_element}:null}function ISD(tt){this.contents=[],this.aspectRatio=tt.aspectRatio}function ISDContentElement(ttelem){for(var sname in this.kind=ttelem.kind||"region",ttelem.id&&(this.id=ttelem.id),this.styleAttrs={},ttelem.styleAttrs)this.styleAttrs[sname]=ttelem.styleAttrs[sname];"src"in ttelem&&(this.src=ttelem.src),"type"in ttelem&&(this.type=ttelem.type),"text"in ttelem?this.text=ttelem.text:("region"===this.kind||"contents"in ttelem)&&(this.contents=[]),"space"in ttelem&&(this.space=ttelem.space)}function reportError(errorHandler,msg){if(errorHandler&&errorHandler.error&&errorHandler.error(msg))throw msg}}(exports,"undefined"==typeof imscNames?__webpack_require__(1392):imscNames,"undefined"==typeof imscStyles?__webpack_require__(1404):imscStyles,"undefined"==typeof imscUtils?__webpack_require__(1393):imscUtils)},1468:function(module,exports,__webpack_require__){!function(imscDoc,sax,imscNames,imscStyles,imscUtils){function resolveTiming(doc,element,prev_sibling,parent){var isinseq=parent&&"seq"===parent.timeContainer,implicit_begin=0;parent&&(implicit_begin=isinseq&&prev_sibling?prev_sibling.end:parent.begin),element.begin=element.explicit_begin?element.explicit_begin+implicit_begin:implicit_begin;var implicit_end=element.begin,s=null;for(var set_i in element.sets)resolveTiming(doc,element.sets[set_i],s,element),implicit_end="seq"===element.timeContainer?element.sets[set_i].end:Math.max(implicit_end,element.sets[set_i].end),s=element.sets[set_i];if("contents"in element)for(var content_i in element.contents)resolveTiming(doc,element.contents[content_i],s,element),implicit_end="seq"===element.timeContainer?element.contents[content_i].end:Math.max(implicit_end,element.contents[content_i].end),s=element.contents[content_i];else implicit_end=isinseq?element.begin:Number.POSITIVE_INFINITY;null!==element.explicit_end&&null!==element.explicit_dur?element.end=Math.min(element.begin+element.explicit_dur,implicit_begin+element.explicit_end):null===element.explicit_end&&null!==element.explicit_dur?element.end=element.begin+element.explicit_dur:null!==element.explicit_end&&null===element.explicit_dur?element.end=implicit_begin+element.explicit_end:element.end=implicit_end,delete element.explicit_begin,delete element.explicit_dur,delete element.explicit_end,doc._registerEvent(element)}function ForeignElement(node){this.node=node}function TT(){this.events=[],this.head=new Head,this.body=null}function Head(){this.styling=new Styling,this.layout=new Layout}function Styling(){this.styles={},this.initials={}}function Style(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function Initial(){this.styleAttrs=null}function Layout(){this.regions={}}function Image(src,type){ContentElement.call(this,"image"),this.src=src,this.type=type}function ContentElement(kind){this.kind=kind}function IdentifiedElement(id){this.id=id}function LayoutElement(id){this.regionID=id}function StyledElement(styleAttrs){this.styleAttrs=styleAttrs}function AnimatedElement(sets){this.sets=sets}function ContainerElement(contents){this.contents=contents}function TimedElement(explicit_begin,explicit_end,explicit_dur){this.explicit_begin=explicit_begin,this.explicit_end=explicit_end,this.explicit_dur=explicit_dur}function Body(){ContentElement.call(this,"body")}function Div(){ContentElement.call(this,"div")}function P(){ContentElement.call(this,"p")}function Span(){ContentElement.call(this,"span")}function AnonymousSpan(){ContentElement.call(this,"span")}function Br(){ContentElement.call(this,"br")}function Region(){}function Set(){}function elementGetXMLID(node){return node&&"xml:id"in node.attributes&&node.attributes["xml:id"].value||null}function elementGetStyleRefs(node){return node&&"style"in node.attributes?node.attributes.style.value.split(" "):[]}function elementGetStyles(node,errorHandler){var s={};if(null!==node)for(var i in node.attributes){var qname=node.attributes[i].uri+" "+node.attributes[i].local,sa=imscStyles.byQName[qname];if(void 0!==sa){var val=sa.parse(node.attributes[i].value);null!==val?(s[qname]=val,sa===imscStyles.byName.zIndex&&reportWarning(errorHandler,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):reportError(errorHandler,"Cannot parse styling attribute "+qname+" --\x3e "+node.attributes[i].value)}}return s}function findAttribute(node,ns,name){for(var i in node.attributes)if(node.attributes[i].uri===ns&&node.attributes[i].local===name)return node.attributes[i].value;return null}function parseTimeExpression(tickRate,effectiveFrameRate,str){var m,r=null;return null!==(m=/^(\d+(?:\.\d+)?)f$/.exec(str))?null!==effectiveFrameRate&&(r=parseFloat(m[1])/effectiveFrameRate):null!==(m=/^(\d+(?:\.\d+)?)t$/.exec(str))?null!==tickRate&&(r=parseFloat(m[1])/tickRate):null!==(m=/^(\d+(?:\.\d+)?)ms$/.exec(str))?r=parseFloat(m[1])/1e3:null!==(m=/^(\d+(?:\.\d+)?)s$/.exec(str))?r=parseFloat(m[1]):null!==(m=/^(\d+(?:\.\d+)?)h$/.exec(str))?r=3600*parseFloat(m[1]):null!==(m=/^(\d+(?:\.\d+)?)m$/.exec(str))?r=60*parseFloat(m[1]):null!==(m=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(str))?r=3600*parseInt(m[1])+60*parseInt(m[2])+parseFloat(m[3]):null!==(m=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(str))&&null!==effectiveFrameRate&&(r=3600*parseInt(m[1])+60*parseInt(m[2])+parseInt(m[3])+(null===m[4]?0:parseInt(m[4])/effectiveFrameRate)),r}function mergeChainedStyles(styling,style,errorHandler){for(;style.styleRefs.length>0;){var sref=style.styleRefs.pop();sref in styling.styles?(mergeChainedStyles(styling,styling.styles[sref],errorHandler),mergeStylesIfNotPresent(styling.styles[sref].styleAttrs,style.styleAttrs)):reportError(errorHandler,"Non-existant style id referenced")}}function mergeReferencedStyles(styling,stylerefs,styleattrs,errorHandler){for(var i=stylerefs.length-1;i>=0;i--){var sref=stylerefs[i];sref in styling.styles?mergeStylesIfNotPresent(styling.styles[sref].styleAttrs,styleattrs):reportError(errorHandler,"Non-existant style id referenced")}}function mergeStylesIfNotPresent(from_styles,into_styles){for(var sname in from_styles)sname in into_styles||(into_styles[sname]=from_styles[sname])}function reportWarning(errorHandler,msg){if(errorHandler&&errorHandler.warn&&errorHandler.warn(msg))throw msg}function reportError(errorHandler,msg){if(errorHandler&&errorHandler.error&&errorHandler.error(msg))throw msg}function reportFatal(errorHandler,msg){throw errorHandler&&errorHandler.fatal&&errorHandler.fatal(msg),msg}function indexOf(arr,searchval){for(var cur,min=0,max=arr.length-1;min<=max;){var curval=arr[cur=Math.floor((min+max)/2)];if(curval<searchval)min=cur+1;else{if(!(curval>searchval))return{found:!0,index:cur};max=cur-1}}return{found:!1,index:min}}imscDoc.fromXML=function(xmlstring,errorHandler,metadataHandler){var p=sax.parser(!0,{xmlns:!0}),estack=[],xmllangstack=[],xmlspacestack=[],metadata_depth=0,doc=null;p.onclosetag=function(node){if(estack[0]instanceof Styling)for(var sid in estack[0].styles)mergeChainedStyles(estack[0],estack[0].styles[sid],errorHandler);else if(estack[0]instanceof P||estack[0]instanceof Span){if(estack[0].contents.length>1){var c,cs=[estack[0].contents[0]];for(c=1;c<estack[0].contents.length;c++)estack[0].contents[c]instanceof AnonymousSpan&&cs[cs.length-1]instanceof AnonymousSpan?cs[cs.length-1].text+=estack[0].contents[c].text:cs.push(estack[0].contents[c]);estack[0].contents=cs}estack[0]instanceof Span&&1===estack[0].contents.length&&estack[0].contents[0]instanceof AnonymousSpan&&(estack[0].text=estack[0].contents[0].text,delete estack[0].contents)}else estack[0]instanceof ForeignElement&&(estack[0].node.uri===imscNames.ns_tt&&"metadata"===estack[0].node.local?metadata_depth--:metadata_depth>0&&metadataHandler&&"onCloseTag"in metadataHandler&&metadataHandler.onCloseTag());xmlspacestack.shift(),xmllangstack.shift(),estack.shift()},p.ontext=function(str){if(void 0===estack[0]);else if(estack[0]instanceof Span||estack[0]instanceof P){if(estack[0]instanceof Span){var ruby=estack[0].styleAttrs[imscStyles.byName.ruby.qname];if("container"===ruby||"textContainer"===ruby||"baseContainer"===ruby)return}var s=new AnonymousSpan;s.initFromText(doc,estack[0],str,xmlspacestack[0],errorHandler),estack[0].contents.push(s)}else estack[0]instanceof ForeignElement&&metadata_depth>0&&metadataHandler&&"onText"in metadataHandler&&metadataHandler.onText(str)},p.onopentag=function(node){var xmlspace=node.attributes["xml:space"];xmlspace?xmlspacestack.unshift(xmlspace.value):0===xmlspacestack.length?xmlspacestack.unshift("default"):xmlspacestack.unshift(xmlspacestack[0]);var xmllang=node.attributes["xml:lang"];if(xmllang?xmllangstack.unshift(xmllang.value):0===xmllangstack.length?xmllangstack.unshift(""):xmllangstack.unshift(xmllangstack[0]),node.uri===imscNames.ns_tt)if("tt"===node.local)null!==doc&&reportFatal(errorHandler,"Two <tt> elements at ("+this.line+","+this.column+")"),(doc=new TT).initFromNode(node,errorHandler),estack.unshift(doc);else if("head"===node.local)estack[0]instanceof TT||reportFatal(errorHandler,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),estack.unshift(doc.head);else if("styling"===node.local)estack[0]instanceof Head||reportFatal(errorHandler,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),estack.unshift(doc.head.styling);else if("style"===node.local){var s;estack[0]instanceof Styling?((s=new Style).initFromNode(node,errorHandler),s.id?doc.head.styling.styles[s.id]=s:reportError(errorHandler,"<style> element missing @id attribute"),estack.unshift(s)):estack[0]instanceof Region?((s=new Style).initFromNode(node,errorHandler),mergeStylesIfNotPresent(s.styleAttrs,estack[0].styleAttrs),estack.unshift(s)):reportFatal(errorHandler,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("initial"===node.local){var ini;if(estack[0]instanceof Styling){for(var qn in(ini=new Initial).initFromNode(node,errorHandler),ini.styleAttrs)doc.head.styling.initials[qn]=ini.styleAttrs[qn];estack.unshift(ini)}else reportFatal(errorHandler,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")")}else if("layout"===node.local)estack[0]instanceof Head||reportFatal(errorHandler,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),estack.unshift(doc.head.layout);else if("region"===node.local){estack[0]instanceof Layout||reportFatal(errorHandler,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var r=new Region;r.initFromNode(doc,node,errorHandler),!r.id||r.id in doc.head.layout.regions?reportError(errorHandler,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):doc.head.layout.regions[r.id]=r,estack.unshift(r)}else if("body"===node.local){estack[0]instanceof TT||reportFatal(errorHandler,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==doc.body&&reportFatal(errorHandler,"Second <body> element at "+this.line+","+this.column+")");var b=new Body;b.initFromNode(doc,node,errorHandler),doc.body=b,estack.unshift(b)}else if("div"===node.local){estack[0]instanceof Div||estack[0]instanceof Body||reportFatal(errorHandler,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var d=new Div;d.initFromNode(doc,estack[0],node,errorHandler);var bi=d.styleAttrs[imscStyles.byName.backgroundImage.qname];bi&&(d.contents.push(new Image(bi)),delete d.styleAttrs[imscStyles.byName.backgroundImage.qname]),estack[0].contents.push(d),estack.unshift(d)}else if("image"===node.local){estack[0]instanceof Div||reportFatal(errorHandler,"Parent of <image> element is not <div> at "+this.line+","+this.column+")");var img=new Image;img.initFromNode(doc,estack[0],node,errorHandler),estack[0].contents.push(img),estack.unshift(img)}else if("p"===node.local){estack[0]instanceof Div||reportFatal(errorHandler,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var p=new P;p.initFromNode(doc,estack[0],node,errorHandler),estack[0].contents.push(p),estack.unshift(p)}else if("span"===node.local){estack[0]instanceof Span||estack[0]instanceof P||reportFatal(errorHandler,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var ns=new Span;ns.initFromNode(doc,estack[0],node,xmlspacestack[0],errorHandler),estack[0].contents.push(ns),estack.unshift(ns)}else if("br"===node.local){estack[0]instanceof Span||estack[0]instanceof P||reportFatal(errorHandler,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var nb=new Br;nb.initFromNode(doc,estack[0],node,errorHandler),estack[0].contents.push(nb),estack.unshift(nb)}else if("set"===node.local){estack[0]instanceof Span||estack[0]instanceof P||estack[0]instanceof Div||estack[0]instanceof Body||estack[0]instanceof Region||estack[0]instanceof Br||reportFatal(errorHandler,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var st=new Set;st.initFromNode(doc,estack[0],node,errorHandler),estack[0].sets.push(st),estack.unshift(st)}else estack.unshift(new ForeignElement(node));else estack.unshift(new ForeignElement(node));if(estack[0]instanceof ForeignElement)if(node.uri===imscNames.ns_tt&&"metadata"===node.local)metadata_depth++;else if(metadata_depth>0&&metadataHandler&&"onOpenTag"in metadataHandler){var attrs=[];for(var a in node.attributes)attrs[node.attributes[a].uri+" "+node.attributes[a].local]={uri:node.attributes[a].uri,local:node.attributes[a].local,value:node.attributes[a].value};metadataHandler.onOpenTag(node.uri,node.local,attrs)}},p.write(xmlstring).close(),delete doc.head.styling.styles;var hasRegions=!1;for(var i in doc.head.layout.regions){hasRegions=!0;break}if(!hasRegions){var dr=Region.prototype.createDefaultRegion();doc.head.layout.regions[dr.id]=dr}for(var region_i in doc.head.layout.regions)resolveTiming(doc,doc.head.layout.regions[region_i],null,null);return doc.body&&resolveTiming(doc,doc.body,null,null),doc.body&&function cleanRubyContainers(element){if(!("contents"in element))return;for(var rubyval=("styleAttrs"in element?element.styleAttrs[imscStyles.byName.ruby.qname]:null),isrubycontainer="span"===element.kind&&("container"===rubyval||"textContainer"===rubyval||"baseContainer"===rubyval),i=element.contents.length-1;i>=0;i--)!isrubycontainer||"styleAttrs"in element.contents[i]&&imscStyles.byName.ruby.qname in element.contents[i].styleAttrs?cleanRubyContainers(element.contents[i]):delete element.contents[i]}(doc.body),doc},TT.prototype.initFromNode=function(node,errorHandler){var cr=function extractCellResolution(node,errorHandler){var cr=findAttribute(node,imscNames.ns_ttp,"cellResolution"),h=15,w=32;if(null!==cr){var m=/(\d+) (\d+)/.exec(cr);null!==m?(w=parseInt(m[1]),h=parseInt(m[2])):reportWarning(errorHandler,"Malformed cellResolution value (using initial value instead)")}return{w:w,h:h}}(node,errorHandler);this.cellLength={h:new imscUtils.ComputedLength(0,1/cr.h),w:new imscUtils.ComputedLength(1/cr.w,0)};var frtr=function extractFrameAndTickRate(node,errorHandler){var m,fps_attr=findAttribute(node,imscNames.ns_ttp,"frameRate"),fps=30;if(null!==fps_attr){null!==(m=/(\d+)/.exec(fps_attr))?fps=parseInt(m[1]):reportWarning(errorHandler,"Malformed frame rate attribute (using initial value instead)")}var frm_attr=findAttribute(node,imscNames.ns_ttp,"frameRateMultiplier"),frm=1;if(null!==frm_attr){null!==(m=/(\d+) (\d+)/.exec(frm_attr))?frm=parseInt(m[1])/parseInt(m[2]):reportWarning(errorHandler,"Malformed frame rate multiplier attribute (using initial value instead)")}var efps=frm*fps,tr=1,trattr=findAttribute(node,imscNames.ns_ttp,"tickRate");if(null===trattr)null!==fps_attr&&(tr=efps);else{null!==(m=/(\d+)/.exec(trattr))?tr=parseInt(m[1]):reportWarning(errorHandler,"Malformed tick rate attribute (using initial value instead)")}return{effectiveFrameRate:efps,tickRate:tr}}(node,errorHandler);this.effectiveFrameRate=frtr.effectiveFrameRate,this.tickRate=frtr.tickRate,this.aspectRatio=function extractAspectRatio(node,errorHandler){var ar=findAttribute(node,imscNames.ns_ittp,"aspectRatio");null===ar&&(ar=findAttribute(node,imscNames.ns_ttp,"displayAspectRatio"));var rslt=null;if(null!==ar){var m=/(\d+)\s+(\d+)/.exec(ar);if(null!==m){var w=parseInt(m[1]),h=parseInt(m[2]);0!==w&&0!==h?rslt=w/h:reportError(errorHandler,"Illegal aspectRatio values (ignoring)")}else reportError(errorHandler,"Malformed aspectRatio attribute (ignoring)")}return rslt}(node,errorHandler);var attr=findAttribute(node,imscNames.ns_ttp,"timeBase");null!==attr&&"media"!==attr&&reportFatal(errorHandler,"Unsupported time base");var e=function extractExtent(node,errorHandler){var attr=findAttribute(node,imscNames.ns_tts,"extent");if(null===attr)return null;var s=attr.split(" ");if(2!==s.length)return reportWarning(errorHandler,"Malformed extent (ignoring)"),null;var w=imscUtils.parseLength(s[0]),h=imscUtils.parseLength(s[1]);if(!h||!w)return reportWarning(errorHandler,"Malformed extent values (ignoring)"),null;return{h:h,w:w}}(node,errorHandler);null===e?this.pxLength={h:null,w:null}:("px"===e.h.unit&&"px"===e.w.unit||reportFatal(errorHandler,"Extent on TT must be in px or absent"),this.pxLength={h:new imscUtils.ComputedLength(0,1/e.h.value),w:new imscUtils.ComputedLength(1/e.w.value,0)}),this.dimensions={h:new imscUtils.ComputedLength(0,1),w:new imscUtils.ComputedLength(1,0)}},TT.prototype._registerEvent=function(elem){if(!(elem.end<=elem.begin)){var b_i=indexOf(this.events,elem.begin);if(b_i.found||this.events.splice(b_i.index,0,elem.begin),elem.end!==Number.POSITIVE_INFINITY){var e_i=indexOf(this.events,elem.end);e_i.found||this.events.splice(e_i.index,0,elem.end)}}},TT.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},TT.prototype.getMediaTimeEvents=function(){return this.events},Style.prototype.initFromNode=function(node,errorHandler){this.id=elementGetXMLID(node),this.styleAttrs=elementGetStyles(node,errorHandler),this.styleRefs=elementGetStyleRefs(node)},Initial.prototype.initFromNode=function(node,errorHandler){for(var i in this.styleAttrs={},node.attributes)if(node.attributes[i].uri===imscNames.ns_itts||node.attributes[i].uri===imscNames.ns_ebutts||node.attributes[i].uri===imscNames.ns_tts){var qname=node.attributes[i].uri+" "+node.attributes[i].local;this.styleAttrs[qname]=node.attributes[i].value}},Image.prototype.initFromNode=function(doc,parent,node,errorHandler){this.src="src"in node.attributes?node.attributes.src.value:null,this.src||reportError(errorHandler,"Invalid image@src attribute"),this.type="type"in node.attributes?node.attributes.type.value:null,this.type||reportError(errorHandler,"Invalid image@type attribute"),StyledElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),TimedElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),AnimatedElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),LayoutElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler)},IdentifiedElement.prototype.initFromNode=function(doc,parent,node,errorHandler){this.id=elementGetXMLID(node)},LayoutElement.prototype.initFromNode=function(doc,parent,node,errorHandler){this.regionID=function elementGetRegionID(node){return node&&"region"in node.attributes?node.attributes.region.value:""}(node)},StyledElement.prototype.initFromNode=function(doc,parent,node,errorHandler){this.styleAttrs=elementGetStyles(node,errorHandler),null!==doc.head&&null!==doc.head.styling&&mergeReferencedStyles(doc.head.styling,elementGetStyleRefs(node),this.styleAttrs,errorHandler)},AnimatedElement.prototype.initFromNode=function(doc,parent,node,errorHandler){this.sets=[]},ContainerElement.prototype.initFromNode=function(doc,parent,node,errorHandler){this.contents=[]},TimedElement.prototype.initFromNode=function(doc,parent,node,errorHandler){var t=function processTiming(doc,parent,node,errorHandler){var explicit_begin=null;node&&"begin"in node.attributes&&null===(explicit_begin=parseTimeExpression(doc.tickRate,doc.effectiveFrameRate,node.attributes.begin.value))&&reportWarning(errorHandler,"Malformed begin value "+node.attributes.begin.value+" (using 0)");var explicit_dur=null;node&&"dur"in node.attributes&&null===(explicit_dur=parseTimeExpression(doc.tickRate,doc.effectiveFrameRate,node.attributes.dur.value))&&reportWarning(errorHandler,"Malformed dur value "+node.attributes.dur.value+" (ignoring)");var explicit_end=null;node&&"end"in node.attributes&&null===(explicit_end=parseTimeExpression(doc.tickRate,doc.effectiveFrameRate,node.attributes.end.value))&&reportWarning(errorHandler,"Malformed end value (ignoring)");return{explicit_begin:explicit_begin,explicit_end:explicit_end,explicit_dur:explicit_dur}}(doc,0,node,errorHandler);this.explicit_begin=t.explicit_begin,this.explicit_end=t.explicit_end,this.explicit_dur=t.explicit_dur,this.timeContainer=function elementGetTimeContainer(node,errorHandler){var tc=node&&"timeContainer"in node.attributes?node.attributes.timeContainer.value:null;return tc&&"par"!==tc?"seq"===tc?"seq":(reportError(errorHandler,"Illegal value of timeContainer (assuming 'par')"),"par"):"par"}(node,errorHandler)},Body.prototype.initFromNode=function(doc,node,errorHandler){StyledElement.prototype.initFromNode.call(this,doc,null,node,errorHandler),TimedElement.prototype.initFromNode.call(this,doc,null,node,errorHandler),AnimatedElement.prototype.initFromNode.call(this,doc,null,node,errorHandler),LayoutElement.prototype.initFromNode.call(this,doc,null,node,errorHandler),ContainerElement.prototype.initFromNode.call(this,doc,null,node,errorHandler)},Div.prototype.initFromNode=function(doc,parent,node,errorHandler){StyledElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),TimedElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),AnimatedElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),LayoutElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),ContainerElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler)},P.prototype.initFromNode=function(doc,parent,node,errorHandler){StyledElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),TimedElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),AnimatedElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),LayoutElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),ContainerElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler)},Span.prototype.initFromNode=function(doc,parent,node,xmlspace,errorHandler){StyledElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),TimedElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),AnimatedElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),LayoutElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),ContainerElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),this.space=xmlspace},AnonymousSpan.prototype.initFromText=function(doc,parent,text,xmlspace,errorHandler){TimedElement.prototype.initFromNode.call(this,doc,parent,null,errorHandler),this.text=text,this.space=xmlspace},Br.prototype.initFromNode=function(doc,parent,node,errorHandler){LayoutElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler),TimedElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler)},Region.prototype.createDefaultRegion=function(){var r=new Region;return IdentifiedElement.call(r,""),StyledElement.call(r,{}),AnimatedElement.call(r,[]),TimedElement.call(r,0,Number.POSITIVE_INFINITY,null),r},Region.prototype.initFromNode=function(doc,node,errorHandler){IdentifiedElement.prototype.initFromNode.call(this,doc,null,node,errorHandler),StyledElement.prototype.initFromNode.call(this,doc,null,node,errorHandler),TimedElement.prototype.initFromNode.call(this,doc,null,node,errorHandler),AnimatedElement.prototype.initFromNode.call(this,doc,null,node,errorHandler),null!==doc.head&&null!==doc.head.styling&&mergeReferencedStyles(doc.head.styling,elementGetStyleRefs(node),this.styleAttrs,errorHandler)},Set.prototype.initFromNode=function(doc,parent,node,errorHandler){TimedElement.prototype.initFromNode.call(this,doc,parent,node,errorHandler);var styles=elementGetStyles(node,errorHandler);for(var qname in this.qname=null,this.value=null,styles){if(this.qname){reportError(errorHandler,"More than one style specified on set");break}this.qname=qname,this.value=styles[qname]}}}(exports,"undefined"==typeof sax?__webpack_require__(1469):sax,"undefined"==typeof imscNames?__webpack_require__(1392):imscNames,"undefined"==typeof imscStyles?__webpack_require__(1404):imscStyles,"undefined"==typeof imscUtils?__webpack_require__(1393):imscUtils)},1469:function(module,exports,__webpack_require__){(function(Buffer){!function(sax){sax.parser=function(strict,opt){return new SAXParser(strict,opt)},sax.SAXParser=SAXParser,sax.SAXStream=SAXStream,sax.createStream=function createStream(strict,opt){return new SAXStream(strict,opt)},sax.MAX_BUFFER_LENGTH=65536;var Stream,buffers=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function SAXParser(strict,opt){if(!(this instanceof SAXParser))return new SAXParser(strict,opt);!function clearBuffers(parser){for(var i=0,l=buffers.length;i<l;i++)parser[buffers[i]]=""}(this),this.q=this.c="",this.bufferCheckPosition=sax.MAX_BUFFER_LENGTH,this.opt=opt||{},this.opt.lowercase=this.opt.lowercase||this.opt.lowercasetags,this.looseCase=this.opt.lowercase?"toLowerCase":"toUpperCase",this.tags=[],this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.strict=!!strict,this.noscript=!(!strict&&!this.opt.noscript),this.state=S.BEGIN,this.strictEntities=this.opt.strictEntities,this.ENTITIES=this.strictEntities?Object.create(sax.XML_ENTITIES):Object.create(sax.ENTITIES),this.attribList=[],this.opt.xmlns&&(this.ns=Object.create(rootNS)),this.trackPosition=!1!==this.opt.position,this.trackPosition&&(this.position=this.line=this.column=0),emit(this,"onready")}sax.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(o){function F(){}return F.prototype=o,new F}),Object.keys||(Object.keys=function(o){var a=[];for(var i in o)o.hasOwnProperty(i)&&a.push(i);return a}),SAXParser.prototype={end:function(){end(this)},write:function write(chunk){if(this.error)throw this.error;if(this.closed)return error(this,"Cannot write after close. Assign an onready handler.");if(null===chunk)return end(this);"object"==typeof chunk&&(chunk=chunk.toString());var i=0,c="";for(;c=charAt(chunk,i++),this.c=c,c;)switch(this.trackPosition&&(this.position++,"\n"===c?(this.line++,this.column=0):this.column++),this.state){case S.BEGIN:if(this.state=S.BEGIN_WHITESPACE,"\ufeff"===c)continue;beginWhiteSpace(this,c);continue;case S.BEGIN_WHITESPACE:beginWhiteSpace(this,c);continue;case S.TEXT:if(this.sawRoot&&!this.closedRoot){for(var starti=i-1;c&&"<"!==c&&"&"!==c;)(c=charAt(chunk,i++))&&this.trackPosition&&(this.position++,"\n"===c?(this.line++,this.column=0):this.column++);this.textNode+=chunk.substring(starti,i-1)}"<"!==c||this.sawRoot&&this.closedRoot&&!this.strict?(!not(whitespace,c)||this.sawRoot&&!this.closedRoot||strictFail(this,"Text data outside of root node."),"&"===c?this.state=S.TEXT_ENTITY:this.textNode+=c):(this.state=S.OPEN_WAKA,this.startTagPosition=this.position);continue;case S.SCRIPT:"<"===c?this.state=S.SCRIPT_ENDING:this.script+=c;continue;case S.SCRIPT_ENDING:"/"===c?this.state=S.CLOSE_TAG:(this.script+="<"+c,this.state=S.SCRIPT);continue;case S.OPEN_WAKA:if("!"===c)this.state=S.SGML_DECL,this.sgmlDecl="";else if(is(whitespace,c));else if(is(nameStart,c))this.state=S.OPEN_TAG,this.tagName=c;else if("/"===c)this.state=S.CLOSE_TAG,this.tagName="";else if("?"===c)this.state=S.PROC_INST,this.procInstName=this.procInstBody="";else{if(strictFail(this,"Unencoded <"),this.startTagPosition+1<this.position){var pad=this.position-this.startTagPosition;c=new Array(pad).join(" ")+c}this.textNode+="<"+c,this.state=S.TEXT}continue;case S.SGML_DECL:"[CDATA["===(this.sgmlDecl+c).toUpperCase()?(emitNode(this,"onopencdata"),this.state=S.CDATA,this.sgmlDecl="",this.cdata=""):this.sgmlDecl+c==="--"?(this.state=S.COMMENT,this.comment="",this.sgmlDecl=""):"DOCTYPE"===(this.sgmlDecl+c).toUpperCase()?(this.state=S.DOCTYPE,(this.doctype||this.sawRoot)&&strictFail(this,"Inappropriately located doctype declaration"),this.doctype="",this.sgmlDecl=""):">"===c?(emitNode(this,"onsgmldeclaration",this.sgmlDecl),this.sgmlDecl="",this.state=S.TEXT):is(quote,c)?(this.state=S.SGML_DECL_QUOTED,this.sgmlDecl+=c):this.sgmlDecl+=c;continue;case S.SGML_DECL_QUOTED:c===this.q&&(this.state=S.SGML_DECL,this.q=""),this.sgmlDecl+=c;continue;case S.DOCTYPE:">"===c?(this.state=S.TEXT,emitNode(this,"ondoctype",this.doctype),this.doctype=!0):(this.doctype+=c,"["===c?this.state=S.DOCTYPE_DTD:is(quote,c)&&(this.state=S.DOCTYPE_QUOTED,this.q=c));continue;case S.DOCTYPE_QUOTED:this.doctype+=c,c===this.q&&(this.q="",this.state=S.DOCTYPE);continue;case S.DOCTYPE_DTD:this.doctype+=c,"]"===c?this.state=S.DOCTYPE:is(quote,c)&&(this.state=S.DOCTYPE_DTD_QUOTED,this.q=c);continue;case S.DOCTYPE_DTD_QUOTED:this.doctype+=c,c===this.q&&(this.state=S.DOCTYPE_DTD,this.q="");continue;case S.COMMENT:"-"===c?this.state=S.COMMENT_ENDING:this.comment+=c;continue;case S.COMMENT_ENDING:"-"===c?(this.state=S.COMMENT_ENDED,this.comment=textopts(this.opt,this.comment),this.comment&&emitNode(this,"oncomment",this.comment),this.comment=""):(this.comment+="-"+c,this.state=S.COMMENT);continue;case S.COMMENT_ENDED:">"!==c?(strictFail(this,"Malformed comment"),this.comment+="--"+c,this.state=S.COMMENT):this.state=S.TEXT;continue;case S.CDATA:"]"===c?this.state=S.CDATA_ENDING:this.cdata+=c;continue;case S.CDATA_ENDING:"]"===c?this.state=S.CDATA_ENDING_2:(this.cdata+="]"+c,this.state=S.CDATA);continue;case S.CDATA_ENDING_2:">"===c?(this.cdata&&emitNode(this,"oncdata",this.cdata),emitNode(this,"onclosecdata"),this.cdata="",this.state=S.TEXT):"]"===c?this.cdata+="]":(this.cdata+="]]"+c,this.state=S.CDATA);continue;case S.PROC_INST:"?"===c?this.state=S.PROC_INST_ENDING:is(whitespace,c)?this.state=S.PROC_INST_BODY:this.procInstName+=c;continue;case S.PROC_INST_BODY:if(!this.procInstBody&&is(whitespace,c))continue;"?"===c?this.state=S.PROC_INST_ENDING:this.procInstBody+=c;continue;case S.PROC_INST_ENDING:">"===c?(emitNode(this,"onprocessinginstruction",{name:this.procInstName,body:this.procInstBody}),this.procInstName=this.procInstBody="",this.state=S.TEXT):(this.procInstBody+="?"+c,this.state=S.PROC_INST_BODY);continue;case S.OPEN_TAG:is(nameBody,c)?this.tagName+=c:(newTag(this),">"===c?openTag(this):"/"===c?this.state=S.OPEN_TAG_SLASH:(not(whitespace,c)&&strictFail(this,"Invalid character in tag name"),this.state=S.ATTRIB));continue;case S.OPEN_TAG_SLASH:">"===c?(openTag(this,!0),closeTag(this)):(strictFail(this,"Forward-slash in opening tag not followed by >"),this.state=S.ATTRIB);continue;case S.ATTRIB:if(is(whitespace,c))continue;">"===c?openTag(this):"/"===c?this.state=S.OPEN_TAG_SLASH:is(nameStart,c)?(this.attribName=c,this.attribValue="",this.state=S.ATTRIB_NAME):strictFail(this,"Invalid attribute name");continue;case S.ATTRIB_NAME:"="===c?this.state=S.ATTRIB_VALUE:">"===c?(strictFail(this,"Attribute without value"),this.attribValue=this.attribName,attrib(this),openTag(this)):is(whitespace,c)?this.state=S.ATTRIB_NAME_SAW_WHITE:is(nameBody,c)?this.attribName+=c:strictFail(this,"Invalid attribute name");continue;case S.ATTRIB_NAME_SAW_WHITE:if("="===c)this.state=S.ATTRIB_VALUE;else{if(is(whitespace,c))continue;strictFail(this,"Attribute without value"),this.tag.attributes[this.attribName]="",this.attribValue="",emitNode(this,"onattribute",{name:this.attribName,value:""}),this.attribName="",">"===c?openTag(this):is(nameStart,c)?(this.attribName=c,this.state=S.ATTRIB_NAME):(strictFail(this,"Invalid attribute name"),this.state=S.ATTRIB)}continue;case S.ATTRIB_VALUE:if(is(whitespace,c))continue;is(quote,c)?(this.q=c,this.state=S.ATTRIB_VALUE_QUOTED):(strictFail(this,"Unquoted attribute value"),this.state=S.ATTRIB_VALUE_UNQUOTED,this.attribValue=c);continue;case S.ATTRIB_VALUE_QUOTED:if(c!==this.q){"&"===c?this.state=S.ATTRIB_VALUE_ENTITY_Q:this.attribValue+=c;continue}attrib(this),this.q="",this.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:is(whitespace,c)?this.state=S.ATTRIB:">"===c?openTag(this):"/"===c?this.state=S.OPEN_TAG_SLASH:is(nameStart,c)?(strictFail(this,"No whitespace between attributes"),this.attribName=c,this.attribValue="",this.state=S.ATTRIB_NAME):strictFail(this,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(not(attribEnd,c)){"&"===c?this.state=S.ATTRIB_VALUE_ENTITY_U:this.attribValue+=c;continue}attrib(this),">"===c?openTag(this):this.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(this.tagName)">"===c?closeTag(this):is(nameBody,c)?this.tagName+=c:this.script?(this.script+="</"+this.tagName,this.tagName="",this.state=S.SCRIPT):(not(whitespace,c)&&strictFail(this,"Invalid tagname in closing tag"),this.state=S.CLOSE_TAG_SAW_WHITE);else{if(is(whitespace,c))continue;not(nameStart,c)?this.script?(this.script+="</"+c,this.state=S.SCRIPT):strictFail(this,"Invalid tagname in closing tag."):this.tagName=c}continue;case S.CLOSE_TAG_SAW_WHITE:if(is(whitespace,c))continue;">"===c?closeTag(this):strictFail(this,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:var returnState,buffer;switch(this.state){case S.TEXT_ENTITY:returnState=S.TEXT,buffer="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:returnState=S.ATTRIB_VALUE_QUOTED,buffer="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:returnState=S.ATTRIB_VALUE_UNQUOTED,buffer="attribValue"}";"===c?(this[buffer]+=parseEntity(this),this.entity="",this.state=returnState):is(this.entity.length?entityBody:entityStart,c)?this.entity+=c:(strictFail(this,"Invalid character in entity name"),this[buffer]+="&"+this.entity+c,this.entity="",this.state=returnState);continue;default:throw new Error(this,"Unknown state: "+this.state)}this.position>=this.bufferCheckPosition&&function checkBufferLength(parser){for(var maxAllowed=Math.max(sax.MAX_BUFFER_LENGTH,10),maxActual=0,i=0,l=buffers.length;i<l;i++){var len=parser[buffers[i]].length;if(len>maxAllowed)switch(buffers[i]){case"textNode":closeText(parser);break;case"cdata":emitNode(parser,"oncdata",parser.cdata),parser.cdata="";break;case"script":emitNode(parser,"onscript",parser.script),parser.script="";break;default:error(parser,"Max buffer length exceeded: "+buffers[i])}maxActual=Math.max(maxActual,len)}var m=sax.MAX_BUFFER_LENGTH-maxActual;parser.bufferCheckPosition=m+parser.position}(this);return this},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){!function flushBuffers(parser){closeText(parser),""!==parser.cdata&&(emitNode(parser,"oncdata",parser.cdata),parser.cdata=""),""!==parser.script&&(emitNode(parser,"onscript",parser.script),parser.script="")}(this)}};try{Stream=__webpack_require__(1472).Stream}catch(ex){Stream=function(){}}var streamWraps=sax.EVENTS.filter((function(ev){return"error"!==ev&&"end"!==ev}));function SAXStream(strict,opt){if(!(this instanceof SAXStream))return new SAXStream(strict,opt);Stream.apply(this),this._parser=new SAXParser(strict,opt),this.writable=!0,this.readable=!0;var me=this;this._parser.onend=function(){me.emit("end")},this._parser.onerror=function(er){me.emit("error",er),me._parser.error=null},this._decoder=null,streamWraps.forEach((function(ev){Object.defineProperty(me,"on"+ev,{get:function(){return me._parser["on"+ev]},set:function(h){if(!h)return me.removeAllListeners(ev),me._parser["on"+ev]=h,h;me.on(ev,h)},enumerable:!0,configurable:!1})}))}SAXStream.prototype=Object.create(Stream.prototype,{constructor:{value:SAXStream}}),SAXStream.prototype.write=function(data){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(data)){if(!this._decoder){var SD=__webpack_require__(1409).StringDecoder;this._decoder=new SD("utf8")}data=this._decoder.write(data)}return this._parser.write(data.toString()),this.emit("data",data),!0},SAXStream.prototype.end=function(chunk){return chunk&&chunk.length&&this.write(chunk),this._parser.end(),!0},SAXStream.prototype.on=function(ev,handler){var me=this;return me._parser["on"+ev]||-1===streamWraps.indexOf(ev)||(me._parser["on"+ev]=function(){var args=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);args.splice(0,0,ev),me.emit.apply(me,args)}),Stream.prototype.on.call(me,ev,handler)};var whitespace="\r\n\t ",number="0124356789",letter="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",quote="'\"",attribEnd=whitespace+">",XML_NAMESPACE="http://www.w3.org/XML/1998/namespace",rootNS={xml:XML_NAMESPACE,xmlns:"http://www.w3.org/2000/xmlns/"};whitespace=charClass(whitespace),number=charClass(number),letter=charClass(letter);var nameStart=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameBody=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,entityStart=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,entityBody=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function charClass(str){return str.split("").reduce((function(s,c){return s[c]=!0,s}),{})}function is(charclass,c){return function isRegExp(c){return"[object RegExp]"===Object.prototype.toString.call(c)}(charclass)?!!c.match(charclass):charclass[c]}function not(charclass,c){return!is(charclass,c)}quote=charClass(quote),attribEnd=charClass(attribEnd);var stringFromCharCode,floor,fromCodePoint,S=0;for(var s in sax.STATE={BEGIN:S++,BEGIN_WHITESPACE:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++},sax.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},sax.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(sax.ENTITIES).forEach((function(key){var e=sax.ENTITIES[key],s="number"==typeof e?String.fromCharCode(e):e;sax.ENTITIES[key]=s})),sax.STATE)sax.STATE[sax.STATE[s]]=s;function emit(parser,event,data){parser[event]&&parser[event](data)}function emitNode(parser,nodeType,data){parser.textNode&&closeText(parser),emit(parser,nodeType,data)}function closeText(parser){parser.textNode=textopts(parser.opt,parser.textNode),parser.textNode&&emit(parser,"ontext",parser.textNode),parser.textNode=""}function textopts(opt,text){return opt.trim&&(text=text.trim()),opt.normalize&&(text=text.replace(/\s+/g," ")),text}function error(parser,er){return closeText(parser),parser.trackPosition&&(er+="\nLine: "+parser.line+"\nColumn: "+parser.column+"\nChar: "+parser.c),er=new Error(er),parser.error=er,emit(parser,"onerror",er),parser}function end(parser){return parser.sawRoot&&!parser.closedRoot&&strictFail(parser,"Unclosed root tag"),parser.state!==S.BEGIN&&parser.state!==S.BEGIN_WHITESPACE&&parser.state!==S.TEXT&&error(parser,"Unexpected end"),closeText(parser),parser.c="",parser.closed=!0,emit(parser,"onend"),SAXParser.call(parser,parser.strict,parser.opt),parser}function strictFail(parser,message){if("object"!=typeof parser||!(parser instanceof SAXParser))throw new Error("bad call to strictFail");parser.strict&&error(parser,message)}function newTag(parser){parser.strict||(parser.tagName=parser.tagName[parser.looseCase]());var parent=parser.tags[parser.tags.length-1]||parser,tag=parser.tag={name:parser.tagName,attributes:{}};parser.opt.xmlns&&(tag.ns=parent.ns),parser.attribList.length=0,emitNode(parser,"onopentagstart",tag)}function qname(name,attribute){var qualName=name.indexOf(":")<0?["",name]:name.split(":"),prefix=qualName[0],local=qualName[1];return attribute&&"xmlns"===name&&(prefix="xmlns",local=""),{prefix:prefix,local:local}}function attrib(parser){if(parser.strict||(parser.attribName=parser.attribName[parser.looseCase]()),-1!==parser.attribList.indexOf(parser.attribName)||parser.tag.attributes.hasOwnProperty(parser.attribName))parser.attribName=parser.attribValue="";else{if(parser.opt.xmlns){var qn=qname(parser.attribName,!0),prefix=qn.prefix,local=qn.local;if("xmlns"===prefix)if("xml"===local&&parser.attribValue!==XML_NAMESPACE)strictFail(parser,"xml: prefix must be bound to "+XML_NAMESPACE+"\nActual: "+parser.attribValue);else if("xmlns"===local&&"http://www.w3.org/2000/xmlns/"!==parser.attribValue)strictFail(parser,"xmlns: prefix must be bound to http://www.w3.org/2000/xmlns/\nActual: "+parser.attribValue);else{var tag=parser.tag,parent=parser.tags[parser.tags.length-1]||parser;tag.ns===parent.ns&&(tag.ns=Object.create(parent.ns)),tag.ns[local]=parser.attribValue}parser.attribList.push([parser.attribName,parser.attribValue])}else parser.tag.attributes[parser.attribName]=parser.attribValue,emitNode(parser,"onattribute",{name:parser.attribName,value:parser.attribValue});parser.attribName=parser.attribValue=""}}function openTag(parser,selfClosing){if(parser.opt.xmlns){var tag=parser.tag,qn=qname(parser.tagName);tag.prefix=qn.prefix,tag.local=qn.local,tag.uri=tag.ns[qn.prefix]||"",tag.prefix&&!tag.uri&&(strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(parser.tagName)),tag.uri=qn.prefix);var parent=parser.tags[parser.tags.length-1]||parser;tag.ns&&parent.ns!==tag.ns&&Object.keys(tag.ns).forEach((function(p){emitNode(parser,"onopennamespace",{prefix:p,uri:tag.ns[p]})}));for(var i=0,l=parser.attribList.length;i<l;i++){var nv=parser.attribList[i],name=nv[0],value=nv[1],qualName=qname(name,!0),prefix=qualName.prefix,local=qualName.local,uri=""===prefix?"":tag.ns[prefix]||"",a={name:name,value:value,prefix:prefix,local:local,uri:uri};prefix&&"xmlns"!==prefix&&!uri&&(strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(prefix)),a.uri=prefix),parser.tag.attributes[name]=a,emitNode(parser,"onattribute",a)}parser.attribList.length=0}parser.tag.isSelfClosing=!!selfClosing,parser.sawRoot=!0,parser.tags.push(parser.tag),emitNode(parser,"onopentag",parser.tag),selfClosing||(parser.noscript||"script"!==parser.tagName.toLowerCase()?parser.state=S.TEXT:parser.state=S.SCRIPT,parser.tag=null,parser.tagName=""),parser.attribName=parser.attribValue="",parser.attribList.length=0}function closeTag(parser){if(!parser.tagName)return strictFail(parser,"Weird empty close tag."),parser.textNode+="</>",void(parser.state=S.TEXT);if(parser.script){if("script"!==parser.tagName)return parser.script+="</"+parser.tagName+">",parser.tagName="",void(parser.state=S.SCRIPT);emitNode(parser,"onscript",parser.script),parser.script=""}var t=parser.tags.length,tagName=parser.tagName;parser.strict||(tagName=tagName[parser.looseCase]());for(var closeTo=tagName;t--;){if(parser.tags[t].name===closeTo)break;strictFail(parser,"Unexpected close tag")}if(t<0)return strictFail(parser,"Unmatched closing tag: "+parser.tagName),parser.textNode+="</"+parser.tagName+">",void(parser.state=S.TEXT);parser.tagName=tagName;for(var s=parser.tags.length;s-- >t;){var tag=parser.tag=parser.tags.pop();parser.tagName=parser.tag.name,emitNode(parser,"onclosetag",parser.tagName);var x={};for(var i in tag.ns)x[i]=tag.ns[i];var parent=parser.tags[parser.tags.length-1]||parser;parser.opt.xmlns&&tag.ns!==parent.ns&&Object.keys(tag.ns).forEach((function(p){var n=tag.ns[p];emitNode(parser,"onclosenamespace",{prefix:p,uri:n})}))}0===t&&(parser.closedRoot=!0),parser.tagName=parser.attribValue=parser.attribName="",parser.attribList.length=0,parser.state=S.TEXT}function parseEntity(parser){var num,entity=parser.entity,entityLC=entity.toLowerCase(),numStr="";return parser.ENTITIES[entity]?parser.ENTITIES[entity]:parser.ENTITIES[entityLC]?parser.ENTITIES[entityLC]:("#"===(entity=entityLC).charAt(0)&&("x"===entity.charAt(1)?(entity=entity.slice(2),numStr=(num=parseInt(entity,16)).toString(16)):(entity=entity.slice(1),numStr=(num=parseInt(entity,10)).toString(10))),entity=entity.replace(/^0+/,""),numStr.toLowerCase()!==entity?(strictFail(parser,"Invalid character entity"),"&"+parser.entity+";"):String.fromCodePoint(num))}function beginWhiteSpace(parser,c){"<"===c?(parser.state=S.OPEN_WAKA,parser.startTagPosition=parser.position):not(whitespace,c)&&(strictFail(parser,"Non-whitespace before first tag."),parser.textNode=c,parser.state=S.TEXT)}function charAt(chunk,i){var result="";return i<chunk.length&&(result=chunk.charAt(i)),result}S=sax.STATE,String.fromCodePoint||(stringFromCharCode=String.fromCharCode,floor=Math.floor,fromCodePoint=function(){var highSurrogate,lowSurrogate,MAX_SIZE=16384,codeUnits=[],index=-1,length=arguments.length;if(!length)return"";for(var result="";++index<length;){var codePoint=Number(arguments[index]);if(!isFinite(codePoint)||codePoint<0||codePoint>1114111||floor(codePoint)!==codePoint)throw RangeError("Invalid code point: "+codePoint);codePoint<=65535?codeUnits.push(codePoint):(highSurrogate=55296+((codePoint-=65536)>>10),lowSurrogate=codePoint%1024+56320,codeUnits.push(highSurrogate,lowSurrogate)),(index+1===length||codeUnits.length>MAX_SIZE)&&(result+=stringFromCharCode.apply(null,codeUnits),codeUnits.length=0)}return result},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:fromCodePoint,configurable:!0,writable:!0}):String.fromCodePoint=fromCodePoint)}(exports)}).call(this,__webpack_require__(1394).Buffer)},1470:function(module,exports,__webpack_require__){"use strict";exports.byteLength=function byteLength(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function toByteArray(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(function _byteLength(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(0,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},1471:function(module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},1472:function(module,exports,__webpack_require__){module.exports=Stream;var EE=__webpack_require__(1405).EventEmitter;function Stream(){EE.call(this)}__webpack_require__(1384)(Stream,EE),Stream.Readable=__webpack_require__(1406),Stream.Writable=__webpack_require__(1478),Stream.Duplex=__webpack_require__(1479),Stream.Transform=__webpack_require__(1480),Stream.PassThrough=__webpack_require__(1481),Stream.Stream=Stream,Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&!1===options.end||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},1474:function(module,exports,__webpack_require__){"use strict";var Buffer=__webpack_require__(1407).Buffer,util=__webpack_require__(1475);module.exports=function(){function BufferList(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BufferList),this.head=null,this.tail=null,this.length=0}return BufferList.prototype.push=function push(v){var entry={data:v,next:null};this.length>0?this.tail.next=entry:this.head=entry,this.tail=entry,++this.length},BufferList.prototype.unshift=function unshift(v){var entry={data:v,next:this.head};0===this.length&&(this.tail=entry),this.head=entry,++this.length},BufferList.prototype.shift=function shift(){if(0!==this.length){var ret=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},BufferList.prototype.clear=function clear(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function join(s){if(0===this.length)return"";for(var p=this.head,ret=""+p.data;p=p.next;)ret+=s+p.data;return ret},BufferList.prototype.concat=function concat(n){if(0===this.length)return Buffer.alloc(0);if(1===this.length)return this.head.data;for(var src,target,offset,ret=Buffer.allocUnsafe(n>>>0),p=this.head,i=0;p;)src=p.data,target=ret,offset=i,src.copy(target,offset),i+=p.data.length,p=p.next;return ret},BufferList}(),util&&util.inspect&&util.inspect.custom&&(module.exports.prototype[util.inspect.custom]=function(){var obj=util.inspect({length:this.length});return this.constructor.name+" "+obj})},1476:function(module,exports,__webpack_require__){var buffer=__webpack_require__(1394),Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src)dst[key]=src[key]}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow?module.exports=buffer:(copyProps(buffer,exports),exports.Buffer=SafeBuffer),SafeBuffer.prototype=Object.create(Buffer.prototype),copyProps(Buffer,SafeBuffer),SafeBuffer.from=function(arg,encodingOrOffset,length){if("number"==typeof arg)throw new TypeError("Argument must not be a number");return Buffer(arg,encodingOrOffset,length)},SafeBuffer.alloc=function(size,fill,encoding){if("number"!=typeof size)throw new TypeError("Argument must be a number");var buf=Buffer(size);return void 0!==fill?"string"==typeof encoding?buf.fill(fill,encoding):buf.fill(fill):buf.fill(0),buf},SafeBuffer.allocUnsafe=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return Buffer(size)},SafeBuffer.allocUnsafeSlow=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return buffer.SlowBuffer(size)}},1477:function(module,exports,__webpack_require__){"use strict";module.exports=PassThrough;var Transform=__webpack_require__(1430),util=Object.create(__webpack_require__(1387));function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}util.inherits=__webpack_require__(1384),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},1478:function(module,exports,__webpack_require__){module.exports=__webpack_require__(1408)},1479:function(module,exports,__webpack_require__){module.exports=__webpack_require__(1379)},1480:function(module,exports,__webpack_require__){module.exports=__webpack_require__(1406).Transform},1481:function(module,exports,__webpack_require__){module.exports=__webpack_require__(1406).PassThrough},1482:function(module,exports,__webpack_require__){!function(imscHTML,imscNames,imscStyles){function processElement(context,dom_parent,isd_element){var e;if("region"===isd_element.kind)(e=document.createElement("div")).style.position="absolute";else if("body"===isd_element.kind)e=document.createElement("div");else if("div"===isd_element.kind)e=document.createElement("div");else if("image"===isd_element.kind){if(e=document.createElement("img"),null!==context.imgResolver&&null!==isd_element.src){var uri=context.imgResolver(isd_element.src,e);uri&&(e.src=uri),e.height=context.regionH,e.width=context.regionW}}else if("p"===isd_element.kind)e=document.createElement("p");else if("span"===isd_element.kind){if("container"===isd_element.styleAttrs[imscStyles.byName.ruby.qname])e=document.createElement("ruby"),context.ruby=!0;else if("base"===isd_element.styleAttrs[imscStyles.byName.ruby.qname])e=document.createElement("rb");else if("text"===isd_element.styleAttrs[imscStyles.byName.ruby.qname])e=document.createElement("rt");else if("baseContainer"===isd_element.styleAttrs[imscStyles.byName.ruby.qname])e=document.createElement("rbc");else if("textContainer"===isd_element.styleAttrs[imscStyles.byName.ruby.qname])e=document.createElement("rtc");else{if("delimiter"===isd_element.styleAttrs[imscStyles.byName.ruby.qname])return;e=document.createElement("span")}var te=isd_element.styleAttrs[imscStyles.byName.textEmphasis.qname];te&&"none"!==te.style&&(context.textEmphasis=!0)}else"br"===isd_element.kind&&(e=document.createElement("br"));if(e){for(var i in dom_parent.appendChild(e),e.style.margin="0",STYLING_MAP_DEFS){var sm=STYLING_MAP_DEFS[i],attr=isd_element.styleAttrs[sm.qname];void 0!==attr&&null!==sm.map&&sm.map(context,e,isd_element,attr)}var proc_e=e;if("region"===isd_element.kind){var wdir=isd_element.styleAttrs[imscStyles.byName.writingMode.qname];"lrtb"===wdir||"lr"===wdir?(context.ipd="lr",context.bpd="tb"):"rltb"===wdir||"rl"===wdir?(context.ipd="rl",context.bpd="tb"):"tblr"===wdir?(context.ipd="tb",context.bpd="lr"):"tbrl"!==wdir&&"tb"!==wdir||(context.ipd="tb",context.bpd="rl")}var lp=isd_element.styleAttrs[imscStyles.byName.linePadding.qname];if(lp&&!lp.isZero()){var plength=lp.toUsedLength(context.w,context.h);if(plength>0){var padmeasure=Math.ceil(plength)+"px";"tb"===context.bpd?(proc_e.style.paddingLeft=padmeasure,proc_e.style.paddingRight=padmeasure):(proc_e.style.paddingTop=padmeasure,proc_e.style.paddingBottom=padmeasure),context.lp=lp}}var mra=isd_element.styleAttrs[imscStyles.byName.multiRowAlign.qname];if(mra&&"auto"!==mra){var s=document.createElement("span");s.style.display="inline-block",s.style.textAlign=mra,e.appendChild(s),proc_e=s,context.mra=mra}var rr=isd_element.styleAttrs[imscStyles.byName.rubyReserve.qname];if(rr&&"none"!==rr[0]&&(context.rubyReserve=rr),isd_element.styleAttrs[imscStyles.byName.fillLineGap.qname]&&(context.flg=!0),"span"===isd_element.kind&&isd_element.text)if(imscStyles.byName.textCombine.qname in isd_element.styleAttrs&&"all"===isd_element.styleAttrs[imscStyles.byName.textCombine.qname][0])e.textContent=isd_element.text;else for(var cbuf="",j=0;j<isd_element.text.length;j++){cbuf+=isd_element.text.charAt(j);var cc=isd_element.text.charCodeAt(j);if(cc<55296||cc>56319||j===isd_element.text.length){var span=document.createElement("span");span.textContent=cbuf,e.appendChild(span),cbuf=""}}for(var k in isd_element.contents)processElement(context,proc_e,isd_element.contents[k]);var linelist=[];if((context.lp||context.mra||context.flg||context.ruby||context.textEmphasis||context.rubyReserve)&&"p"===isd_element.kind&&(constructLineList(context,proc_e,linelist,null),context.rubyReserve&&(!function applyRubyReserve(lineList,context){for(var i=0;i<lineList.length;i++){var rt1,rt2,ruby=document.createElement("ruby"),rb=document.createElement("rb");rb.textContent="​",ruby.appendChild(rb);var fs=context.rubyReserve[1].toUsedLength(context.w,context.h)+"px";"both"===context.rubyReserve[0]?((rt1=document.createElement("rtc")).style.rubyPosition="under",rt1.textContent="​",rt1.style.fontSize=fs,(rt2=document.createElement("rtc")).style.rubyPosition="over",rt2.textContent="​",rt2.style.fontSize=fs,ruby.appendChild(rt1),ruby.appendChild(rt2)):((rt1=document.createElement("rtc")).textContent="​",rt1.style.fontSize=fs,"after"===context.rubyReserve[0]||"outside"===context.rubyReserve[0]&&i>0?rt1.style.rubyPosition="tb"===context.bpd||"rl"===context.bpd?"under":"over":rt1.style.rubyPosition="tb"===context.bpd||"rl"===context.bpd?"over":"under",ruby.appendChild(rt1));lineList[i].elements[0].node.parentElement.insertBefore(ruby,lineList[i].elements[0].node)}}(linelist,context),context.rubyReserve=null),(context.ruby||context.rubyReserve)&&(!function applyRubyPosition(lineList,context){for(var i=0;i<lineList.length;i++)for(var j=0;j<lineList[i].rbc.length;j++){var pos;if(!lineList[i].rbc[j].style.rubyPosition)pos="tb"===context.bpd?0===i?"over":"under":"rl"===context.bpd?0===i?"over":"under":0===i?"under":"over",lineList[i].rbc[j].style.rubyPosition=pos}}(linelist,context),context.ruby=null),context.textEmphasis&&(!function applyTextEmphasis(lineList,context){for(var i=0;i<lineList.length;i++)for(var j=0;j<lineList[i].te.length;j++){var pos;if(!lineList[i].te[j].style.textEmphasisPosition||"none"===lineList[i].te[j].style.textEmphasisPosition)pos="tb"===context.bpd?0===i?"left over":"left under":"rl"===context.bpd?0===i?"right under":"left under":0===i?"left under":"right under",lineList[i].te[j].style.textEmphasisPosition=pos}}(linelist,context),context.textEmphasis=null),context.mra&&(!function applyMultiRowAlign(lineList){for(var i=0;i<lineList.length-1;i++){var l=lineList[i].elements.length;if(0!==l&&!1===lineList[i].br){var br=document.createElement("br"),lastnode=lineList[i].elements[l-1].node;lastnode.parentElement.insertBefore(br,lastnode.nextSibling)}}}(linelist),context.mra=null),context.lp&&(!function applyLinePadding(lineList,lp,context){for(var i in lineList){var l=lineList[i].elements.length,se=lineList[i].elements[lineList[i].start_elem],ee=lineList[i].elements[lineList[i].end_elem],pospadpxlen=Math.ceil(lp)+"px",negpadpxlen="-"+Math.ceil(lp)+"px";0!==l&&("lr"===context.ipd?(se.node.style.borderLeftColor=se.bgcolor||"#00000000",se.node.style.borderLeftStyle="solid",se.node.style.borderLeftWidth=pospadpxlen,se.node.style.marginLeft=negpadpxlen):"rl"===context.ipd?(se.node.style.borderRightColor=se.bgcolor||"#00000000",se.node.style.borderRightStyle="solid",se.node.style.borderRightWidth=pospadpxlen,se.node.style.marginRight=negpadpxlen):"tb"===context.ipd&&(se.node.style.borderTopColor=se.bgcolor||"#00000000",se.node.style.borderTopStyle="solid",se.node.style.borderTopWidth=pospadpxlen,se.node.style.marginTop=negpadpxlen),"lr"===context.ipd?(ee.node.style.borderRightColor=ee.bgcolor||"#00000000",ee.node.style.borderRightStyle="solid",ee.node.style.borderRightWidth=pospadpxlen,ee.node.style.marginRight=negpadpxlen):"rl"===context.ipd?(ee.node.style.borderLeftColor=ee.bgcolor||"#00000000",ee.node.style.borderLeftStyle="solid",ee.node.style.borderLeftWidth=pospadpxlen,ee.node.style.marginLeft=negpadpxlen):"tb"===context.ipd&&(ee.node.style.borderBottomColor=ee.bgcolor||"#00000000",ee.node.style.borderBottomStyle="solid",ee.node.style.borderBottomWidth=pospadpxlen,ee.node.style.marginBottom=negpadpxlen))}}(linelist,context.lp.toUsedLength(context.w,context.h),context),context.lp=null),context.flg)){var par_edges=rect2edges(proc_e.getBoundingClientRect(),context);!function applyFillLineGap(lineList,par_before,par_after,context){for(var s=Math.sign(par_after-par_before),i=0;i<=lineList.length;i++){var frontier,pad,e;if(frontier=0===i?par_before:i===lineList.length?par_after:(lineList[i].before+lineList[i-1].after)/2,i>0)for(var j=0;j<lineList[i-1].elements.length;j++)null!==lineList[i-1].elements[j].bgcolor&&(e=lineList[i-1].elements[j],s*(e.after-frontier)<0&&(pad=Math.ceil(Math.abs(frontier-e.after))+"px",e.node.style.backgroundColor=e.bgcolor,"lr"===context.bpd?e.node.style.paddingRight=pad:"rl"===context.bpd?e.node.style.paddingLeft=pad:"tb"===context.bpd&&(e.node.style.paddingBottom=pad)));if(i<lineList.length)for(var k=0;k<lineList[i].elements.length;k++)null!==(e=lineList[i].elements[k]).bgcolor&&s*(e.before-frontier)>0&&(pad=Math.ceil(Math.abs(e.before-frontier))+"px",e.node.style.backgroundColor=e.bgcolor,"lr"===context.bpd?e.node.style.paddingLeft=pad:"rl"===context.bpd?e.node.style.paddingRight=pad:"tb"===context.bpd&&(e.node.style.paddingTop=pad))}}(linelist,par_edges.before,par_edges.after,context),context.flg=null}if("region"===isd_element.kind&&(constructLineList(context,proc_e,linelist),"tb"===context.bpd&&context.enableRollUp&&isd_element.contents.length>0&&"after"===isd_element.styleAttrs[imscStyles.byName.displayAlign.qname])){var rb=new RegionPBuffer(""===isd_element.id?"_":isd_element.id,linelist);if(context.currentISDState[rb.id]=rb,context.previousISDState&&rb.id in context.previousISDState&&context.previousISDState[rb.id].plist.length>0&&rb.plist.length>1&&rb.plist[rb.plist.length-2].text===context.previousISDState[rb.id].plist[context.previousISDState[rb.id].plist.length-1].text){var body_elem=e.firstElementChild,h=rb.plist[rb.plist.length-1].after-rb.plist[rb.plist.length-1].before;body_elem.style.bottom="-"+h+"px",body_elem.style.transition="transform 0.4s",body_elem.style.position="relative",body_elem.style.transform="translateY(-"+h+"px)"}}}else(function reportError(errorHandler,msg){if(errorHandler&&errorHandler.error&&errorHandler.error(msg))throw msg})(context.errorHandler,"Error processing ISD element kind: "+isd_element.kind)}function RegionPBuffer(id,lineList){this.id=id,this.plist=lineList}function rect2edges(rect,context){var edges={before:null,after:null,start:null,end:null};return"tb"===context.bpd?(edges.before=rect.top,edges.after=rect.bottom,"lr"===context.ipd?(edges.start=rect.left,edges.end=rect.right):(edges.start=rect.right,edges.end=rect.left)):"lr"===context.bpd?(edges.before=rect.left,edges.after=rect.right,edges.start=rect.top,edges.end=rect.bottom):"rl"===context.bpd&&(edges.before=rect.right,edges.after=rect.left,edges.start=rect.top,edges.end=rect.bottom),edges}function constructLineList(context,element,llist,bgcolor){if("rt"!==element.localName&&"rtc"!==element.localName){var curbgcolor=element.style.backgroundColor||bgcolor;if(0===element.childElementCount)if("span"===element.localName||"rb"===element.localName){var r=element.getBoundingClientRect();if(0===r.height||0===r.width)return;var edges=rect2edges(r,context);if(0!==llist.length&&function isSameLine(before1,after1,before2,after2){return after1<after2&&before1>before2||after2<=after1&&before2>=before1}(edges.before,edges.after,llist[llist.length-1].before,llist[llist.length-1].after)){var bpd_dir=Math.sign(edges.after-edges.before),ipd_dir=Math.sign(edges.end-edges.start);bpd_dir*(edges.before-llist[llist.length-1].before)<0&&(llist[llist.length-1].before=edges.before),bpd_dir*(edges.after-llist[llist.length-1].after)>0&&(llist[llist.length-1].after=edges.after),ipd_dir*(edges.start-llist[llist.length-1].start)<0&&(llist[llist.length-1].start=edges.start,llist[llist.length-1].start_elem=llist[llist.length-1].elements.length),ipd_dir*(edges.end-llist[llist.length-1].end)>0&&(llist[llist.length-1].end=edges.end,llist[llist.length-1].end_elem=llist[llist.length-1].elements.length)}else llist.push({before:edges.before,after:edges.after,start:edges.start,end:edges.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1});llist[llist.length-1].text+=element.textContent,llist[llist.length-1].elements.push({node:element,bgcolor:curbgcolor,before:edges.before,after:edges.after})}else"br"===element.localName&&0!==llist.length&&(llist[llist.length-1].br=!0);else for(var child=element.firstChild;child;)child.nodeType===Node.ELEMENT_NODE&&(constructLineList(context,child,llist,curbgcolor),"ruby"===child.localName||"rtc"===child.localName?llist.length>0&&llist[llist.length-1].rbc.push(child):"span"===child.localName&&child.style.textEmphasisStyle&&"none"!==child.style.textEmphasisStyle&&llist.length>0&&llist[llist.length-1].te.push(child)),child=child.nextSibling}}function HTMLStylingMapDefintion(qName,mapFunc){this.qname=qName,this.map=mapFunc}imscHTML.render=function(isd,element,imgResolver,eheight,ewidth,displayForcedOnlyMode,errorHandler,previousISDState,enableRollUp){var height=eheight||element.clientHeight,width=ewidth||element.clientWidth;if(null!==isd.aspectRatio){var twidth=height*isd.aspectRatio;twidth>width?height=Math.round(width/isd.aspectRatio):width=twidth}var rootcontainer=document.createElement("div");rootcontainer.style.position="relative",rootcontainer.style.width=width+"px",rootcontainer.style.height=height+"px",rootcontainer.style.margin="auto",rootcontainer.style.top=0,rootcontainer.style.bottom=0,rootcontainer.style.left=0,rootcontainer.style.right=0,rootcontainer.style.zIndex=0;var context={h:height,w:width,regionH:null,regionW:null,imgResolver:imgResolver,displayForcedOnlyMode:displayForcedOnlyMode||!1,isd:isd,errorHandler:errorHandler,previousISDState:previousISDState,enableRollUp:enableRollUp||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};for(var i in element.appendChild(rootcontainer),isd.contents)processElement(context,rootcontainer,isd.contents[i]);return context.currentISDState};var STYLING_MAP_DEFS=[new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling backgroundColor",(function(context,dom_element,isd_element,attr){0!==attr[3]&&(dom_element.style.backgroundColor="rgba("+attr[0].toString()+","+attr[1].toString()+","+attr[2].toString()+","+(attr[3]/255).toString()+")")})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling color",(function(context,dom_element,isd_element,attr){dom_element.style.color="rgba("+attr[0].toString()+","+attr[1].toString()+","+attr[2].toString()+","+(attr[3]/255).toString()+")"})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling direction",(function(context,dom_element,isd_element,attr){dom_element.style.direction=attr})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling display",(function(context,dom_element,isd_element,attr){})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling displayAlign",(function(context,dom_element,isd_element,attr){dom_element.style.display="flex",dom_element.style.flexDirection="column","before"===attr?dom_element.style.justifyContent="flex-start":"center"===attr?dom_element.style.justifyContent="center":"after"===attr&&(dom_element.style.justifyContent="flex-end")})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling extent",(function(context,dom_element,isd_element,attr){context.regionH=attr.h.toUsedLength(context.w,context.h),context.regionW=attr.w.toUsedLength(context.w,context.h);var hdelta=0,wdelta=0,p=isd_element.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];p&&(hdelta=p[0].toUsedLength(context.w,context.h)+p[2].toUsedLength(context.w,context.h),wdelta=p[1].toUsedLength(context.w,context.h)+p[3].toUsedLength(context.w,context.h)),dom_element.style.height=context.regionH-hdelta+"px",dom_element.style.width=context.regionW-wdelta+"px"})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling fontFamily",(function(context,dom_element,isd_element,attr){var rslt=[];for(var i in attr)"monospaceSerif"===attr[i]?(rslt.push("Courier New"),rslt.push('"Liberation Mono"'),rslt.push("Courier"),rslt.push("monospace")):"proportionalSansSerif"===attr[i]?(rslt.push("Arial"),rslt.push("Helvetica"),rslt.push('"Liberation Sans"'),rslt.push("sans-serif")):"monospace"===attr[i]?rslt.push("monospace"):"sansSerif"===attr[i]?rslt.push("sans-serif"):"serif"===attr[i]?rslt.push("serif"):"monospaceSansSerif"===attr[i]?(rslt.push("Consolas"),rslt.push("monospace")):"proportionalSerif"===attr[i]?rslt.push("serif"):rslt.push(attr[i]);dom_element.style.fontFamily=rslt.join(",")})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling shear",(function(context,dom_element,isd_element,attr){if(0!==attr){var angle=-.9*attr;"tb"===context.bpd?dom_element.style.transform="skewX("+angle+"deg)":dom_element.style.transform="skewY("+angle+"deg)"}})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling fontSize",(function(context,dom_element,isd_element,attr){dom_element.style.fontSize=attr.toUsedLength(context.w,context.h)+"px"})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling fontStyle",(function(context,dom_element,isd_element,attr){dom_element.style.fontStyle=attr})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling fontWeight",(function(context,dom_element,isd_element,attr){dom_element.style.fontWeight=attr})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling lineHeight",(function(context,dom_element,isd_element,attr){dom_element.style.lineHeight="normal"===attr?"normal":attr.toUsedLength(context.w,context.h)+"px"})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling opacity",(function(context,dom_element,isd_element,attr){dom_element.style.opacity=attr})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling origin",(function(context,dom_element,isd_element,attr){dom_element.style.top=attr.h.toUsedLength(context.w,context.h)+"px",dom_element.style.left=attr.w.toUsedLength(context.w,context.h)+"px"})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling overflow",(function(context,dom_element,isd_element,attr){dom_element.style.overflow=attr})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling padding",(function(context,dom_element,isd_element,attr){var rslt=[];rslt[0]=attr[0].toUsedLength(context.w,context.h)+"px",rslt[1]=attr[3].toUsedLength(context.w,context.h)+"px",rslt[2]=attr[2].toUsedLength(context.w,context.h)+"px",rslt[3]=attr[1].toUsedLength(context.w,context.h)+"px",dom_element.style.padding=rslt.join(" ")})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling position",(function(context,dom_element,isd_element,attr){dom_element.style.top=attr.h.toUsedLength(context.w,context.h)+"px",dom_element.style.left=attr.w.toUsedLength(context.w,context.h)+"px"})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling rubyAlign",(function(context,dom_element,isd_element,attr){dom_element.style.rubyAlign=attr})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling rubyPosition",(function(context,dom_element,isd_element,attr){var pos;"before"!==attr&&"after"!==attr||(pos="tb"===context.bpd?"before"===attr?"over":"under":"rl"===context.bpd?"before"===attr?"over":"under":"before"===attr?"under":"over",dom_element.parentElement.style.rubyPosition=pos)})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling showBackground",null),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling textAlign",(function(context,dom_element,isd_element,attr){var ta,dir=isd_element.styleAttrs[imscStyles.byName.direction.qname];ta="start"===attr?"rtl"===dir?"right":"left":"end"===attr?"rtl"===dir?"left":"right":attr,dom_element.style.textAlign=ta})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling textDecoration",(function(context,dom_element,isd_element,attr){dom_element.style.textDecoration=attr.join(" ").replace("lineThrough","line-through")})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling textOutline",(function(context,dom_element,isd_element,attr){})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling textShadow",(function(context,dom_element,isd_element,attr){var txto=isd_element.styleAttrs[imscStyles.byName.textOutline.qname];if("none"===attr&&"none"===txto)dom_element.style.textShadow="";else{var s=[];if("none"!==txto&&s.push("rgba("+txto.color[0].toString()+","+txto.color[1].toString()+","+txto.color[2].toString()+","+(txto.color[3]/255).toString()+") 0px 0px "+txto.thickness.toUsedLength(context.w,context.h)+"px"),"none"!==attr)for(var i in attr)s.push(attr[i].x_off.toUsedLength(context.w,context.h)+"px "+attr[i].y_off.toUsedLength(context.w,context.h)+"px "+attr[i].b_radius.toUsedLength(context.w,context.h)+"px rgba("+attr[i].color[0].toString()+","+attr[i].color[1].toString()+","+attr[i].color[2].toString()+","+(attr[i].color[3]/255).toString()+")");dom_element.style.textShadow=s.join(",")}})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling textCombine",(function(context,dom_element,isd_element,attr){dom_element.style.textCombineUpright=attr.join(" ")})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling textEmphasis",(function(context,dom_element,isd_element,attr){var pos;"none"!==attr.style?("auto"===attr.style?dom_element.style.textEmphasisStyle="filled":dom_element.style.textEmphasisStyle=attr.style+" "+attr.symbol,("before"===attr.position||"after"===attr.position)&&(pos="tb"===context.bpd?"before"===attr.position?"left over":"left under":"rl"===context.bpd?"before"===attr.position?"right under":"left under":"before"===attr.position?"left under":"right under",dom_element.style.textEmphasisPosition=pos)):dom_element.style.textEmphasisStyle="none"})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling unicodeBidi",(function(context,dom_element,isd_element,attr){var ub;ub="bidiOverride"===attr?"bidi-override":attr,dom_element.style.unicodeBidi=ub})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling visibility",(function(context,dom_element,isd_element,attr){dom_element.style.visibility=attr})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling wrapOption",(function(context,dom_element,isd_element,attr){"wrap"===attr?"preserve"===isd_element.space?dom_element.style.whiteSpace="pre-wrap":dom_element.style.whiteSpace="normal":"preserve"===isd_element.space?dom_element.style.whiteSpace="pre":dom_element.style.whiteSpace="noWrap"})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling writingMode",(function(context,dom_element,isd_element,attr){"lrtb"===attr||"lr"===attr?context.writingMode="horizontal-tb":"rltb"===attr||"rl"===attr?context.writingMode="horizontal-tb":"tblr"===attr?context.writingMode="vertical-lr":"tbrl"!==attr&&"tb"!==attr||(context.writingMode="vertical-rl"),dom_element.style.writingMode=context.writingMode})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml#styling zIndex",(function(context,dom_element,isd_element,attr){dom_element.style.zIndex=attr})),new HTMLStylingMapDefintion("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",(function(context,dom_element,isd_element,attr){context.displayForcedOnlyMode&&!1===attr&&(dom_element.style.visibility="hidden")}))],STYLMAP_BY_QNAME={};for(var i in STYLING_MAP_DEFS)STYLMAP_BY_QNAME[STYLING_MAP_DEFS[i].qname]=STYLING_MAP_DEFS[i]}(exports,"undefined"==typeof imscNames?__webpack_require__(1392):imscNames,"undefined"==typeof imscStyles?__webpack_require__(1404):imscStyles,"undefined"==typeof imscUtils?__webpack_require__(1393):imscUtils)},1483:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function EmbeddedTextHtmlRender(){var captionId=0;function checkIndent(chars){for(var line="",c=0;c<chars.length;++c){line+=chars[c].uchar}return line.length-line.replace(/^\s+/,"").length}function getRegionProperties(region){return"left: "+3.125*region.x+"%; top: "+6.66*region.y1+"%; width: "+(100-3.125*region.x)+"%; height: "+6.66*Math.max(region.y2-1-region.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function createRGB(color){return"red"===color?"rgb(255, 0, 0)":"green"===color?"rgb(0, 255, 0)":"blue"===color?"rgb(0, 0, 255)":"cyan"===color?"rgb(0, 255, 255)":"magenta"===color?"rgb(255, 0, 255)":"yellow"===color?"rgb(255, 255, 0)":"white"===color?"rgb(255, 255, 255)":"black"===color?"rgb(0, 0, 0)":color}function getStyle(videoElement,style){var fontSize=videoElement.videoHeight/15;return style?"font-size: "+fontSize+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(style.foreground?createRGB(style.foreground):"rgb(255, 255, 255)")+"; font-style: "+(style.italics?"italic":"normal")+"; text-decoration: "+(style.underline?"underline":"none")+"; white-space: pre; background-color: "+(style.background?createRGB(style.background):"transparent")+";":"font-size: "+fontSize+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function ltrim(s){return s.replace(/^\s+/g,"")}function rtrim(s){return s.replace(/\s+$/g,"")}return{createHTMLCaptionsFromScreen:function createHTMLCaptionsFromScreen(videoElement,startTime,endTime,captionScreen){var currRegion=null,lastRowHasText=!1,lastRowIndentL=-1,currP={start:startTime,end:endTime,spans:[]},currentStyle="style_cea608_white_black",seenRegions={},styleStates={},regions=[],r=void 0,s=void 0;for(r=0;r<15;++r){var row=captionScreen.rows[r],line="",prevPenState=null;if(!1===row.isEmpty()){var rowIndent=checkIndent(row.chars);null===currRegion&&(currRegion={x:rowIndent,y1:r,y2:r+1,p:[]}),rowIndent!==lastRowIndentL&&lastRowHasText&&(currRegion.p.push(currP),currP={start:startTime,end:endTime,spans:[]},currRegion.y2=r,currRegion.name="region_"+currRegion.x+"_"+currRegion.y1+"_"+currRegion.y2,!1===seenRegions.hasOwnProperty(currRegion.name)?(regions.push(currRegion),seenRegions[currRegion.name]=currRegion):seenRegions[currRegion.name].p.contat(currRegion.p),currRegion={x:rowIndent,y1:r,y2:r+1,p:[]});for(var c=0;c<row.chars.length;++c){var uc=row.chars[c],currPenState=uc.penState;if(null===prevPenState||!currPenState.equals(prevPenState)){line.trim().length>0&&(currP.spans.push({name:currentStyle,line:line,row:r}),line="");var currPenStateString="style_cea608_"+currPenState.foreground+"_"+currPenState.background;currPenState.underline&&(currPenStateString+="_underline"),currPenState.italics&&(currPenStateString+="_italics"),styleStates.hasOwnProperty(currPenStateString)||(styleStates[currPenStateString]=JSON.parse(JSON.stringify(currPenState))),prevPenState=currPenState,currentStyle=currPenStateString}line+=uc.uchar}line.trim().length>0&&currP.spans.push({name:currentStyle,line:line,row:r}),lastRowHasText=!0,lastRowIndentL=rowIndent}else lastRowHasText=!1,lastRowIndentL=-1,currRegion&&(currRegion.p.push(currP),currP={start:startTime,end:endTime,spans:[]},currRegion.y2=r,currRegion.name="region_"+currRegion.x+"_"+currRegion.y1+"_"+currRegion.y2,!1===seenRegions.hasOwnProperty(currRegion.name)?(regions.push(currRegion),seenRegions[currRegion.name]=currRegion):seenRegions[currRegion.name].p.contat(currRegion.p),currRegion=null)}currRegion&&(currRegion.p.push(currP),currRegion.y2=r+1,currRegion.name="region_"+currRegion.x+"_"+currRegion.y1+"_"+currRegion.y2,!1===seenRegions.hasOwnProperty(currRegion.name)?(regions.push(currRegion),seenRegions[currRegion.name]=currRegion):seenRegions[currRegion.name].p.contat(currRegion.p),currRegion=null);var captionsArray=[];for(r=0;r<regions.length;++r){var region=regions[r],cueID="sub_cea608_"+captionId++,finalDiv=document.createElement("div");finalDiv.id=cueID;var cueRegionProperties=getRegionProperties(region);finalDiv.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+cueRegionProperties;var bodyDiv=document.createElement("div");bodyDiv.className="paragraph bodyStyle",bodyDiv.style.cssText=getStyle(videoElement);var cueUniWrapper=document.createElement("div");cueUniWrapper.className="cueUniWrapper",cueUniWrapper.style.cssText="unicode-bidi: normal; direction: ltr;";for(var p=0;p<region.p.length;++p){var ptag=region.p[p],lastSpanRow=0;for(s=0;s<ptag.spans.length;++s){var span=ptag.spans[s];if(span.line.length>0){if(0!==s&&lastSpanRow!=span.row){var brElement=document.createElement("br");brElement.className="lineBreak",cueUniWrapper.appendChild(brElement)}var sameRow=!1;lastSpanRow===span.row&&(sameRow=!0),lastSpanRow=span.row;var spanStyle=styleStates[span.name],spanElement=document.createElement("span");spanElement.className="spanPadding "+span.name+" customSpanColor",spanElement.style.cssText=getStyle(videoElement,spanStyle),0!==s&&sameRow?s===ptag.spans.length-1?spanElement.textContent=rtrim(span.line):spanElement.textContent=span.line:ptag.spans.length>1&&s<ptag.spans.length-1&&span.row===ptag.spans[s+1].row?spanElement.textContent=ltrim(span.line):spanElement.textContent=span.line.trim(),cueUniWrapper.appendChild(spanElement)}}}bodyDiv.appendChild(cueUniWrapper),finalDiv.appendChild(bodyDiv);var fontSize={bodyStyle:["%",90]};for(var _s in styleStates)styleStates.hasOwnProperty(_s)&&(fontSize[_s]=["%",90]);captionsArray.push({type:"html",start:startTime,end:endTime,cueHTMLElement:finalDiv,cueID:cueID,cellResolution:[32,15],isFromCEA608:!0,fontSize:fontSize,lineHeight:{},linePadding:{}})}return captionsArray}}}EmbeddedTextHtmlRender.__dashjs_factory_name="EmbeddedTextHtmlRender",exports.default=_coreFactoryMaker2.default.getSingletonFactory(EmbeddedTextHtmlRender),module.exports=exports.default},1484:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function VTTParser(){var context=this.context,instance=void 0,logger=void 0,regExNewLine=void 0,regExToken=void 0,regExWhiteSpace=void 0,regExWhiteSpaceWordBoundary=void 0;function convertCuePointTimes(time){var timeArray=time.split(":"),len=timeArray.length-1;return time=60*parseInt(timeArray[len-1],10)+parseFloat(timeArray[len]),2===len&&(time+=3600*parseInt(timeArray[0],10)),time}function parseItemAttributes(data){var vttCuePoints=data.split(regExToken),arr=vttCuePoints[1].split(regExWhiteSpaceWordBoundary);return arr.shift(),vttCuePoints[1]=arr[0],arr.shift(),{cuePoints:vttCuePoints,styles:getCaptionStyles(arr)}}function getCaptionStyles(arr){var styleObject={};return arr.forEach((function(element){if(element.split(/:/).length>1){var val=element.split(/:/)[1];val&&-1!=val.search(/%/)&&(val=parseInt(val.replace(/%/,""),10)),(element.match(/align/)||element.match(/A/))&&(styleObject.align=val),(element.match(/line/)||element.match(/L/))&&(styleObject.line=val),(element.match(/position/)||element.match(/P/))&&(styleObject.position=val),(element.match(/size/)||element.match(/S/))&&(styleObject.size=val)}})),styleObject}function getSublines(data,idx){for(var lineCount,i=idx,subline="",lineData="";""!==data[i]&&i<data.length;)i++;if((lineCount=i-idx)>1)for(var j=0;j<lineCount;j++){if((lineData=data[idx+j]).match(regExToken)){subline="";break}subline+=lineData,j!==lineCount-1&&(subline+="\n")}else(lineData=data[idx]).match(regExToken)||(subline=lineData);return subline}return instance={parse:function parse(data){var len,captionArray=[],lastStartTime=void 0;if(!data)return captionArray;len=(data=data.split(regExNewLine)).length,lastStartTime=-1;for(var i=0;i<len;i++){var item=data[i];if(item.length>0&&"WEBVTT"!==item&&item.match(regExToken)){var attributes=parseItemAttributes(item),cuePoints=attributes.cuePoints,styles=attributes.styles,text=getSublines(data,i+1),startTime=convertCuePointTimes(cuePoints[0].replace(regExWhiteSpace,"")),endTime=convertCuePointTimes(cuePoints[1].replace(regExWhiteSpace,""));!isNaN(startTime)&&!isNaN(endTime)&&startTime>=lastStartTime&&endTime>startTime?""!==text?(lastStartTime=startTime,captionArray.push({start:startTime,end:endTime,data:text,styles:styles})):logger.error("Skipping cue due to empty/malformed cue text"):logger.error("Skipping cue due to incorrect cue timing")}}return captionArray}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),regExNewLine=/(?:\r\n|\r|\n)/gm,regExToken=/-->/,regExWhiteSpace=/(^[\s]+|[\s]+$)/g,regExWhiteSpaceWordBoundary=/\s\b/g}(),instance}VTTParser.__dashjs_factory_name="VTTParser",exports.default=_coreFactoryMaker2.default.getSingletonFactory(VTTParser),module.exports=exports.default},1485:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_imsc=__webpack_require__(1425);function TTMLParser(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,cueCounter=0;return instance={parse:function parse(data,offsetTime,startTimeSegment,endTimeSegment,images){var errorMsg="",captionArray=[],startTime=void 0,endTime=void 0,i=void 0,content={},embeddedImages={},currentImageId="",accumulated_image_data="",metadataHandler={onOpenTag:function onOpenTag(ns,name,attrs){if("image"===name&&"http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===ns){if(!attrs[" imagetype"]||"PNG"!==attrs[" imagetype"].value)return void logger.warn("smpte-tt imagetype != PNG. Discarded");currentImageId=attrs["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function onCloseTag(){currentImageId&&(embeddedImages[currentImageId]=accumulated_image_data.trim()),accumulated_image_data="",currentImageId=""},onText:function onText(contents){currentImageId&&(accumulated_image_data+=contents)}};if(!data)throw errorMsg="no ttml data to parse",new Error(errorMsg);content.data=data,eventBus.trigger(_coreEventsEvents2.default.TTML_TO_PARSE,content);var imsc1doc=(0,_imsc.fromXML)(content.data,(function(msg){errorMsg=msg}),metadataHandler);eventBus.trigger(_coreEventsEvents2.default.TTML_PARSED,{ttmlString:content.data,ttmlDoc:imsc1doc});var id,mediaTimeEvents=imsc1doc.getMediaTimeEvents();for(i=0;i<mediaTimeEvents.length;i++){var isd=(0,_imsc.generateISD)(imsc1doc,mediaTimeEvents[i],(function(error){errorMsg=error}));isd.contents.some((function(topLevelContents){return topLevelContents.contents.length}))&&(startTime=mediaTimeEvents[i]+offsetTime<startTimeSegment?startTimeSegment:mediaTimeEvents[i]+offsetTime)<(endTime=mediaTimeEvents[i+1]+offsetTime>endTimeSegment?endTimeSegment:mediaTimeEvents[i+1]+offsetTime)&&captionArray.push({start:startTime,end:endTime,type:"html",cueID:(id=void 0,id="cue_TTML_"+cueCounter,cueCounter++,id),isd:isd,images:images,embeddedImages:embeddedImages})}if(""!==errorMsg)throw logger.error(errorMsg),new Error(errorMsg);return captionArray}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}TTMLParser.__dashjs_factory_name="TTMLParser",exports.default=_coreFactoryMaker2.default.getSingletonFactory(TTMLParser),module.exports=exports.default},1486:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366));function PreBufferSink(onAppendedCallback){var context=this.context,instance=void 0,logger=void 0,outstandingInit=void 0,chunks=[],onAppended=onAppendedCallback;function remove(start,end){chunks=chunks.filter((function(a){return!((isNaN(end)||a.start<end)&&(isNaN(start)||a.end>start))}))}return instance={getAllBufferRanges:function getAllBufferRanges(){for(var ranges=[],i=0;i<chunks.length;i++){var chunk=chunks[i];0===ranges.length||chunk.start>ranges[ranges.length-1].end?ranges.push({start:chunk.start,end:chunk.end}):ranges[ranges.length-1].end=chunk.end}var timeranges={start:function start(n){return ranges[n].start},end:function end(n){return ranges[n].end}};return Object.defineProperty(timeranges,"length",{get:function get(){return ranges.length}}),timeranges},append:function append(chunk){"InitializationSegment"!==chunk.segmentType?(chunks.push(chunk),chunks.sort((function(a,b){return a.start-b.start})),outstandingInit=null):outstandingInit=chunk,logger.debug("PreBufferSink appended chunk s: "+chunk.start+"; e: "+chunk.end),onAppended&&onAppended({chunk:chunk})},remove:remove,abort:function abort(){},discharge:function discharge(start,end){var result=function getChunksAt(start,end){return chunks.filter((function(a){return(isNaN(end)||a.start<end)&&(isNaN(start)||a.end>start)}))}(start,end);return outstandingInit&&(result.push(outstandingInit),outstandingInit=null),remove(start,end),result},reset:function reset(){chunks=[],outstandingInit=null,onAppended=null},updateTimestampOffset:function updateTimestampOffset(){},hasDiscontinuitiesAfter:function hasDiscontinuitiesAfter(){return!1}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}PreBufferSink.__dashjs_factory_name="PreBufferSink";var factory=_coreFactoryMaker2.default.getClassFactory(PreBufferSink);exports.default=factory,module.exports=exports.default},1487:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _controllersBufferController2=_interopRequireDefault(__webpack_require__(1377)),_controllersAbrController2=_interopRequireDefault(__webpack_require__(1396)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_SwitchRequest2=_interopRequireDefault(__webpack_require__(1375)),_constantsConstants2=_interopRequireDefault(__webpack_require__(1367));function ThroughputRule(config){config=config||{};var context=this.context,metricsModel=config.metricsModel,instance=void 0,logger=void 0;return instance={getMaxIndex:function getMaxIndex(rulesContext){var switchRequest=(0,_SwitchRequest2.default)(context).create();if(!(rulesContext&&rulesContext.hasOwnProperty("getMediaInfo")&&rulesContext.hasOwnProperty("getMediaType")&&rulesContext.hasOwnProperty("useBufferOccupancyABR")&&rulesContext.hasOwnProperty("getAbrController")&&rulesContext.hasOwnProperty("getScheduleController")))return switchRequest;!function checkConfig(){if(!metricsModel||!metricsModel.hasOwnProperty("getReadOnlyMetricsFor"))throw new Error(_constantsConstants2.default.MISSING_CONFIG_ERROR)}();var mediaInfo=rulesContext.getMediaInfo(),mediaType=rulesContext.getMediaType(),metrics=metricsModel.getReadOnlyMetricsFor(mediaType),scheduleController=rulesContext.getScheduleController(),abrController=rulesContext.getAbrController(),streamInfo=rulesContext.getStreamInfo(),isDynamic=streamInfo&&streamInfo.manifestInfo?streamInfo.manifestInfo.isDynamic:null,throughputHistory=abrController.getThroughputHistory(),throughput=throughputHistory.getSafeAverageThroughput(mediaType,isDynamic),latency=throughputHistory.getAverageLatency(mediaType),bufferStateVO=metrics.BufferState.length>0?metrics.BufferState[metrics.BufferState.length-1]:null,useBufferOccupancyABR=rulesContext.useBufferOccupancyABR();return!metrics||isNaN(throughput)||!bufferStateVO||useBufferOccupancyABR?switchRequest:(abrController.getAbandonmentStateFor(mediaType)!==_controllersAbrController2.default.ABANDON_LOAD&&(bufferStateVO.state===_controllersBufferController2.default.BUFFER_LOADED||isDynamic)&&(switchRequest.quality=abrController.getQualityForBitrate(mediaInfo,throughput,latency),scheduleController.setTimeToLoadDelay(0),logger.debug("requesting switch to index: ",switchRequest.quality,"type: ",mediaType,"Average throughput",Math.round(throughput),"kbps"),switchRequest.reason={throughput:throughput,latency:latency}),switchRequest)},reset:function reset(){}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}ThroughputRule.__dashjs_factory_name="ThroughputRule",exports.default=_coreFactoryMaker2.default.getClassFactory(ThroughputRule),module.exports=exports.default},1488:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _controllersBufferController2=_interopRequireDefault(__webpack_require__(1377)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_SwitchRequest2=_interopRequireDefault(__webpack_require__(1375)),_constantsConstants2=_interopRequireDefault(__webpack_require__(1367));function InsufficientBufferRule(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),metricsModel=config.metricsModel,dashMetrics=config.dashMetrics,instance=void 0,logger=void 0,bufferStateDict=void 0;function resetInitialSettings(){bufferStateDict={}}function onPlaybackSeeking(){resetInitialSettings()}return instance={getMaxIndex:function getMaxIndex(rulesContext){var switchRequest=(0,_SwitchRequest2.default)(context).create();if(!rulesContext||!rulesContext.hasOwnProperty("getMediaType"))return switchRequest;!function checkConfig(){if(!(metricsModel&&metricsModel.hasOwnProperty("getReadOnlyMetricsFor")&&dashMetrics&&dashMetrics.hasOwnProperty("getCurrentBufferLevel")))throw new Error(_constantsConstants2.default.MISSING_CONFIG_ERROR)}();var mediaType=rulesContext.getMediaType(),metrics=metricsModel.getReadOnlyMetricsFor(mediaType),lastBufferStateVO=metrics.BufferState.length>0?metrics.BufferState[metrics.BufferState.length-1]:null,fragmentDuration=rulesContext.getRepresentationInfo().fragmentDuration;if(!lastBufferStateVO||!function wasFirstBufferLoadedEventTriggered(mediaType,currentBufferState){bufferStateDict[mediaType]=bufferStateDict[mediaType]||{};var wasTriggered=!1;bufferStateDict[mediaType].firstBufferLoadedEvent?wasTriggered=!0:currentBufferState&&currentBufferState.state===_controllersBufferController2.default.BUFFER_LOADED&&(bufferStateDict[mediaType].firstBufferLoadedEvent=!0,wasTriggered=!0);return wasTriggered}(mediaType,lastBufferStateVO)||!fragmentDuration)return switchRequest;if(lastBufferStateVO.state===_controllersBufferController2.default.BUFFER_EMPTY)logger.debug("Switch to index 0; buffer is empty."),switchRequest.quality=0,switchRequest.reason="InsufficientBufferRule: Buffer is empty";else{var mediaInfo=rulesContext.getMediaInfo(),abrController=rulesContext.getAbrController(),throughputHistory=abrController.getThroughputHistory(),bufferLevel=dashMetrics.getCurrentBufferLevel(metrics),throughput=throughputHistory.getAverageThroughput(mediaType),latency=throughputHistory.getAverageLatency(mediaType),bitrate=throughput*(bufferLevel/fragmentDuration)*.5;switchRequest.quality=abrController.getQualityForBitrate(mediaInfo,bitrate,latency),switchRequest.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return switchRequest},reset:function reset(){resetInitialSettings(),eventBus.off(_coreEventsEvents2.default.PLAYBACK_SEEKING,onPlaybackSeeking,instance)}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),resetInitialSettings(),eventBus.on(_coreEventsEvents2.default.PLAYBACK_SEEKING,onPlaybackSeeking,instance)}(),instance}InsufficientBufferRule.__dashjs_factory_name="InsufficientBufferRule",exports.default=_coreFactoryMaker2.default.getClassFactory(InsufficientBufferRule),module.exports=exports.default},1489:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _SwitchRequest2=_interopRequireDefault(__webpack_require__(1375)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function AbandonRequestsRule(config){config=config||{};var context=this.context,mediaPlayerModel=config.mediaPlayerModel,metricsModel=config.metricsModel,dashMetrics=config.dashMetrics,instance=void 0,logger=void 0,fragmentDict=void 0,abandonDict=void 0,throughputArray=void 0;function reset(){fragmentDict={},abandonDict={},throughputArray=[]}return instance={shouldAbandon:function shouldAbandon(rulesContext){var switchRequest=(0,_SwitchRequest2.default)(context).create(_SwitchRequest2.default.NO_CHANGE,{name:AbandonRequestsRule.__dashjs_factory_name});if(!(rulesContext&&rulesContext.hasOwnProperty("getMediaInfo")&&rulesContext.hasOwnProperty("getMediaType")&&rulesContext.hasOwnProperty("getCurrentRequest")&&rulesContext.hasOwnProperty("getRepresentationInfo")&&rulesContext.hasOwnProperty("getAbrController")))return switchRequest;var mediaInfo=rulesContext.getMediaInfo(),mediaType=rulesContext.getMediaType(),req=rulesContext.getCurrentRequest();if(!isNaN(req.index)){!function setFragmentRequestDict(type,id){fragmentDict[type]=fragmentDict[type]||{},fragmentDict[type][id]=fragmentDict[type][id]||{}}(mediaType,req.index);var stableBufferTime=mediaPlayerModel.getStableBufferTime();if(dashMetrics.getCurrentBufferLevel(metricsModel.getReadOnlyMetricsFor(mediaType))>stableBufferTime)return switchRequest;var fragmentInfo=fragmentDict[mediaType][req.index];if(null===fragmentInfo||null===req.firstByteDate||abandonDict.hasOwnProperty(fragmentInfo.id))return switchRequest;if(void 0===fragmentInfo.firstByteTime&&(throughputArray[mediaType]=[],fragmentInfo.firstByteTime=req.firstByteDate.getTime(),fragmentInfo.segmentDuration=req.duration,fragmentInfo.bytesTotal=req.bytesTotal,fragmentInfo.id=req.index),fragmentInfo.bytesLoaded=req.bytesLoaded,fragmentInfo.elapsedTime=(new Date).getTime()-fragmentInfo.firstByteTime,fragmentInfo.bytesLoaded>0&&fragmentInfo.elapsedTime>0&&function storeLastRequestThroughputByType(type,throughput){throughputArray[type]=throughputArray[type]||[],throughputArray[type].push(throughput)}(mediaType,Math.round(8*fragmentInfo.bytesLoaded/fragmentInfo.elapsedTime)),throughputArray[mediaType].length>=5&&fragmentInfo.elapsedTime>500&&fragmentInfo.bytesLoaded<fragmentInfo.bytesTotal){var totalSampledValue=throughputArray[mediaType].reduce((function(a,b){return a+b}),0);if(fragmentInfo.measuredBandwidthInKbps=Math.round(totalSampledValue/throughputArray[mediaType].length),fragmentInfo.estimatedTimeOfDownload=+(8*fragmentInfo.bytesTotal/fragmentInfo.measuredBandwidthInKbps/1e3).toFixed(2),fragmentInfo.estimatedTimeOfDownload<1.8*fragmentInfo.segmentDuration||0===rulesContext.getRepresentationInfo().quality)return switchRequest;if(!abandonDict.hasOwnProperty(fragmentInfo.id)){var abrController=rulesContext.getAbrController(),bytesRemaining=fragmentInfo.bytesTotal-fragmentInfo.bytesLoaded,bitrateList=abrController.getBitrateList(mediaInfo),newQuality=abrController.getQualityForBitrate(mediaInfo,fragmentInfo.measuredBandwidthInKbps*mediaPlayerModel.getBandwidthSafetyFactor());bytesRemaining>fragmentInfo.bytesTotal*bitrateList[newQuality].bitrate/bitrateList[abrController.getQualityFor(mediaType,mediaInfo.streamInfo)].bitrate&&(switchRequest.quality=newQuality,switchRequest.reason.throughput=fragmentInfo.measuredBandwidthInKbps,switchRequest.reason.fragmentID=fragmentInfo.id,abandonDict[fragmentInfo.id]=fragmentInfo,logger.debug("( ",mediaType,"frag id",fragmentInfo.id,") is asking to abandon and switch to quality to ",newQuality," measured bandwidth was",fragmentInfo.measuredBandwidthInKbps),delete fragmentDict[mediaType][fragmentInfo.id])}}else fragmentInfo.bytesLoaded===fragmentInfo.bytesTotal&&delete fragmentDict[mediaType][fragmentInfo.id]}return switchRequest},reset:reset},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),reset()}(),instance}AbandonRequestsRule.__dashjs_factory_name="AbandonRequestsRule",exports.default=_coreFactoryMaker2.default.getClassFactory(AbandonRequestsRule),module.exports=exports.default},1490:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_SwitchRequest2=_interopRequireDefault(__webpack_require__(1375)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function DroppedFramesRule(){var context=this.context,instance=void 0,logger=void 0;return instance={getMaxIndex:function getMaxIndex(rulesContext){var droppedFramesHistory=rulesContext.getDroppedFramesHistory();if(droppedFramesHistory){for(var dfh=droppedFramesHistory.getFrameHistory(),droppedFrames=0,totalFrames=0,maxIndex=_SwitchRequest2.default.NO_CHANGE,i=1;i<dfh.length;i++)if(dfh[i]&&(droppedFrames=dfh[i].droppedVideoFrames,(totalFrames=dfh[i].totalVideoFrames)>375&&droppedFrames/totalFrames>.15)){maxIndex=i-1,logger.debug("index: "+maxIndex+" Dropped Frames: "+droppedFrames+" Total Frames: "+totalFrames);break}return(0,_SwitchRequest2.default)(context).create(maxIndex,{droppedFrames:droppedFrames})}return(0,_SwitchRequest2.default)(context).create()}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}DroppedFramesRule.__dashjs_factory_name="DroppedFramesRule",exports.default=_coreFactoryMaker2.default.getClassFactory(DroppedFramesRule),module.exports=exports.default},1491:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_SwitchRequest2=_interopRequireDefault(__webpack_require__(1375));function SwitchHistoryRule(){var context=this.context,instance=void 0,logger=void 0;return instance={getMaxIndex:function getMaxIndex(rulesContext){for(var switchRequestHistory=rulesContext?rulesContext.getSwitchHistory():null,switchRequests=switchRequestHistory?switchRequestHistory.getSwitchRequests():[],drops=0,noDrops=0,dropSize=0,switchRequest=(0,_SwitchRequest2.default)(context).create(),i=0;i<switchRequests.length;i++)if(void 0!==switchRequests[i]&&(drops+=switchRequests[i].drops,noDrops+=switchRequests[i].noDrops,dropSize+=switchRequests[i].dropSize,drops+noDrops>=6&&drops/noDrops>.075)){switchRequest.quality=i>0&&switchRequests[i].drops>0?i-1:i,switchRequest.reason={index:switchRequest.quality,drops:drops,noDrops:noDrops,dropSize:dropSize},logger.debug("Switch history rule index: "+switchRequest.quality+" samples: "+(drops+noDrops)+" drops: "+drops);break}return switchRequest}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}SwitchHistoryRule.__dashjs_factory_name="SwitchHistoryRule",exports.default=_coreFactoryMaker2.default.getClassFactory(SwitchHistoryRule),module.exports=exports.default},1492:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsMetricsConstants2=_interopRequireDefault(__webpack_require__(1382)),_SwitchRequest2=_interopRequireDefault(__webpack_require__(1375)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_voMetricsHTTPRequest=__webpack_require__(1373),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function BolaRule(config){config=config||{};var context=this.context,dashMetrics=config.dashMetrics,metricsModel=config.metricsModel,mediaPlayerModel=config.mediaPlayerModel,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,bolaStateDict=void 0;function calculateBolaParameters(stableBufferTime,bitrates,utilities){var highestUtilityIndex=utilities.reduce((function(highestIndex,u,uIndex){return u>utilities[highestIndex]?uIndex:highestIndex}),0);if(0===highestUtilityIndex)return null;var bufferTime=Math.max(stableBufferTime,10+2*bitrates.length),gp=(utilities[highestUtilityIndex]-1)/(bufferTime/10-1);return{gp:gp,Vp:10/gp}}function getInitialBolaState(rulesContext){var initialState={},bitrates=rulesContext.getMediaInfo().bitrateList.map((function(b){return b.bandwidth})),utilities=function utilitiesFromBitrates(bitrates){return bitrates.map((function(b){return Math.log(b)}))}(bitrates);utilities=utilities.map((function(u){return u-utilities[0]+1}));var stableBufferTime=mediaPlayerModel.getStableBufferTime(),params=calculateBolaParameters(stableBufferTime,bitrates,utilities);return params?(initialState.state=1,initialState.bitrates=bitrates,initialState.utilities=utilities,initialState.stableBufferTime=stableBufferTime,initialState.Vp=params.Vp,initialState.gp=params.gp,initialState.lastQuality=0,clearBolaStateOnSeek(initialState)):initialState.state=0,initialState}function clearBolaStateOnSeek(bolaState){bolaState.placeholderBuffer=0,bolaState.mostAdvancedSegmentStart=NaN,bolaState.lastSegmentWasReplacement=!1,bolaState.lastSegmentStart=NaN,bolaState.lastSegmentDurationS=NaN,bolaState.lastSegmentRequestTimeMs=NaN,bolaState.lastSegmentFinishTimeMs=NaN}function checkBolaStateStableBufferTime(bolaState,mediaType){var stableBufferTime=mediaPlayerModel.getStableBufferTime();if(bolaState.stableBufferTime!==stableBufferTime){var params=calculateBolaParameters(stableBufferTime,bolaState.bitrates,bolaState.utilities);if(params.Vp!==bolaState.Vp||params.gp!==bolaState.gp){var bufferLevel=dashMetrics.getCurrentBufferLevel(metricsModel.getReadOnlyMetricsFor(mediaType)),effectiveBufferLevel=bufferLevel+bolaState.placeholderBuffer;effectiveBufferLevel-=10,effectiveBufferLevel*=params.Vp/bolaState.Vp,effectiveBufferLevel+=10,bolaState.stableBufferTime=stableBufferTime,bolaState.Vp=params.Vp,bolaState.gp=params.gp,bolaState.placeholderBuffer=Math.max(0,effectiveBufferLevel-bufferLevel)}}}function maxBufferLevelForQuality(bolaState,quality){return bolaState.Vp*(bolaState.utilities[quality]+bolaState.gp)}function minBufferLevelForQuality(bolaState,quality){for(var qBitrate=bolaState.bitrates[quality],qUtility=bolaState.utilities[quality],min=0,i=quality-1;i>=0;--i)if(bolaState.utilities[i]<bolaState.utilities[quality]){var iBitrate=bolaState.bitrates[i],iUtility=bolaState.utilities[i],level=bolaState.Vp*(bolaState.gp+(qBitrate*iUtility-iBitrate*qUtility)/(qBitrate-iBitrate));min=Math.max(min,level)}return min}function onBufferEmpty(){for(var mediaType in bolaStateDict)bolaStateDict.hasOwnProperty(mediaType)&&2===bolaStateDict[mediaType].state&&(bolaStateDict[mediaType].placeholderBuffer=0)}function onPlaybackSeeking(){for(var mediaType in bolaStateDict)if(bolaStateDict.hasOwnProperty(mediaType)){var bolaState=bolaStateDict[mediaType];0!==bolaState.state&&(bolaState.state=1,clearBolaStateOnSeek(bolaState))}}function onPeriodSwitchStarted(){}function onMediaFragmentLoaded(e){if(e&&e.chunk&&e.chunk.mediaInfo){var bolaState=bolaStateDict[e.chunk.mediaInfo.type];if(bolaState&&0!==bolaState.state){var start=e.chunk.start;isNaN(bolaState.mostAdvancedSegmentStart)||start>bolaState.mostAdvancedSegmentStart?(bolaState.mostAdvancedSegmentStart=start,bolaState.lastSegmentWasReplacement=!1):bolaState.lastSegmentWasReplacement=!0,bolaState.lastSegmentStart=start,bolaState.lastSegmentDurationS=e.chunk.duration,bolaState.lastQuality=e.chunk.quality,checkNewSegment(bolaState,e.chunk.mediaInfo.type)}}}function onMetricAdded(e){if(e&&e.metric===_constantsMetricsConstants2.default.HTTP_REQUEST&&e.value&&e.value.type===_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var bolaState=bolaStateDict[e.mediaType];bolaState&&0!==bolaState.state&&(bolaState.lastSegmentRequestTimeMs=e.value.trequest.getTime(),bolaState.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),checkNewSegment(bolaState,e.mediaType))}}function checkNewSegment(bolaState,mediaType){if(!isNaN(bolaState.lastSegmentStart)&&!isNaN(bolaState.lastSegmentRequestTimeMs)&&!isNaN(bolaState.placeholderBuffer)){if(bolaState.placeholderBuffer*=.99,!isNaN(bolaState.lastSegmentFinishTimeMs)){var bufferAtLastSegmentRequest=dashMetrics.getCurrentBufferLevel(metricsModel.getReadOnlyMetricsFor(mediaType))+.001*(bolaState.lastSegmentFinishTimeMs-bolaState.lastSegmentRequestTimeMs),maxEffectiveBufferForLastSegment=maxBufferLevelForQuality(bolaState,bolaState.lastQuality),maxPlaceholderBuffer=Math.max(0,maxEffectiveBufferForLastSegment-bufferAtLastSegmentRequest);bolaState.placeholderBuffer=Math.min(maxPlaceholderBuffer,bolaState.placeholderBuffer)}bolaState.lastSegmentWasReplacement&&!isNaN(bolaState.lastSegmentDurationS)&&(bolaState.placeholderBuffer+=bolaState.lastSegmentDurationS),bolaState.lastSegmentStart=NaN,bolaState.lastSegmentRequestTimeMs=NaN}}function onQualityChangeRequested(e){if(e){var bolaState=bolaStateDict[e.mediaType];bolaState&&0!==bolaState.state&&(bolaState.abrQuality=e.newQuality)}}function onFragmentLoadingAbandoned(e){if(e){var bolaState=bolaStateDict[e.mediaType];if(bolaState&&0!==bolaState.state){var bufferLevel=dashMetrics.getCurrentBufferLevel(metricsModel.getReadOnlyMetricsFor(e.mediaType)),wantEffectiveBufferLevel=void 0;wantEffectiveBufferLevel=bolaState.abrQuality>0?minBufferLevelForQuality(bolaState,bolaState.abrQuality):10;var maxPlaceholderBuffer=Math.max(0,wantEffectiveBufferLevel-bufferLevel);bolaState.placeholderBuffer=Math.min(bolaState.placeholderBuffer,maxPlaceholderBuffer)}}}function resetInitialSettings(){bolaStateDict={}}return instance={getMaxIndex:function getMaxIndex(rulesContext){var mediaInfo=rulesContext.getMediaInfo(),mediaType=rulesContext.getMediaType(),metrics=metricsModel.getReadOnlyMetricsFor(mediaType),scheduleController=rulesContext.getScheduleController(),streamInfo=rulesContext.getStreamInfo(),abrController=rulesContext.getAbrController(),throughputHistory=abrController.getThroughputHistory(),streamId=streamInfo?streamInfo.id:null,isDynamic=streamInfo&&streamInfo.manifestInfo&&streamInfo.manifestInfo.isDynamic,useBufferOccupancyABR=rulesContext.useBufferOccupancyABR(),switchRequest=(0,_SwitchRequest2.default)(context).create();if(switchRequest.reason=switchRequest.reason||{},!useBufferOccupancyABR)return switchRequest;scheduleController.setTimeToLoadDelay(0);var bolaState=function getBolaState(rulesContext){var mediaType=rulesContext.getMediaType(),bolaState=bolaStateDict[mediaType];return bolaState?0!==bolaState.state&&checkBolaStateStableBufferTime(bolaState,mediaType):(bolaState=getInitialBolaState(rulesContext),bolaStateDict[mediaType]=bolaState),bolaState}(rulesContext);if(0===bolaState.state)return switchRequest;var bufferLevel=dashMetrics.getCurrentBufferLevel(metrics),throughput=throughputHistory.getAverageThroughput(mediaType,isDynamic),safeThroughput=throughputHistory.getSafeAverageThroughput(mediaType,isDynamic),latency=throughputHistory.getAverageLatency(mediaType),quality=void 0;if(switchRequest.reason.state=bolaState.state,switchRequest.reason.throughput=throughput,switchRequest.reason.latency=latency,isNaN(throughput))return switchRequest;switch(bolaState.state){case 1:quality=abrController.getQualityForBitrate(mediaInfo,safeThroughput,latency),switchRequest.quality=quality,switchRequest.reason.throughput=safeThroughput,bolaState.placeholderBuffer=Math.max(0,minBufferLevelForQuality(bolaState,quality)-bufferLevel),bolaState.lastQuality=quality,!isNaN(bolaState.lastSegmentDurationS)&&bufferLevel>=bolaState.lastSegmentDurationS&&(bolaState.state=2);break;case 2:!function updatePlaceholderBuffer(bolaState,mediaType){var nowMs=Date.now();if(isNaN(bolaState.lastSegmentFinishTimeMs)){if(!isNaN(bolaState.lastCallTimeMs)){delay=.001*(nowMs-bolaState.lastCallTimeMs);bolaState.placeholderBuffer+=Math.max(0,delay)}}else{var delay=.001*(nowMs-bolaState.lastSegmentFinishTimeMs);bolaState.placeholderBuffer+=Math.max(0,delay)}bolaState.lastCallTimeMs=nowMs,bolaState.lastSegmentStart=NaN,bolaState.lastSegmentRequestTimeMs=NaN,bolaState.lastSegmentFinishTimeMs=NaN,checkBolaStateStableBufferTime(bolaState,mediaType)}(bolaState,mediaType),quality=function getQualityFromBufferLevel(bolaState,bufferLevel){for(var bitrateCount=bolaState.bitrates.length,quality=NaN,score=NaN,i=0;i<bitrateCount;++i){var s=(bolaState.Vp*(bolaState.utilities[i]+bolaState.gp)-bufferLevel)/bolaState.bitrates[i];(isNaN(score)||s>=score)&&(score=s,quality=i)}return quality}(bolaState,bufferLevel+bolaState.placeholderBuffer);var qualityForThroughput=abrController.getQualityForBitrate(mediaInfo,safeThroughput,latency);quality>bolaState.lastQuality&&quality>qualityForThroughput&&(quality=Math.max(qualityForThroughput,bolaState.lastQuality));var delayS=Math.max(0,bufferLevel+bolaState.placeholderBuffer-maxBufferLevelForQuality(bolaState,quality));delayS<=bolaState.placeholderBuffer?(bolaState.placeholderBuffer-=delayS,delayS=0):(delayS-=bolaState.placeholderBuffer,bolaState.placeholderBuffer=0,quality<abrController.getTopQualityIndexFor(mediaType,streamId)?scheduleController.setTimeToLoadDelay(1e3*delayS):delayS=0),switchRequest.quality=quality,switchRequest.reason.throughput=throughput,switchRequest.reason.latency=latency,switchRequest.reason.bufferLevel=bufferLevel,switchRequest.reason.placeholderBuffer=bolaState.placeholderBuffer,switchRequest.reason.delay=delayS,bolaState.lastQuality=quality;break;default:logger.debug("BOLA ABR rule invoked in bad state."),switchRequest.quality=abrController.getQualityForBitrate(mediaInfo,safeThroughput,latency),switchRequest.reason.state=bolaState.state,switchRequest.reason.throughput=safeThroughput,switchRequest.reason.latency=latency,bolaState.state=1,clearBolaStateOnSeek(bolaState)}return switchRequest},reset:function reset(){resetInitialSettings(),eventBus.off(_coreEventsEvents2.default.BUFFER_EMPTY,onBufferEmpty,instance),eventBus.off(_coreEventsEvents2.default.PLAYBACK_SEEKING,onPlaybackSeeking,instance),eventBus.off(_coreEventsEvents2.default.PERIOD_SWITCH_STARTED,onPeriodSwitchStarted,instance),eventBus.off(_coreEventsEvents2.default.MEDIA_FRAGMENT_LOADED,onMediaFragmentLoaded,instance),eventBus.off(_coreEventsEvents2.default.METRIC_ADDED,onMetricAdded,instance),eventBus.off(_coreEventsEvents2.default.QUALITY_CHANGE_REQUESTED,onQualityChangeRequested,instance),eventBus.off(_coreEventsEvents2.default.FRAGMENT_LOADING_ABANDONED,onFragmentLoadingAbandoned,instance)}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),resetInitialSettings(),eventBus.on(_coreEventsEvents2.default.BUFFER_EMPTY,onBufferEmpty,instance),eventBus.on(_coreEventsEvents2.default.PLAYBACK_SEEKING,onPlaybackSeeking,instance),eventBus.on(_coreEventsEvents2.default.PERIOD_SWITCH_STARTED,onPeriodSwitchStarted,instance),eventBus.on(_coreEventsEvents2.default.MEDIA_FRAGMENT_LOADED,onMediaFragmentLoaded,instance),eventBus.on(_coreEventsEvents2.default.METRIC_ADDED,onMetricAdded,instance),eventBus.on(_coreEventsEvents2.default.QUALITY_CHANGE_REQUESTED,onQualityChangeRequested,instance),eventBus.on(_coreEventsEvents2.default.FRAGMENT_LOADING_ABANDONED,onFragmentLoadingAbandoned,instance)}(),instance}BolaRule.__dashjs_factory_name="BolaRule",exports.default=_coreFactoryMaker2.default.getClassFactory(BolaRule),module.exports=exports.default},1493:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function RulesContext(config){var abrController=(config=config||{}).abrController,switchHistory=config.switchHistory,droppedFramesHistory=config.droppedFramesHistory,currentRequest=config.currentRequest,bufferOccupancyABR=config.useBufferOccupancyABR,scheduleController=config.streamProcessor?config.streamProcessor.getScheduleController():null,representationInfo=config.streamProcessor?config.streamProcessor.getRepresentationInfo():null;function getMediaInfo(){return representationInfo?representationInfo.mediaInfo:null}return{getMediaType:function getMediaType(){var mediaInfo=getMediaInfo();return mediaInfo?mediaInfo.type:null},getMediaInfo:getMediaInfo,getDroppedFramesHistory:function getDroppedFramesHistory(){return droppedFramesHistory},getCurrentRequest:function getCurrentRequest(){return currentRequest},getSwitchHistory:function getSwitchHistory(){return switchHistory},getStreamInfo:function getStreamInfo(){var mediaInfo=getMediaInfo();return mediaInfo?mediaInfo.streamInfo:null},getScheduleController:function getScheduleController(){return scheduleController},getAbrController:function getAbrController(){return abrController},getRepresentationInfo:function getRepresentationInfo(){return representationInfo},useBufferOccupancyABR:function useBufferOccupancyABR(){return bufferOccupancyABR}}}RulesContext.__dashjs_factory_name="RulesContext",exports.default=_coreFactoryMaker2.default.getClassFactory(RulesContext),module.exports=exports.default},1494:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_SwitchRequest2=_interopRequireDefault(__webpack_require__(1375));function SwitchRequestHistory(){var switchRequests=[],srHistory=[];return{push:function push(switchRequest){switchRequest.newValue===_SwitchRequest2.default.NO_CHANGE&&(switchRequest.newValue=switchRequest.oldValue),switchRequests[switchRequest.oldValue]||(switchRequests[switchRequest.oldValue]={noDrops:0,drops:0,dropSize:0});var indexDiff=switchRequest.newValue-switchRequest.oldValue,drop=indexDiff<0?1:0,dropSize=drop?-indexDiff:0,noDrop=drop?0:1;if(switchRequests[switchRequest.oldValue].drops+=drop,switchRequests[switchRequest.oldValue].dropSize+=dropSize,switchRequests[switchRequest.oldValue].noDrops+=noDrop,srHistory.push({idx:switchRequest.oldValue,noDrop:noDrop,drop:drop,dropSize:dropSize}),srHistory.length>8){var srHistoryFirst=srHistory.shift();switchRequests[srHistoryFirst.idx].drops-=srHistoryFirst.drop,switchRequests[srHistoryFirst.idx].dropSize-=srHistoryFirst.dropSize,switchRequests[srHistoryFirst.idx].noDrops-=srHistoryFirst.noDrop}},getSwitchRequests:function getSwitchRequests(){return switchRequests},reset:function reset(){switchRequests=[],srHistory=[]}}}SwitchRequestHistory.__dashjs_factory_name="SwitchRequestHistory";var factory=_coreFactoryMaker2.default.getClassFactory(SwitchRequestHistory);exports.default=factory,module.exports=exports.default},1495:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function DroppedFramesHistory(){var values=[],lastDroppedFrames=0,lastTotalFrames=0;return{push:function push(index,playbackQuality){var droppedVideoFrames=playbackQuality&&playbackQuality.droppedVideoFrames?playbackQuality.droppedVideoFrames:0,totalVideoFrames=playbackQuality&&playbackQuality.totalVideoFrames?playbackQuality.totalVideoFrames:0,intervalDroppedFrames=droppedVideoFrames-lastDroppedFrames;lastDroppedFrames=droppedVideoFrames;var intervalTotalFrames=totalVideoFrames-lastTotalFrames;lastTotalFrames=totalVideoFrames,isNaN(index)||(values[index]?(values[index].droppedVideoFrames+=intervalDroppedFrames,values[index].totalVideoFrames+=intervalTotalFrames):values[index]={droppedVideoFrames:intervalDroppedFrames,totalVideoFrames:intervalTotalFrames})},getFrameHistory:function getDroppedFrameHistory(){return values},reset:function reset(playbackQuality){values=[],lastDroppedFrames=playbackQuality.droppedVideoFrames,lastTotalFrames=playbackQuality.totalVideoFrames}}}DroppedFramesHistory.__dashjs_factory_name="DroppedFramesHistory";var factory=_coreFactoryMaker2.default.getClassFactory(DroppedFramesHistory);exports.default=factory,module.exports=exports.default},1496:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366));function ThroughputHistory(config){var mediaPlayerModel=(config=config||{}).mediaPlayerModel,throughputDict=void 0,latencyDict=void 0,ewmaThroughputDict=void 0,ewmaLatencyDict=void 0,ewmaHalfLife=void 0;function updateEwmaEstimate(ewmaObj,value,weight,halfLife){var fastAlpha=Math.pow(.5,weight/halfLife.fast);ewmaObj.fastEstimate=(1-fastAlpha)*value+fastAlpha*ewmaObj.fastEstimate;var slowAlpha=Math.pow(.5,weight/halfLife.slow);ewmaObj.slowEstimate=(1-slowAlpha)*value+slowAlpha*ewmaObj.slowEstimate,ewmaObj.totalWeight+=weight}function getAverage(isThroughput,mediaType,isDynamic){return mediaPlayerModel.getMovingAverageMethod()!==_constantsConstants2.default.MOVING_AVERAGE_SLIDING_WINDOW?function getAverageEwma(isThroughput,mediaType){var halfLife=isThroughput?ewmaHalfLife.throughputHalfLife:ewmaHalfLife.latencyHalfLife,ewmaObj=isThroughput?ewmaThroughputDict[mediaType]:ewmaLatencyDict[mediaType];if(!ewmaObj||ewmaObj.totalWeight<=0)return NaN;var fastEstimate=ewmaObj.fastEstimate/(1-Math.pow(.5,ewmaObj.totalWeight/halfLife.fast)),slowEstimate=ewmaObj.slowEstimate/(1-Math.pow(.5,ewmaObj.totalWeight/halfLife.slow));return isThroughput?Math.min(fastEstimate,slowEstimate):Math.max(fastEstimate,slowEstimate)}(isThroughput,mediaType):function getAverageSlidingWindow(isThroughput,mediaType,isDynamic){var sampleSize=function getSampleSize(isThroughput,mediaType,isLive){var arr=void 0,sampleSize=void 0;if(isThroughput?(arr=throughputDict[mediaType],sampleSize=isLive?3:4):(arr=latencyDict[mediaType],sampleSize=4),arr){if(sampleSize>=arr.length)sampleSize=arr.length;else if(isThroughput)for(var i=1;i<sampleSize;++i){var ratio=arr[i]/arr[i-1];if((ratio>=1.3||ratio<=1/1.3)&&(sampleSize+=1)===arr.length)break}}else sampleSize=0;return sampleSize}(isThroughput,mediaType,isDynamic),arr=(isThroughput?throughputDict:latencyDict)[mediaType];if(0===sampleSize||!arr||0===arr.length)return NaN;return(arr=arr.slice(-sampleSize)).reduce((function(total,elem){return total+elem}))/arr.length}(isThroughput,mediaType,isDynamic)}function getAverageThroughput(mediaType,isDynamic){return getAverage(!0,mediaType,isDynamic)}function checkSettingsForMediaType(mediaType){throughputDict[mediaType]=throughputDict[mediaType]||[],latencyDict[mediaType]=latencyDict[mediaType]||[],ewmaThroughputDict[mediaType]=ewmaThroughputDict[mediaType]||{fastEstimate:0,slowEstimate:0,totalWeight:0},ewmaLatencyDict[mediaType]=ewmaLatencyDict[mediaType]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function reset(){throughputDict={},latencyDict={},ewmaThroughputDict={},ewmaLatencyDict={}}var instance={push:function push(mediaType,httpRequest,useDeadTimeLatency){if(httpRequest.trace&&httpRequest.trace.length){var latencyTimeInMilliseconds=httpRequest.tresponse.getTime()-httpRequest.trequest.getTime()||1,downloadTimeInMilliseconds=httpRequest._tfinish.getTime()-httpRequest.tresponse.getTime()||1,downloadBytes=httpRequest.trace.reduce((function(a,b){return a+b.b[0]}),0),throughputMeasureTime=void 0;throughputMeasureTime=mediaPlayerModel.getLowLatencyEnabled()?httpRequest.trace.reduce((function(a,b){return a+b.d}),0):useDeadTimeLatency?downloadTimeInMilliseconds:latencyTimeInMilliseconds+downloadTimeInMilliseconds;var throughput=Math.round(8*downloadBytes/throughputMeasureTime);if(checkSettingsForMediaType(mediaType),function isCachedResponse(mediaType,latencyMs,downloadTimeMs){return mediaType===_constantsConstants2.default.VIDEO?downloadTimeMs<mediaPlayerModel.getCacheLoadThresholdForType(_constantsConstants2.default.VIDEO):mediaType===_constantsConstants2.default.AUDIO?downloadTimeMs<mediaPlayerModel.getCacheLoadThresholdForType(_constantsConstants2.default.AUDIO):void 0}(mediaType,0,downloadTimeInMilliseconds)){if(throughputDict[mediaType].length>0&&!throughputDict[mediaType].hasCachedEntries)return;throughputDict[mediaType].hasCachedEntries=!0}else throughputDict[mediaType]&&throughputDict[mediaType].hasCachedEntries&&function clearSettingsForMediaType(mediaType){delete throughputDict[mediaType],delete latencyDict[mediaType],delete ewmaThroughputDict[mediaType],delete ewmaLatencyDict[mediaType],checkSettingsForMediaType(mediaType)}(mediaType);throughputDict[mediaType].push(throughput),throughputDict[mediaType].length>20&&throughputDict[mediaType].shift(),latencyDict[mediaType].push(latencyTimeInMilliseconds),latencyDict[mediaType].length>20&&latencyDict[mediaType].shift(),updateEwmaEstimate(ewmaThroughputDict[mediaType],throughput,.001*downloadTimeInMilliseconds,ewmaHalfLife.throughputHalfLife),updateEwmaEstimate(ewmaLatencyDict[mediaType],latencyTimeInMilliseconds,1,ewmaHalfLife.latencyHalfLife)}},getAverageThroughput:getAverageThroughput,getSafeAverageThroughput:function getSafeAverageThroughput(mediaType,isDynamic){var average=getAverageThroughput(mediaType,isDynamic);return isNaN(average)||(average*=mediaPlayerModel.getBandwidthSafetyFactor()),average},getAverageLatency:function getAverageLatency(mediaType){return getAverage(!1,mediaType)},reset:reset};return function setup(){ewmaHalfLife={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},reset()}(),instance}ThroughputHistory.__dashjs_factory_name="ThroughputHistory",exports.default=_coreFactoryMaker2.default.getClassFactory(ThroughputHistory),module.exports=exports.default},1497:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_constantsMetricsConstants2=_interopRequireDefault(__webpack_require__(1382)),_Stream2=_interopRequireDefault(__webpack_require__(1498)),_ManifestUpdater2=_interopRequireDefault(__webpack_require__(1523)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_voMetricsPlayList=__webpack_require__(1435),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_utilsInitCache2=_interopRequireDefault(__webpack_require__(1411)),_utilsURLUtils2=_interopRequireDefault(__webpack_require__(1376)),_MediaPlayerEvents2=_interopRequireDefault(__webpack_require__(1438)),_TimeSyncController2=_interopRequireDefault(__webpack_require__(1524)),_BaseURLController2=_interopRequireDefault(__webpack_require__(1439)),_MediaSourceController2=_interopRequireDefault(__webpack_require__(1531)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372));function StreamController(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,capabilities=void 0,manifestUpdater=void 0,manifestLoader=void 0,manifestModel=void 0,dashManifestModel=void 0,adapter=void 0,metricsModel=void 0,dashMetrics=void 0,mediaSourceController=void 0,timeSyncController=void 0,baseURLController=void 0,domStorage=void 0,abrController=void 0,mediaController=void 0,textController=void 0,initCache=void 0,urlUtils=void 0,errHandler=void 0,timelineConverter=void 0,streams=void 0,activeStream=void 0,protectionController=void 0,protectionData=void 0,autoPlay=void 0,isStreamSwitchingInProgress=void 0,hasMediaError=void 0,hasInitialisationError=void 0,mediaSource=void 0,videoModel=void 0,playbackController=void 0,mediaPlayerModel=void 0,isPaused=void 0,initialPlayback=void 0,playListMetrics=void 0,videoTrackDetected=void 0,audioTrackDetected=void 0,isPeriodSwitchInProgress=void 0,playbackEndedTimerId=void 0,preloadTimerId=void 0,wallclockTicked=void 0,buffers=void 0,useSmoothPeriodTransition=void 0,preloading=void 0,lastPlaybackTime=void 0,supportsChangeType=void 0;function onPlaybackTimeUpdated(){if(isTrackTypePresent(_constantsConstants2.default.VIDEO)){var playbackQuality=videoModel.getPlaybackQuality();playbackQuality&&metricsModel.addDroppedFrames(_constantsConstants2.default.VIDEO,playbackQuality)}}function onWallclockTimeUpdated(){if(!(!mediaPlayerModel.getJumpGaps()||0===getActiveStreamProcessors()||playbackController.isSeeking()||isPaused||isStreamSwitchingInProgress||hasMediaError||hasInitialisationError)&&++wallclockTicked>=40){var currentTime=playbackController.getTime();lastPlaybackTime===currentTime?function jumpGap(time){for(var streamProcessors=getActiveStreamProcessors(),smallGapLimit=mediaPlayerModel.getSmallGapLimit(),seekToPosition=void 0,i=0;i<streamProcessors.length;i++){var ranges=streamProcessors[i].getBuffer().getAllBufferRanges(),nextRangeStartTime=void 0;if(ranges&&!(ranges.length<=1)){for(var j=0;j<ranges.length;j++)if(time<ranges.start(j)){nextRangeStartTime=ranges.start(j);break}if(nextRangeStartTime>0){var gap=nextRangeStartTime-time;gap>0&&gap<=smallGapLimit&&(void 0===seekToPosition||nextRangeStartTime>seekToPosition)&&(seekToPosition=nextRangeStartTime)}}}var timeToStreamEnd=playbackController.getTimeToStreamEnd();void 0===seekToPosition&&!isNaN(timeToStreamEnd)&&timeToStreamEnd<smallGapLimit&&(seekToPosition=time+timeToStreamEnd);seekToPosition>0&&(!isNaN(timeToStreamEnd)&&seekToPosition>=time+timeToStreamEnd?(logger.info("Jumping media gap (discontinuity) at time ",time,". Jumping to end of the stream"),eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_ENDED,{isLast:getActiveStreamInfo().isLast})):(logger.info("Jumping media gap (discontinuity) at time ",time,". Jumping to time position",seekToPosition),playbackController.seek(seekToPosition,!0,!0)))}(currentTime):lastPlaybackTime=currentTime,wallclockTicked=0}}function onPlaybackSeeking(e){var seekingStream=getStreamForTime(e.seekTime);playbackEndedTimerId&&(stopEndPeriodTimer(),isPeriodSwitchInProgress=!1),preloadTimerId&&function stopPreloadTimer(){logger.debug("[PreloadTimer] stop period preload timer."),clearTimeout(preloadTimerId),preloadTimerId=void 0}(),seekingStream===activeStream&&preloading&&preloading.deactivate(!0),seekingStream&&(seekingStream!==activeStream||preloading&&!activeStream.isActive())?(flushPlaylistMetrics(_voMetricsPlayList.PlayListTrace.END_OF_PERIOD_STOP_REASON),switchStream(activeStream,seekingStream,e.seekTime)):flushPlaylistMetrics(_voMetricsPlayList.PlayListTrace.USER_REQUEST_STOP_REASON),addPlaylistMetrics(_voMetricsPlayList.PlayList.SEEK_START_REASON)}function onPlaybackStarted(){logger.debug("[onPlaybackStarted]"),initialPlayback?(initialPlayback=!1,addPlaylistMetrics(_voMetricsPlayList.PlayList.INITIAL_PLAYOUT_START_REASON)):isPaused&&(isPaused=!1,addPlaylistMetrics(_voMetricsPlayList.PlayList.RESUME_FROM_PAUSE_START_REASON),toggleEndPeriodTimer())}function onPlaybackPaused(e){logger.debug("[onPlaybackPaused]"),e.ended||(isPaused=!0,flushPlaylistMetrics(_voMetricsPlayList.PlayListTrace.USER_REQUEST_STOP_REASON),toggleEndPeriodTimer())}function stopEndPeriodTimer(){logger.debug("[toggleEndPeriodTimer] stop end period timer."),clearTimeout(playbackEndedTimerId),playbackEndedTimerId=void 0}function toggleEndPeriodTimer(){if(isPeriodSwitchInProgress)if(playbackEndedTimerId)stopEndPeriodTimer();else{var timeToEnd=playbackController.getTimeToStreamEnd(),delayPlaybackEnded=timeToEnd>0?1e3*timeToEnd:0,preloadDelay=delayPlaybackEnded<2e3?delayPlaybackEnded/4:delayPlaybackEnded-2e3;logger.debug("[toggleEndPeriodTimer] Going to fire preload in",preloadDelay,"milliseconds"),preloadTimerId=setTimeout(onStreamCanLoadNext,preloadDelay),logger.debug("[toggleEndPeriodTimer] start-up of timer to notify PLAYBACK_ENDED event. It will be triggered in",delayPlaybackEnded,"milliseconds"),playbackEndedTimerId=setTimeout((function(){eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_ENDED,{isLast:getActiveStreamInfo().isLast})}),delayPlaybackEnded)}}function onTrackBufferingCompleted(e){if(e.sender&&(e.sender.getType()===_constantsConstants2.default.AUDIO||e.sender.getType()===_constantsConstants2.default.VIDEO)){var isLast=getActiveStreamInfo().isLast;mediaSource&&!isLast&&void 0===playbackEndedTimerId&&(logger.info("[onTrackBufferingCompleted] end of period detected. Track",e.sender.getType(),"has finished"),isPeriodSwitchInProgress=!0,!1===isPaused&&toggleEndPeriodTimer())}}function onStreamBufferingCompleted(){var isLast=getActiveStreamInfo().isLast;mediaSource&&isLast&&(logger.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),mediaSourceController.signalEndOfStream(mediaSource))}function onStreamCanLoadNext(){var newStream,isLast=getActiveStreamInfo().isLast;mediaSource&&!isLast&&(newStream=getNextStream(),(useSmoothPeriodTransition=activeStream.isProtectionCompatible(newStream)&&(supportsChangeType||activeStream.isMediaCodecCompatible(newStream)))&&(logger.info("[onStreamCanLoadNext] Preloading next stream"),activeStream.stopEventController(),activeStream.deactivate(!0),newStream.preload(mediaSource,buffers),preloading=newStream,newStream.getProcessors().forEach((function(p){adapter.setIndexHandlerTime(p,newStream.getStartTime())}))))}function getStreamForTime(time){var duration=0,stream=null,ln=streams.length;ln>0&&(duration+=streams[0].getStartTime());for(var i=0;i<ln;i++)if(stream=streams[i],time<(duration=parseFloat((duration+stream.getDuration()).toFixed(5))))return stream;return null}function getActiveStreamProcessors(){return activeStream?activeStream.getProcessors():[]}function onEnded(){var nextStream=getNextStream();nextStream?(audioTrackDetected=void 0,videoTrackDetected=void 0,switchStream(activeStream,nextStream,NaN)):logger.debug("StreamController no next stream found"),flushPlaylistMetrics(nextStream?_voMetricsPlayList.PlayListTrace.END_OF_PERIOD_STOP_REASON:_voMetricsPlayList.PlayListTrace.END_OF_CONTENT_STOP_REASON),playbackEndedTimerId=void 0,isPeriodSwitchInProgress=!1}function getNextStream(){if(activeStream){var _ret2=(start=getActiveStreamInfo().start,duration=getActiveStreamInfo().duration,{v:streams.filter((function(stream){return stream.getStreamInfo().start===parseFloat((start+duration).toFixed(5))}))[0]});if("object"==typeof _ret2)return _ret2.v}var start,duration}function switchStream(oldStream,newStream,seekTime){isStreamSwitchingInProgress||!newStream||oldStream===newStream&&newStream.isActive()||(isStreamSwitchingInProgress=!0,eventBus.trigger(_coreEventsEvents2.default.PERIOD_SWITCH_STARTED,{fromStreamInfo:oldStream?oldStream.getStreamInfo():null,toStreamInfo:newStream.getStreamInfo()}),useSmoothPeriodTransition=!1,oldStream&&(oldStream.stopEventController(),useSmoothPeriodTransition=activeStream.isProtectionCompatible(newStream)&&(supportsChangeType||activeStream.isMediaCodecCompatible(newStream))&&!seekTime||newStream.getPreloaded(),oldStream.deactivate(useSmoothPeriodTransition)),activeStream=newStream,preloading=!1,playbackController.initialize(getActiveStreamInfo(),useSmoothPeriodTransition),videoModel.getElement()?openMediaSource(seekTime,oldStream,!1,useSmoothPeriodTransition):function preloadStream(seekTime){activateStream(seekTime,useSmoothPeriodTransition)}(seekTime))}function openMediaSource(seekTime,oldStream,streamActivated,keepBuffers){var sourceUrl=void 0;function onMediaSourceOpen(){mediaSource&&(logger.debug("MediaSource is open!"),window.URL.revokeObjectURL(sourceUrl),mediaSource.removeEventListener("sourceopen",onMediaSourceOpen),mediaSource.removeEventListener("webkitsourceopen",onMediaSourceOpen),setMediaDuration(),oldStream||eventBus.trigger(_coreEventsEvents2.default.SOURCE_INITIALIZED),streamActivated?activeStream.setMediaSource(mediaSource):activateStream(seekTime,keepBuffers))}mediaSource?keepBuffers?(activateStream(seekTime,keepBuffers),oldStream||eventBus.trigger(_coreEventsEvents2.default.SOURCE_INITIALIZED)):(mediaSourceController.detachMediaSource(videoModel),mediaSource.addEventListener("sourceopen",onMediaSourceOpen,!1),mediaSource.addEventListener("webkitsourceopen",onMediaSourceOpen,!1),sourceUrl=mediaSourceController.attachMediaSource(mediaSource,videoModel),logger.debug("MediaSource attached to element.  Waiting on open...")):((mediaSource=mediaSourceController.createMediaSource()).addEventListener("sourceopen",onMediaSourceOpen,!1),mediaSource.addEventListener("webkitsourceopen",onMediaSourceOpen,!1),sourceUrl=mediaSourceController.attachMediaSource(mediaSource,videoModel),logger.debug("MediaSource attached to element.  Waiting on open..."))}function activateStream(seekTime,keepBuffers){if(buffers=activeStream.activate(mediaSource,keepBuffers?buffers:void 0),audioTrackDetected=checkTrackPresence(_constantsConstants2.default.AUDIO),videoTrackDetected=checkTrackPresence(_constantsConstants2.default.VIDEO),buffers){var keys=Object.keys(buffers);keys.length>0&&buffers[keys[0]].changeType&&(logger.debug("SourceBuffer changeType method supported. Use it to switch codecs in periods transitions"),supportsChangeType=!0)}var startTime;initialPlayback||(isNaN(seekTime)?(startTime=playbackController.getStreamStartTime(!0),keepBuffers||getActiveStreamProcessors().forEach((function(p){adapter.setIndexHandlerTime(p,startTime)}))):playbackController.seek(seekTime)),activeStream.startEventController(),!autoPlay&&initialPlayback||playbackController.play(),isStreamSwitchingInProgress=!1,eventBus.trigger(_coreEventsEvents2.default.PERIOD_SWITCH_COMPLETED,{toStreamInfo:getActiveStreamInfo()})}function setMediaDuration(duration){var manifestDuration=duration||getActiveStreamInfo().manifestInfo.duration,mediaDuration=mediaSourceController.setDuration(mediaSource,manifestDuration);logger.debug("Duration successfully set to: "+mediaDuration)}function getComposedStream(streamInfo){for(var i=0,ln=streams.length;i<ln;i++)if(streams[i].getId()===streamInfo.id)return streams[i];return null}function onTimeSyncCompleted(){var manifest=manifestModel.getValue();protectionController&&(eventBus.trigger(_coreEventsEvents2.default.PROTECTION_CREATED,{controller:protectionController,manifest:manifest}),protectionController.setMediaElement(videoModel.getElement()),protectionData&&protectionController.setProtectionData(protectionData)),function composeStreams(){try{var streamsInfo=adapter.getStreamsInfo();if(0===streamsInfo.length)throw new Error("There are no streams");var manifestUpdateInfo=dashMetrics.getCurrentManifestUpdate(metricsModel.getMetricsFor(_constantsConstants2.default.STREAM));metricsModel.updateManifestUpdateInfo(manifestUpdateInfo,{currentTime:playbackController.getTime(),buffered:videoModel.getBufferRange(),presentationStartTime:streamsInfo[0].start,clientTimeOffset:timelineConverter.getClientTimeOffset()});for(var i=0,ln=streamsInfo.length;i<ln;i++){var streamInfo=streamsInfo[i],stream=getComposedStream(streamInfo);stream?stream.updateData(streamInfo):(stream=(0,_Stream2.default)(context).create({manifestModel:manifestModel,dashManifestModel:dashManifestModel,mediaPlayerModel:mediaPlayerModel,metricsModel:metricsModel,dashMetrics:dashMetrics,manifestUpdater:manifestUpdater,adapter:adapter,timelineConverter:timelineConverter,capabilities:capabilities,errHandler:errHandler,baseURLController:baseURLController,domStorage:domStorage,abrController:abrController,playbackController:playbackController,mediaController:mediaController,textController:textController,videoModel:videoModel,streamController:instance}),streams.push(stream),stream.initialize(streamInfo,protectionController)),metricsModel.addManifestUpdateStreamInfo(manifestUpdateInfo,streamInfo.id,streamInfo.index,streamInfo.start,streamInfo.duration)}if(!activeStream){var startTimeFormUriParameters=playbackController.getStartTimeFromUriParameters(),initialStream=null;if(startTimeFormUriParameters)initialStream=getStreamForTime(isNaN(startTimeFormUriParameters.fragS)?startTimeFormUriParameters.fragT:startTimeFormUriParameters.fragS);switchStream(null,null!==initialStream?initialStream:streams[0],NaN)}eventBus.trigger(_coreEventsEvents2.default.STREAMS_COMPOSED)}catch(e){errHandler.manifestError(e.message,"nostreamscomposed",manifestModel.getValue()),errHandler.error(new _voDashJSError2.default(_coreErrorsErrors2.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e.message+"nostreamscomposed",manifestModel.getValue())),hasInitialisationError=!0,reset()}}()}function onManifestUpdated(e){e.error?(hasInitialisationError=!0,reset()):function(){var manifest=e.manifest;adapter.updatePeriods(manifest);var streamInfo=adapter.getStreamsInfo(void 0,1)[0],mediaInfo=adapter.getMediaInfoForType(streamInfo,_constantsConstants2.default.VIDEO)||adapter.getMediaInfoForType(streamInfo,_constantsConstants2.default.AUDIO),useCalculatedLiveEdgeTime=void 0;mediaInfo&&(useCalculatedLiveEdgeTime=dashManifestModel.getUseCalculatedLiveEdgeTimeForAdaptation(adapter.getDataForMedia(mediaInfo)))&&(logger.debug("SegmentTimeline detected using calculated Live Edge Time"),mediaPlayerModel.setUseManifestDateHeaderTimeSource(!1));var manifestUTCTimingSources=dashManifestModel.getUTCTimingSources(e.manifest),allUTCTimingSources=!dashManifestModel.getIsDynamic(manifest)||useCalculatedLiveEdgeTime?manifestUTCTimingSources:manifestUTCTimingSources.concat(mediaPlayerModel.getUTCTimingSources()),isHTTPS=urlUtils.isHTTPS(e.manifest.url);allUTCTimingSources.forEach((function(item){item.value.replace(/.*?:\/\//g,"")===mediaPlayerModel.getDefaultUtcTimingSource().value.replace(/.*?:\/\//g,"")&&(item.value=item.value.replace(isHTTPS?new RegExp(/^(http:)?\/\//i):new RegExp(/^(https:)?\/\//i),isHTTPS?"https://":"http://"),logger.debug("Matching default timing source protocol to manifest protocol: ",item.value))})),baseURLController.initialize(manifest),timeSyncController.setConfig({metricsModel:metricsModel,dashMetrics:dashMetrics,baseURLController:baseURLController}),timeSyncController.initialize(allUTCTimingSources,mediaPlayerModel.getUseManifestDateHeaderTimeSource())}()}function isTrackTypePresent(trackType){var isTrackTypeDetected=void 0;if(!trackType)return isTrackTypeDetected;switch(trackType){case _constantsConstants2.default.VIDEO:isTrackTypeDetected=videoTrackDetected;break;case _constantsConstants2.default.AUDIO:isTrackTypeDetected=audioTrackDetected}return isTrackTypeDetected}function checkTrackPresence(type){var isDetected=!1;return getActiveStreamProcessors().forEach((function(p){p.getMediaInfo().type===type&&(isDetected=!0)})),isDetected}function flushPlaylistMetrics(reason,time){time=time||new Date,playListMetrics&&(getActiveStreamProcessors().forEach((function(p){var ctrlr=p.getScheduleController();ctrlr&&ctrlr.finalisePlayList(time,reason)})),metricsModel.addPlayList(playListMetrics),playListMetrics=null)}function addPlaylistMetrics(startReason){(playListMetrics=new _voMetricsPlayList.PlayList).start=new Date,playListMetrics.mstart=1e3*playbackController.getTime(),playListMetrics.starttype=startReason,getActiveStreamProcessors().forEach((function(p){var ctrlr=p.getScheduleController();ctrlr&&ctrlr.setPlayList(playListMetrics)}))}function onPlaybackError(e){if(e.error){var msg="";switch(e.error.code){case 1:msg="MEDIA_ERR_ABORTED";break;case 2:msg="MEDIA_ERR_NETWORK";break;case 3:msg="MEDIA_ERR_DECODE";break;case 4:msg="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:msg="MEDIA_ERR_ENCRYPTED";break;default:msg="UNKNOWN"}hasMediaError=!0,e.error.message&&(msg+=" ("+e.error.message+")"),e.error.msExtendedCode&&(msg+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),logger.fatal("Video Element Error: "+msg),e.error&&logger.fatal(e.error),errHandler.mediaSourceError(msg),errHandler.error(new _voDashJSError2.default(e.error.code,msg)),reset()}}function getActiveStreamInfo(){return activeStream?activeStream.getStreamInfo():null}function checkSetConfigCall(){if(!(manifestLoader&&manifestLoader.hasOwnProperty("load")&&timelineConverter&&timelineConverter.hasOwnProperty("initialize")&&timelineConverter.hasOwnProperty("reset")&&timelineConverter.hasOwnProperty("getClientTimeOffset")&&manifestModel&&errHandler&&metricsModel&&playbackController))throw new Error("setConfig function has to be called previously")}function onManifestValidityChanged(e){isNaN(e.newDuration)||setMediaDuration(e.newDuration)}function resetInitialSettings(){streams=[],protectionController=null,isStreamSwitchingInProgress=!1,activeStream=null,hasMediaError=!1,hasInitialisationError=!1,videoTrackDetected=void 0,audioTrackDetected=void 0,initialPlayback=!0,isPaused=!1,autoPlay=!0,playListMetrics=null,playbackEndedTimerId=void 0,isPeriodSwitchInProgress=!1,wallclockTicked=0}function reset(){checkSetConfigCall(),timeSyncController.reset(),flushPlaylistMetrics(hasMediaError||hasInitialisationError?_voMetricsPlayList.PlayListTrace.FAILURE_STOP_REASON:_voMetricsPlayList.PlayListTrace.USER_REQUEST_STOP_REASON);for(var i=0,ln=streams?streams.length:0;i<ln;i++){streams[i].reset(hasMediaError)}!function unRegisterEvents(){eventBus.off(_coreEventsEvents2.default.PLAYBACK_TIME_UPDATED,onPlaybackTimeUpdated,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_SEEKING,onPlaybackSeeking,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_ERROR,onPlaybackError,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_STARTED,onPlaybackStarted,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_PAUSED,onPlaybackPaused,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_ENDED,onEnded,this),eventBus.off(_coreEventsEvents2.default.MANIFEST_UPDATED,onManifestUpdated,this),eventBus.off(_coreEventsEvents2.default.BUFFERING_COMPLETED,onTrackBufferingCompleted,this),eventBus.off(_coreEventsEvents2.default.STREAM_BUFFERING_COMPLETED,onStreamBufferingCompleted,this),eventBus.off(_coreEventsEvents2.default.MANIFEST_VALIDITY_CHANGED,onManifestValidityChanged,this),eventBus.off(_coreEventsEvents2.default.TIME_SYNCHRONIZATION_COMPLETED,onTimeSyncCompleted,this),eventBus.off(_coreEventsEvents2.default.WALLCLOCK_TIME_UPDATED,onWallclockTimeUpdated,this),eventBus.off(_MediaPlayerEvents2.default.METRIC_ADDED,onMetricAdded,this)}(),baseURLController.reset(),manifestUpdater.reset(),metricsModel.clearAllCurrentMetrics(),manifestModel.setValue(null),manifestLoader.reset(),timelineConverter.reset(),initCache.reset(),mediaSource&&(mediaSourceController.detachMediaSource(videoModel),mediaSource=null),videoModel=null,protectionController&&(protectionController.setMediaElement(null),protectionController=null,protectionData=null,manifestModel.getValue()&&eventBus.trigger(_coreEventsEvents2.default.PROTECTION_DESTROYED,{data:manifestModel.getValue().url})),eventBus.trigger(_coreEventsEvents2.default.STREAM_TEARDOWN_COMPLETE),resetInitialSettings()}function onMetricAdded(e){e.metric===_constantsMetricsConstants2.default.DVR_INFO&&e.mediaType===_constantsConstants2.default.AUDIO&&mediaSourceController.setSeekable(mediaSource,e.value.range.start,e.value.range.end)}return instance={initialize:function initialize(autoPl,protData){checkSetConfigCall(),autoPlay=autoPl,protectionData=protData,timelineConverter.initialize(),(manifestUpdater=(0,_ManifestUpdater2.default)(context).create()).setConfig({manifestModel:manifestModel,dashManifestModel:dashManifestModel,mediaPlayerModel:mediaPlayerModel,manifestLoader:manifestLoader,errHandler:errHandler}),manifestUpdater.initialize(),baseURLController.setConfig({dashManifestModel:dashManifestModel}),function registerEvents(){eventBus.on(_coreEventsEvents2.default.PLAYBACK_TIME_UPDATED,onPlaybackTimeUpdated,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_SEEKING,onPlaybackSeeking,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_ERROR,onPlaybackError,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_STARTED,onPlaybackStarted,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_PAUSED,onPlaybackPaused,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_ENDED,onEnded,this),eventBus.on(_coreEventsEvents2.default.MANIFEST_UPDATED,onManifestUpdated,this),eventBus.on(_coreEventsEvents2.default.BUFFERING_COMPLETED,onTrackBufferingCompleted,this),eventBus.on(_coreEventsEvents2.default.STREAM_BUFFERING_COMPLETED,onStreamBufferingCompleted,this),eventBus.on(_coreEventsEvents2.default.MANIFEST_VALIDITY_CHANGED,onManifestValidityChanged,this),eventBus.on(_coreEventsEvents2.default.TIME_SYNCHRONIZATION_COMPLETED,onTimeSyncCompleted,this),eventBus.on(_coreEventsEvents2.default.WALLCLOCK_TIME_UPDATED,onWallclockTimeUpdated,this),eventBus.on(_MediaPlayerEvents2.default.METRIC_ADDED,onMetricAdded,this)}()},getActiveStreamInfo:getActiveStreamInfo,isTrackTypePresent:isTrackTypePresent,switchToVideoElement:function switchToVideoElement(seekTime){activeStream&&(playbackController.initialize(getActiveStreamInfo()),openMediaSource(seekTime,null,!0,!1))},getStreamById:function getStreamById(id){return streams.filter((function(item){return item.getId()===id}))[0]},getStreamForTime:getStreamForTime,getTimeRelativeToStreamId:function getTimeRelativeToStreamId(time,id){for(var stream=null,baseStart=0,streamStart=0,streamDur=null,ln=streams.length,i=0;i<ln;i++){if(streamStart=(stream=streams[i]).getStartTime(),streamDur=stream.getDuration(),Number.isFinite(streamStart)&&(baseStart=streamStart),stream.getId()===id)return time-baseStart;Number.isFinite(streamDur)&&(baseStart+=streamDur)}return null},load:function load(url){checkSetConfigCall(),manifestLoader.load(url)},loadWithManifest:function loadWithManifest(manifest){!function checkInitializeCall(){if(!manifestUpdater||!manifestUpdater.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}(),manifestUpdater.setManifest(manifest)},getActiveStreamProcessors:getActiveStreamProcessors,setConfig:function setConfig(config){config&&(config.capabilities&&(capabilities=config.capabilities),config.manifestLoader&&(manifestLoader=config.manifestLoader),config.manifestModel&&(manifestModel=config.manifestModel),config.dashManifestModel&&(dashManifestModel=config.dashManifestModel),config.mediaPlayerModel&&(mediaPlayerModel=config.mediaPlayerModel),config.protectionController&&(protectionController=config.protectionController),config.adapter&&(adapter=config.adapter),config.metricsModel&&(metricsModel=config.metricsModel),config.dashMetrics&&(dashMetrics=config.dashMetrics),config.errHandler&&(errHandler=config.errHandler),config.timelineConverter&&(timelineConverter=config.timelineConverter),config.videoModel&&(videoModel=config.videoModel),config.playbackController&&(playbackController=config.playbackController),config.domStorage&&(domStorage=config.domStorage),config.abrController&&(abrController=config.abrController),config.mediaController&&(mediaController=config.mediaController),config.textController&&(textController=config.textController))},setProtectionData:function setProtectionData(protData){protectionData=protData},reset:reset},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),timeSyncController=(0,_TimeSyncController2.default)(context).getInstance(),baseURLController=(0,_BaseURLController2.default)(context).getInstance(),mediaSourceController=(0,_MediaSourceController2.default)(context).getInstance(),initCache=(0,_utilsInitCache2.default)(context).getInstance(),urlUtils=(0,_utilsURLUtils2.default)(context).getInstance(),resetInitialSettings()}(),instance}StreamController.__dashjs_factory_name="StreamController",exports.default=_coreFactoryMaker2.default.getSingletonFactory(StreamController),module.exports=exports.default},1498:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_StreamProcessor2=_interopRequireDefault(__webpack_require__(1499)),_controllersEventController2=_interopRequireDefault(__webpack_require__(1515)),_controllersFragmentController2=_interopRequireDefault(__webpack_require__(1516)),_thumbnailThumbnailController2=_interopRequireDefault(__webpack_require__(1520)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371));function Stream(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),manifestModel=config.manifestModel,dashManifestModel=config.dashManifestModel,mediaPlayerModel=config.mediaPlayerModel,manifestUpdater=config.manifestUpdater,adapter=config.adapter,capabilities=config.capabilities,errHandler=config.errHandler,timelineConverter=config.timelineConverter,metricsModel=config.metricsModel,abrController=config.abrController,playbackController=config.playbackController,mediaController=config.mediaController,textController=config.textController,videoModel=config.videoModel,instance=void 0,logger=void 0,streamProcessors=void 0,isStreamActivated=void 0,isMediaInitialized=void 0,streamInfo=void 0,updateError=void 0,isUpdating=void 0,protectionController=void 0,fragmentController=void 0,thumbnailController=void 0,eventController=void 0,preloaded=void 0,trackChangedEvent=void 0,codecCompatibilityTable=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function deactivate(keepBuffers){for(var ln=streamProcessors?streamProcessors.length:0,i=0;i<ln;i++){streamProcessors[i].getFragmentModel().removeExecutedRequestsBeforeTime(getStartTime()+getDuration()),streamProcessors[i].reset(!1,keepBuffers)}streamProcessors=[],isStreamActivated=!1,isMediaInitialized=!1,setPreloaded(!1),eventBus.off(_coreEventsEvents2.default.CURRENT_TRACK_CHANGED,onCurrentTrackChanged,instance)}function resetInitialSettings(){deactivate(),streamInfo=null,updateError={},isUpdating=!1}function reset(){playbackController&&playbackController.pause(),fragmentController&&(fragmentController.reset(),fragmentController=null),resetInitialSettings(),function unRegisterEvents(){eventBus.off(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,onDataUpdateCompleted,instance),eventBus.off(_coreEventsEvents2.default.BUFFERING_COMPLETED,onBufferingCompleted,instance)}(),function unRegisterProtectionEvents(){protectionController&&(eventBus.off(_coreEventsEvents2.default.KEY_ERROR,onProtectionError,instance),eventBus.off(_coreEventsEvents2.default.SERVER_CERTIFICATE_UPDATED,onProtectionError,instance),eventBus.off(_coreEventsEvents2.default.LICENSE_REQUEST_COMPLETE,onProtectionError,instance),eventBus.off(_coreEventsEvents2.default.KEY_SYSTEM_SELECTED,onProtectionError,instance),eventBus.off(_coreEventsEvents2.default.KEY_SESSION_CREATED,onProtectionError,instance),eventBus.off(_coreEventsEvents2.default.KEY_STATUSES_CHANGED,onProtectionError,instance))}(),setPreloaded(!1)}function getDuration(){return streamInfo?streamInfo.duration:NaN}function getStartTime(){return streamInfo?streamInfo.start:NaN}function getStreamInfo(){return streamInfo}function checkConfig(){if(!(abrController&&abrController.hasOwnProperty("getBitrateList")&&adapter&&adapter.hasOwnProperty("getAllMediaInfoForType")&&adapter.hasOwnProperty("getEventsFor")))throw new Error(_constantsConstants2.default.MISSING_CONFIG_ERROR)}function onProtectionError(event){event.error&&(errHandler.mediaKeySessionError(event.error.message),errHandler.error(event.error),logger.fatal(event.error.message),reset())}function isMediaSupported(mediaInfo){var codec,type=mediaInfo.type,msg=void 0;if(type===_constantsConstants2.default.MUXED&&mediaInfo)return msg="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",logger.fatal(msg),errHandler.manifestError(msg,"multiplexedrep",manifestModel.getValue()),errHandler.error(new _voDashJSError2.default(_coreErrorsErrors2.default.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,msg,manifestModel.getValue())),!1;if(type===_constantsConstants2.default.TEXT||type===_constantsConstants2.default.FRAGMENTED_TEXT||type===_constantsConstants2.default.EMBEDDED_TEXT||type===_constantsConstants2.default.IMAGE)return!0;if(codec=mediaInfo.codec,logger.debug(type+" codec: "+codec),mediaInfo.contentProtection&&!capabilities.supportsEncryptedMedia())errHandler.capabilityError("encryptedmedia"),errHandler.error(new _voDashJSError2.default(_coreErrorsErrors2.default.CAPABILITY_MEDIAKEYS_ERROR_CODE,_coreErrorsErrors2.default.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE));else if(!capabilities.supportsCodec(codec))return msg=type+"Codec ("+codec+") is not supported.",logger.error(msg),!1;return!0}function onCurrentTrackChanged(e){if(e.newMediaInfo.streamInfo.id===streamInfo.id){var processor=getProcessorForMediaInfo(e.newMediaInfo);if(processor){var currentTime=playbackController.getTime();logger.info("Stream -  Process track changed at current time "+currentTime);var mediaInfo=e.newMediaInfo,manifest=manifestModel.getValue();adapter.setCurrentMediaInfo(streamInfo.id,mediaInfo.type,mediaInfo),logger.debug("Stream -  Update stream controller"),manifest.refreshManifestOnSwitchTrack?(logger.debug("Stream -  Refreshing manifest for switch track"),trackChangedEvent=e,manifestUpdater.refreshManifest()):(processor.selectMediaInfo(mediaInfo),mediaInfo.type!==_constantsConstants2.default.FRAGMENTED_TEXT?(abrController.updateTopQualityIndex(mediaInfo),processor.switchTrackAsked(),processor.getFragmentModel().abortRequests()):(processor.getScheduleController().setSeekTarget(NaN),adapter.setIndexHandlerTime(processor,currentTime),adapter.resetIndexHandler(processor)))}}}function initializeMediaForType(type,mediaSource){var allMediaForType=adapter.getAllMediaInfoForType(streamInfo,type),mediaInfo=null,initialMediaInfo=void 0;if(allMediaForType&&0!==allMediaForType.length){for(var i=0,ln=allMediaForType.length;i<ln;i++)if(mediaInfo=allMediaForType[i],type===_constantsConstants2.default.EMBEDDED_TEXT)textController.addEmbeddedTrack(mediaInfo);else{if(!isMediaSupported(mediaInfo))continue;mediaController.addTrack(mediaInfo)}type!==_constantsConstants2.default.EMBEDDED_TEXT&&0!==mediaController.getTracksFor(type,streamInfo).length&&(type!==_constantsConstants2.default.IMAGE?((type!==_constantsConstants2.default.FRAGMENTED_TEXT||type===_constantsConstants2.default.FRAGMENTED_TEXT&&textController.getTextDefaultEnabled())&&(mediaController.checkInitialMediaSettingsForType(type,streamInfo),initialMediaInfo=mediaController.getCurrentTrackFor(type,streamInfo)),type!==_constantsConstants2.default.FRAGMENTED_TEXT||textController.getTextDefaultEnabled()||(initialMediaInfo=mediaController.getTracksFor(type,streamInfo)[0]),function createStreamProcessor(mediaInfo,allMediaForType,mediaSource,optionalSettings){var streamProcessor=(0,_StreamProcessor2.default)(context).create({type:mediaInfo.type,mimeType:mediaInfo.mimeType,timelineConverter:timelineConverter,adapter:adapter,manifestModel:manifestModel,dashManifestModel:dashManifestModel,mediaPlayerModel:mediaPlayerModel,metricsModel:metricsModel,dashMetrics:config.dashMetrics,baseURLController:config.baseURLController,stream:instance,abrController:abrController,domStorage:config.domStorage,playbackController:playbackController,mediaController:mediaController,streamController:config.streamController,textController:textController,errHandler:errHandler});if(streamProcessor.initialize(mediaSource),abrController.updateTopQualityIndex(mediaInfo),optionalSettings?(streamProcessor.setBuffer(optionalSettings.buffer),streamProcessor.getIndexHandler().setCurrentTime(optionalSettings.currentTime),streamProcessors[optionalSettings.replaceIdx]=streamProcessor):streamProcessors.push(streamProcessor),!optionalSettings||!optionalSettings.ignoreMediaInfo)if(mediaInfo.type===_constantsConstants2.default.TEXT||mediaInfo.type===_constantsConstants2.default.FRAGMENTED_TEXT){for(var idx=void 0,i=0;i<allMediaForType.length;i++)allMediaForType[i].index===mediaInfo.index&&(idx=i),streamProcessor.addMediaInfo(allMediaForType[i]);streamProcessor.selectMediaInfo(allMediaForType[idx])}else streamProcessor.addMediaInfo(mediaInfo,!0)}(initialMediaInfo,allMediaForType,mediaSource)):thumbnailController=(0,_thumbnailThumbnailController2.default)(context).create({dashManifestModel:dashManifestModel,adapter:adapter,baseURLController:config.baseURLController,stream:instance,timelineConverter:config.timelineConverter}))}else logger.info("No "+type+" data.")}function initializeEventController(){eventController||((eventController=(0,_controllersEventController2.default)(context).create()).setConfig({manifestUpdater:manifestUpdater,playbackController:playbackController}),addInlineEvents())}function addInlineEvents(){var events=adapter.getEventsFor(streamInfo);eventController.addInlineEvents(events)}function filterCodecs(type){var realAdaptation=adapter.getAdaptationForType(manifestModel.getValue(),streamInfo.index,type,streamInfo);realAdaptation&&Array.isArray(realAdaptation.Representation_asArray)&&(realAdaptation.Representation_asArray=realAdaptation.Representation_asArray.filter((function(_,i){if(0===i)return!0;var codec=dashManifestModel.getCodec(realAdaptation,i,!0);return!!capabilities.supportsCodec(codec)||(logger.error("[Stream] codec not supported: "+codec),!1)})))}function checkIfInitializationCompleted(){for(var ln=streamProcessors.length,error=!!updateError.audio||!!updateError.video?new _voDashJSError2.default(_coreErrorsErrors2.default.DATA_UPDATE_FAILED_ERROR_CODE,_coreErrorsErrors2.default.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,i=0;i<ln;i++)if(streamProcessors[i].isUpdating()||isUpdating)return;if(isMediaInitialized){if(protectionController)for(i=0;i<ln&&streamProcessors[i];i++)streamProcessors[i].getType()!==_constantsConstants2.default.AUDIO&&streamProcessors[i].getType()!==_constantsConstants2.default.VIDEO&&streamProcessors[i].getType()!==_constantsConstants2.default.FRAGMENTED_TEXT||protectionController.initializeForMedia(streamProcessors[i].getMediaInfo());eventBus.trigger(_coreEventsEvents2.default.STREAM_INITIALIZED,{streamInfo:streamInfo,error:error})}}function createBuffers(previousBuffers){for(var buffers={},i=0,ln=streamProcessors.length;i<ln;i++)buffers[streamProcessors[i].getType()]=streamProcessors[i].createBuffer(previousBuffers).getBuffer();return buffers}function onBufferingCompleted(e){if(e.streamInfo===streamInfo){var processors=getProcessors(),ln=processors.length;if(0!==ln){for(var i=0;i<ln;i++)if(!processors[i].isBufferingCompleted()&&(processors[i].getType()===_constantsConstants2.default.AUDIO||processors[i].getType()===_constantsConstants2.default.VIDEO))return void logger.warn("onBufferingCompleted - One streamProcessor has finished but",processors[i].getType(),"one is not buffering completed");logger.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),eventBus.trigger(_coreEventsEvents2.default.STREAM_BUFFERING_COMPLETED,{streamInfo:streamInfo})}else logger.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}}function onDataUpdateCompleted(e){var sp=e.sender.getStreamProcessor();sp.getStreamInfo()===streamInfo&&(updateError[sp.getType()]=e.error,checkIfInitializationCompleted())}function getProcessorForMediaInfo(mediaInfo){return mediaInfo?getProcessors().filter((function(processor){return processor.getType()===mediaInfo.type}))[0]:null}function getProcessors(){for(var ln=streamProcessors.length,arr=[],type=void 0,streamProcessor=void 0,i=0;i<ln;i++)(type=(streamProcessor=streamProcessors[i]).getType())!==_constantsConstants2.default.AUDIO&&type!==_constantsConstants2.default.VIDEO&&type!==_constantsConstants2.default.FRAGMENTED_TEXT&&type!==_constantsConstants2.default.TEXT||arr.push(streamProcessor);return arr}function compareProtectionConfig(stream,type){if(!stream)return!1;var newStreamInfo=stream.getStreamInfo(),currentStreamInfo=getStreamInfo();if(!newStreamInfo||!currentStreamInfo)return!1;var newAdaptation=adapter.getAdaptationForType(manifestModel.getValue(),newStreamInfo.index,type,newStreamInfo),currentAdaptation=adapter.getAdaptationForType(manifestModel.getValue(),currentStreamInfo.index,type,currentStreamInfo);return newAdaptation&&currentAdaptation?!newAdaptation.ContentProtection&&!currentAdaptation.ContentProtection:!newAdaptation&&!currentAdaptation}function compareCodecs(stream,type){if(!stream)return!1;var newStreamInfo=stream.getStreamInfo(),currentStreamInfo=getStreamInfo();if(!newStreamInfo||!currentStreamInfo)return!1;var newAdaptation=adapter.getAdaptationForType(manifestModel.getValue(),newStreamInfo.index,type,newStreamInfo),currentAdaptation=adapter.getAdaptationForType(manifestModel.getValue(),currentStreamInfo.index,type,currentStreamInfo);if(!newAdaptation||!currentAdaptation)return!newAdaptation&&!currentAdaptation;var sameMimeType=newAdaptation&&currentAdaptation&&newAdaptation.mimeType===currentAdaptation.mimeType,oldCodecs=currentAdaptation.Representation_asArray.map((function(representation){return representation.codecs})),newCodecs=newAdaptation.Representation_asArray.map((function(representation){return representation.codecs})),codecMatch=newCodecs.some((function(newCodec){return oldCodecs.indexOf(newCodec)>-1})),partialCodecMatch=newCodecs.some((function(newCodec){return oldCodecs.some((function(oldCodec){return function codecRootCompatibleWithCodec(codec1,codec2){for(var codecRoot=codec1.split(".")[0],rootCompatible=0===codec2.indexOf(codecRoot),compatTableCodec=void 0,i=0;i<codecCompatibilityTable.length;i++)if(codecCompatibilityTable[i].codec===codecRoot){compatTableCodec=codecCompatibilityTable[i];break}if(compatTableCodec)return rootCompatible||compatTableCodec.compatibleCodecs.some((function(compatibleCodec){return 0===codec2.indexOf(compatibleCodec)}));return rootCompatible}(oldCodec,newCodec)}))}));return codecMatch||partialCodecMatch&&sameMimeType}function setPreloaded(value){preloaded=value}function getPreloaded(){return preloaded}return instance={initialize:function initialize(StreamInfo,ProtectionController){streamInfo=StreamInfo,protectionController=ProtectionController,function registerProtectionEvents(){protectionController&&(eventBus.on(_coreEventsEvents2.default.KEY_ERROR,onProtectionError,instance),eventBus.on(_coreEventsEvents2.default.SERVER_CERTIFICATE_UPDATED,onProtectionError,instance),eventBus.on(_coreEventsEvents2.default.LICENSE_REQUEST_COMPLETE,onProtectionError,instance),eventBus.on(_coreEventsEvents2.default.KEY_SYSTEM_SELECTED,onProtectionError,instance),eventBus.on(_coreEventsEvents2.default.KEY_SESSION_CREATED,onProtectionError,instance),eventBus.on(_coreEventsEvents2.default.KEY_STATUSES_CHANGED,onProtectionError,instance))}()},activate:function activate(mediaSource,previousBuffers){if(!isStreamActivated){var result=void 0;return eventBus.on(_coreEventsEvents2.default.CURRENT_TRACK_CHANGED,onCurrentTrackChanged,instance),getPreloaded()?(!function initializeAfterPreload(){if(isUpdating=!0,checkConfig(),filterCodecs(_constantsConstants2.default.VIDEO),filterCodecs(_constantsConstants2.default.AUDIO),isMediaInitialized=!0,isUpdating=!1,0===streamProcessors.length){var msg="No streams to play.";errHandler.manifestError(msg,"nostreams",manifestModel.getValue()),logger.debug(msg)}else checkIfInitializationCompleted()}(),result=previousBuffers):result=function initializeMedia(mediaSource,previousBuffers){checkConfig();var element=videoModel.getElement();initializeEventController(),isUpdating=!0,filterCodecs(_constantsConstants2.default.VIDEO),filterCodecs(_constantsConstants2.default.AUDIO),(null===element||element&&/^VIDEO$/i.test(element.nodeName))&&initializeMediaForType(_constantsConstants2.default.VIDEO,mediaSource);initializeMediaForType(_constantsConstants2.default.AUDIO,mediaSource),initializeMediaForType(_constantsConstants2.default.TEXT,mediaSource),initializeMediaForType(_constantsConstants2.default.FRAGMENTED_TEXT,mediaSource),initializeMediaForType(_constantsConstants2.default.EMBEDDED_TEXT,mediaSource),initializeMediaForType(_constantsConstants2.default.MUXED,mediaSource),initializeMediaForType(_constantsConstants2.default.IMAGE,mediaSource);var buffers=createBuffers(previousBuffers);if(isMediaInitialized=!0,isUpdating=!1,0===streamProcessors.length){var msg="No streams to play.";errHandler.manifestError(msg,"nostreams",manifestModel.getValue()),errHandler.error(new _voDashJSError2.default(_coreErrorsErrors2.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,msg,manifestModel.getValue())),logger.fatal(msg)}else checkIfInitializationCompleted();return buffers}(mediaSource,previousBuffers),isStreamActivated=!0,result}return previousBuffers},deactivate:deactivate,isActive:function isActive(){return isStreamActivated},getDuration:getDuration,getStartTime:getStartTime,getId:function getId(){return streamInfo?streamInfo.id:null},getStreamInfo:getStreamInfo,preload:function preload(mediaSource,previousBuffers){initializeEventController(),initializeMediaForType(_constantsConstants2.default.VIDEO,mediaSource),initializeMediaForType(_constantsConstants2.default.AUDIO,mediaSource),initializeMediaForType(_constantsConstants2.default.TEXT,mediaSource),initializeMediaForType(_constantsConstants2.default.FRAGMENTED_TEXT,mediaSource),initializeMediaForType(_constantsConstants2.default.EMBEDDED_TEXT,mediaSource),initializeMediaForType(_constantsConstants2.default.MUXED,mediaSource),initializeMediaForType(_constantsConstants2.default.IMAGE,mediaSource),createBuffers(previousBuffers),eventBus.on(_coreEventsEvents2.default.CURRENT_TRACK_CHANGED,onCurrentTrackChanged,instance);for(var i=0;i<streamProcessors.length&&streamProcessors[i];i++)streamProcessors[i].getScheduleController().start();setPreloaded(!0)},getFragmentController:function getFragmentController(){return fragmentController},getThumbnailController:function getThumbnailController(){return thumbnailController},getBitrateListFor:function getBitrateListFor(type){if(checkConfig(),type===_constantsConstants2.default.IMAGE)return thumbnailController?thumbnailController.getBitrateList():[];var mediaInfo=function getMediaInfo(type){for(var ln=streamProcessors.length,streamProcessor=null,i=0;i<ln;i++)if((streamProcessor=streamProcessors[i]).getType()===type)return streamProcessor.getMediaInfo();return null}(type);return abrController.getBitrateList(mediaInfo)},startEventController:function startEventController(){eventController&&eventController.start()},stopEventController:function stopEventController(){eventController&&eventController.stop()},updateData:function updateData(updatedStreamInfo){logger.info("Manifest updated... updating data system wide."),isStreamActivated=!1,isUpdating=!0,streamInfo=updatedStreamInfo,eventController&&addInlineEvents(),filterCodecs(_constantsConstants2.default.VIDEO),filterCodecs(_constantsConstants2.default.AUDIO);for(var i=0,ln=streamProcessors.length;i<ln;i++){var streamProcessor=streamProcessors[i],mediaInfo=adapter.getMediaInfoForType(streamInfo,streamProcessor.getType());abrController.updateTopQualityIndex(mediaInfo),streamProcessor.addMediaInfo(mediaInfo,!0)}if(trackChangedEvent&&"fragmentedText"!==(mediaInfo=trackChangedEvent.newMediaInfo).type){var processor=getProcessorForMediaInfo(trackChangedEvent.oldMediaInfo);if(!processor)return;processor.switchTrackAsked(),trackChangedEvent=void 0}isUpdating=!1,checkIfInitializationCompleted()},reset:reset,getProcessors:getProcessors,setMediaSource:function setMediaSource(mediaSource){for(var i=0;i<streamProcessors.length;)isMediaSupported(streamProcessors[i].getMediaInfo())?(streamProcessors[i].setMediaSource(mediaSource),i++):(streamProcessors[i].reset(),streamProcessors.splice(i,1));for(i=0;i<streamProcessors.length;i++)streamProcessors[i].dischargePreBuffer();if(0===streamProcessors.length){var msg="No streams to play.";errHandler.manifestError(msg,"nostreams",manifestModel.getValue()),errHandler.error(new _voDashJSError2.default(_coreErrorsErrors2.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,msg+"nostreams",manifestModel.getValue())),logger.fatal(msg)}},isMediaCodecCompatible:function isMediaCodecCompatible(stream){return compareCodecs(stream,_constantsConstants2.default.VIDEO)&&compareCodecs(stream,_constantsConstants2.default.AUDIO)},isProtectionCompatible:function isProtectionCompatible(stream){return compareProtectionConfig(stream,_constantsConstants2.default.VIDEO)&&compareProtectionConfig(stream,_constantsConstants2.default.AUDIO)},getPreloaded:getPreloaded,addInbandEvents:function addInbandEvents(events){eventController&&eventController.addInbandEvents(events)}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),resetInitialSettings(),fragmentController=(0,_controllersFragmentController2.default)(context).create({mediaPlayerModel:mediaPlayerModel,metricsModel:metricsModel,errHandler:errHandler}),function registerEvents(){eventBus.on(_coreEventsEvents2.default.BUFFERING_COMPLETED,onBufferingCompleted,instance),eventBus.on(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,onDataUpdateCompleted,instance)}()}(),instance}Stream.__dashjs_factory_name="Stream",exports.default=_coreFactoryMaker2.default.getClassFactory(Stream),module.exports=exports.default},1499:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_utilsLiveEdgeFinder2=_interopRequireDefault(__webpack_require__(1500)),_controllersBufferController2=_interopRequireDefault(__webpack_require__(1377)),_textTextBufferController2=_interopRequireDefault(__webpack_require__(1501)),_controllersScheduleController2=_interopRequireDefault(__webpack_require__(1503)),_dashControllersRepresentationController2=_interopRequireDefault(__webpack_require__(1506)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_dashDashHandler2=_interopRequireDefault(__webpack_require__(1507));function StreamProcessor(config){config=config||{};var context=this.context,type=config.type,errHandler=config.errHandler,mimeType=config.mimeType,timelineConverter=config.timelineConverter,adapter=config.adapter,manifestModel=config.manifestModel,mediaPlayerModel=config.mediaPlayerModel,stream=config.stream,abrController=config.abrController,playbackController=config.playbackController,streamController=config.streamController,mediaController=config.mediaController,textController=config.textController,domStorage=config.domStorage,metricsModel=config.metricsModel,dashMetrics=config.dashMetrics,dashManifestModel=config.dashManifestModel,instance=void 0,mediaInfo=void 0,mediaInfoArr=void 0,bufferController=void 0,scheduleController=void 0,liveEdgeFinder=void 0,representationController=void 0,fragmentModel=void 0,spExternalControllers=void 0,indexHandler=void 0;function unregisterAllExternalController(){spExternalControllers=[]}function resetInitialSettings(){mediaInfoArr=[],mediaInfo=null,unregisterAllExternalController()}function getStreamInfo(){return stream?stream.getStreamInfo():null}function getMediaInfo(){return mediaInfo}return instance={initialize:function initialize(mediaSource){(indexHandler=(0,_dashDashHandler2.default)(context).create({mimeType:mimeType,timelineConverter:timelineConverter,dashMetrics:dashMetrics,metricsModel:metricsModel,mediaPlayerModel:mediaPlayerModel,baseURLController:config.baseURLController,errHandler:errHandler})).initialize(instance),abrController.registerStreamType(type,instance),(fragmentModel=stream.getFragmentController().getModel(type)).setStreamProcessor(instance),bufferController=function createBufferControllerForType(type){var controller=null;controller=type===_constantsConstants2.default.VIDEO||type===_constantsConstants2.default.AUDIO?(0,_controllersBufferController2.default)(context).create({type:type,metricsModel:metricsModel,mediaPlayerModel:mediaPlayerModel,manifestModel:manifestModel,errHandler:errHandler,streamController:streamController,mediaController:mediaController,adapter:adapter,textController:textController,abrController:abrController,playbackController:playbackController,streamProcessor:instance}):(0,_textTextBufferController2.default)(context).create({type:type,mimeType:mimeType,metricsModel:metricsModel,mediaPlayerModel:mediaPlayerModel,manifestModel:manifestModel,errHandler:errHandler,streamController:streamController,mediaController:mediaController,adapter:adapter,textController:textController,abrController:abrController,playbackController:playbackController,streamProcessor:instance});return controller}(type),scheduleController=(0,_controllersScheduleController2.default)(context).create({type:type,mimeType:mimeType,metricsModel:metricsModel,adapter:adapter,dashMetrics:dashMetrics,dashManifestModel:dashManifestModel,timelineConverter:timelineConverter,mediaPlayerModel:mediaPlayerModel,abrController:abrController,playbackController:playbackController,streamController:streamController,textController:textController,streamProcessor:instance,mediaController:mediaController}),(representationController=(0,_dashControllersRepresentationController2.default)(context).create()).setConfig({abrController:abrController,domStorage:domStorage,metricsModel:metricsModel,dashMetrics:dashMetrics,dashManifestModel:dashManifestModel,manifestModel:manifestModel,playbackController:playbackController,timelineConverter:timelineConverter,streamProcessor:instance}),bufferController.initialize(mediaSource),scheduleController.initialize(),representationController.initialize()},isUpdating:function isUpdating(){return!!representationController&&representationController.isUpdating()},getType:function getType(){return type},getBufferController:function getBufferController(){return bufferController},getFragmentModel:function getFragmentModel(){return fragmentModel},getScheduleController:function getScheduleController(){return scheduleController},getLiveEdgeFinder:function getLiveEdgeFinder(){return liveEdgeFinder},getFragmentController:function getFragmentController(){return stream?stream.getFragmentController():null},getRepresentationController:function getRepresentationController(){return representationController},getIndexHandler:function getIndexHandler(){return indexHandler},getRepresentationInfo:function getRepresentationInfo(quality){return adapter.getRepresentationInfo(representationController,quality)},getBufferLevel:function getBufferLevel(){return bufferController.getBufferLevel()},switchInitData:function switchInitData(representationId,bufferResetEnabled){bufferController&&bufferController.switchInitData(getStreamInfo().id,representationId,bufferResetEnabled)},isBufferingCompleted:function isBufferingCompleted(){return!!bufferController&&bufferController.getIsBufferingCompleted()},timeIsBuffered:function timeIsBuffered(time){return!!bufferController&&null!==bufferController.getRangeAt(time,0)},createBuffer:function createBuffer(previousBuffers){return bufferController.getBuffer()||bufferController.createBuffer(mediaInfo,previousBuffers)},getStreamInfo:getStreamInfo,selectMediaInfo:function selectMediaInfo(newMediaInfo){newMediaInfo===mediaInfo||newMediaInfo&&mediaInfo&&newMediaInfo.type!==mediaInfo.type||(mediaInfo=newMediaInfo),adapter.updateData(this)},addMediaInfo:function addMediaInfo(newMediaInfo,selectNewMediaInfo){-1===mediaInfoArr.indexOf(newMediaInfo)&&mediaInfoArr.push(newMediaInfo),selectNewMediaInfo&&this.selectMediaInfo(newMediaInfo)},switchTrackAsked:function switchTrackAsked(){scheduleController.switchTrackAsked()},getMediaInfoArr:function getMediaInfoArr(){return mediaInfoArr},getMediaInfo:getMediaInfo,getMediaSource:function getMediaSource(){return bufferController.getMediaSource()},setMediaSource:function setMediaSource(mediaSource){bufferController.setMediaSource(mediaSource,getMediaInfo())},dischargePreBuffer:function dischargePreBuffer(){bufferController.dischargePreBuffer()},getBuffer:function getBuffer(){return bufferController.getBuffer()},setBuffer:function setBuffer(buffer){bufferController.setBuffer(buffer)},registerExternalController:function registerExternalController(controller){spExternalControllers.push(controller)},unregisterExternalController:function unregisterExternalController(controller){var index=spExternalControllers.indexOf(controller);-1!==index&&spExternalControllers.splice(index,1)},getExternalControllers:function getExternalControllers(){return spExternalControllers},unregisterAllExternalController:unregisterAllExternalController,addInbandEvents:function addInbandEvents(events){stream&&stream.addInbandEvents(events)},reset:function reset(errored,keepBuffers){indexHandler.reset(),bufferController&&(bufferController.reset(errored,keepBuffers),bufferController=null),scheduleController&&(scheduleController.reset(),scheduleController=null),representationController&&(representationController.reset(),representationController=null),abrController&&abrController.unRegisterStreamType(type),spExternalControllers.forEach((function(controller){controller.reset()})),resetInitialSettings(),type=null,stream=null,liveEdgeFinder&&(liveEdgeFinder.reset(),liveEdgeFinder=null)}},function setup(){playbackController&&playbackController.getIsDynamic()&&(liveEdgeFinder=(0,_utilsLiveEdgeFinder2.default)(context).create({timelineConverter:timelineConverter,streamProcessor:instance})),resetInitialSettings()}(),instance}StreamProcessor.__dashjs_factory_name="StreamProcessor",exports.default=_coreFactoryMaker2.default.getClassFactory(StreamProcessor),module.exports=exports.default},1500:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_constantsConstants2=_interopRequireDefault(__webpack_require__(1367));function LiveEdgeFinder(config){var timelineConverter=(config=config||{}).timelineConverter,streamProcessor=config.streamProcessor;return{getLiveEdge:function getLiveEdge(){!function checkConfig(){if(!(timelineConverter&&timelineConverter.hasOwnProperty("getExpectedLiveEdge")&&streamProcessor&&streamProcessor.hasOwnProperty("getRepresentationInfo")))throw new Error(_constantsConstants2.default.MISSING_CONFIG_ERROR)}();var representationInfo=streamProcessor.getRepresentationInfo(),dvrEnd=representationInfo.DVRWindow?representationInfo.DVRWindow.end:0,liveEdge=dvrEnd;return representationInfo.useCalculatedLiveEdgeTime&&(liveEdge=timelineConverter.getExpectedLiveEdge(),timelineConverter.setClientTimeOffset(liveEdge-dvrEnd)),liveEdge},reset:function reset(){timelineConverter=null,streamProcessor=null}}}LiveEdgeFinder.__dashjs_factory_name="LiveEdgeFinder",exports.default=_coreFactoryMaker2.default.getClassFactory(LiveEdgeFinder),module.exports=exports.default},1501:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_controllersBufferController2=_interopRequireDefault(__webpack_require__(1377)),_NotFragmentedTextBufferController2=_interopRequireDefault(__webpack_require__(1502));function TextBufferController(config){config=config||{};var instance,context=this.context,_BufferControllerImpl=void 0;function getBuffer(){return _BufferControllerImpl.getBuffer()}return instance={getBufferControllerType:function getBufferControllerType(){return _BufferControllerImpl.getBufferControllerType()},initialize:function initialize(source,StreamProcessor){return _BufferControllerImpl.initialize(source,StreamProcessor)},createBuffer:function createBuffer(mediaInfo){return _BufferControllerImpl.createBuffer(mediaInfo)},getType:function getType(){return _BufferControllerImpl.getType()},getStreamProcessor:function getStreamProcessor(){_BufferControllerImpl.getStreamProcessor()},setSeekStartTime:function setSeekStartTime(value){_BufferControllerImpl.setSeekStartTime(value)},getBuffer:getBuffer,setBuffer:function setBuffer(value){_BufferControllerImpl.setBuffer(value)},getBufferLevel:function getBufferLevel(){return _BufferControllerImpl.getBufferLevel()},setMediaSource:function setMediaSource(value){_BufferControllerImpl.setMediaSource(value)},getMediaSource:function getMediaSource(){return _BufferControllerImpl.getMediaSource()},getIsBufferingCompleted:function getIsBufferingCompleted(){return _BufferControllerImpl.getIsBufferingCompleted()},getIsPruningInProgress:function getIsPruningInProgress(){return _BufferControllerImpl.getIsPruningInProgress()},dischargePreBuffer:function dischargePreBuffer(){return _BufferControllerImpl.dischargePreBuffer()},switchInitData:function switchInitData(streamId,representationId){_BufferControllerImpl.switchInitData(streamId,representationId)},getRangeAt:function getRangeAt(time){return _BufferControllerImpl.getRangeAt(time)},reset:function reset(errored){_BufferControllerImpl.reset(errored)},updateTimestampOffset:function updateTimestampOffset(MSETimeOffset){var buffer=getBuffer();buffer.timestampOffset===MSETimeOffset||isNaN(MSETimeOffset)||(buffer.timestampOffset=MSETimeOffset)}},function setup(){_BufferControllerImpl=config.type===_constantsConstants2.default.FRAGMENTED_TEXT?(0,_controllersBufferController2.default)(context).create({type:config.type,metricsModel:config.metricsModel,mediaPlayerModel:config.mediaPlayerModel,manifestModel:config.manifestModel,errHandler:config.errHandler,streamController:config.streamController,mediaController:config.mediaController,adapter:config.adapter,textController:config.textController,abrController:config.abrController,playbackController:config.playbackController,streamProcessor:config.streamProcessor}):(0,_NotFragmentedTextBufferController2.default)(context).create({type:config.type,mimeType:config.mimeType,errHandler:config.errHandler,streamProcessor:config.streamProcessor})}(),instance}TextBufferController.__dashjs_factory_name="TextBufferController",exports.default=_coreFactoryMaker2.default.getClassFactory(TextBufferController),module.exports=exports.default},1502:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_utilsInitCache2=_interopRequireDefault(__webpack_require__(1411)),_SourceBufferSink2=_interopRequireDefault(__webpack_require__(1423)),_streamingTextTextController2=_interopRequireDefault(__webpack_require__(1401)),_streamingVoDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372));function NotFragmentedTextBufferController(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),textController=(0,_streamingTextTextController2.default)(context).getInstance(),errHandler=config.errHandler,type=config.type,mimeType=config.mimeType,streamProcessor=config.streamProcessor,instance=void 0,isBufferingCompleted=void 0,initialized=void 0,mediaSource=void 0,buffer=void 0,initCache=void 0;function setMediaSource(value){mediaSource=value}function onDataUpdateCompleted(e){e.sender.getStreamProcessor()===streamProcessor&&(initCache.extract(streamProcessor.getStreamInfo().id,e.sender.getCurrentRepresentation().id)||eventBus.trigger(_coreEventsEvents2.default.TIMED_TEXT_REQUESTED,{index:0,sender:e.sender}))}function onInitFragmentLoaded(e){e.fragmentModel===streamProcessor.getFragmentModel()&&e.chunk.bytes&&(initCache.save(e.chunk),buffer.append(e.chunk),eventBus.trigger(_coreEventsEvents2.default.STREAM_COMPLETED,{request:e.request,fragmentModel:e.fragmentModel}))}return instance={getBufferControllerType:function getBufferControllerType(){return"NotFragmentedTextBufferController"},initialize:function initialize(source){setMediaSource(source),initCache=(0,_utilsInitCache2.default)(context).getInstance()},createBuffer:function createBuffer(mediaInfo){try{if(buffer=(0,_SourceBufferSink2.default)(context).create(mediaSource,mediaInfo),!initialized){var textBuffer=buffer.getBuffer();textBuffer.hasOwnProperty(_constantsConstants2.default.INITIALIZE)&&textBuffer.initialize(mimeType,streamProcessor),initialized=!0}return buffer}catch(e){if(mediaInfo.isText||-1!==mediaInfo.codec.indexOf('codecs="stpp')||-1!==mediaInfo.codec.indexOf('codecs="wvtt'))try{buffer=textController.getTextSourceBuffer()}catch(e){errHandler.mediaSourceError("Error creating "+type+" source buffer."),errHandler.error(new _streamingVoDashJSError2.default(_coreErrorsErrors2.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,_coreErrorsErrors2.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+type+" : "+e.message))}else errHandler.mediaSourceError("Error creating "+type+" source buffer."),errHandler.error(new _streamingVoDashJSError2.default(_coreErrorsErrors2.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,_coreErrorsErrors2.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+type))}},getType:function getType(){return type},getStreamProcessor:function getStreamProcessor(){return streamProcessor},setSeekStartTime:function setSeekStartTime(){},getBuffer:function getBuffer(){return buffer},getBufferLevel:function getBufferLevel(){return 0},setMediaSource:setMediaSource,getMediaSource:function getMediaSource(){return mediaSource},getIsBufferingCompleted:function getIsBufferingCompleted(){return isBufferingCompleted},getIsPruningInProgress:function getIsPruningInProgress(){return!1},dischargePreBuffer:function dischargePreBuffer(){},switchInitData:function switchInitData(streamId,representationId){initCache.extract(streamId,representationId)||eventBus.trigger(_coreEventsEvents2.default.TIMED_TEXT_REQUESTED,{index:0,sender:instance})},getRangeAt:function getRangeAt(){return null},reset:function reset(errored){eventBus.off(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,onDataUpdateCompleted,instance),eventBus.off(_coreEventsEvents2.default.INIT_FRAGMENT_LOADED,onInitFragmentLoaded,instance),!errored&&buffer&&(buffer.abort(),buffer.reset(),buffer=null)},updateTimestampOffset:function updateTimestampOffset(MSETimeOffset){buffer.timestampOffset===MSETimeOffset||isNaN(MSETimeOffset)||(buffer.timestampOffset=MSETimeOffset)}},function setup(){initialized=!1,mediaSource=null,isBufferingCompleted=!1,eventBus.on(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,onDataUpdateCompleted,instance),eventBus.on(_coreEventsEvents2.default.INIT_FRAGMENT_LOADED,onInitFragmentLoaded,instance)}(),instance}NotFragmentedTextBufferController.__dashjs_factory_name="NotFragmentedTextBufferController",exports.default=_coreFactoryMaker2.default.getClassFactory(NotFragmentedTextBufferController),module.exports=exports.default},1503:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_voMetricsPlayList=__webpack_require__(1435),_AbrController2=_interopRequireDefault(__webpack_require__(1396)),_BufferController2=_interopRequireDefault(__webpack_require__(1377)),_rulesSchedulingBufferLevelRule2=_interopRequireDefault(__webpack_require__(1504)),_rulesSchedulingNextFragmentRequestRule2=_interopRequireDefault(__webpack_require__(1505)),_modelsFragmentModel2=_interopRequireDefault(__webpack_require__(1390)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_MediaController2=_interopRequireDefault(__webpack_require__(1410)),_dashUtilsSegmentsUtils=__webpack_require__(1380);function ScheduleController(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),metricsModel=config.metricsModel,adapter=config.adapter,dashMetrics=config.dashMetrics,dashManifestModel=config.dashManifestModel,timelineConverter=config.timelineConverter,mediaPlayerModel=config.mediaPlayerModel,abrController=config.abrController,playbackController=config.playbackController,streamController=config.streamController,textController=config.textController,type=config.type,streamProcessor=config.streamProcessor,mediaController=config.mediaController,instance=void 0,logger=void 0,fragmentModel=void 0,currentRepresentationInfo=void 0,initialRequest=void 0,isStopped=void 0,playListMetrics=void 0,playListTraceMetrics=void 0,playListTraceMetricsClosed=void 0,isFragmentProcessingInProgress=void 0,timeToLoadDelay=void 0,scheduleTimeout=void 0,seekTarget=void 0,bufferLevelRule=void 0,nextFragmentRequestRule=void 0,lastFragmentRequest=void 0,topQualityIndex=void 0,lastInitQuality=void 0,replaceRequestArray=void 0,switchTrack=void 0,bufferResetInProgress=void 0,mediaRequest=void 0,isReplacementRequest=void 0;function start(){currentRepresentationInfo&&!streamProcessor.isBufferingCompleted()?(logger.debug("Schedule Controller starts"),addPlaylistTraceMetrics(),isStopped=!1,initialRequest&&(initialRequest=!1),startScheduleTimer(0)):logger.warn("Start denied to Schedule Controller")}function stop(){isStopped||(logger.debug("Schedule Controller stops"),isStopped=!0,clearTimeout(scheduleTimeout))}function schedule(){var bufferController=streamProcessor.getBufferController();if(isStopped||isFragmentProcessingInProgress||!bufferController||playbackController.isPaused()&&!mediaPlayerModel.getScheduleWhilePaused()||!(type!==_constantsConstants2.default.FRAGMENTED_TEXT&&type!==_constantsConstants2.default.TEXT||textController.isTextEnabled()))logger.debug("Schedule stop!");else if(bufferController.getIsBufferingCompleted())logger.debug("Schedule stop because buffering is completed!");else{!function validateExecutedFragmentRequest(){var time=playbackController.getTime(),safeBufferLevel=1.5*currentRepresentationInfo.fragmentDuration,request=fragmentModel.getRequests({state:_modelsFragmentModel2.default.FRAGMENT_MODEL_EXECUTED,time:time+safeBufferLevel,threshold:0})[0];if(request&&-1===replaceRequestArray.indexOf(request)&&!dashManifestModel.getIsTextTrack(type)){var fastSwitchModeEnabled=mediaPlayerModel.getFastSwitchEnabled(),bufferLevel=streamProcessor.getBufferLevel(),abandonmentState=abrController.getAbandonmentStateFor(type),trackChanged=!mediaController.isCurrentTrack(request.mediaInfo)&&mediaController.getSwitchMode(request.mediaInfo.type)===_MediaController2.default.TRACK_SWITCH_MODE_NEVER_REPLACE,qualityChanged=request.quality<currentRepresentationInfo.quality;fastSwitchModeEnabled&&(trackChanged||qualityChanged)&&bufferLevel>=safeBufferLevel&&abandonmentState!==_AbrController2.default.ABANDON_LOAD?(replaceRequest(request),isReplacementRequest=!0,logger.debug("Reloading outdated fragment at index: ",request.index)):request.quality>currentRepresentationInfo.quality&&!bufferResetInProgress&&setSeekTarget(playbackController.getTime()+streamProcessor.getBufferLevel())}}();var isReplacement=replaceRequestArray.length>0,streamInfo=streamProcessor.getStreamInfo();if(bufferResetInProgress||isNaN(lastInitQuality)||switchTrack||isReplacement||function hasTopQualityChanged(type,id){topQualityIndex[id]=topQualityIndex[id]||{};var newTopQualityIndex=abrController.getTopQualityIndexFor(type,id);return topQualityIndex[id][type]!=newTopQualityIndex&&(logger.info("Top quality "+type+" index has changed from "+topQualityIndex[id][type]+" to "+newTopQualityIndex),topQualityIndex[id][type]=newTopQualityIndex,!0)}(currentRepresentationInfo.mediaInfo.type,streamInfo.id)||bufferLevelRule.execute(streamProcessor,streamController.isTrackTypePresent(_constantsConstants2.default.VIDEO))){setFragmentProcessState(!0),isReplacement||switchTrack||abrController.checkPlaybackQuality(type),function getNextFragment(){var fragmentController=streamProcessor.getFragmentController();if(currentRepresentationInfo.quality===lastInitQuality&&!switchTrack||bufferResetInProgress){var replacement=replaceRequestArray.shift();if(fragmentController.isInitializationRequest(replacement))streamProcessor.switchInitData(replacement.representationId);else{var request=void 0;streamProcessor.getBufferController().getIsPruningInProgress()||(request=nextFragmentRequestRule.execute(streamProcessor,seekTarget,replacement),setSeekTarget(NaN),request&&!replacement&&(isNaN(request.startTime+request.duration)||adapter.setIndexHandlerTime(streamProcessor,request.startTime+request.duration),request.delayLoadingTime=(new Date).getTime()+timeToLoadDelay,setTimeToLoadDelay(0)),!request&&streamInfo.manifestInfo&&streamInfo.manifestInfo.isDynamic&&logger.debug("Next fragment seems to be at the bleeding live edge and is not available yet. Rescheduling.")),request?(logger.debug("Next fragment request url is "+request.url),fragmentModel.executeRequest(request)):(setFragmentProcessState(!1),startScheduleTimer(mediaPlayerModel.getLowLatencyEnabled()?100:500))}}else logger.debug("Quality has changed, get init request for representationid = "+currentRepresentationInfo.id),switchTrack?(bufferResetInProgress=mediaController.getSwitchMode(type)===_MediaController2.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE,logger.debug("Switch track has been asked, get init request for "+type+" with representationid = "+currentRepresentationInfo.id+"bufferResetInProgress = "+bufferResetInProgress),streamProcessor.switchInitData(currentRepresentationInfo.id,bufferResetInProgress),switchTrack=!1):streamProcessor.switchInitData(currentRepresentationInfo.id),lastInitQuality=currentRepresentationInfo.quality}()}else startScheduleTimer(500)}}function startScheduleTimer(value){clearTimeout(scheduleTimeout),scheduleTimeout=setTimeout(schedule,value)}function onInitRequested(e){e.sender&&e.sender.getStreamProcessor()===streamProcessor&&getInitRequest(currentRepresentationInfo.quality)}function setFragmentProcessState(state){isFragmentProcessingInProgress!==state?isFragmentProcessingInProgress=state:logger.debug("isFragmentProcessingInProgress is already equal to",state)}function getInitRequest(quality){var request=adapter.getInitRequest(streamProcessor,quality);request&&(setFragmentProcessState(!0),request.url=(0,_dashUtilsSegmentsUtils.replaceTokenForTemplate)(request.url,"Bandwidth",currentRepresentationInfo?currentRepresentationInfo.bandwidth:null),fragmentModel.executeRequest(request))}function replaceRequest(request){replaceRequestArray.push(request)}function onQualityChanged(e){if(type===e.mediaType&&streamProcessor.getStreamInfo().id===e.streamInfo.id){if(null==(currentRepresentationInfo=streamProcessor.getRepresentationInfo(e.newQuality)))throw new Error("Unexpected error! - currentRepresentationInfo is null or undefined");clearPlayListTraceMetrics(new Date,_voMetricsPlayList.PlayListTrace.REPRESENTATION_SWITCH_STOP_REASON),addPlaylistTraceMetrics()}}function completeQualityChange(trigger){if(playbackController&&fragmentModel){var item=fragmentModel.getRequests({state:_modelsFragmentModel2.default.FRAGMENT_MODEL_EXECUTED,time:playbackController.getTime(),threshold:0})[0];item&&playbackController.getTime()>=item.startTime&&((!lastFragmentRequest.mediaInfo||item.mediaInfo.type===lastFragmentRequest.mediaInfo.type&&item.mediaInfo.id!==lastFragmentRequest.mediaInfo.id)&&trigger&&eventBus.trigger(_coreEventsEvents2.default.TRACK_CHANGE_RENDERED,{mediaType:type,oldMediaInfo:lastFragmentRequest.mediaInfo,newMediaInfo:item.mediaInfo}),item.quality===lastFragmentRequest.quality&&item.adaptationIndex===lastFragmentRequest.adaptationIndex||!trigger||eventBus.trigger(_coreEventsEvents2.default.QUALITY_CHANGE_RENDERED,{mediaType:type,oldQuality:lastFragmentRequest.quality,newQuality:item.quality}),lastFragmentRequest={mediaInfo:item.mediaInfo,quality:item.quality,adaptationIndex:item.adaptationIndex})}}function onDataUpdateCompleted(e){e.error||e.sender.getStreamProcessor()!==streamProcessor||(currentRepresentationInfo=adapter.convertDataToRepresentationInfo(e.currentRepresentation))}function onStreamInitialized(e){e.error||streamProcessor.getStreamInfo().id!==e.streamInfo.id||(currentRepresentationInfo=streamProcessor.getRepresentationInfo(),initialRequest&&(playbackController.getIsDynamic()?(timelineConverter.setTimeSyncCompleted(!0),function setLiveEdgeSeekTarget(){var liveEdgeFinder=streamProcessor.getLiveEdgeFinder();if(liveEdgeFinder){var liveEdge=liveEdgeFinder.getLiveEdge(),dvrWindowSize=currentRepresentationInfo.mediaInfo.streamInfo.manifestInfo.DVRWindowSize/2,startTime=liveEdge-playbackController.computeLiveDelay(currentRepresentationInfo.fragmentDuration,dvrWindowSize),request=adapter.getFragmentRequest(streamProcessor,currentRepresentationInfo,startTime,{ignoreIsFinished:!0});if(request)if(mediaPlayerModel.getLowLatencyEnabled()){var liveStartTime=request.duration<mediaPlayerModel.getLiveDelay()?request.startTime:request.startTime+request.duration-mediaPlayerModel.getLiveDelay();playbackController.setLiveStartTime(liveStartTime)}else playbackController.setLiveStartTime(request.startTime);else logger.debug("setLiveEdgeSeekTarget : getFragmentRequest returned undefined request object");seekTarget=playbackController.getStreamStartTime(!1,liveEdge),streamProcessor.getBufferController().setSeekStartTime(seekTarget),seekTarget>currentRepresentationInfo.mediaInfo.streamInfo.start+currentRepresentationInfo.mediaInfo.streamInfo.duration&&playbackController.seek(seekTarget);var manifestUpdateInfo=dashMetrics.getCurrentManifestUpdate(metricsModel.getMetricsFor(_constantsConstants2.default.STREAM));metricsModel.updateManifestUpdateInfo(manifestUpdateInfo,{currentTime:seekTarget,presentationStartTime:liveEdge,latency:liveEdge-seekTarget,clientTimeOffset:timelineConverter.getClientTimeOffset()})}}()):(seekTarget=playbackController.getStreamStartTime(!1),streamProcessor.getBufferController().setSeekStartTime(seekTarget))),isStopped&&start())}function onStreamCompleted(e){e.fragmentModel===fragmentModel&&(stop(),setFragmentProcessState(!1),logger.info("Stream is complete"))}function onFragmentLoadingCompleted(e){e.sender===fragmentModel&&(logger.info("OnFragmentLoadingCompleted - Url:",e.request?e.request.url:"undefined",", Range:",e.request.range?e.request.range:"undefined"),dashManifestModel.getIsTextTrack(type)&&setFragmentProcessState(!1),e.error&&e.request.serviceLocation&&!isStopped&&(replaceRequest(e.request),setFragmentProcessState(!1),startScheduleTimer(0)),bufferResetInProgress&&(mediaRequest=e.request))}function onPlaybackTimeUpdated(){completeQualityChange(!0)}function onBytesAppended(e){if(e.sender.getStreamProcessor()===streamProcessor)if(bufferResetInProgress&&!isNaN(e.startTime)&&(bufferResetInProgress=!1,fragmentModel.addExecutedRequest(mediaRequest)),setFragmentProcessState(!1),isReplacementRequest&&!isNaN(e.startTime)){var currentTime=playbackController.getTime(),fragEndTime=e.startTime+currentRepresentationInfo.fragmentDuration,safeBufferLevel=1.5*currentRepresentationInfo.fragmentDuration;startScheduleTimer(currentTime+safeBufferLevel>=fragEndTime?0:1e3*(fragEndTime-(currentTime+safeBufferLevel))),isReplacementRequest=!1}else startScheduleTimer(0)}function onFragmentLoadingAbandoned(e){e.streamProcessor===streamProcessor&&(logger.info("onFragmentLoadingAbandoned for "+type+", request: "+e.request.url+" has been aborted"),playbackController.isSeeking()||switchTrack||(logger.info("onFragmentLoadingAbandoned for "+type+", request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),replaceRequest(e.request)),setFragmentProcessState(!1),startScheduleTimer(0))}function onDataUpdateStarted(e){e.sender.getStreamProcessor()===streamProcessor&&stop()}function onBufferCleared(e){if(e.sender.getStreamProcessor()===streamProcessor){var streamInfo=streamProcessor.getStreamInfo();streamInfo&&(e.unintended?fragmentModel.removeExecutedRequestsAfterTime(e.from,streamInfo.duration):fragmentModel.syncExecutedRequestsWithBufferedRange(streamProcessor.getBufferController().getBuffer().getAllBufferRanges(),streamInfo.duration)),e.hasEnoughSpaceToAppend&&isStopped&&start()}}function onBufferLevelStateChanged(e){e.sender.getStreamProcessor()!==streamProcessor||e.state!==_BufferController2.default.BUFFER_EMPTY||playbackController.isSeeking()||(logger.info("Buffer is empty! Stalling!"),clearPlayListTraceMetrics(new Date,_voMetricsPlayList.PlayListTrace.REBUFFERING_REASON))}function onQuotaExceeded(e){e.sender.getStreamProcessor()===streamProcessor&&(stop(),setFragmentProcessState(!1))}function onURLResolutionFailed(){fragmentModel.abortRequests(),stop()}function onTimedTextRequested(e){e.sender.getStreamProcessor()===streamProcessor&&textController.isTextEnabled()&&getInitRequest(e.index)}function onPlaybackStarted(){!isStopped&&mediaPlayerModel.getScheduleWhilePaused()||start()}function onPlaybackSeeking(e){seekTarget=e.seekTime,setTimeToLoadDelay(0),isStopped&&start();var manifestUpdateInfo=dashMetrics.getCurrentManifestUpdate(metricsModel.getMetricsFor(_constantsConstants2.default.STREAM)),latency=currentRepresentationInfo.DVRWindow&&playbackController?currentRepresentationInfo.DVRWindow.end-playbackController.getTime():NaN;metricsModel.updateManifestUpdateInfo(manifestUpdateInfo,{latency:latency}),isFragmentProcessingInProgress?(logger.debug("onPlaybackSeeking for "+type+", call fragmentModel.abortRequests in order to seek quicker"),fragmentModel.abortRequests()):startScheduleTimer(0)}function onPlaybackRateChanged(e){playListTraceMetrics&&(playListTraceMetrics.playbackspeed=e.playbackRate.toString())}function setSeekTarget(value){seekTarget=value}function setTimeToLoadDelay(value){timeToLoadDelay=value}function clearPlayListTraceMetrics(endTime,stopreason){if(playListMetrics&&!1===playListTraceMetricsClosed){var startTime=playListTraceMetrics.start,duration=endTime.getTime()-startTime.getTime();playListTraceMetrics.duration=duration,playListTraceMetrics.stopreason=stopreason,playListMetrics.trace.push(playListTraceMetrics),playListTraceMetricsClosed=!0}}function addPlaylistTraceMetrics(){playListMetrics&&!0===playListTraceMetricsClosed&&currentRepresentationInfo&&(playListTraceMetricsClosed=!1,(playListTraceMetrics=new _voMetricsPlayList.PlayListTrace).representationid=currentRepresentationInfo.id,playListTraceMetrics.start=new Date,playListTraceMetrics.mstart=1e3*playbackController.getTime(),playListTraceMetrics.playbackspeed=playbackController.getPlaybackRate().toString())}function resetInitialSettings(){isFragmentProcessingInProgress=!1,timeToLoadDelay=0,seekTarget=NaN,playListMetrics=null,playListTraceMetrics=null,playListTraceMetricsClosed=!0,initialRequest=!0,lastInitQuality=NaN,lastFragmentRequest={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},topQualityIndex={},replaceRequestArray=[],isStopped=!0,switchTrack=!1,bufferResetInProgress=!1,mediaRequest=null,isReplacementRequest=!1}return instance={initialize:function initialize(){fragmentModel=streamProcessor.getFragmentModel(),bufferLevelRule=(0,_rulesSchedulingBufferLevelRule2.default)(context).create({abrController:abrController,dashMetrics:dashMetrics,metricsModel:metricsModel,mediaPlayerModel:mediaPlayerModel,textController:textController}),nextFragmentRequestRule=(0,_rulesSchedulingNextFragmentRequestRule2.default)(context).create({adapter:adapter,textController:textController,playbackController:playbackController}),dashManifestModel.getIsTextTrack(config.mimeType)&&eventBus.on(_coreEventsEvents2.default.TIMED_TEXT_REQUESTED,onTimedTextRequested,this),eventBus.on(_coreEventsEvents2.default.QUALITY_CHANGE_REQUESTED,onQualityChanged,this),eventBus.on(_coreEventsEvents2.default.DATA_UPDATE_STARTED,onDataUpdateStarted,this),eventBus.on(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,onDataUpdateCompleted,this),eventBus.on(_coreEventsEvents2.default.FRAGMENT_LOADING_COMPLETED,onFragmentLoadingCompleted,this),eventBus.on(_coreEventsEvents2.default.STREAM_COMPLETED,onStreamCompleted,this),eventBus.on(_coreEventsEvents2.default.STREAM_INITIALIZED,onStreamInitialized,this),eventBus.on(_coreEventsEvents2.default.BUFFER_LEVEL_STATE_CHANGED,onBufferLevelStateChanged,this),eventBus.on(_coreEventsEvents2.default.BUFFER_CLEARED,onBufferCleared,this),eventBus.on(_coreEventsEvents2.default.BYTES_APPENDED_END_FRAGMENT,onBytesAppended,this),eventBus.on(_coreEventsEvents2.default.INIT_REQUESTED,onInitRequested,this),eventBus.on(_coreEventsEvents2.default.QUOTA_EXCEEDED,onQuotaExceeded,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_SEEKING,onPlaybackSeeking,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_STARTED,onPlaybackStarted,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_RATE_CHANGED,onPlaybackRateChanged,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_TIME_UPDATED,onPlaybackTimeUpdated,this),eventBus.on(_coreEventsEvents2.default.URL_RESOLUTION_FAILED,onURLResolutionFailed,this),eventBus.on(_coreEventsEvents2.default.FRAGMENT_LOADING_ABANDONED,onFragmentLoadingAbandoned,this)},getType:function getType(){return type},setSeekTarget:setSeekTarget,setTimeToLoadDelay:setTimeToLoadDelay,replaceRequest:replaceRequest,switchTrackAsked:function switchTrackAsked(){switchTrack=!0},isStarted:function isStarted(){return!1===isStopped},start:start,stop:stop,reset:function reset(){eventBus.off(_coreEventsEvents2.default.DATA_UPDATE_STARTED,onDataUpdateStarted,this),eventBus.off(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,onDataUpdateCompleted,this),eventBus.off(_coreEventsEvents2.default.BUFFER_LEVEL_STATE_CHANGED,onBufferLevelStateChanged,this),eventBus.off(_coreEventsEvents2.default.QUALITY_CHANGE_REQUESTED,onQualityChanged,this),eventBus.off(_coreEventsEvents2.default.FRAGMENT_LOADING_COMPLETED,onFragmentLoadingCompleted,this),eventBus.off(_coreEventsEvents2.default.STREAM_COMPLETED,onStreamCompleted,this),eventBus.off(_coreEventsEvents2.default.STREAM_INITIALIZED,onStreamInitialized,this),eventBus.off(_coreEventsEvents2.default.QUOTA_EXCEEDED,onQuotaExceeded,this),eventBus.off(_coreEventsEvents2.default.BYTES_APPENDED_END_FRAGMENT,onBytesAppended,this),eventBus.off(_coreEventsEvents2.default.BUFFER_CLEARED,onBufferCleared,this),eventBus.off(_coreEventsEvents2.default.INIT_REQUESTED,onInitRequested,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_RATE_CHANGED,onPlaybackRateChanged,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_SEEKING,onPlaybackSeeking,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_STARTED,onPlaybackStarted,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_TIME_UPDATED,onPlaybackTimeUpdated,this),eventBus.off(_coreEventsEvents2.default.URL_RESOLUTION_FAILED,onURLResolutionFailed,this),eventBus.off(_coreEventsEvents2.default.FRAGMENT_LOADING_ABANDONED,onFragmentLoadingAbandoned,this),dashManifestModel.getIsTextTrack(type)&&eventBus.off(_coreEventsEvents2.default.TIMED_TEXT_REQUESTED,onTimedTextRequested,this),stop(),completeQualityChange(!1),resetInitialSettings()},setPlayList:function setPlayList(playList){playListMetrics=playList},getBufferTarget:function getBufferTarget(){return bufferLevelRule.getBufferTarget(streamProcessor,streamController.isTrackTypePresent(_constantsConstants2.default.VIDEO))},finalisePlayList:function finalisePlayList(time,reason){clearPlayListTraceMetrics(time,reason),playListMetrics=null}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),resetInitialSettings()}(),instance}ScheduleController.__dashjs_factory_name="ScheduleController",exports.default=_coreFactoryMaker2.default.getClassFactory(ScheduleController),module.exports=exports.default},1504:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366));function BufferLevelRule(config){var dashMetrics=(config=config||{}).dashMetrics,metricsModel=config.metricsModel,mediaPlayerModel=config.mediaPlayerModel,textController=config.textController,abrController=config.abrController;function getBufferTarget(streamProcessor,videoTrackPresent){var bufferTarget=NaN;if(!streamProcessor)return bufferTarget;var type=streamProcessor.getType(),representationInfo=streamProcessor.getRepresentationInfo();if(type===_constantsConstants2.default.FRAGMENTED_TEXT)bufferTarget=textController.isTextEnabled()?representationInfo.fragmentDuration:0;else if(type===_constantsConstants2.default.AUDIO&&videoTrackPresent){var videoBufferLevel=dashMetrics.getCurrentBufferLevel(metricsModel.getReadOnlyMetricsFor(_constantsConstants2.default.VIDEO));bufferTarget=isNaN(representationInfo.fragmentDuration)?videoBufferLevel:Math.max(videoBufferLevel,representationInfo.fragmentDuration)}else{var streamInfo=representationInfo.mediaInfo.streamInfo;if(abrController.isPlayingAtTopQuality(streamInfo))bufferTarget=streamInfo.manifestInfo.duration>=mediaPlayerModel.getLongFormContentDurationThreshold()?mediaPlayerModel.getBufferTimeAtTopQualityLongForm():mediaPlayerModel.getBufferTimeAtTopQuality();else bufferTarget=mediaPlayerModel.getStableBufferTime()}return bufferTarget}return{execute:function execute(streamProcessor,videoTrackPresent){return!streamProcessor||dashMetrics.getCurrentBufferLevel(metricsModel.getReadOnlyMetricsFor(streamProcessor.getType()))<getBufferTarget(streamProcessor,videoTrackPresent)},getBufferTarget:getBufferTarget}}BufferLevelRule.__dashjs_factory_name="BufferLevelRule",exports.default=_coreFactoryMaker2.default.getClassFactory(BufferLevelRule),module.exports=exports.default},1505:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_streamingVoFragmentRequest2=_interopRequireDefault(__webpack_require__(1378));function NextFragmentRequestRule(config){config=config||{};var context=this.context,adapter=config.adapter,textController=config.textController,playbackController=config.playbackController,instance=void 0,logger=void 0;return instance={execute:function execute(streamProcessor,seekTarget,requestToReplace){if(!streamProcessor)return null;var representationInfo=streamProcessor.getRepresentationInfo(),mediaType=streamProcessor.getType(),hasSeekTarget=!isNaN(seekTarget),bufferController=streamProcessor.getBufferController(),currentTime=playbackController.getNormalizedTime(),time=hasSeekTarget?seekTarget:adapter.getIndexHandlerTime(streamProcessor),bufferIsDivided=!1,request=void 0;if(isNaN(time)||mediaType===_constantsConstants2.default.FRAGMENTED_TEXT&&!textController.isTextEnabled())return null;if(bufferController){var range=bufferController.getRangeAt(time),playingRange=bufferController.getRangeAt(currentTime),hasDiscontinuities=bufferController.getBuffer().hasDiscontinuitiesAfter(currentTime);null===range&&null===playingRange||hasSeekTarget||((!range||playingRange&&playingRange.start!=range.start&&playingRange.end!=range.end)&&(hasDiscontinuities&&mediaType!==_constantsConstants2.default.FRAGMENTED_TEXT&&(streamProcessor.getFragmentModel().removeExecutedRequestsAfterTime(playingRange.end),bufferIsDivided=!0),range=playingRange),time!==range.end&&(logger.debug("Prior to making a request for time, NextFragmentRequestRule is aligning index handler's currentTime with bufferedRange.end for",mediaType,".",time,"was changed to",range.end),time=range.end))}if(requestToReplace)time=requestToReplace.startTime+requestToReplace.duration/2,request=adapter.getFragmentRequest(streamProcessor,representationInfo,time,{timeThreshold:0,ignoreIsFinished:!0});else for(request=adapter.getFragmentRequest(streamProcessor,representationInfo,time,{keepIdx:!hasSeekTarget&&!bufferIsDivided});request&&request.action!==_streamingVoFragmentRequest2.default.ACTION_COMPLETE&&streamProcessor.getFragmentModel().isFragmentLoaded(request);)request=adapter.getFragmentRequest(streamProcessor,representationInfo);return request}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}NextFragmentRequestRule.__dashjs_factory_name="NextFragmentRequestRule",exports.default=_coreFactoryMaker2.default.getClassFactory(NextFragmentRequestRule),module.exports=exports.default},1506:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _streamingConstantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_constantsDashConstants2=_interopRequireDefault(__webpack_require__(1374)),_streamingVoDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_voRepresentation2=_interopRequireDefault(__webpack_require__(1413));function RepresentationController(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,realAdaptation=void 0,realAdaptationIndex=void 0,updating=void 0,voAvailableRepresentations=void 0,currentVoRepresentation=void 0,abrController=void 0,indexHandler=void 0,playbackController=void 0,metricsModel=void 0,domStorage=void 0,timelineConverter=void 0,dashManifestModel=void 0,dashMetrics=void 0,streamProcessor=void 0,manifestModel=void 0;function isUpdating(){return updating}function getCurrentRepresentation(){return currentVoRepresentation}function resetInitialSettings(){realAdaptation=null,realAdaptationIndex=-1,updating=!0,voAvailableRepresentations=[],abrController=null,playbackController=null,metricsModel=null,domStorage=null,timelineConverter=null,dashManifestModel=null,dashMetrics=null}function addRepresentationSwitch(){var now=new Date,currentRepresentation=getCurrentRepresentation(),currentVideoTimeMs=1e3*playbackController.getTime();metricsModel.addRepresentationSwitch(currentRepresentation.adaptation.type,now,currentVideoTimeMs,currentRepresentation.id)}function addDVRMetric(){var streamInfo=streamProcessor.getStreamInfo(),manifestInfo=streamInfo?streamInfo.manifestInfo:null,isDynamic=manifestInfo?manifestInfo.isDynamic:null,range=timelineConverter.calcSegmentAvailabilityRange(currentVoRepresentation,isDynamic);metricsModel.addDVRInfo(streamProcessor.getType(),playbackController.getTime(),manifestInfo,range)}function getRepresentationForQuality(quality){return null==quality||quality>=voAvailableRepresentations.length?null:voAvailableRepresentations[quality]}function postponeUpdate(postponeTimePeriod){var delay=postponeTimePeriod;updating=!1,eventBus.trigger(_coreEventsEvents2.default.AST_IN_FUTURE,{delay:delay}),setTimeout((function update(){if(!isUpdating()){updating=!0,eventBus.trigger(_coreEventsEvents2.default.DATA_UPDATE_STARTED,{sender:instance}),function resetAvailabilityWindow(){voAvailableRepresentations.forEach((function(rep){rep.segmentAvailabilityRange=null}))}();for(var i=0;i<voAvailableRepresentations.length;i++)indexHandler.updateRepresentation(voAvailableRepresentations[i],!0)}}),delay)}function onRepresentationUpdated(e){if(e.sender.getStreamProcessor()===streamProcessor&&isUpdating()){var r=e.representation,streamMetrics=metricsModel.getMetricsFor(_streamingConstantsConstants2.default.STREAM),metrics=metricsModel.getMetricsFor(getCurrentRepresentation().adaptation.type),manifestUpdateInfo=dashMetrics.getCurrentManifestUpdate(streamMetrics),alreadyAdded=!1,postponeTimePeriod=0,repInfo=void 0,err=void 0;if(r.adaptation.period.mpd.manifest.type===_constantsDashConstants2.default.DYNAMIC&&!r.adaptation.period.mpd.manifest.ignorePostponeTimePeriod){var segmentAvailabilityTimePeriod=r.segmentAvailabilityRange.end-r.segmentAvailabilityRange.start;postponeTimePeriod=1e3*(playbackController.computeLiveDelay(currentVoRepresentation.segmentDuration,streamProcessor.getStreamInfo().manifestInfo.DVRWindowSize)-segmentAvailabilityTimePeriod)}if(postponeTimePeriod>0)return addDVRMetric(),postponeUpdate(postponeTimePeriod),err=new _streamingVoDashJSError2.default(_coreErrorsErrors2.default.SEGMENTS_UPDATE_FAILED_ERROR_CODE,_coreErrorsErrors2.default.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE),void eventBus.trigger(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,{sender:this,data:realAdaptation,currentRepresentation:currentVoRepresentation,error:err});if(manifestUpdateInfo){for(var i=0;i<manifestUpdateInfo.representationInfo.length;i++)if((repInfo=manifestUpdateInfo.representationInfo[i]).index===r.index&&repInfo.mediaType===streamProcessor.getType()){alreadyAdded=!0;break}alreadyAdded||metricsModel.addManifestUpdateRepresentationInfo(manifestUpdateInfo,r.id,r.index,r.adaptation.period.index,streamProcessor.getType(),r.presentationTimeOffset,r.startNumber,r.segmentInfoType)}(function isAllRepresentationsUpdated(){for(var i=0,ln=voAvailableRepresentations.length;i<ln;i++){var segmentInfoType=voAvailableRepresentations[i].segmentInfoType;if(null===voAvailableRepresentations[i].segmentAvailabilityRange||!_voRepresentation2.default.hasInitialization(voAvailableRepresentations[i])||(segmentInfoType===_constantsDashConstants2.default.SEGMENT_BASE||segmentInfoType===_constantsDashConstants2.default.BASE_URL)&&!voAvailableRepresentations[i].segments)return!1}return!0})()&&(updating=!1,abrController.setPlaybackQuality(streamProcessor.getType(),streamProcessor.getStreamInfo(),function getQualityForRepresentation(voRepresentation){return voAvailableRepresentations.indexOf(voRepresentation)}(currentVoRepresentation)),metricsModel.updateManifestUpdateInfo(manifestUpdateInfo,{latency:currentVoRepresentation.segmentAvailabilityRange.end-playbackController.getTime()}),dashMetrics.getCurrentRepresentationSwitch(metrics)||addRepresentationSwitch(),eventBus.trigger(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,{sender:this,data:realAdaptation,currentRepresentation:currentVoRepresentation}))}}function onWallclockTimeUpdated(e){e.isDynamic&&function updateAvailabilityWindow(isDynamic){for(var voRepresentation=void 0,i=0,ln=voAvailableRepresentations.length;i<ln;i++)(voRepresentation=voAvailableRepresentations[i]).segmentAvailabilityRange=timelineConverter.calcSegmentAvailabilityRange(voRepresentation,isDynamic)}(e.isDynamic)}function onBufferLevelUpdated(e){e.sender.getStreamProcessor()===streamProcessor&&(manifestModel.getValue().doNotUpdateDVRWindowOnBufferUpdated||addDVRMetric())}function onQualityChanged(e){if(e.mediaType===streamProcessor.getType()&&streamProcessor.getStreamInfo().id===e.streamInfo.id&&e.oldQuality!==e.newQuality){currentVoRepresentation=getRepresentationForQuality(e.newQuality);var bitrate=abrController.getThroughputHistory().getAverageThroughput(e.mediaType);isNaN(bitrate)||domStorage.setSavedBitrateSettings(e.mediaType,bitrate),addRepresentationSwitch()}}function onManifestValidityChanged(e){if(e.newDuration){var representation=getCurrentRepresentation();if(representation&&representation.adaptation.period)representation.adaptation.period.duration=e.newDuration}}return instance={initialize:function initialize(){indexHandler=streamProcessor.getIndexHandler()},setConfig:function setConfig(config){config.abrController&&(abrController=config.abrController),config.domStorage&&(domStorage=config.domStorage),config.metricsModel&&(metricsModel=config.metricsModel),config.dashMetrics&&(dashMetrics=config.dashMetrics),config.dashManifestModel&&(dashManifestModel=config.dashManifestModel),config.playbackController&&(playbackController=config.playbackController),config.timelineConverter&&(timelineConverter=config.timelineConverter),config.manifestModel&&(manifestModel=config.manifestModel),config.streamProcessor&&(streamProcessor=config.streamProcessor)},getData:function getData(){return realAdaptation},getDataIndex:function getDataIndex(){return realAdaptationIndex},isUpdating:isUpdating,updateData:function updateData(newRealAdaptation,voAdaptation,type){var streamInfo=streamProcessor.getStreamInfo(),maxQuality=abrController.getTopQualityIndexFor(type,streamInfo.id),minIdx=abrController.getMinAllowedIndexFor(type),quality=void 0,bitrate=null;if(updating=!0,eventBus.trigger(_coreEventsEvents2.default.DATA_UPDATE_STARTED,{sender:this}),voAvailableRepresentations=function updateRepresentations(voAdaptation){return realAdaptationIndex=dashManifestModel.getIndexForAdaptation(realAdaptation,voAdaptation.period.mpd.manifest,voAdaptation.period.index),dashManifestModel.getRepresentationsForAdaptation(voAdaptation)}(voAdaptation),null!==realAdaptation&&realAdaptation.id==newRealAdaptation.id||type===_streamingConstantsConstants2.default.FRAGMENTED_TEXT?quality=abrController.getQualityFor(type,streamInfo):(bitrate=abrController.getThroughputHistory().getAverageThroughput(type)||abrController.getInitialBitrateFor(type,streamInfo),quality=abrController.getQualityForBitrate(streamProcessor.getMediaInfo(),bitrate)),void 0!==minIdx&&quality<minIdx&&(quality=minIdx),quality>maxQuality&&(quality=maxQuality),currentVoRepresentation=getRepresentationForQuality(quality),realAdaptation=newRealAdaptation,type!==_streamingConstantsConstants2.default.VIDEO&&type!==_streamingConstantsConstants2.default.AUDIO&&type!==_streamingConstantsConstants2.default.FRAGMENTED_TEXT)return updating=!1,void eventBus.trigger(_coreEventsEvents2.default.DATA_UPDATE_COMPLETED,{sender:this,data:realAdaptation,currentRepresentation:currentVoRepresentation});for(var i=0;i<voAvailableRepresentations.length;i++)indexHandler.updateRepresentation(voAvailableRepresentations[i],!0)},getStreamProcessor:function getStreamProcessor(){return streamProcessor},getCurrentRepresentation:getCurrentRepresentation,getRepresentationForQuality:getRepresentationForQuality,reset:function reset(){eventBus.off(_coreEventsEvents2.default.QUALITY_CHANGE_REQUESTED,onQualityChanged,instance),eventBus.off(_coreEventsEvents2.default.REPRESENTATION_UPDATED,onRepresentationUpdated,instance),eventBus.off(_coreEventsEvents2.default.WALLCLOCK_TIME_UPDATED,onWallclockTimeUpdated,instance),eventBus.off(_coreEventsEvents2.default.BUFFER_LEVEL_UPDATED,onBufferLevelUpdated,instance),eventBus.off(_coreEventsEvents2.default.MANIFEST_VALIDITY_CHANGED,onManifestValidityChanged,instance),resetInitialSettings()}},function setup(){resetInitialSettings(),eventBus.on(_coreEventsEvents2.default.QUALITY_CHANGE_REQUESTED,onQualityChanged,instance),eventBus.on(_coreEventsEvents2.default.REPRESENTATION_UPDATED,onRepresentationUpdated,instance),eventBus.on(_coreEventsEvents2.default.WALLCLOCK_TIME_UPDATED,onWallclockTimeUpdated,instance),eventBus.on(_coreEventsEvents2.default.BUFFER_LEVEL_UPDATED,onBufferLevelUpdated,instance),eventBus.on(_coreEventsEvents2.default.MANIFEST_VALIDITY_CHANGED,onManifestValidityChanged,instance)}(),instance}RepresentationController.__dashjs_factory_name="RepresentationController",exports.default=_coreFactoryMaker2.default.getClassFactory(RepresentationController),module.exports=exports.default},1507:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _streamingConstantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_constantsDashConstants2=_interopRequireDefault(__webpack_require__(1374)),_streamingVoFragmentRequest2=_interopRequireDefault(__webpack_require__(1378)),_streamingVoDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_streamingVoMetricsHTTPRequest=__webpack_require__(1373),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_streamingUtilsURLUtils2=_interopRequireDefault(__webpack_require__(1376)),_voRepresentation2=_interopRequireDefault(__webpack_require__(1413)),_utilsSegmentsUtils=__webpack_require__(1380),_utilsSegmentsGetter2=_interopRequireDefault(__webpack_require__(1508)),_SegmentBaseLoader2=_interopRequireDefault(__webpack_require__(1436)),_WebmSegmentBaseLoader2=_interopRequireDefault(__webpack_require__(1513));function DashHandler(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),urlUtils=(0,_streamingUtilsURLUtils2.default)(context).getInstance(),segmentBaseLoader=void 0,timelineConverter=config.timelineConverter,dashMetrics=config.dashMetrics,metricsModel=config.metricsModel,mediaPlayerModel=config.mediaPlayerModel,errHandler=config.errHandler,baseURLController=config.baseURLController,instance=void 0,logger=void 0,index=void 0,requestedTime=void 0,currentTime=void 0,streamProcessor=void 0,segmentsGetter=void 0;function getType(){return streamProcessor?streamProcessor.getType():null}function isDynamic(){var streamInfo=streamProcessor?streamProcessor.getStreamInfo():null;return streamInfo?streamInfo.manifestInfo.isDynamic:null}function getMediaInfo(){return streamProcessor?streamProcessor.getMediaInfo():null}function resetIndex(){index=-1}function resetInitialSettings(){resetIndex(),currentTime=0,requestedTime=null,streamProcessor=null,segmentsGetter=null}function setRequestUrl(request,destination,representation){var baseURL=baseURLController.resolve(representation.path),url=void 0,serviceLocation=void 0;return baseURL&&destination!==baseURL.url&&urlUtils.isRelative(destination)?(url=baseURL.url,serviceLocation=baseURL.serviceLocation,destination&&(url=urlUtils.resolve(destination,url))):url=destination,!urlUtils.isRelative(url)&&(request.url=url,request.serviceLocation=serviceLocation,!0)}function isMediaFinished(representation){var isFinished=!1,isDynamicStream=isDynamic();if(isDynamicStream||index!==representation.availableSegmentsNumber){var seg=(0,_utilsSegmentsUtils.getSegmentByIndex)(index,representation);if(seg){var time=parseFloat((seg.presentationStartTime-representation.adaptation.period.start).toFixed(5)),duration=representation.adaptation.period.duration;logger.debug(representation.segmentInfoType+": "+time+" / "+duration),isFinished=(representation.segmentInfoType!==_constantsDashConstants2.default.SEGMENT_TIMELINE||!isDynamicStream)&&time>=duration}else logger.debug("isMediaFinished - no segment found")}else isFinished=!0;return isFinished}function updateSegments(voRepresentation){segmentsGetter.getSegments(voRepresentation,requestedTime,index,onSegmentListUpdated)}function onSegmentListUpdated(voRepresentation,segments){if(voRepresentation.segments=segments,segments&&segments.length>0&&isDynamic()){var liveEdge=segments[segments.length-1].presentationStartTime,metrics=metricsModel.getMetricsFor(_streamingConstantsConstants2.default.STREAM);timelineConverter.setExpectedLiveEdge(liveEdge),metricsModel.updateManifestUpdateInfo(dashMetrics.getCurrentManifestUpdate(metrics),{presentationStartTime:liveEdge})}}function updateSegmentList(voRepresentation){if(!voRepresentation)throw new Error("no representation");voRepresentation.segments=null,updateSegments(voRepresentation)}function getIndexForSegments(time,representation,timeThreshold){var segments=representation.segments,ln=segments?segments.length:null,idx=-1,epsilon=void 0,frag=void 0,ft=void 0,fd=void 0,i=void 0;if(segments&&ln>0)for(timeThreshold=null==timeThreshold?mediaPlayerModel.getSegmentOverlapToleranceTime():timeThreshold,i=0;i<ln;i++)if(ft=(frag=segments[i]).presentationStartTime,fd=frag.duration,time+(epsilon=null==timeThreshold?fd/2:timeThreshold)>=ft&&time-epsilon<ft+fd){idx=frag.availabilityIdx;break}return idx}function getRequestForSegment(segment){if(null==segment)return null;var request=new _streamingVoFragmentRequest2.default,representation=segment.representation,bandwidth=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].bandwidth,url=segment.media;return url=(0,_utilsSegmentsUtils.replaceTokenForTemplate)(url,"Number",segment.replacementNumber),url=(0,_utilsSegmentsUtils.replaceTokenForTemplate)(url,"Time",segment.replacementTime),url=(0,_utilsSegmentsUtils.replaceTokenForTemplate)(url,"Bandwidth",bandwidth),url=(0,_utilsSegmentsUtils.replaceIDForTemplate)(url,representation.id),url=(0,_utilsSegmentsUtils.unescapeDollarsInTemplate)(url),request.mediaType=getType(),request.type=_streamingVoMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE,request.range=segment.mediaRange,request.startTime=segment.presentationStartTime,request.duration=segment.duration,request.timescale=representation.timescale,request.availabilityStartTime=segment.availabilityStartTime,request.availabilityEndTime=segment.availabilityEndTime,request.wallStartTime=segment.wallStartTime,request.quality=representation.index,request.index=segment.availabilityIdx,request.mediaInfo=getMediaInfo(),request.adaptationIndex=representation.adaptation.index,request.representationId=representation.id,setRequestUrl(request,url,representation)?request:void 0}function onInitializationLoaded(e){var representation=e.representation;representation.segments&&eventBus.trigger(_coreEventsEvents2.default.REPRESENTATION_UPDATED,{sender:this,representation:representation})}function onSegmentsLoaded(e){if(!e.error&&getType()===e.mediaType){var len,fragments=e.segments,representation=e.representation,segments=[],count=0,i=void 0,s=void 0,seg=void 0;for(i=0,len=fragments.length;i<len;i++)s=fragments[i],seg=(0,_utilsSegmentsUtils.getTimeBasedSegment)(timelineConverter,isDynamic(),representation,s.startTime,s.duration,s.timescale,s.media,s.mediaRange,count),segments.push(seg),seg=null,count++;representation.segmentAvailabilityRange={start:segments[0].presentationStartTime,end:segments[len-1].presentationStartTime},representation.availableSegmentsNumber=len,onSegmentListUpdated(representation,segments),_voRepresentation2.default.hasInitialization(representation)&&eventBus.trigger(_coreEventsEvents2.default.REPRESENTATION_UPDATED,{sender:this,representation:representation})}}return instance={initialize:function initialize(StreamProcessor){streamProcessor=StreamProcessor,segmentBaseLoader.initialize(),segmentsGetter=(0,_utilsSegmentsGetter2.default)(context).create(config,isDynamic())},getStreamProcessor:function getStreamProcessor(){return streamProcessor},getInitRequest:function getInitRequest(representation){return representation?function generateInitRequest(representation,mediaType){var request=new _streamingVoFragmentRequest2.default,period=representation.adaptation.period,presentationStartTime=period.start,isDynamicStream=isDynamic();if(request.mediaType=mediaType,request.type=_streamingVoMetricsHTTPRequest.HTTPRequest.INIT_SEGMENT_TYPE,request.range=representation.range,request.availabilityStartTime=timelineConverter.calcAvailabilityStartTimeFromPresentationTime(presentationStartTime,period.mpd,isDynamicStream),request.availabilityEndTime=timelineConverter.calcAvailabilityEndTimeFromPresentationTime(presentationStartTime+period.duration,period.mpd,isDynamicStream),request.quality=representation.index,request.mediaInfo=getMediaInfo(),request.representationId=representation.id,setRequestUrl(request,representation.initialization,representation))return request}(representation,getType()):null},getSegmentRequestForTime:function getSegmentRequestForTime(representation,time,options){var request=void 0;if(!representation)return null;var type=getType(),idx=index,keepIdx=!!options&&options.keepIdx,timeThreshold=options?options.timeThreshold:null,ignoreIsFinished=!(!options||!options.ignoreIsFinished);return requestedTime!==time&&(requestedTime=time,logger.debug("Getting the request for "+type+" time : "+time)),updateSegments(representation),(index=getIndexForSegments(time,representation,timeThreshold))<0&&(updateSegments(representation),index=getIndexForSegments(time,representation,timeThreshold)),index>=0&&logger.debug("Index for "+type+" time "+time+" is "+index),!ignoreIsFinished&&isMediaFinished(representation)?((request=new _streamingVoFragmentRequest2.default).action=_streamingVoFragmentRequest2.default.ACTION_COMPLETE,request.index=index,request.mediaType=type,request.mediaInfo=getMediaInfo(),logger.debug("Signal complete in getSegmentRequestForTime -",type)):request=getRequestForSegment((0,_utilsSegmentsUtils.getSegmentByIndex)(index,representation)),keepIdx&&idx>=0&&(index=representation.segmentInfoType===_constantsDashConstants2.default.SEGMENT_TIMELINE&&isDynamic()?index:idx),request},getNextSegmentRequest:function getNextSegmentRequest(representation){var request=void 0,segment=void 0;if(!representation||-1===index)return null;var type=getType(),isDynamicStream=isDynamic();return requestedTime=null,index++,logger.debug("Getting the next request at index: "+index+", type: "+type),!(0,_utilsSegmentsUtils.getSegmentByIndex)(index,representation)&&isDynamicStream?(logger.debug("No segment found at index: "+index+". Wait for next loop"),updateSegments(representation),index--,null):(isMediaFinished(representation)?((request=new _streamingVoFragmentRequest2.default).action=_streamingVoFragmentRequest2.default.ACTION_COMPLETE,request.index=index,request.mediaType=type,request.mediaInfo=getMediaInfo(),logger.debug("Signal complete -",type)):(updateSegments(representation),request=getRequestForSegment(segment=(0,_utilsSegmentsUtils.getSegmentByIndex)(index,representation)),!segment&&isDynamicStream&&index--),request)},updateRepresentation:function updateRepresentation(voRepresentation,keepIdx){var hasInitialization=_voRepresentation2.default.hasInitialization(voRepresentation),hasSegments=_voRepresentation2.default.hasSegments(voRepresentation),error=void 0;if(voRepresentation.segmentDuration||voRepresentation.segments||updateSegmentList(voRepresentation),voRepresentation.segmentAvailabilityRange=timelineConverter.calcSegmentAvailabilityRange(voRepresentation,isDynamic()),voRepresentation.segmentAvailabilityRange.end<voRepresentation.segmentAvailabilityRange.start&&!voRepresentation.useCalculatedLiveEdgeTime)return error=new _streamingVoDashJSError2.default(_coreErrorsErrors2.default.SEGMENTS_UNAVAILABLE_ERROR_CODE,_coreErrorsErrors2.default.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE,{availabilityDelay:voRepresentation.segmentAvailabilityRange.start-voRepresentation.segmentAvailabilityRange.end}),void eventBus.trigger(_coreEventsEvents2.default.REPRESENTATION_UPDATED,{sender:this,representation:voRepresentation,error:error});keepIdx||resetIndex(),voRepresentation.segmentDuration&&updateSegmentList(voRepresentation),hasInitialization||segmentBaseLoader.loadInitialization(voRepresentation),hasSegments||segmentBaseLoader.loadSegments(voRepresentation,getType(),voRepresentation.indexRange),hasInitialization&&hasSegments&&eventBus.trigger(_coreEventsEvents2.default.REPRESENTATION_UPDATED,{sender:this,representation:voRepresentation})},updateSegmentList:updateSegmentList,setCurrentTime:function setCurrentTime(value){currentTime=value},getCurrentTime:function getCurrentTime(){return currentTime},reset:function reset(){resetInitialSettings(),eventBus.off(_coreEventsEvents2.default.INITIALIZATION_LOADED,onInitializationLoaded,instance),eventBus.off(_coreEventsEvents2.default.SEGMENTS_LOADED,onSegmentsLoaded,instance)},resetIndex:resetIndex},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),resetInitialSettings(),(segmentBaseLoader=function isWebM(mimeType){return"webm"===mimeType.split("/")[1].toLowerCase()}(config.mimeType)?(0,_WebmSegmentBaseLoader2.default)(context).getInstance():(0,_SegmentBaseLoader2.default)(context).getInstance()).setConfig({baseURLController:baseURLController,metricsModel:metricsModel,mediaPlayerModel:mediaPlayerModel,errHandler:errHandler}),eventBus.on(_coreEventsEvents2.default.INITIALIZATION_LOADED,onInitializationLoaded,instance),eventBus.on(_coreEventsEvents2.default.SEGMENTS_LOADED,onSegmentsLoaded,instance)}(),instance}DashHandler.__dashjs_factory_name="DashHandler",exports.default=_coreFactoryMaker2.default.getClassFactory(DashHandler),module.exports=exports.default},1508:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsDashConstants2=_interopRequireDefault(__webpack_require__(1374)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_TimelineSegmentsGetter2=_interopRequireDefault(__webpack_require__(1509)),_TemplateSegmentsGetter2=_interopRequireDefault(__webpack_require__(1510)),_ListSegmentsGetter2=_interopRequireDefault(__webpack_require__(1511));function SegmentsGetter(config,isDynamic){var instance,context=this.context,timelineSegmentsGetter=void 0,templateSegmentsGetter=void 0,listSegmentsGetter=void 0;return instance={getSegments:function getSegments(representation,requestedTime,index,onSegmentListUpdatedCallback,availabilityUpperLimit){var segments=void 0,type=representation.segmentInfoType;type!==_constantsDashConstants2.default.SEGMENT_BASE&&type!==_constantsDashConstants2.default.BASE_URL&&function isSegmentListUpdateRequired(representation,index){var segments=representation.segments,updateRequired=!1,upperIdx=void 0,lowerIdx=void 0;segments&&0!==segments.length?(lowerIdx=segments[0].availabilityIdx,upperIdx=segments[segments.length-1].availabilityIdx,updateRequired=index<lowerIdx||index>upperIdx):updateRequired=!0;return updateRequired}(representation,index)?(type===_constantsDashConstants2.default.SEGMENT_TIMELINE?segments=timelineSegmentsGetter.getSegments(representation,requestedTime,index,availabilityUpperLimit):type===_constantsDashConstants2.default.SEGMENT_TEMPLATE?segments=templateSegmentsGetter.getSegments(representation,requestedTime,index,availabilityUpperLimit):type===_constantsDashConstants2.default.SEGMENT_LIST&&(segments=listSegmentsGetter.getSegments(representation,requestedTime,index,availabilityUpperLimit)),onSegmentListUpdatedCallback&&onSegmentListUpdatedCallback(representation,segments)):segments=representation.segments}},function setup(){timelineSegmentsGetter=(0,_TimelineSegmentsGetter2.default)(context).create(config,isDynamic),templateSegmentsGetter=(0,_TemplateSegmentsGetter2.default)(context).create(config,isDynamic),listSegmentsGetter=(0,_ListSegmentsGetter2.default)(context).create(config,isDynamic)}(),instance}SegmentsGetter.__dashjs_factory_name="SegmentsGetter";var factory=_coreFactoryMaker2.default.getClassFactory(SegmentsGetter);exports.default=factory,module.exports=exports.default},1509:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_streamingConstantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_SegmentsUtils=__webpack_require__(1380);function TimelineSegmentsGetter(config,isDynamic){var timelineConverter=(config=config||{}).timelineConverter;return{getSegments:function getSegmentsFromTimeline(representation,requestedTime,index,availabilityUpperLimit){if(function checkConfig(){if(!timelineConverter||!timelineConverter.hasOwnProperty("calcMediaTimeFromPresentationTime")||!timelineConverter.hasOwnProperty("calcSegmentAvailabilityRange"))throw new Error(_streamingConstantsConstants2.default.MISSING_CONFIG_ERROR)}(),!representation)throw new Error("no representation");void 0===requestedTime&&(requestedTime=null);var base=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].SegmentTemplate||representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].SegmentList,timeline=base.SegmentTimeline,list=base.SegmentURL_asArray,isAvailableSegmentNumberCalculated=representation.availableSegmentsNumber>0,maxSegmentsAhead=void 0;maxSegmentsAhead=availabilityUpperLimit||(index>-1||null!==requestedTime?10:1/0);var fragments,len,startIdx,time=0,scaledTime=0,availabilityIdx=-1,segments=[],requiredMediaTime=null,frag=void 0,i=void 0,j=void 0,repeat=void 0,repeatEndTime=void 0,nextFrag=void 0,hasEnoughSegments=void 0,fTimescale=void 0,createSegment=function createSegment(s,i){var media=base.media,mediaRange=s.mediaRange;return list&&(media=list[i].media||"",mediaRange=list[i].mediaRange),(0,_SegmentsUtils.getTimeBasedSegment)(timelineConverter,isDynamic,representation,time,s.d,fTimescale,media,mediaRange,availabilityIdx,s.tManifest)};for(fTimescale=representation.timescale,fragments=timeline.S_asArray,startIdx=index,null!==requestedTime&&(requiredMediaTime=timelineConverter.calcMediaTimeFromPresentationTime(requestedTime,representation)),i=0,len=fragments.length;i<len;i++){if(repeat=0,(frag=fragments[i]).hasOwnProperty("r")&&(repeat=frag.r),frag.hasOwnProperty("t")&&(scaledTime=(time=frag.t)/fTimescale),repeat<0){if((nextFrag=fragments[i+1])&&nextFrag.hasOwnProperty("t"))repeatEndTime=nextFrag.t/fTimescale;else{var availabilityEnd=representation.segmentAvailabilityRange?representation.segmentAvailabilityRange.end:timelineConverter.calcSegmentAvailabilityRange(representation,isDynamic).end;repeatEndTime=timelineConverter.calcMediaTimeFromPresentationTime(availabilityEnd,representation),representation.segmentDuration=frag.d/fTimescale}repeat=Math.ceil((repeatEndTime-scaledTime)/(frag.d/fTimescale))-1}if(hasEnoughSegments){if(isAvailableSegmentNumberCalculated)break;availabilityIdx+=repeat+1}else for(j=0;j<=repeat;j++)if(availabilityIdx++,segments.length>maxSegmentsAhead){if(hasEnoughSegments=!0,isAvailableSegmentNumberCalculated)break}else null!==requiredMediaTime?scaledTime>=requiredMediaTime-frag.d/fTimescale*1.5&&segments.push(createSegment(frag,availabilityIdx)):availabilityIdx>=startIdx&&segments.push(createSegment(frag,availabilityIdx)),scaledTime=(time+=frag.d)/fTimescale}return isAvailableSegmentNumberCalculated||(representation.availableSegmentsNumber=availabilityIdx+1),segments}}}TimelineSegmentsGetter.__dashjs_factory_name="TimelineSegmentsGetter";var factory=_coreFactoryMaker2.default.getClassFactory(TimelineSegmentsGetter);exports.default=factory,module.exports=exports.default},1510:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366)),_SegmentsUtils=__webpack_require__(1380);function TemplateSegmentsGetter(config,isDynamic){var timelineConverter=config.timelineConverter;return{getSegments:function getSegmentsFromTemplate(representation,requestedTime,index,availabilityUpperLimit){var startIdx,endIdx,start,template=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].SegmentTemplate,duration=representation.segmentDuration,availabilityWindow=representation.segmentAvailabilityRange,segments=[],url=null,seg=null,segmentRange=void 0,periodSegIdx=void 0;for(start=representation.startNumber,startIdx=(segmentRange=isNaN(duration)&&!isDynamic?{start:start,end:start}:(0,_SegmentsUtils.decideSegmentListRangeForTemplate)(timelineConverter,isDynamic,representation,requestedTime,index,availabilityUpperLimit)).start,endIdx=segmentRange.end,periodSegIdx=startIdx;periodSegIdx<=endIdx;periodSegIdx++)(seg=(0,_SegmentsUtils.getIndexBasedSegment)(timelineConverter,isDynamic,representation,periodSegIdx)).replacementTime=(start+periodSegIdx-1)*representation.segmentDuration,url=template.media,url=(0,_SegmentsUtils.replaceTokenForTemplate)(url,"Number",seg.replacementNumber),url=(0,_SegmentsUtils.replaceTokenForTemplate)(url,"Time",seg.replacementTime),seg.media=url,segments.push(seg),seg=null;return isNaN(duration)?representation.availableSegmentsNumber=1:representation.availableSegmentsNumber=Math.ceil((availabilityWindow.end-availabilityWindow.start)/duration),segments}}}TemplateSegmentsGetter.__dashjs_factory_name="TemplateSegmentsGetter";var factory=_coreFactoryMaker2.default.getClassFactory(TemplateSegmentsGetter);exports.default=factory,module.exports=exports.default},1511:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366)),_SegmentsUtils=__webpack_require__(1380);function ListSegmentsGetter(config,isDynamic){var timelineConverter=(config=config||{}).timelineConverter;return{getSegments:function getSegmentsFromList(representation,requestedTime,index,availabilityUpperLimit){var range,startIdx,endIdx,start,list=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].SegmentList,len=list.SegmentURL_asArray.length,segments=[],periodSegIdx=void 0,seg=void 0,s=void 0;for(start=representation.startNumber,range=(0,_SegmentsUtils.decideSegmentListRangeForTemplate)(timelineConverter,isDynamic,representation,requestedTime,index,availabilityUpperLimit),startIdx=Math.max(range.start,0),endIdx=Math.min(range.end,list.SegmentURL_asArray.length-1),periodSegIdx=startIdx;periodSegIdx<=endIdx;periodSegIdx++)s=list.SegmentURL_asArray[periodSegIdx],(seg=(0,_SegmentsUtils.getIndexBasedSegment)(timelineConverter,isDynamic,representation,periodSegIdx)).replacementTime=(start+periodSegIdx-1)*representation.segmentDuration,seg.media=s.media?s.media:"",seg.mediaRange=s.mediaRange,seg.index=s.index,seg.indexRange=s.indexRange,segments.push(seg),seg=null;return representation.availableSegmentsNumber=len,segments}}}ListSegmentsGetter.__dashjs_factory_name="ListSegmentsGetter";var factory=_coreFactoryMaker2.default.getClassFactory(ListSegmentsGetter);exports.default=factory,module.exports=exports.default},1512:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function FetchLoader(cfg){var requestModifier=(cfg=cfg||{}).requestModifier,boxParser=cfg.boxParser;function read(httpRequest,processResult){httpRequest.reader.read().then(processResult).catch((function(e){httpRequest.onerror&&200===httpRequest.response.status&&httpRequest.onerror(e)}))}function calculateDownloadedTime(datum,bytesReceived){if((datum=datum.filter((function(data){return data.bytes>bytesReceived/4/datum.length}))).length>1){var _ret=(time=0,avgTimeDistance=(datum[datum.length-1].ts-datum[0].ts)/datum.length,datum.forEach((function(data,index){var next=datum[index+1];if(next){var distance=next.ts-data.ts;time+=distance<avgTimeDistance?distance:0}})),{v:time});if("object"==typeof _ret)return _ret.v}var time,avgTimeDistance;return null}return{load:function load(httpRequest){var requestStartTime=new Date,request=httpRequest.request,headers=new Headers;request.range&&headers.append("Range","bytes="+request.range),request.requestStartDate||(request.requestStartDate=requestStartTime),requestModifier&&requestModifier.modifyRequestHeader({setRequestHeader:function setRequestHeader(header,value){headers.append(header,value)}});var abortController=void 0;"function"==typeof window.AbortController&&(abortController=new AbortController,httpRequest.abortController=abortController);var reqOptions={method:httpRequest.method,headers:headers,credentials:httpRequest.withCredentials?"include":void 0,signal:abortController?abortController.signal:void 0};fetch(httpRequest.url,reqOptions).then((function(response){httpRequest.response||(httpRequest.response={}),httpRequest.response.status=response.status,httpRequest.response.statusText=response.statusText,httpRequest.response.responseURL=response.url,response.ok||httpRequest.onerror();var responseHeaders="",_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=response.headers.keys()[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var key=_step.value;responseHeaders+=key+": "+response.headers.get(key)+"\n"}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}if(httpRequest.response.responseHeaders=responseHeaders,!response.body)return response.arrayBuffer().then((function(buffer){httpRequest.response.response=buffer;var event={loaded:buffer.byteLength,total:buffer.byteLength,stream:!1};httpRequest.progress(event),httpRequest.onload(),httpRequest.onend()}));var totalBytes=parseInt(response.headers.get("Content-Length"),10),bytesReceived=0,signaledFirstByte=!1,remaining=new Uint8Array,offset=0;httpRequest.reader=response.body.getReader();var downLoadedData=[];read(httpRequest,(function processResult(_ref){var value=_ref.value;if(_ref.done)return remaining&&(httpRequest.progress({loaded:bytesReceived,total:isNaN(totalBytes)?bytesReceived:totalBytes,lengthComputable:!0,time:calculateDownloadedTime(downLoadedData,bytesReceived),stream:!0}),httpRequest.response.response=remaining.buffer),httpRequest.onload(),void httpRequest.onend();if(value&&value.length>0){remaining=function concatTypedArray(remaining,data){if(0===remaining.length)return data;var result=new Uint8Array(remaining.length+data.length);return result.set(remaining),result.set(data,remaining.length),result}(remaining,value),bytesReceived+=value.length,downLoadedData.push({ts:Date.now(),bytes:value.length});var boxesInfo=boxParser.findLastTopIsoBoxCompleted(["moov","mdat"],remaining,offset);if(boxesInfo.found){var end=boxesInfo.lastCompletedOffset+boxesInfo.size,data=void 0;end===remaining.length?(data=remaining,remaining=new Uint8Array):(data=new Uint8Array(remaining.subarray(0,end)),remaining=remaining.subarray(end)),httpRequest.progress({data:data.buffer,lengthComputable:!1,noTrace:!0}),offset=0}else offset=boxesInfo.lastCompletedOffset,signaledFirstByte||(httpRequest.progress({lengthComputable:!1,noTrace:!0}),signaledFirstByte=!0)}read(httpRequest,processResult)}))})).catch((function(e){httpRequest.onerror&&httpRequest.onerror(e)}))},abort:function abort(request){if(request.abortController)request.abortController.abort();else if(request.reader)try{request.reader.cancel()}catch(e){}},calculateDownloadedTime:calculateDownloadedTime}}FetchLoader.__dashjs_factory_name="FetchLoader";var factory=_coreFactoryMaker2.default.getClassFactory(FetchLoader);exports.default=factory,module.exports=exports.default},1513:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_streamingUtilsEBMLParser2=_interopRequireDefault(__webpack_require__(1514)),_streamingConstantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_streamingUtilsRequestModifier2=_interopRequireDefault(__webpack_require__(1397)),_voSegment2=_interopRequireDefault(__webpack_require__(1412)),_streamingVoMetricsHTTPRequest=__webpack_require__(1373),_streamingVoFragmentRequest2=_interopRequireDefault(__webpack_require__(1378)),_streamingNetHTTPLoader2=_interopRequireDefault(__webpack_require__(1388)),_streamingVoDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372));function WebmSegmentBaseLoader(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,WebM=void 0,errHandler=void 0,requestModifier=void 0,metricsModel=void 0,mediaPlayerModel=void 0,httpLoader=void 0,baseURLController=void 0;function parseSegments(data,segmentStart,segmentEnd,segmentDuration){var parsed,len,duration=void 0,segments=void 0,segment=void 0,i=void 0,start=void 0,end=void 0;for(segments=[],i=0,len=(parsed=function parseCues(ab){var cues=[],cue=void 0,cueTrack=void 0,ebmlParser=(0,_streamingUtilsEBMLParser2.default)(context).create({data:ab});for(ebmlParser.consumeTagAndSize(WebM.Segment.Cues);ebmlParser.moreData()&&ebmlParser.consumeTagAndSize(WebM.Segment.Cues.CuePoint,!0);){for((cue={}).CueTime=ebmlParser.parseTag(WebM.Segment.Cues.CuePoint.CueTime),cue.CueTracks=[];ebmlParser.moreData()&&ebmlParser.consumeTag(WebM.Segment.Cues.CuePoint.CueTrackPositions,!0);){var cueTrackPositionSize=ebmlParser.getMatroskaCodedNum(),startPos=ebmlParser.getPos();if((cueTrack={}).Track=ebmlParser.parseTag(WebM.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===cueTrack.Track)throw new Error("Cue track cannot be 0");cueTrack.ClusterPosition=ebmlParser.parseTag(WebM.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),cue.CueTracks.push(cueTrack),ebmlParser.setPos(startPos+cueTrackPositionSize)}if(0===cue.CueTracks.length)throw new Error("Mandatory cuetrack not found");cues.push(cue)}if(0===cues.length)throw new Error("mandatory cuepoint not found");return cues}(data)).length;i<len;i+=1)segment=new _voSegment2.default,duration=0,duration=i<parsed.length-1?parsed[i+1].CueTime-parsed[i].CueTime:segmentDuration-parsed[i].CueTime,segment.duration=duration,segment.startTime=parsed[i].CueTime,segment.timescale=1e3,start=parsed[i].CueTracks[0].ClusterPosition+segmentStart,end=i<parsed.length-1?parsed[i+1].CueTracks[0].ClusterPosition+segmentStart-1:segmentEnd-1,segment.mediaRange=start+"-"+end,segments.push(segment);return logger.debug("Parsed cues: "+segments.length+" cues."),segments}function checkSetConfigCall(){if(!baseURLController||!baseURLController.hasOwnProperty("resolve"))throw new Error("setConfig function has to be called previously")}function onLoaded(segments,representation,type){segments?eventBus.trigger(_coreEventsEvents2.default.SEGMENTS_LOADED,{segments:segments,representation:representation,mediaType:type}):eventBus.trigger(_coreEventsEvents2.default.SEGMENTS_LOADED,{segments:null,representation:representation,mediaType:type,error:new _streamingVoDashJSError2.default(_coreErrorsErrors2.default.SEGMENT_BASE_LOADER_ERROR_CODE,_coreErrorsErrors2.default.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function getFragmentRequest(info){var request=new _streamingVoFragmentRequest2.default;return request.type=info.init?_streamingVoMetricsHTTPRequest.HTTPRequest.INIT_SEGMENT_TYPE:_streamingVoMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE,request.url=info.url,request.range=info.range.start+"-"+info.range.end,request}return instance={setConfig:function setConfig(config){if(!(config.baseURLController&&config.metricsModel&&config.mediaPlayerModel&&config.errHandler))throw new Error(_streamingConstantsConstants2.default.MISSING_CONFIG_ERROR);baseURLController=config.baseURLController,metricsModel=config.metricsModel,mediaPlayerModel=config.mediaPlayerModel,errHandler=config.errHandler},initialize:function initialize(){requestModifier=(0,_streamingUtilsRequestModifier2.default)(context).getInstance(),httpLoader=(0,_streamingNetHTTPLoader2.default)(context).create({errHandler:errHandler,metricsModel:metricsModel,mediaPlayerModel:mediaPlayerModel,requestModifier:requestModifier})},loadInitialization:function loadInitialization(representation,loadingInfo){checkSetConfigCall();var request=null,baseUrl=baseURLController.resolve(representation.path),media=baseUrl?baseUrl.url:void 0,initRange=representation.range.split("-"),info=loadingInfo||{range:{start:parseFloat(initRange[0]),end:parseFloat(initRange[1])},request:request,url:media,init:!0};logger.info("Start loading initialization."),request=getFragmentRequest(info),httpLoader.load({request:request,success:function onload(){eventBus.trigger(_coreEventsEvents2.default.INITIALIZATION_LOADED,{representation:representation})},error:function onloadend(){eventBus.trigger(_coreEventsEvents2.default.INITIALIZATION_LOADED,{representation:representation})}}),logger.debug("Perform init load: "+info.url)},loadSegments:function loadSegments(representation,type,theRange,callback){checkSetConfigCall();var request=null,baseUrl=baseURLController.resolve(representation.path),media=baseUrl?baseUrl.url:void 0;callback=callback||onLoaded,request=getFragmentRequest({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:request,url:media,init:!1}),logger.debug("Parsing ebml header"),httpLoader.load({request:request,success:function onload(response){!function parseEbmlHeader(data,media,theRange,callback){var segmentStart,ebmlParser=(0,_streamingUtilsEBMLParser2.default)(context).create({data:data}),duration=void 0,segments=void 0,parts=theRange.split("-"),request=null,info={url:media,range:{start:parseFloat(parts[0]),end:parseFloat(parts[1])},request:request},segmentEnd=void 0;for(logger.debug("Parse EBML header: "+info.url),ebmlParser.skipOverElement(WebM.EBML),ebmlParser.consumeTag(WebM.Segment),segmentEnd=ebmlParser.getMatroskaCodedNum(),segmentEnd+=ebmlParser.getPos(),segmentStart=ebmlParser.getPos();ebmlParser.moreData()&&!ebmlParser.consumeTagAndSize(WebM.Segment.Info,!0);)if(!(ebmlParser.skipOverElement(WebM.Segment.SeekHead,!0)||ebmlParser.skipOverElement(WebM.Segment.Tracks,!0)||ebmlParser.skipOverElement(WebM.Segment.Cues,!0)||ebmlParser.skipOverElement(WebM.Void,!0)))throw new Error("no valid top level element found");for(;void 0===duration;){var infoTag=ebmlParser.getMatroskaCodedNum(!0),infoElementSize=ebmlParser.getMatroskaCodedNum();switch(infoTag){case WebM.Segment.Info.Duration.tag:duration=ebmlParser[WebM.Segment.Info.Duration.parse](infoElementSize);break;default:ebmlParser.setPos(ebmlParser.getPos()+infoElementSize)}}request=getFragmentRequest(info),httpLoader.load({request:request,success:function onload(response){segments=parseSegments(response,segmentStart,segmentEnd,duration),callback(segments)},error:function onloadend(){logger.error("Download Error: Cues "+info.url),callback(null)}}),logger.debug("Perform cues load: "+info.url+" bytes="+info.range.start+"-"+info.range.end)}(response,media,theRange,(function(segments){callback(segments,representation,type)}))},error:function onloadend(){callback(null,representation,type)}})},reset:function reset(){errHandler=null,requestModifier=null}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),WebM={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}}}(),instance}WebmSegmentBaseLoader.__dashjs_factory_name="WebmSegmentBaseLoader",exports.default=_coreFactoryMaker2.default.getSingletonFactory(WebmSegmentBaseLoader),module.exports=exports.default},1514:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function EBMLParser(config){config=config||{};var instance=void 0,data=new DataView(config.data),pos=0;function consumeTag(tag,test){var found=!0,bytesConsumed=0;if(void 0===test&&(test=!1),tag.tag>16777215?(data.getUint32(pos)!==tag.tag&&(found=!1),bytesConsumed=4):tag.tag>65535?(256*data.getUint16(pos)+data.getUint8(pos+2)!==tag.tag&&(found=!1),bytesConsumed=3):tag.tag>255?(data.getUint16(pos)!==tag.tag&&(found=!1),bytesConsumed=2):(data.getUint8(pos)!==tag.tag&&(found=!1),bytesConsumed=1),!found&&tag.required&&!test)throw new Error("required tag not found");return found&&(pos+=bytesConsumed),found}function getMatroskaCodedNum(retainMSB){var bytesUsed=1,mask=128,extraBytes=-1,num=0,ch=data.getUint8(pos),i=0;for(i=0;i<8;i+=1){if((ch&mask)===mask){num=void 0===retainMSB?ch&~mask:ch,extraBytes=i;break}mask>>=1}for(i=0;i<extraBytes;i+=1,bytesUsed+=1)num=num<<8|255&data.getUint8(pos+bytesUsed);return pos+=bytesUsed,num}return instance={getPos:function getPos(){return pos},setPos:function setPos(value){pos=value},consumeTag:consumeTag,consumeTagAndSize:function consumeTagAndSize(tag,test){var found=consumeTag(tag,test);return found&&getMatroskaCodedNum(),found},parseTag:function parseTag(tag){var size;return consumeTag(tag),size=getMatroskaCodedNum(),instance[tag.parse](size)},skipOverElement:function skipOverElement(tag,test){var found=consumeTag(tag,test),headerSize=void 0;return found&&(headerSize=getMatroskaCodedNum(),pos+=headerSize),found},getMatroskaCodedNum:getMatroskaCodedNum,getMatroskaFloat:function getMatroskaFloat(size){var outFloat=void 0;switch(size){case 4:outFloat=data.getFloat32(pos),pos+=4;break;case 8:outFloat=data.getFloat64(pos),pos+=8}return outFloat},getMatroskaUint:function getMatroskaUint(size){for(var val=0,i=0;i<size;i+=1)val<<=8,val|=255&data.getUint8(pos+i);return pos+=size,val},moreData:function moreData(){return pos<data.byteLength}}}EBMLParser.__dashjs_factory_name="EBMLParser",exports.default=_coreFactoryMaker2.default.getClassFactory(EBMLParser),module.exports=exports.default},1515:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_netXHRLoader2=_interopRequireDefault(__webpack_require__(1414));function EventController(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,inlineEvents=void 0,inbandEvents=void 0,activeEvents=void 0,eventInterval=void 0,refreshDelay=void 0,lastEventTimerCall=void 0,manifestUpdater=void 0,playbackController=void 0,isStarted=void 0;function resetInitialSettings(){isStarted=!1,inlineEvents={},inbandEvents={},activeEvents={},eventInterval=null,refreshDelay=100,lastEventTimerCall=Date.now()/1e3}function checkSetConfigCall(){if(!manifestUpdater||!playbackController)throw new Error("setConfig function has to be called previously")}function stop(){null!==eventInterval&&isStarted&&(clearInterval(eventInterval),eventInterval=null,isStarted=!1)}function handleManifestReloadEvent(event){if(1==event.eventStream.value){var timescale=event.eventStream.timescale||1,validUntil=event.presentationTime/timescale,newDuration=void 0;newDuration=4294967295==event.presentationTime?NaN:(event.presentationTime+event.duration)/timescale,logger.info("Manifest validity changed: Valid until: "+validUntil+"; remaining duration: "+newDuration),eventBus.trigger(_coreEventsEvents2.default.MANIFEST_VALIDITY_CHANGED,{id:event.id,validUntil:validUntil,newDuration:newDuration,newManifestValidAfter:NaN})}}function onEventTimer(){var currentVideoTime=playbackController.getTime(),presentationTimeThreshold=currentVideoTime-lastEventTimerCall;lastEventTimerCall=currentVideoTime,triggerEvents(inbandEvents,presentationTimeThreshold,currentVideoTime),triggerEvents(inlineEvents,presentationTimeThreshold,currentVideoTime),function removeEvents(){if(activeEvents)for(var currentVideoTime=playbackController.getTime(),eventIds=Object.keys(activeEvents),i=0;i<eventIds.length;i++){var eventId=eventIds[i],curr=activeEvents[eventId];null!==curr&&(curr.duration+curr.presentationTime)/curr.eventStream.timescale<currentVideoTime&&(logger.debug("Remove Event "+eventId+" at time "+currentVideoTime),curr=null,delete activeEvents[eventId])}}()}function triggerEvents(events,presentationTimeThreshold,currentVideoTime){var presentationTime,url;if(events)for(var eventIds=Object.keys(events),i=0;i<eventIds.length;i++){var eventId=eventIds[i],curr=events[eventId];void 0!==curr&&(0===(presentationTime=curr.presentationTime/curr.eventStream.timescale)||presentationTime<=currentVideoTime&&presentationTime+presentationTimeThreshold>currentVideoTime)&&(logger.debug("Start Event "+eventId+" at "+currentVideoTime),curr.duration>0&&(activeEvents[eventId]=curr),"urn:mpeg:dash:event:2012"==curr.eventStream.schemeIdUri&&1==curr.eventStream.value?0===curr.duration&&0===curr.presentationTimeDelta||(checkSetConfigCall(),manifestUpdater.refreshManifest()):"urn:mpeg:dash:event:callback:2015"==curr.eventStream.schemeIdUri&&1==curr.eventStream.value?(url=curr.messageData,(0,_netXHRLoader2.default)(context).create({}).load({method:"get",url:url,request:{responseType:"arraybuffer"}})):eventBus.trigger(curr.eventStream.schemeIdUri,{event:curr}),delete events[eventId])}}return instance={addInlineEvents:function addInlineEvents(values){if(checkSetConfigCall(),inlineEvents={},values)for(var i=0;i<values.length;i++){var _event=values[i];inlineEvents[_event.id]=_event,logger.debug("Add inline event with id "+_event.id)}logger.debug("Added "+values.length+" inline events")},addInbandEvents:function addInbandEvents(values){checkSetConfigCall();for(var i=0;i<values.length;i++){var _event2=values[i];_event2.id in inbandEvents?logger.debug("Repeated event with id "+_event2.id):("urn:mpeg:dash:event:2012"===_event2.eventStream.schemeIdUri&&void 0===inbandEvents[_event2.id]&&handleManifestReloadEvent(_event2),inbandEvents[_event2.id]=_event2,logger.debug("Add inband event with id "+_event2.id))}},stop:stop,start:function start(){checkSetConfigCall(),logger.debug("Start Event Controller"),isStarted||isNaN(refreshDelay)||(isStarted=!0,eventInterval=setInterval(onEventTimer,refreshDelay))},setConfig:function setConfig(config){config&&(config.manifestUpdater&&(manifestUpdater=config.manifestUpdater),config.playbackController&&(playbackController=config.playbackController))},reset:function reset(){stop(),resetInitialSettings()}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),resetInitialSettings()}(),instance}EventController.__dashjs_factory_name="EventController",exports.default=_coreFactoryMaker2.default.getClassFactory(EventController),module.exports=exports.default},1516:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_voMetricsHTTPRequest=__webpack_require__(1373),_voDataChunk2=_interopRequireDefault(__webpack_require__(1517)),_modelsFragmentModel2=_interopRequireDefault(__webpack_require__(1390)),_FragmentLoader2=_interopRequireDefault(__webpack_require__(1518)),_utilsRequestModifier2=_interopRequireDefault(__webpack_require__(1397)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function FragmentController(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),errHandler=config.errHandler,mediaPlayerModel=config.mediaPlayerModel,metricsModel=config.metricsModel,instance=void 0,logger=void 0,fragmentModels=void 0;function isInitializationRequest(request){return request&&request.type&&request.type===_voMetricsHTTPRequest.HTTPRequest.INIT_SEGMENT_TYPE}function resetInitialSettings(){for(var model in fragmentModels)fragmentModels[model].reset();fragmentModels={}}function onFragmentLoadingCompleted(e){if(fragmentModels[e.request.mediaType]===e.sender){var request=e.request,bytes=e.response,isInit=isInitializationRequest(request),streamInfo=request.mediaInfo.streamInfo;if(e.error&&(e.request.mediaType!==_constantsConstants2.default.AUDIO&&e.request.mediaType!==_constantsConstants2.default.VIDEO&&e.request.mediaType!==_constantsConstants2.default.FRAGMENTED_TEXT||eventBus.trigger(_coreEventsEvents2.default.SERVICE_LOCATION_BLACKLIST_ADD,{entry:e.request.serviceLocation})),bytes&&streamInfo){var chunk=function createDataChunk(bytes,request,streamId,endFragment){var chunk=new _voDataChunk2.default;return chunk.streamId=streamId,chunk.mediaInfo=request.mediaInfo,chunk.segmentType=request.type,chunk.start=request.startTime,chunk.duration=request.duration,chunk.end=chunk.start+chunk.duration,chunk.bytes=bytes,chunk.index=request.index,chunk.quality=request.quality,chunk.representationId=request.representationId,chunk.endFragment=endFragment,chunk}(bytes,request,streamInfo.id,e.type!==_coreEventsEvents2.default.FRAGMENT_LOADING_PROGRESS);eventBus.trigger(isInit?_coreEventsEvents2.default.INIT_FRAGMENT_LOADED:_coreEventsEvents2.default.MEDIA_FRAGMENT_LOADED,{chunk:chunk,fragmentModel:e.sender})}else logger.warn("No "+request.mediaType+" bytes to push or stream is inactive.")}}return instance={getModel:function getModel(type){var model=fragmentModels[type];return model||(model=(0,_modelsFragmentModel2.default)(context).create({metricsModel:metricsModel,fragmentLoader:(0,_FragmentLoader2.default)(context).create({metricsModel:metricsModel,mediaPlayerModel:mediaPlayerModel,errHandler:errHandler,requestModifier:(0,_utilsRequestModifier2.default)(context).getInstance()})}),fragmentModels[type]=model),model},isInitializationRequest:isInitializationRequest,reset:function reset(){eventBus.off(_coreEventsEvents2.default.FRAGMENT_LOADING_COMPLETED,onFragmentLoadingCompleted,this),eventBus.off(_coreEventsEvents2.default.FRAGMENT_LOADING_PROGRESS,onFragmentLoadingCompleted,this),resetInitialSettings()}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),resetInitialSettings(),eventBus.on(_coreEventsEvents2.default.FRAGMENT_LOADING_COMPLETED,onFragmentLoadingCompleted,instance),eventBus.on(_coreEventsEvents2.default.FRAGMENT_LOADING_PROGRESS,onFragmentLoadingCompleted,instance)}(),instance}FragmentController.__dashjs_factory_name="FragmentController",exports.default=_coreFactoryMaker2.default.getClassFactory(FragmentController),module.exports=exports.default},1517:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function DataChunk(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DataChunk),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null},module.exports=exports.default},1518:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _netHTTPLoader2=_interopRequireDefault(__webpack_require__(1388)),_voHeadRequest2=_interopRequireDefault(__webpack_require__(1519)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_streamingUtilsBoxParser2=_interopRequireDefault(__webpack_require__(1386)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366));function FragmentLoader(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,httpLoader=void 0;return instance={checkForExistence:function checkForExistence(request){var report=function report(success){eventBus.trigger(_coreEventsEvents2.default.CHECK_FOR_EXISTENCE_COMPLETED,{request:request,exists:success})};if(request){var headRequest=new _voHeadRequest2.default(request.url);httpLoader.load({request:headRequest,success:function success(){report(!0)},error:function error(){report(!1)}})}else report(!1)},load:function load(request){var report=function report(data,error){eventBus.trigger(_coreEventsEvents2.default.LOADING_COMPLETED,{request:request,response:data||null,error:error||null,sender:instance})};request?httpLoader.load({request:request,progress:function progress(event){eventBus.trigger(_coreEventsEvents2.default.LOADING_PROGRESS,{request:request,stream:event.stream}),event.data&&eventBus.trigger(_coreEventsEvents2.default.LOADING_DATA_PROGRESS,{request:request,response:event.data||null,error:null,sender:instance})},success:function success(data){report(data)},error:function error(request,statusText,errorText){report(void 0,new _voDashJSError2.default(_coreErrorsErrors2.default.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,errorText,statusText))},abort:function abort(request){request&&eventBus.trigger(_coreEventsEvents2.default.LOADING_ABANDONED,{request:request,mediaType:request.mediaType,sender:instance})}}):report(void 0,new _voDashJSError2.default(_coreErrorsErrors2.default.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,_coreErrorsErrors2.default.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},abort:function abort(){httpLoader&&httpLoader.abort()},reset:function reset(){httpLoader&&(httpLoader.abort(),httpLoader=null)}},function setup(){var boxParser=(0,_streamingUtilsBoxParser2.default)(context).getInstance();httpLoader=(0,_netHTTPLoader2.default)(context).create({errHandler:config.errHandler,metricsModel:config.metricsModel,mediaPlayerModel:config.mediaPlayerModel,requestModifier:config.requestModifier,boxParser:boxParser,useFetch:config.mediaPlayerModel.getLowLatencyEnabled()})}(),instance}FragmentLoader.__dashjs_factory_name="FragmentLoader",exports.default=_coreFactoryMaker2.default.getClassFactory(FragmentLoader),module.exports=exports.default},1519:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var HeadRequest=function(_FragmentRequest){function HeadRequest(url){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HeadRequest),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(HeadRequest.prototype),"constructor",this).call(this),this.url=url||null,this.checkForExistenceOnly=!0}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(HeadRequest,_FragmentRequest),HeadRequest}(function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1378)).default);exports.default=HeadRequest,module.exports=exports.default},1520:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_voThumbnail2=_interopRequireDefault(__webpack_require__(1521)),_ThumbnailTracks2=_interopRequireDefault(__webpack_require__(1437)),_voBitrateInfo2=_interopRequireDefault(__webpack_require__(1434)),_dashUtilsSegmentsUtils=__webpack_require__(1380);function ThumbnailController(config){var instance,context=this.context,thumbnailTracks=void 0;function reset(){thumbnailTracks&&thumbnailTracks.reset()}return instance={get:function getThumbnail(time,callback){var track=thumbnailTracks.getCurrentTrack();if(!track||track.segmentDuration<=0||null==time)return null;var seq=Math.floor(time/track.segmentDuration),offset=time%track.segmentDuration,thumbIndex=Math.floor(offset*track.tilesHor*track.tilesVert/track.segmentDuration),thumbnail=new _voThumbnail2.default;return thumbnail.width=Math.floor(track.widthPerTile),thumbnail.height=Math.floor(track.heightPerTile),thumbnail.x=Math.floor(thumbIndex%track.tilesHor)*track.widthPerTile,thumbnail.y=Math.floor(thumbIndex/track.tilesHor)*track.heightPerTile,"readThumbnail"in track?track.readThumbnail(time,(function(url){thumbnail.url=url,callback&&callback(thumbnail)})):(thumbnail.url=function buildUrlFromTemplate(track,seq){var seqIdx=seq+track.startNumber,url=(0,_dashUtilsSegmentsUtils.replaceTokenForTemplate)(track.templateUrl,"Number",seqIdx);return url=(0,_dashUtilsSegmentsUtils.replaceTokenForTemplate)(url,"Time",(seqIdx-1)*track.segmentDuration),url=(0,_dashUtilsSegmentsUtils.replaceTokenForTemplate)(url,"Bandwidth",track.bandwidth),(0,_dashUtilsSegmentsUtils.unescapeDollarsInTemplate)(url)}(track,seq),callback&&callback(thumbnail),thumbnail)},setTrackByIndex:function setTrackByIndex(index){thumbnailTracks.setTrackByIndex(index)},getCurrentTrackIndex:function getCurrentTrackIndex(){return thumbnailTracks.getCurrentTrackIndex()},getBitrateList:function getBitrateList(){var tracks=thumbnailTracks.getTracks(),i=0;return tracks.map((function(t){var bitrateInfo=new _voBitrateInfo2.default;return bitrateInfo.mediaType=_constantsConstants2.default.IMAGE,bitrateInfo.qualityIndex=i++,bitrateInfo.bitrate=t.bitrate,bitrateInfo.width=t.width,bitrateInfo.height=t.height,bitrateInfo}))},reset:reset},function setup(){reset(),thumbnailTracks=(0,_ThumbnailTracks2.default)(context).create({dashManifestModel:config.dashManifestModel,adapter:config.adapter,baseURLController:config.baseURLController,stream:config.stream,timelineConverter:config.timelineConverter})}(),instance}ThumbnailController.__dashjs_factory_name="ThumbnailController",exports.default=_coreFactoryMaker2.default.getClassFactory(ThumbnailController),module.exports=exports.default},1521:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function Thumbnail(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Thumbnail),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null},module.exports=exports.default},1522:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function ThumbnailTrackInfo(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ThumbnailTrackInfo),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""},module.exports=exports.default},1523:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372));function ManifestUpdater(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),instance=void 0,logger=void 0,refreshDelay=void 0,refreshTimer=void 0,isPaused=void 0,isUpdating=void 0,manifestLoader=void 0,manifestModel=void 0,dashManifestModel=void 0,errHandler=void 0,mediaPlayerModel=void 0;function resetInitialSettings(){refreshDelay=NaN,isUpdating=!1,isPaused=!0,stopManifestRefreshTimer()}function stopManifestRefreshTimer(){null!==refreshTimer&&(clearInterval(refreshTimer),refreshTimer=null)}function startManifestRefreshTimer(delay){stopManifestRefreshTimer(),isNaN(delay)&&!isNaN(refreshDelay)&&(delay=1e3*refreshDelay),isNaN(delay)||(logger.debug("Refresh manifest in "+delay+" milliseconds."),refreshTimer=setTimeout(onRefreshTimer,delay))}function refreshManifest(){isUpdating=!0;var manifest=manifestModel.getValue(),url=manifest.url,location=dashManifestModel.getLocation(manifest);location&&(url=location),manifestLoader.load(url)}function update(manifest){manifestModel.setValue(manifest);var date=new Date,latencyOfLastUpdate=(date.getTime()-manifest.loadedTime.getTime())/1e3;1e3*(refreshDelay=dashManifestModel.getManifestUpdatePeriod(manifest,latencyOfLastUpdate))>2147483647&&(refreshDelay=2147483.647),eventBus.trigger(_coreEventsEvents2.default.MANIFEST_UPDATED,{manifest:manifest}),logger.info("Manifest has been refreshed at "+date+"["+date.getTime()/1e3+"] "),isPaused||startManifestRefreshTimer()}function onRefreshTimer(){isPaused&&!mediaPlayerModel.getScheduleWhilePaused()||(isUpdating?startManifestRefreshTimer(mediaPlayerModel.getManifestUpdateRetryInterval()):refreshManifest())}function onManifestLoaded(e){e.error?e.error.code===_coreErrorsErrors2.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&errHandler.error(e.error):update(e.manifest)}function onPlaybackStarted(){isPaused=!1,startManifestRefreshTimer()}function onPlaybackPaused(){isPaused=!0,stopManifestRefreshTimer()}function onStreamsComposed(){isUpdating=!1}return instance={initialize:function initialize(){resetInitialSettings(),eventBus.on(_coreEventsEvents2.default.STREAMS_COMPOSED,onStreamsComposed,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_STARTED,onPlaybackStarted,this),eventBus.on(_coreEventsEvents2.default.PLAYBACK_PAUSED,onPlaybackPaused,this),eventBus.on(_coreEventsEvents2.default.INTERNAL_MANIFEST_LOADED,onManifestLoaded,this)},setManifest:function setManifest(manifest){update(manifest)},refreshManifest:refreshManifest,setConfig:function setConfig(config){config&&(config.manifestModel&&(manifestModel=config.manifestModel),config.dashManifestModel&&(dashManifestModel=config.dashManifestModel),config.mediaPlayerModel&&(mediaPlayerModel=config.mediaPlayerModel),config.manifestLoader&&(manifestLoader=config.manifestLoader),config.errHandler&&(errHandler=config.errHandler))},reset:function reset(){eventBus.off(_coreEventsEvents2.default.PLAYBACK_STARTED,onPlaybackStarted,this),eventBus.off(_coreEventsEvents2.default.PLAYBACK_PAUSED,onPlaybackPaused,this),eventBus.off(_coreEventsEvents2.default.STREAMS_COMPOSED,onStreamsComposed,this),eventBus.off(_coreEventsEvents2.default.INTERNAL_MANIFEST_LOADED,onManifestLoaded,this),resetInitialSettings()}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}ManifestUpdater.__dashjs_factory_name="ManifestUpdater",exports.default=_coreFactoryMaker2.default.getClassFactory(ManifestUpdater),module.exports=exports.default},1524:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_voMetricsHTTPRequest=__webpack_require__(1373),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_utilsURLUtils2=_interopRequireDefault(__webpack_require__(1376));function TimeSyncController(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),urlUtils=(0,_utilsURLUtils2.default)(context).getInstance(),instance=void 0,logger=void 0,offsetToDeviceTimeMs=void 0,isSynchronizing=void 0,useManifestDateHeaderTimeSource=void 0,handlers=void 0,metricsModel=void 0,dashMetrics=void 0,baseURLController=void 0;function setIsSynchronizing(value){isSynchronizing=value}function setOffsetMs(value){offsetToDeviceTimeMs=value}function xsdatetimeDecoder(xsdatetimeStr){var parsedDate=Date.parse(xsdatetimeStr);return isNaN(parsedDate)&&(parsedDate=function alternateXsdatetimeDecoder(xsdatetimeStr){var utcDate=void 0,timezoneOffset=void 0,match=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(xsdatetimeStr);return utcDate=Date.UTC(parseInt(match[1],10),parseInt(match[2],10)-1,parseInt(match[3],10),parseInt(match[4],10),parseInt(match[5],10),match[6]&&(parseInt(match[6],10)||0),match[7]&&1e3*parseFloat(match[7])||0),match[9]&&match[10]&&(timezoneOffset=60*parseInt(match[9],10)+parseInt(match[10],10),utcDate+=("+"===match[8]?-1:1)*timezoneOffset*60*1e3),new Date(utcDate).getTime()}(xsdatetimeStr)),parsedDate}function iso8601Decoder(isoStr){return Date.parse(isoStr)}function rfc1123Decoder(dateStr){return Date.parse(dateStr)}function notSupportedHandler(url,onSuccessCB,onFailureCB){onFailureCB()}function directHandler(xsdatetimeStr,onSuccessCB,onFailureCB){var time=xsdatetimeDecoder(xsdatetimeStr);isNaN(time)?onFailureCB():onSuccessCB(time)}function httpHandler(decoder,url,onSuccessCB,onFailureCB,isHeadRequest){var oncomplete,onload,complete=!1,req=new XMLHttpRequest,verb=isHeadRequest?_voMetricsHTTPRequest.HTTPRequest.HEAD:_voMetricsHTTPRequest.HTTPRequest.GET,urls=url.match(/\S+/g);if(url=urls.shift(),oncomplete=function(){complete||(complete=!0,urls.length?httpHandler(decoder,urls.join(" "),onSuccessCB,onFailureCB,isHeadRequest):onFailureCB())},onload=function(){var time=void 0,result=void 0;200===req.status&&(time=isHeadRequest?req.getResponseHeader("Date"):req.response,result=decoder(time),isNaN(result)||(onSuccessCB(result),complete=!0))},urlUtils.isRelative(url)){var baseUrl=baseURLController.resolve();baseUrl&&(url=urlUtils.resolve(url,baseUrl.url))}req.open(verb,url),req.timeout=5e3,req.onload=onload,req.onloadend=oncomplete,req.send()}function httpHeadHandler(url,onSuccessCB,onFailureCB){httpHandler(rfc1123Decoder,url,onSuccessCB,onFailureCB,!0)}function completeTimeSyncSequence(failed,time,offset){setIsSynchronizing(!1),eventBus.trigger(_coreEventsEvents2.default.TIME_SYNCHRONIZATION_COMPLETED,{time:time,offset:offset,error:failed?new _voDashJSError2.default(_coreErrorsErrors2.default.TIME_SYNC_FAILED_ERROR_CODE,_coreErrorsErrors2.default.TIME_SYNC_FAILED_ERROR_MESSAGE):null})}return instance={initialize:function initialize(timingSources,useManifestDateHeader){useManifestDateHeaderTimeSource=useManifestDateHeader,offsetToDeviceTimeMs=0,isSynchronizing=!1,handlers={"urn:mpeg:dash:utc:http-head:2014":httpHeadHandler,"urn:mpeg:dash:utc:http-xsdate:2014":httpHandler.bind(null,xsdatetimeDecoder),"urn:mpeg:dash:utc:http-iso:2014":httpHandler.bind(null,iso8601Decoder),"urn:mpeg:dash:utc:direct:2014":directHandler,"urn:mpeg:dash:utc:http-head:2012":httpHeadHandler,"urn:mpeg:dash:utc:http-xsdate:2012":httpHandler.bind(null,xsdatetimeDecoder),"urn:mpeg:dash:utc:http-iso:2012":httpHandler.bind(null,iso8601Decoder),"urn:mpeg:dash:utc:direct:2012":directHandler,"urn:mpeg:dash:utc:http-ntp:2014":notSupportedHandler,"urn:mpeg:dash:utc:ntp:2014":notSupportedHandler,"urn:mpeg:dash:utc:sntp:2014":notSupportedHandler},function getIsSynchronizing(){return isSynchronizing}()||function attemptSync(sources,sourceIndex){var index=sourceIndex||0,source=sources[index],onComplete=function onComplete(time,offset){var failed=!time||!offset;failed&&useManifestDateHeaderTimeSource?function checkForDateHeader(){var metrics=metricsModel.getReadOnlyMetricsFor(_constantsConstants2.default.STREAM),dateHeaderValue=dashMetrics.getLatestMPDRequestHeaderValueByID(metrics,"Date"),dateHeaderTime=null!==dateHeaderValue?new Date(dateHeaderValue).getTime():Number.NaN;isNaN(dateHeaderTime)?completeTimeSyncSequence(!0):(setOffsetMs(dateHeaderTime-(new Date).getTime()),completeTimeSyncSequence(!1,dateHeaderTime/1e3,offsetToDeviceTimeMs))}():completeTimeSyncSequence(failed,time,offset)};setIsSynchronizing(!0),source?handlers.hasOwnProperty(source.schemeIdUri)?handlers[source.schemeIdUri](source.value,(function(serverTime){var deviceTime=(new Date).getTime(),offset=function calculateTimeOffset(serverTime,deviceTime){return serverTime-deviceTime}(serverTime,deviceTime);setOffsetMs(offset),logger.info("Local time: "+new Date(deviceTime)),logger.info("Server time: "+new Date(serverTime)),logger.info("Server Time - Local Time (ms): "+offset),onComplete(serverTime,offset)}),(function(){attemptSync(sources,index+1)})):attemptSync(sources,index+1):(setOffsetMs(0),onComplete())}(timingSources)},getOffsetToDeviceTimeMs:function getOffsetToDeviceTimeMs(){return function getOffsetMs(){return offsetToDeviceTimeMs}()},setConfig:function setConfig(config){config&&(config.metricsModel&&(metricsModel=config.metricsModel),config.dashMetrics&&(dashMetrics=config.dashMetrics),config.baseURLController&&(baseURLController=config.baseURLController))},reset:function reset(){setIsSynchronizing(!1)}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}TimeSyncController.__dashjs_factory_name="TimeSyncController";var factory=_coreFactoryMaker2.default.getSingletonFactory(TimeSyncController);factory.HTTP_TIMEOUT_MS=5e3,_coreFactoryMaker2.default.updateSingletonFactory(TimeSyncController.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1525:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _utilsObjectUtils2=_interopRequireDefault(__webpack_require__(1440)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),Node=function Node(_baseUrls,_selectedIdx){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Node),this.data={baseUrls:_baseUrls||null,selectedIdx:_selectedIdx||NaN},this.children=[]};function BaseURLTreeModel(){var instance,root=void 0,dashManifestModel=void 0,context=this.context,objectUtils=(0,_utilsObjectUtils2.default)(context).getInstance();function updateChildData(node,index,element){var baseUrls=dashManifestModel.getBaseURLsFromElement(element);node[index]?objectUtils.areEqual(baseUrls,node[index].data.baseUrls)||(node[index].data.baseUrls=baseUrls,node[index].data.selectedIdx=NaN):node[index]=new Node(baseUrls)}function getBaseURLCollectionsFromManifest(manifest){!function checkSetConfigCall(){if(!dashManifestModel||!dashManifestModel.hasOwnProperty("getBaseURLsFromElement")||!dashManifestModel.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}();var baseUrls=dashManifestModel.getBaseURLsFromElement(manifest);objectUtils.areEqual(baseUrls,root.data.baseUrls)||(root.data.baseUrls=baseUrls,root.data.selectedIdx=NaN),manifest&&manifest.Period_asArray&&manifest.Period_asArray.forEach((function(p,pi){updateChildData(root.children,pi,p),p.AdaptationSet_asArray&&p.AdaptationSet_asArray.forEach((function(a,ai){updateChildData(root.children[pi].children,ai,a),a.Representation_asArray&&a.Representation_asArray.sort(dashManifestModel.getRepresentationSortFunction()).forEach((function(r,ri){updateChildData(root.children[pi].children[ai].children,ri,r)}))}))}))}function reset(){root=new Node}return instance={reset:reset,update:function update(manifest){getBaseURLCollectionsFromManifest(manifest)},getForPath:function getForPath(path){var target=root,nodes=[target.data];return path&&path.forEach((function(p){(target=target.children[p])&&nodes.push(target.data)})),nodes.filter((function(n){return n.baseUrls.length}))},invalidateSelectedIndexes:function invalidateSelectedIndexes(serviceLocation){!function walk(callback,node){var target=node||root;callback(target.data),target.children&&target.children.forEach((function(child){return walk(callback,child)}))}((function(data){isNaN(data.selectedIdx)||serviceLocation===data.baseUrls[data.selectedIdx].serviceLocation&&(data.selectedIdx=NaN)}))},setConfig:function setConfig(config){config.dashManifestModel&&(dashManifestModel=config.dashManifestModel)}},function setup(){reset()}(),instance}BaseURLTreeModel.__dashjs_factory_name="BaseURLTreeModel",exports.default=_coreFactoryMaker2.default.getClassFactory(BaseURLTreeModel),module.exports=exports.default},1526:function(module,exports,__webpack_require__){"use strict";var isArray=Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty;module.exports=function equal(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){var i,length,key,arrA=isArray(a),arrB=isArray(b);if(arrA&&arrB){if((length=a.length)!=b.length)return!1;for(i=length;0!=i--;)if(!equal(a[i],b[i]))return!1;return!0}if(arrA!=arrB)return!1;var dateA=a instanceof Date,dateB=b instanceof Date;if(dateA!=dateB)return!1;if(dateA&&dateB)return a.getTime()==b.getTime();var regexpA=a instanceof RegExp,regexpB=b instanceof RegExp;if(regexpA!=regexpB)return!1;if(regexpA&&regexpB)return a.toString()==b.toString();var keys=keyList(a);if((length=keys.length)!==keyList(b).length)return!1;for(i=length;0!=i--;)if(!hasProp.call(b,keys[i]))return!1;for(i=length;0!=i--;)if(!equal(a[key=keys[i]],b[key]))return!1;return!0}return a!=a&&b!=b}},1527:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_controllersBlacklistController2=_interopRequireDefault(__webpack_require__(1528)),_baseUrlResolutionDVBSelector2=_interopRequireDefault(__webpack_require__(1529)),_baseUrlResolutionBasicSelector2=_interopRequireDefault(__webpack_require__(1530)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_constantsConstants2=_interopRequireDefault(__webpack_require__(1367));function BaseURLSelector(){var instance,context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),dashManifestModel=void 0,serviceLocationBlacklistController=void 0,basicSelector=void 0,dvbSelector=void 0,selector=void 0;function reset(){serviceLocationBlacklistController.reset()}return instance={chooseSelectorFromManifest:function chooseSelectorFromManifest(manifest){!function checkConfig(){if(!dashManifestModel||!dashManifestModel.hasOwnProperty("getIsDVB"))throw new Error(_constantsConstants2.default.MISSING_CONFIG_ERROR)}(),selector=dashManifestModel.getIsDVB(manifest)?dvbSelector:basicSelector},select:function select(data){if(data){var baseUrls=data.baseUrls,selectedIdx=data.selectedIdx;if(!isNaN(selectedIdx))return baseUrls[selectedIdx];var selectedBaseUrl=selector.select(baseUrls);return selectedBaseUrl?(data.selectedIdx=baseUrls.indexOf(selectedBaseUrl),selectedBaseUrl):(eventBus.trigger(_coreEventsEvents2.default.URL_RESOLUTION_FAILED,{error:new _voDashJSError2.default(_coreErrorsErrors2.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,_coreErrorsErrors2.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(selector===basicSelector&&reset()))}},reset:reset,setConfig:function setConfig(config){config.selector&&(selector=config.selector),config.dashManifestModel&&(dashManifestModel=config.dashManifestModel)}},function setup(){serviceLocationBlacklistController=(0,_controllersBlacklistController2.default)(context).create({updateEventName:_coreEventsEvents2.default.SERVICE_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:_coreEventsEvents2.default.SERVICE_LOCATION_BLACKLIST_ADD}),basicSelector=(0,_baseUrlResolutionBasicSelector2.default)(context).create({blacklistController:serviceLocationBlacklistController}),dvbSelector=(0,_baseUrlResolutionDVBSelector2.default)(context).create({blacklistController:serviceLocationBlacklistController}),selector=basicSelector}(),instance}BaseURLSelector.__dashjs_factory_name="BaseURLSelector",exports.default=_coreFactoryMaker2.default.getClassFactory(BaseURLSelector),module.exports=exports.default},1528:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368));function BlackListController(config){config=config||{};var blacklist=[],eventBus=(0,_coreEventBus2.default)(this.context).getInstance(),updateEventName=config.updateEventName,addBlacklistEventName=config.addBlacklistEventName;function add(entry){-1===blacklist.indexOf(entry)&&(blacklist.push(entry),eventBus.trigger(updateEventName,{entry:entry}))}function onAddBlackList(e){add(e.entry)}return function setup(){addBlacklistEventName&&eventBus.on(addBlacklistEventName,onAddBlackList,this)}(),{add:add,contains:function contains(query){return!!(blacklist.length&&query&&query.length)&&-1!==blacklist.indexOf(query)},reset:function reset(){blacklist=[]}}}BlackListController.__dashjs_factory_name="BlackListController",exports.default=_coreFactoryMaker2.default.getClassFactory(BlackListController),module.exports=exports.default},1529:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function DVBSelector(config){var blacklistController=(config=config||{}).blacklistController;return{select:function select(baseUrls){return baseUrls&&function selectByWeight(availableUrls){var totalWeight=0,cumulWeights=[],idx=0,rn=void 0,urls=void 0;if((urls=availableUrls.sort((function prioritySorter(a,b){var diff=a.dvb_priority-b.dvb_priority;return isNaN(diff)?0:diff})).filter((function topPriorityFilter(baseUrl,idx,arr){return!idx||arr[0].dvb_priority&&baseUrl.dvb_priority&&arr[0].dvb_priority===baseUrl.dvb_priority}))).length)return urls.length>1&&(urls.forEach((function(baseUrl){totalWeight+=baseUrl.dvb_weight,cumulWeights.push(totalWeight)})),rn=Math.floor(Math.random()*(totalWeight-1)),cumulWeights.every((function(limit,index){return idx=index,!(rn<limit)}))),urls[idx]}(function getNonBlacklistedBaseUrls(urls){var removedPriorities=[];return urls.filter((function serviceLocationFilter(baseUrl){return!blacklistController.contains(baseUrl.serviceLocation)||(baseUrl.dvb_priority&&removedPriorities.push(baseUrl.dvb_priority),!1)})).filter((function samePrioritiesFilter(el){return!removedPriorities.length||!el.dvb_priority||-1===removedPriorities.indexOf(el.dvb_priority)}))}(baseUrls))}}}DVBSelector.__dashjs_factory_name="DVBSelector",exports.default=_coreFactoryMaker2.default.getClassFactory(DVBSelector),module.exports=exports.default},1530:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function BasicSelector(config){var blacklistController=(config=config||{}).blacklistController;return{select:function select(baseUrls){var index=0,selectedBaseUrl=void 0;return baseUrls&&baseUrls.some((function(baseUrl,idx){return index=idx,!blacklistController.contains(baseUrl.serviceLocation)}))&&(selectedBaseUrl=baseUrls[index]),selectedBaseUrl}}}BasicSelector.__dashjs_factory_name="BasicSelector",exports.default=_coreFactoryMaker2.default.getClassFactory(BasicSelector),module.exports=exports.default},1531:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function MediaSourceController(){var instance=void 0,logger=void 0,context=this.context;return instance={createMediaSource:function createMediaSource(){var hasWebKit="WebKitMediaSource"in window;return"MediaSource"in window?new MediaSource:hasWebKit?new WebKitMediaSource:null},attachMediaSource:function attachMediaSource(source,videoModel){var objectURL=window.URL.createObjectURL(source);return videoModel.setSource(objectURL),objectURL},detachMediaSource:function detachMediaSource(videoModel){videoModel.setSource(null)},setDuration:function setDuration(source,value){return source.duration!=value&&(source.duration=value),source.duration},setSeekable:function setSeekable(source,start,end){source&&"function"==typeof source.setLiveSeekableRange&&"function"==typeof source.clearLiveSeekableRange&&"open"===source.readyState&&start>=0&&start<end&&(source.clearLiveSeekableRange(),source.setLiveSeekableRange(start,end))},signalEndOfStream:function signalEndOfStream(source){var buffers=source.sourceBuffers,ln=buffers.length;if("open"===source.readyState){for(var i=0;i<ln;i++){if(buffers[i].updating)return;if(0===buffers[i].buffered.length)return}logger.info("call to mediaSource endOfStream"),source.endOfStream()}}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}MediaSourceController.__dashjs_factory_name="MediaSourceController",exports.default=_coreFactoryMaker2.default.getSingletonFactory(MediaSourceController),module.exports=exports.default},1532:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_controllersXlinkController2=_interopRequireDefault(__webpack_require__(1533)),_netHTTPLoader2=_interopRequireDefault(__webpack_require__(1388)),_utilsURLUtils2=_interopRequireDefault(__webpack_require__(1376)),_voTextRequest2=_interopRequireDefault(__webpack_require__(1442)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_voMetricsHTTPRequest=__webpack_require__(1373),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_dashParserDashParser2=_interopRequireDefault(__webpack_require__(1535)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function ManifestLoader(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),urlUtils=(0,_utilsURLUtils2.default)(context).getInstance(),instance=void 0,logger=void 0,httpLoader=void 0,xlinkController=void 0,parser=void 0,mssHandler=config.mssHandler,errHandler=config.errHandler;function onXlinkReady(event){eventBus.trigger(_coreEventsEvents2.default.INTERNAL_MANIFEST_LOADED,{manifest:event.manifest})}return instance={load:function load(url){var request=new _voTextRequest2.default(url,_voMetricsHTTPRequest.HTTPRequest.MPD_TYPE);httpLoader.load({request:request,success:function success(data,textStatus,responseURL){if(xlinkController){var actualUrl=void 0,baseUri=void 0,manifest=void 0;if(responseURL&&responseURL!==url?(baseUri=urlUtils.parseBaseUrl(responseURL),actualUrl=responseURL):(urlUtils.isRelative(url)&&(url=urlUtils.resolve(url,window.location.href)),baseUri=urlUtils.parseBaseUrl(url)),null===parser&&(parser=function createParser(data){var parser=null;return data.indexOf("SmoothStreamingMedia")>-1?(mssHandler&&(parser=mssHandler.createMssParser(),mssHandler.registerEvents()),parser):data.indexOf("MPD")>-1?(0,_dashParserDashParser2.default)(context).create():parser}(data)),null!==parser){xlinkController.setMatchers(parser.getMatchers()),xlinkController.setIron(parser.getIron());try{manifest=parser.parse(data)}catch(e){return void eventBus.trigger(_coreEventsEvents2.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new _voDashJSError2.default(_coreErrorsErrors2.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,_coreErrorsErrors2.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+""+url)})}manifest?(manifest.url=actualUrl||url,manifest.originalUrl||(manifest.originalUrl=manifest.url),manifest.hasOwnProperty(_constantsConstants2.default.LOCATION)&&(baseUri=urlUtils.parseBaseUrl(manifest.Location_asArray[0]),logger.debug("BaseURI set by Location to: "+baseUri)),manifest.baseUri=baseUri,manifest.loadedTime=new Date,xlinkController.resolveManifestOnLoad(manifest)):eventBus.trigger(_coreEventsEvents2.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new _voDashJSError2.default(_coreErrorsErrors2.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,_coreErrorsErrors2.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+""+url)})}else eventBus.trigger(_coreEventsEvents2.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new _voDashJSError2.default(_coreErrorsErrors2.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,_coreErrorsErrors2.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+""+url)})}},error:function error(request,statusText,errorText){eventBus.trigger(_coreEventsEvents2.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new _voDashJSError2.default(_coreErrorsErrors2.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,_coreErrorsErrors2.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+(url+", ")+errorText)})}})},reset:function reset(){eventBus.off(_coreEventsEvents2.default.XLINK_READY,onXlinkReady,instance),xlinkController&&(xlinkController.reset(),xlinkController=null),httpLoader&&(httpLoader.abort(),httpLoader=null),mssHandler&&mssHandler.reset()}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),eventBus.on(_coreEventsEvents2.default.XLINK_READY,onXlinkReady,instance),httpLoader=(0,_netHTTPLoader2.default)(context).create({errHandler:errHandler,metricsModel:config.metricsModel,mediaPlayerModel:config.mediaPlayerModel,requestModifier:config.requestModifier}),xlinkController=(0,_controllersXlinkController2.default)(context).create({errHandler:errHandler,metricsModel:config.metricsModel,mediaPlayerModel:config.mediaPlayerModel,requestModifier:config.requestModifier}),parser=null}(),instance}ManifestLoader.__dashjs_factory_name="ManifestLoader";var factory=_coreFactoryMaker2.default.getClassFactory(ManifestLoader);exports.default=factory,module.exports=exports.default},1533:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _XlinkLoader2=_interopRequireDefault(__webpack_require__(1534)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_externalsXml2json2=_interopRequireDefault(__webpack_require__(1443)),_utilsURLUtils2=_interopRequireDefault(__webpack_require__(1376)),_dashConstantsDashConstants2=_interopRequireDefault(__webpack_require__(1374));function XlinkController(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),urlUtils=(0,_utilsURLUtils2.default)(context).getInstance(),instance=void 0,matchers=void 0,iron=void 0,manifest=void 0,converter=void 0,xlinkLoader=void 0;function resolve(elements,type,resolveType){var resolveObject={},element=void 0,url=void 0;resolveObject.elements=elements,resolveObject.type=type,resolveObject.resolveType=resolveType,0===resolveObject.elements.length&&onXlinkAllElementsLoaded(resolveObject);for(var i=0;i<resolveObject.elements.length;i++)element=resolveObject.elements[i],url=urlUtils.isHTTPURL(element.url)?element.url:element.originalContent.BaseURL+element.url,xlinkLoader.load(url,element,resolveObject)}function onXlinkElementLoaded(event){var resolveObject,element=void 0,mergedContent="";if(element=event.element,resolveObject=event.resolveObject,element.resolvedContent){var index=0;0===element.resolvedContent.indexOf("<?xml")&&(index=element.resolvedContent.indexOf("?>")+2),mergedContent=element.resolvedContent.substr(0,index)+"<response>"+element.resolvedContent.substr(index)+"</response>",element.resolvedContent=converter.xml_str2json(mergedContent)}(function isResolvingFinished(elementsToResolve){var i=void 0;for(i=0;i<elementsToResolve.elements.length;i++)if(!1===elementsToResolve.elements[i].resolved)return!1;return!0})(resolveObject)&&onXlinkAllElementsLoaded(resolveObject)}function onXlinkAllElementsLoaded(resolveObject){var elements=[],i=void 0,obj=void 0;if(function mergeElementsBack(resolveObject){var resolvedElements=[],element=void 0,type=void 0,obj=void 0,i=void 0,j=void 0,k=void 0;for(i=resolveObject.elements.length-1;i>=0;i--){if(element=resolveObject.elements[i],type=element.type+"_asArray",element.resolvedContent){if(element.resolvedContent)for(j=0;j<element.resolvedContent[type].length;j++)obj=element.resolvedContent[type][j],resolvedElements.push(obj)}else delete element.originalContent["xlink:actuate"],delete element.originalContent["xlink:href"],resolvedElements.push(element.originalContent);for(element.parentElement[type].splice(element.index,1),k=0;k<resolvedElements.length;k++)element.parentElement[type].splice(element.index+k,0,resolvedElements[k]);resolvedElements=[]}resolveObject.elements.length>0&&iron.run(manifest)}(resolveObject),"onActuate"===resolveObject.resolveType&&eventBus.trigger(_coreEventsEvents2.default.XLINK_READY,{manifest:manifest}),"onLoad"===resolveObject.resolveType)switch(resolveObject.type){case _dashConstantsDashConstants2.default.PERIOD:for(i=0;i<manifest[_dashConstantsDashConstants2.default.PERIOD+"_asArray"].length;i++)(obj=manifest[_dashConstantsDashConstants2.default.PERIOD+"_asArray"][i]).hasOwnProperty(_dashConstantsDashConstants2.default.ADAPTATION_SET+"_asArray")&&(elements=elements.concat(getElementsToResolve(obj[_dashConstantsDashConstants2.default.ADAPTATION_SET+"_asArray"],obj,_dashConstantsDashConstants2.default.ADAPTATION_SET,"onLoad"))),obj.hasOwnProperty(_dashConstantsDashConstants2.default.EVENT_STREAM+"_asArray")&&(elements=elements.concat(getElementsToResolve(obj[_dashConstantsDashConstants2.default.EVENT_STREAM+"_asArray"],obj,_dashConstantsDashConstants2.default.EVENT_STREAM,"onLoad")));resolve(elements,_dashConstantsDashConstants2.default.ADAPTATION_SET,"onLoad");break;case _dashConstantsDashConstants2.default.ADAPTATION_SET:eventBus.trigger(_coreEventsEvents2.default.XLINK_READY,{manifest:manifest})}}function getElementsToResolve(elements,parentElement,type,resolveType){var toResolve=[],element=void 0,i=void 0,xlinkObject=void 0;for(i=elements.length-1;i>=0;i--)(element=elements[i]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===element["xlink:href"]&&elements.splice(i,1);for(i=0;i<elements.length;i++)(element=elements[i]).hasOwnProperty("xlink:href")&&element.hasOwnProperty("xlink:actuate")&&element["xlink:actuate"]===resolveType&&(xlinkObject=createXlinkObject(element["xlink:href"],parentElement,type,i,resolveType,element),toResolve.push(xlinkObject));return toResolve}function createXlinkObject(url,parentElement,type,index,resolveType,originalContent){return{url:url,parentElement:parentElement,type:type,index:index,resolveType:resolveType,originalContent:originalContent,resolvedContent:null,resolved:!1}}return instance={resolveManifestOnLoad:function resolveManifestOnLoad(mpd){converter=new _externalsXml2json2.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:matchers}),resolve(getElementsToResolve((manifest=mpd).Period_asArray,manifest,_dashConstantsDashConstants2.default.PERIOD,"onLoad"),_dashConstantsDashConstants2.default.PERIOD,"onLoad")},setMatchers:function setMatchers(value){value&&(matchers=value)},setIron:function setIron(value){value&&(iron=value)},reset:function reset(){eventBus.off(_coreEventsEvents2.default.XLINK_ELEMENT_LOADED,onXlinkElementLoaded,instance),xlinkLoader&&(xlinkLoader.reset(),xlinkLoader=null)}},function setup(){eventBus.on(_coreEventsEvents2.default.XLINK_ELEMENT_LOADED,onXlinkElementLoaded,instance),xlinkLoader=(0,_XlinkLoader2.default)(context).create({errHandler:config.errHandler,metricsModel:config.metricsModel,mediaPlayerModel:config.mediaPlayerModel,requestModifier:config.requestModifier})}(),instance}XlinkController.__dashjs_factory_name="XlinkController",exports.default=_coreFactoryMaker2.default.getClassFactory(XlinkController),module.exports=exports.default},1534:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_netHTTPLoader2=_interopRequireDefault(__webpack_require__(1388)),_voMetricsHTTPRequest=__webpack_require__(1373),_voTextRequest2=_interopRequireDefault(__webpack_require__(1442)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372));function XlinkLoader(config){config=config||{};var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),httpLoader=(0,_netHTTPLoader2.default)(context).create({errHandler:config.errHandler,metricsModel:config.metricsModel,mediaPlayerModel:config.mediaPlayerModel,requestModifier:config.requestModifier});return{load:function load(url,element,resolveObject){var report=function report(content,resolveToZero){element.resolved=!0,element.resolvedContent=content||null,eventBus.trigger(_coreEventsEvents2.default.XLINK_ELEMENT_LOADED,{element:element,resolveObject:resolveObject,error:content||resolveToZero?null:new _voDashJSError2.default(_coreErrorsErrors2.default.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,_coreErrorsErrors2.default.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+url)})};if("urn:mpeg:dash:resolve-to-zero:2013"===url)report(null,!0);else{var request=new _voTextRequest2.default(url,_voMetricsHTTPRequest.HTTPRequest.XLINK_EXPANSION_TYPE);httpLoader.load({request:request,success:function success(data){report(data)},error:function error(){report(null)}})}},reset:function reset(){httpLoader&&(httpLoader.abort(),httpLoader=null)}}}XlinkLoader.__dashjs_factory_name="XlinkLoader",exports.default=_coreFactoryMaker2.default.getClassFactory(XlinkLoader),module.exports=exports.default},1535:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_objectiron2=_interopRequireDefault(__webpack_require__(1536)),_externalsXml2json2=_interopRequireDefault(__webpack_require__(1443)),_matchersStringMatcher2=_interopRequireDefault(__webpack_require__(1537)),_matchersDurationMatcher2=_interopRequireDefault(__webpack_require__(1538)),_matchersDateTimeMatcher2=_interopRequireDefault(__webpack_require__(1539)),_matchersNumericMatcher2=_interopRequireDefault(__webpack_require__(1540)),_mapsRepresentationBaseValuesMap2=_interopRequireDefault(__webpack_require__(1541)),_mapsSegmentValuesMap2=_interopRequireDefault(__webpack_require__(1543));function DashParser(){var context=this.context,instance=void 0,logger=void 0,matchers=void 0,converter=void 0,objectIron=void 0;return instance={parse:function parse(data){var manifest,startTime=window.performance.now();if(!(manifest=converter.xml_str2json(data)))throw new Error("parsing the manifest failed");var jsonTime=window.performance.now();objectIron.run(manifest);var ironedTime=window.performance.now();return logger.info("Parsing complete: ( xml2json: "+(jsonTime-startTime).toPrecision(3)+"ms, objectiron: "+(ironedTime-jsonTime).toPrecision(3)+"ms, total: "+((ironedTime-startTime)/1e3).toPrecision(3)+"s)"),manifest},getMatchers:function getMatchers(){return matchers},getIron:function getIron(){return objectIron}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),matchers=[new _matchersDurationMatcher2.default,new _matchersDateTimeMatcher2.default,new _matchersNumericMatcher2.default,new _matchersStringMatcher2.default],converter=new _externalsXml2json2.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:matchers}),objectIron=(0,_objectiron2.default)(context).create({adaptationset:new _mapsRepresentationBaseValuesMap2.default,period:new _mapsSegmentValuesMap2.default})}(),instance}DashParser.__dashjs_factory_name="DashParser",exports.default=_coreFactoryMaker2.default.getClassFactory(DashParser),module.exports=exports.default},1536:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function ObjectIron(mappers){function mergeValues(parentItem,childItem){for(var _name in parentItem)childItem.hasOwnProperty(_name)||(childItem[_name]=parentItem[_name])}function mapProperties(properties,parent,child){for(var i=0,len=properties.length;i<len;++i){var property=properties[i];if(parent[property.name])if(child[property.name]){if(property.merge){var parentValue=parent[property.name],childValue=child[property.name];"object"==typeof parentValue&&"object"==typeof childValue?mergeValues(parentValue,childValue):child[property.name]=parentValue+childValue}}else child[property.name]=parent[property.name]}}function mapItem(item,node){for(var i=0,len=item.children.length;i<len;++i){var childItem=item.children[i],array=node[childItem.name+"_asArray"];if(array)for(var v=0,len2=array.length;v<len2;++v){var childNode=array[v];mapProperties(item.properties,node,childNode),mapItem(childItem,childNode)}}}return{run:function run(source){if(null===source||"object"!=typeof source)return source;if("period"in mappers)for(var periodMapper=mappers.period,periods=source.Period_asArray,i=0,len=periods.length;i<len;++i){var period=periods[i];if(mapItem(periodMapper,period),"adaptationset"in mappers){var adaptationSets=period.AdaptationSet_asArray;if(adaptationSets)for(var adaptationSetMapper=mappers.adaptationset,_i=0,_len=adaptationSets.length;_i<_len;++_i)mapItem(adaptationSetMapper,adaptationSets[_i])}}return source}}}ObjectIron.__dashjs_factory_name="ObjectIron";var factory=_coreFactoryMaker2.default.getClassFactory(ObjectIron);exports.default=factory,module.exports=exports.default},1537:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _BaseMatcher3=_interopRequireDefault(__webpack_require__(1398)),_constantsDashConstants2=_interopRequireDefault(__webpack_require__(1374)),StringMatcher=function(_BaseMatcher){function StringMatcher(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,StringMatcher),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(StringMatcher.prototype),"constructor",this).call(this,(function(attr,nodeName){var _stringAttrsInElements,stringAttrsInElements=(_defineProperty(_stringAttrsInElements={},_constantsDashConstants2.default.MPD,[_constantsDashConstants2.default.ID,_constantsDashConstants2.default.PROFILES]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.PERIOD,[_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.BASE_URL,[_constantsDashConstants2.default.SERVICE_LOCATION,_constantsDashConstants2.default.BYTE_RANGE]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.SEGMENT_BASE,[_constantsDashConstants2.default.INDEX_RANGE]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.INITIALIZATION,[_constantsDashConstants2.default.RANGE]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.REPRESENTATION_INDEX,[_constantsDashConstants2.default.RANGE]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.SEGMENT_LIST,[_constantsDashConstants2.default.INDEX_RANGE]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.BITSTREAM_SWITCHING,[_constantsDashConstants2.default.RANGE]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.SEGMENT_URL,[_constantsDashConstants2.default.MEDIA_RANGE,_constantsDashConstants2.default.INDEX_RANGE]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.SEGMENT_TEMPLATE,[_constantsDashConstants2.default.INDEX_RANGE,_constantsDashConstants2.default.MEDIA,_constantsDashConstants2.default.INDEX,_constantsDashConstants2.default.INITIALIZATION_MINUS,_constantsDashConstants2.default.BITSTREAM_SWITCHING_MINUS]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.ASSET_IDENTIFIER,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.EVENT_STREAM,[_constantsDashConstants2.default.VALUE]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.ADAPTATION_SET,[_constantsDashConstants2.default.PROFILES,_constantsDashConstants2.default.MIME_TYPE,_constantsDashConstants2.default.SEGMENT_PROFILES,_constantsDashConstants2.default.CODECS,_constantsDashConstants2.default.CONTENT_TYPE]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.FRAME_PACKING,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.AUDIO_CHANNEL_CONFIGURATION,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.CONTENT_PROTECTION,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.ESSENTIAL_PROPERTY,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.SUPPLEMENTAL_PROPERTY,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.INBAND_EVENT_STREAM,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.ACCESSIBILITY,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.ROLE,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.RATING,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.VIEWPOINT,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.CONTENT_COMPONENT,[_constantsDashConstants2.default.CONTENT_TYPE]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.REPRESENTATION,[_constantsDashConstants2.default.ID,_constantsDashConstants2.default.DEPENDENCY_ID,_constantsDashConstants2.default.MEDIA_STREAM_STRUCTURE_ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.SUBSET,[_constantsDashConstants2.default.ID]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.METRICS,[_constantsDashConstants2.default.METRICS_MINUS]),_defineProperty(_stringAttrsInElements,_constantsDashConstants2.default.REPORTING,[_constantsDashConstants2.default.VALUE,_constantsDashConstants2.default.ID]),_stringAttrsInElements);if(stringAttrsInElements.hasOwnProperty(nodeName)){var attrNames=stringAttrsInElements[nodeName];return void 0!==attrNames&&attrNames.indexOf(attr.name)>=0}return!1}),(function(str){return String(str)}))}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(StringMatcher,_BaseMatcher),StringMatcher}(_BaseMatcher3.default);exports.default=StringMatcher,module.exports=exports.default},1538:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _BaseMatcher3=_interopRequireDefault(__webpack_require__(1398)),_streamingConstantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_constantsDashConstants2=_interopRequireDefault(__webpack_require__(1374)),durationRegex=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,DurationMatcher=function(_BaseMatcher){function DurationMatcher(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DurationMatcher),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(DurationMatcher.prototype),"constructor",this).call(this,(function(attr){for(var attributeList=[_constantsDashConstants2.default.MIN_BUFFER_TIME,_constantsDashConstants2.default.MEDIA_PRESENTATION_DURATION,_constantsDashConstants2.default.MINIMUM_UPDATE_PERIOD,_constantsDashConstants2.default.TIMESHIFT_BUFFER_DEPTH,_constantsDashConstants2.default.MAX_SEGMENT_DURATION,_constantsDashConstants2.default.MAX_SUBSEGMENT_DURATION,_streamingConstantsConstants2.default.SUGGESTED_PRESENTATION_DELAY,_constantsDashConstants2.default.START,_streamingConstantsConstants2.default.START_TIME,_constantsDashConstants2.default.DURATION],len=attributeList.length,i=0;i<len;i++)if(attr.nodeName===attributeList[i])return durationRegex.test(attr.value);return!1}),(function(str){var match=durationRegex.exec(str),result=31536e3*parseFloat(match[2]||0)+2592e3*parseFloat(match[4]||0)+86400*parseFloat(match[6]||0)+3600*parseFloat(match[8]||0)+60*parseFloat(match[10]||0)+parseFloat(match[12]||0);return void 0!==match[1]&&(result=-result),result}))}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(DurationMatcher,_BaseMatcher),DurationMatcher}(_BaseMatcher3.default);exports.default=DurationMatcher,module.exports=exports.default},1539:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _BaseMatcher3=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1398)),datetimeRegex=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,DateTimeMatcher=function(_BaseMatcher){function DateTimeMatcher(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DateTimeMatcher),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(DateTimeMatcher.prototype),"constructor",this).call(this,(function(attr){return datetimeRegex.test(attr.value)}),(function(str){var match=datetimeRegex.exec(str),utcDate=void 0;if(utcDate=Date.UTC(parseInt(match[1],10),parseInt(match[2],10)-1,parseInt(match[3],10),parseInt(match[4],10),parseInt(match[5],10),match[6]&&parseInt(match[6],10)||0,match[7]&&1e3*parseFloat(match[7])||0),match[9]&&match[10]){var timezoneOffset=60*parseInt(match[9],10)+parseInt(match[10],10);utcDate+=("+"===match[8]?-1:1)*timezoneOffset*60*1e3}return new Date(utcDate)}))}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(DateTimeMatcher,_BaseMatcher),DateTimeMatcher}(_BaseMatcher3.default);exports.default=DateTimeMatcher,module.exports=exports.default},1540:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _BaseMatcher3=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1398)),numericRegex=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,NumericMatcher=function(_BaseMatcher){function NumericMatcher(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NumericMatcher),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(NumericMatcher.prototype),"constructor",this).call(this,(function(attr){return numericRegex.test(attr.value)}),(function(str){return parseFloat(str)}))}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(NumericMatcher,_BaseMatcher),NumericMatcher}(_BaseMatcher3.default);exports.default=NumericMatcher,module.exports=exports.default},1541:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _MapNode3=_interopRequireDefault(__webpack_require__(1444)),_constantsDashConstants2=_interopRequireDefault(__webpack_require__(1374)),RepresentationBaseValuesMap=function(_MapNode){function RepresentationBaseValuesMap(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RepresentationBaseValuesMap);var commonProperties=[_constantsDashConstants2.default.PROFILES,_constantsDashConstants2.default.WIDTH,_constantsDashConstants2.default.HEIGHT,_constantsDashConstants2.default.SAR,_constantsDashConstants2.default.FRAMERATE,_constantsDashConstants2.default.AUDIO_SAMPLING_RATE,_constantsDashConstants2.default.MIME_TYPE,_constantsDashConstants2.default.SEGMENT_PROFILES,_constantsDashConstants2.default.CODECS,_constantsDashConstants2.default.MAXIMUM_SAP_PERIOD,_constantsDashConstants2.default.START_WITH_SAP,_constantsDashConstants2.default.MAX_PLAYOUT_RATE,_constantsDashConstants2.default.CODING_DEPENDENCY,_constantsDashConstants2.default.SCAN_TYPE,_constantsDashConstants2.default.FRAME_PACKING,_constantsDashConstants2.default.AUDIO_CHANNEL_CONFIGURATION,_constantsDashConstants2.default.CONTENT_PROTECTION,_constantsDashConstants2.default.ESSENTIAL_PROPERTY,_constantsDashConstants2.default.SUPPLEMENTAL_PROPERTY,_constantsDashConstants2.default.INBAND_EVENT_STREAM];(function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}})(Object.getPrototypeOf(RepresentationBaseValuesMap.prototype),"constructor",this).call(this,_constantsDashConstants2.default.ADAPTATION_SET,commonProperties,[new _MapNode3.default(_constantsDashConstants2.default.REPRESENTATION,commonProperties,[new _MapNode3.default(_constantsDashConstants2.default.SUB_REPRESENTATION,commonProperties)])])}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(RepresentationBaseValuesMap,_MapNode),RepresentationBaseValuesMap}(_MapNode3.default);exports.default=RepresentationBaseValuesMap,module.exports=exports.default},1542:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var CommonProperty=function(){function CommonProperty(name){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CommonProperty);this._name=name,this._merge=function getDefaultMergeForName(n){return n&&n.length&&n.charAt(0)===n.charAt(0).toUpperCase()}(name)}return _createClass(CommonProperty,[{key:"name",get:function get(){return this._name}},{key:"merge",get:function get(){return this._merge}}]),CommonProperty}();exports.default=CommonProperty,module.exports=exports.default},1543:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _MapNode3=_interopRequireDefault(__webpack_require__(1444)),_constantsDashConstants2=_interopRequireDefault(__webpack_require__(1374)),SegmentValuesMap=function(_MapNode){function SegmentValuesMap(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SegmentValuesMap);var commonProperties=[_constantsDashConstants2.default.SEGMENT_BASE,_constantsDashConstants2.default.SEGMENT_TEMPLATE,_constantsDashConstants2.default.SEGMENT_LIST];(function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}})(Object.getPrototypeOf(SegmentValuesMap.prototype),"constructor",this).call(this,_constantsDashConstants2.default.PERIOD,commonProperties,[new _MapNode3.default(_constantsDashConstants2.default.ADAPTATION_SET,commonProperties,[new _MapNode3.default(_constantsDashConstants2.default.REPRESENTATION,commonProperties)])])}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(SegmentValuesMap,_MapNode),SegmentValuesMap}(_MapNode3.default);exports.default=SegmentValuesMap,module.exports=exports.default},1544:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366));function ErrorHandler(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance();return{capabilityError:function capabilityError(err){eventBus.trigger(_coreEventsEvents2.default.ERROR,{error:"capability",event:err})},downloadError:function downloadError(id,url,request){eventBus.trigger(_coreEventsEvents2.default.ERROR,{error:"download",event:{id:id,url:url,request:request}})},manifestError:function manifestError(message,id,manifest,err){eventBus.trigger(_coreEventsEvents2.default.ERROR,{error:"manifestError",event:{message:message,id:id,manifest:manifest,event:err}})},timedTextError:function timedTextError(message,id,ccContent){eventBus.trigger(_coreEventsEvents2.default.ERROR,{error:"cc",event:{message:message,id:id,cc:ccContent}})},mediaSourceError:function mediaSourceError(err){eventBus.trigger(_coreEventsEvents2.default.ERROR,{error:"mediasource",event:err})},mediaKeySessionError:function mediaKeySessionError(err){eventBus.trigger(_coreEventsEvents2.default.ERROR,{error:"key_session",event:err})},mediaKeyMessageError:function mediaKeyMessageError(err){eventBus.trigger(_coreEventsEvents2.default.ERROR,{error:"key_message",event:err})},error:function error(err){eventBus.trigger(_coreEventsEvents2.default.ERROR,{error:err})}}}ErrorHandler.__dashjs_factory_name="ErrorHandler",exports.default=_coreFactoryMaker2.default.getSingletonFactory(ErrorHandler),module.exports=exports.default},1545:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1366));function Capabilities(){var instance,encryptedMediaSupported=void 0;return instance={supportsMediaSource:function supportsMediaSource(){var hasWebKit="WebKitMediaSource"in window,hasMediaSource="MediaSource"in window;return hasWebKit||hasMediaSource},supportsEncryptedMedia:function supportsEncryptedMedia(){return encryptedMediaSupported},supportsCodec:function supportsCodec(codec){return!!("MediaSource"in window&&MediaSource.isTypeSupported(codec))||!!("WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(codec))},setEncryptedMediaSupported:function setEncryptedMediaSupported(value){encryptedMediaSupported=value}},function setup(){encryptedMediaSupported=!1}(),instance}Capabilities.__dashjs_factory_name="Capabilities",exports.default=_coreFactoryMaker2.default.getSingletonFactory(Capabilities),module.exports=exports.default},1546:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _voURIFragmentData2=_interopRequireDefault(__webpack_require__(1547)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366));function URIFragmentModel(){var URIFragmentDataVO=void 0;return{initialize:function initialize(uri){if(URIFragmentDataVO=new _voURIFragmentData2.default,!uri)return null;var hashIndex=uri.indexOf("#");if(-1!==hashIndex)for(var fragments=uri.substr(hashIndex+1).split("&"),i=0,len=fragments.length;i<len;++i){var fragment=fragments[i],equalIndex=fragment.indexOf("=");if(-1!==equalIndex){var key=fragment.substring(0,equalIndex);URIFragmentDataVO.hasOwnProperty(key)&&(URIFragmentDataVO[key]=fragment.substr(equalIndex+1))}}},getURIFragmentData:function getURIFragmentData(){return URIFragmentDataVO}}}URIFragmentModel.__dashjs_factory_name="URIFragmentModel",exports.default=_coreFactoryMaker2.default.getSingletonFactory(URIFragmentModel),module.exports=exports.default},1547:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function URIFragmentData(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,URIFragmentData),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null},module.exports=exports.default},1548:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366));function ManifestModel(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),manifest=void 0;return{getValue:function getValue(){return manifest},setValue:function setValue(value){manifest=value,value&&eventBus.trigger(_coreEventsEvents2.default.MANIFEST_LOADED,{data:value})}}}ManifestModel.__dashjs_factory_name="ManifestModel",exports.default=_coreFactoryMaker2.default.getSingletonFactory(ManifestModel),module.exports=exports.default},1549:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(exports,"__esModule",{value:!0});var _dashVoUTCTiming2=_interopRequireDefault(__webpack_require__(1445)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_voMetricsHTTPRequest=__webpack_require__(1373),_constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_rulesAbrABRRulesCollection2=_interopRequireDefault(__webpack_require__(1433)),_utilsSupervisorTools=__webpack_require__(1383);function MediaPlayerModel(){var instance,useManifestDateHeaderTimeSource=void 0,useSuggestedPresentationDelay=void 0,UTCTimingSources=void 0,liveDelayFragmentCount=void 0,liveDelay=void 0,scheduleWhilePaused=void 0,bufferToKeep=void 0,bufferAheadToKeep=void 0,bufferPruningInterval=void 0,lastBitrateCachingInfo=void 0,lastMediaSettingsCachingInfo=void 0,stableBufferTime=void 0,bufferTimeAtTopQuality=void 0,bufferTimeAtTopQualityLongForm=void 0,longFormContentDurationThreshold=void 0,segmentOverlapToleranceTime=void 0,bandwidthSafetyFactor=void 0,abandonLoadTimeout=void 0,retryAttempts=void 0,retryIntervals=void 0,wallclockTimeUpdateInterval=void 0,ABRStrategy=void 0,useDefaultABRRules=void 0,xhrWithCredentials=void 0,fastSwitchEnabled=void 0,customABRRule=void 0,movingAverageMethod=void 0,cacheLoadThresholds=void 0,jumpGaps=void 0,smallGapLimit=void 0,lowLatencyEnabled=void 0,manifestUpdateRetryInterval=void 0,keepProtectionMediaKeys=void 0,liveCatchUpMinDrift=void 0,liveCatchUpMaxDrift=void 0,liveCatchUpPlaybackRate=void 0,DEFAULT_UTC_TIMING_SOURCE={scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"http://time.akamai.com/?iso&ms"};function findABRCustomRuleIndex(rulename){var i=void 0;for(i=0;i<customABRRule.length;i++)if(customABRRule[i].rulename===rulename)return i;return-1}function getLiveDelay(){return lowLatencyEnabled?liveDelay||3:liveDelay}function addUTCTimingSource(schemeIdUri,value){removeUTCTimingSource(schemeIdUri,value);var vo=new _dashVoUTCTiming2.default;vo.schemeIdUri=schemeIdUri,vo.value=value,UTCTimingSources.push(vo)}function removeUTCTimingSource(schemeIdUri,value){(0,_utilsSupervisorTools.checkParameterType)(schemeIdUri,"string"),(0,_utilsSupervisorTools.checkParameterType)(value,"string"),UTCTimingSources.forEach((function(obj,idx){obj.schemeIdUri===schemeIdUri&&obj.value===value&&UTCTimingSources.splice(idx,1)}))}function getLowLatencyEnabled(){return lowLatencyEnabled}return instance={setABRStrategy:function setABRStrategy(value){if(value!==_constantsConstants2.default.ABR_STRATEGY_DYNAMIC&&value!==_constantsConstants2.default.ABR_STRATEGY_BOLA&&value!==_constantsConstants2.default.ABR_STRATEGY_THROUGHPUT)throw _constantsConstants2.default.BAD_ARGUMENT_ERROR;ABRStrategy=value},getABRStrategy:function getABRStrategy(){return ABRStrategy},setUseDefaultABRRules:function setUseDefaultABRRules(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),useDefaultABRRules=value},getUseDefaultABRRules:function getUseDefaultABRRules(){return useDefaultABRRules},getABRCustomRules:function getABRCustomRules(){return customABRRule},addABRCustomRule:function addABRCustomRule(type,rulename,rule){if("string"!=typeof type||type!==_rulesAbrABRRulesCollection2.default.ABANDON_FRAGMENT_RULES&&type!==_rulesAbrABRRulesCollection2.default.QUALITY_SWITCH_RULES||"string"!=typeof rulename)throw _constantsConstants2.default.BAD_ARGUMENT_ERROR;var index=findABRCustomRuleIndex(rulename);-1===index?customABRRule.push({type:type,rulename:rulename,rule:rule}):(customABRRule[index].type=type,customABRRule[index].rule=rule)},removeABRCustomRule:function removeABRCustomRule(rulename){if(rulename){var index=findABRCustomRuleIndex(rulename);-1!==index&&customABRRule.splice(index,1)}else customABRRule=[]},setBandwidthSafetyFactor:function setBandwidthSafetyFactor(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),bandwidthSafetyFactor=value},getBandwidthSafetyFactor:function getBandwidthSafetyFactor(){return bandwidthSafetyFactor},setAbandonLoadTimeout:function setAbandonLoadTimeout(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),abandonLoadTimeout=value},getAbandonLoadTimeout:function getAbandonLoadTimeout(){return abandonLoadTimeout},setLastBitrateCachingInfo:function setLastBitrateCachingInfo(enable,ttl){if("boolean"!=typeof enable||void 0!==ttl&&("number"!=typeof ttl||isNaN(ttl)))throw _constantsConstants2.default.BAD_ARGUMENT_ERROR;lastBitrateCachingInfo.enabled=enable,void 0!==ttl&&(lastBitrateCachingInfo.ttl=ttl)},getLastBitrateCachingInfo:function getLastBitrateCachingInfo(){return lastBitrateCachingInfo},setLastMediaSettingsCachingInfo:function setLastMediaSettingsCachingInfo(enable,ttl){if("boolean"!=typeof enable||void 0!==ttl&&("number"!=typeof ttl||isNaN(ttl)))throw _constantsConstants2.default.BAD_ARGUMENT_ERROR;lastMediaSettingsCachingInfo.enabled=enable,void 0!==ttl&&(lastMediaSettingsCachingInfo.ttl=ttl)},getLastMediaSettingsCachingInfo:function getLastMediaSettingsCachingInfo(){return lastMediaSettingsCachingInfo},setStableBufferTime:function setStableBufferTime(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),stableBufferTime=value},getStableBufferTime:function getStableBufferTime(){return getLowLatencyEnabled()?.6*getLiveDelay():isNaN(stableBufferTime)?fastSwitchEnabled?20:12:stableBufferTime},setBufferTimeAtTopQuality:function setBufferTimeAtTopQuality(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),bufferTimeAtTopQuality=value},getBufferTimeAtTopQuality:function getBufferTimeAtTopQuality(){return bufferTimeAtTopQuality},setBufferTimeAtTopQualityLongForm:function setBufferTimeAtTopQualityLongForm(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),bufferTimeAtTopQualityLongForm=value},getBufferTimeAtTopQualityLongForm:function getBufferTimeAtTopQualityLongForm(){return bufferTimeAtTopQualityLongForm},setLongFormContentDurationThreshold:function setLongFormContentDurationThreshold(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),longFormContentDurationThreshold=value},getLongFormContentDurationThreshold:function getLongFormContentDurationThreshold(){return longFormContentDurationThreshold},setSegmentOverlapToleranceTime:function setSegmentOverlapToleranceTime(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),segmentOverlapToleranceTime=value},getSegmentOverlapToleranceTime:function getSegmentOverlapToleranceTime(){return segmentOverlapToleranceTime},getCacheLoadThresholdForType:function getCacheLoadThresholdForType(type){return cacheLoadThresholds[type]},setCacheLoadThresholdForType:function setCacheLoadThresholdForType(type,value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),(0,_utilsSupervisorTools.checkIsVideoOrAudioType)(type),cacheLoadThresholds[type]=value},setBufferToKeep:function setBufferToKeep(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),bufferToKeep=value},getBufferToKeep:function getBufferToKeep(){return bufferToKeep},setBufferAheadToKeep:function setBufferAheadToKeep(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),bufferAheadToKeep=value},getBufferAheadToKeep:function getBufferAheadToKeep(){return bufferAheadToKeep},setBufferPruningInterval:function setBufferPruningInterval(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),bufferPruningInterval=value},getBufferPruningInterval:function getBufferPruningInterval(){return bufferPruningInterval},setRetryAttemptsForType:function setRetryAttemptsForType(type,value){if("number"!=typeof value||"string"!=typeof type||type!==_voMetricsHTTPRequest.HTTPRequest.MPD_TYPE&&type!==_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE)throw _constantsConstants2.default.BAD_ARGUMENT_ERROR;retryAttempts[type]=value},getRetryAttemptsForType:function getRetryAttemptsForType(type){return getLowLatencyEnabled()?5*retryAttempts[type]:retryAttempts[type]},setRetryIntervalForType:function setRetryIntervalForType(type,value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),retryIntervals[type]=value},getRetryIntervalForType:function getRetryIntervalForType(type){return getLowLatencyEnabled()?retryIntervals[type]/10:retryIntervals[type]},setWallclockTimeUpdateInterval:function setWallclockTimeUpdateInterval(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),wallclockTimeUpdateInterval=value},getWallclockTimeUpdateInterval:function getWallclockTimeUpdateInterval(){return wallclockTimeUpdateInterval},setScheduleWhilePaused:function setScheduleWhilePaused(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),scheduleWhilePaused=value},getScheduleWhilePaused:function getScheduleWhilePaused(){return scheduleWhilePaused},getUseSuggestedPresentationDelay:function getUseSuggestedPresentationDelay(){return useSuggestedPresentationDelay},setUseSuggestedPresentationDelay:function setUseSuggestedPresentationDelay(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),useSuggestedPresentationDelay=value},setLiveDelayFragmentCount:function setLiveDelayFragmentCount(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),liveDelayFragmentCount=value},getLiveDelayFragmentCount:function getLiveDelayFragmentCount(){return liveDelayFragmentCount},getLiveDelay:getLiveDelay,setLiveDelay:function setLiveDelay(value){void 0!==value&&(0,_utilsSupervisorTools.checkParameterType)(value,"number"),liveDelay=value},setUseManifestDateHeaderTimeSource:function setUseManifestDateHeaderTimeSource(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),useManifestDateHeaderTimeSource=value},getUseManifestDateHeaderTimeSource:function getUseManifestDateHeaderTimeSource(){return useManifestDateHeaderTimeSource},addUTCTimingSource:addUTCTimingSource,removeUTCTimingSource:removeUTCTimingSource,getUTCTimingSources:function getUTCTimingSources(){return UTCTimingSources},clearDefaultUTCTimingSources:function clearDefaultUTCTimingSources(){UTCTimingSources=[]},restoreDefaultUTCTimingSources:function restoreDefaultUTCTimingSources(){addUTCTimingSource(DEFAULT_UTC_TIMING_SOURCE.scheme,DEFAULT_UTC_TIMING_SOURCE.value)},setXHRWithCredentialsForType:function setXHRWithCredentialsForType(type,value){type?xhrWithCredentials[type]=!!value:Object.keys(xhrWithCredentials).forEach((function(key){setXHRWithCredentialsForType(key,value)}))},getXHRWithCredentialsForType:function getXHRWithCredentialsForType(type){var useCreds=xhrWithCredentials[type];return void 0===useCreds?xhrWithCredentials.default:useCreds},setFastSwitchEnabled:function setFastSwitchEnabled(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),fastSwitchEnabled=value},getFastSwitchEnabled:function getFastSwitchEnabled(){return fastSwitchEnabled},setMovingAverageMethod:function setMovingAverageMethod(value){if(value!==_constantsConstants2.default.MOVING_AVERAGE_SLIDING_WINDOW&&value!==_constantsConstants2.default.MOVING_AVERAGE_EWMA)throw _constantsConstants2.default.BAD_ARGUMENT_ERROR;movingAverageMethod=value},getMovingAverageMethod:function getMovingAverageMethod(){return movingAverageMethod},setJumpGaps:function setJumpGaps(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),jumpGaps=value},getJumpGaps:function getJumpGaps(){return jumpGaps},setSmallGapLimit:function setSmallGapLimit(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),smallGapLimit=value},getSmallGapLimit:function getSmallGapLimit(){return smallGapLimit},getLowLatencyEnabled:getLowLatencyEnabled,setLowLatencyEnabled:function setLowLatencyEnabled(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),lowLatencyEnabled=value},setCatchUpPlaybackRate:function setCatchUpPlaybackRate(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),(0,_utilsSupervisorTools.checkRange)(value,0,.5),liveCatchUpPlaybackRate=value},getCatchUpPlaybackRate:function getCatchUpPlaybackRate(){return liveCatchUpPlaybackRate},setLowLatencyMinDrift:function setLowLatencyMinDrift(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),liveCatchUpMinDrift=value},getLowLatencyMinDrift:function getLowLatencyMinDrift(){return liveCatchUpMinDrift},setLowLatencyMaxDriftBeforeSeeking:function setLowLatencyMaxDriftBeforeSeeking(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),liveCatchUpMaxDrift=value},getLowLatencyMaxDriftBeforeSeeking:function getLowLatencyMaxDriftBeforeSeeking(){return liveCatchUpMaxDrift},setManifestUpdateRetryInterval:function setManifestUpdateRetryInterval(value){(0,_utilsSupervisorTools.checkParameterType)(value,"number"),manifestUpdateRetryInterval=value},getManifestUpdateRetryInterval:function getManifestUpdateRetryInterval(){return manifestUpdateRetryInterval},setKeepProtectionMediaKeys:function setKeepProtectionMediaKeys(value){(0,_utilsSupervisorTools.checkParameterType)(value,"boolean"),keepProtectionMediaKeys=value},getKeepProtectionMediaKeys:function getKeepProtectionMediaKeys(){return keepProtectionMediaKeys},getDefaultUtcTimingSource:function getDefaultUtcTimingSource(){return DEFAULT_UTC_TIMING_SOURCE},reset:function reset(){}},function setup(){var _retryAttempts,_retryIntervals;UTCTimingSources=[],useSuggestedPresentationDelay=!1,useManifestDateHeaderTimeSource=!0,scheduleWhilePaused=!0,ABRStrategy=_constantsConstants2.default.ABR_STRATEGY_DYNAMIC,useDefaultABRRules=!0,fastSwitchEnabled=!1,lastBitrateCachingInfo={enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo={enabled:!0,ttl:36e4},liveDelayFragmentCount=4,liveDelay=void 0,bufferToKeep=20,bufferAheadToKeep=80,bufferPruningInterval=10,stableBufferTime=NaN,bufferTimeAtTopQuality=30,bufferTimeAtTopQualityLongForm=60,longFormContentDurationThreshold=600,segmentOverlapToleranceTime=.2,bandwidthSafetyFactor=.9,abandonLoadTimeout=1e4,wallclockTimeUpdateInterval=50,jumpGaps=!1,smallGapLimit=.8,manifestUpdateRetryInterval=100,xhrWithCredentials={default:!1},customABRRule=[],movingAverageMethod=_constantsConstants2.default.MOVING_AVERAGE_SLIDING_WINDOW,lowLatencyEnabled=!1,liveCatchUpMinDrift=.02,liveCatchUpMaxDrift=0,liveCatchUpPlaybackRate=.5,_defineProperty(_retryAttempts={},_voMetricsHTTPRequest.HTTPRequest.MPD_TYPE,3),_defineProperty(_retryAttempts,_voMetricsHTTPRequest.HTTPRequest.XLINK_EXPANSION_TYPE,1),_defineProperty(_retryAttempts,_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE,3),_defineProperty(_retryAttempts,_voMetricsHTTPRequest.HTTPRequest.INIT_SEGMENT_TYPE,3),_defineProperty(_retryAttempts,_voMetricsHTTPRequest.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),_defineProperty(_retryAttempts,_voMetricsHTTPRequest.HTTPRequest.INDEX_SEGMENT_TYPE,3),_defineProperty(_retryAttempts,_voMetricsHTTPRequest.HTTPRequest.OTHER_TYPE,3),retryAttempts=_retryAttempts,_defineProperty(_retryIntervals={},_voMetricsHTTPRequest.HTTPRequest.MPD_TYPE,500),_defineProperty(_retryIntervals,_voMetricsHTTPRequest.HTTPRequest.XLINK_EXPANSION_TYPE,500),_defineProperty(_retryIntervals,_voMetricsHTTPRequest.HTTPRequest.MEDIA_SEGMENT_TYPE,1e3),_defineProperty(_retryIntervals,_voMetricsHTTPRequest.HTTPRequest.INIT_SEGMENT_TYPE,1e3),_defineProperty(_retryIntervals,_voMetricsHTTPRequest.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),_defineProperty(_retryIntervals,_voMetricsHTTPRequest.HTTPRequest.INDEX_SEGMENT_TYPE,1e3),_defineProperty(_retryIntervals,_voMetricsHTTPRequest.HTTPRequest.OTHER_TYPE,1e3),retryIntervals=_retryIntervals,(cacheLoadThresholds={})[_constantsConstants2.default.VIDEO]=50,cacheLoadThresholds[_constantsConstants2.default.AUDIO]=5,keepProtectionMediaKeys=!1}(),instance}MediaPlayerModel.__dashjs_factory_name="MediaPlayerModel",exports.default=_coreFactoryMaker2.default.getSingletonFactory(MediaPlayerModel),module.exports=exports.default},1550:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_constantsMetricsConstants2=_interopRequireDefault(__webpack_require__(1382)),_voMetricsList2=_interopRequireDefault(__webpack_require__(1551)),_voMetricsHTTPRequest=__webpack_require__(1373),_voMetricsRepresentationSwitch2=_interopRequireDefault(__webpack_require__(1552)),_voMetricsBufferLevel2=_interopRequireDefault(__webpack_require__(1553)),_voMetricsBufferState2=_interopRequireDefault(__webpack_require__(1554)),_voMetricsDVRInfo2=_interopRequireDefault(__webpack_require__(1555)),_voMetricsDroppedFrames2=_interopRequireDefault(__webpack_require__(1556)),_voMetricsManifestUpdate=__webpack_require__(1557),_voMetricsSchedulingInfo2=_interopRequireDefault(__webpack_require__(1558)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_voMetricsRequestsQueue2=_interopRequireDefault(__webpack_require__(1559)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366));function MetricsModel(){var instance,context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),streamMetrics=void 0;function metricsChanged(){eventBus.trigger(_coreEventsEvents2.default.METRICS_CHANGED)}function metricChanged(mediaType){eventBus.trigger(_coreEventsEvents2.default.METRIC_CHANGED,{mediaType:mediaType}),metricsChanged()}function metricUpdated(mediaType,metricType,vo){eventBus.trigger(_coreEventsEvents2.default.METRIC_UPDATED,{mediaType:mediaType,metric:metricType,value:vo}),metricChanged(mediaType)}function metricAdded(mediaType,metricType,vo){eventBus.trigger(_coreEventsEvents2.default.METRIC_ADDED,{mediaType:mediaType,metric:metricType,value:vo}),metricChanged(mediaType)}function getMetricsFor(type){var metrics=void 0;return streamMetrics.hasOwnProperty(type)?metrics=streamMetrics[type]:(metrics=new _voMetricsList2.default,streamMetrics[type]=metrics),metrics}function pushMetrics(type,list,value){var metrics=getMetricsFor(type);metrics[list].push(value),metrics[list].length>1e3&&metrics[list].shift()}function pushAndNotify(mediaType,metricType,metricObject){pushMetrics(mediaType,metricType,metricObject),metricAdded(mediaType,metricType,metricObject)}return instance={clearCurrentMetricsForType:function clearCurrentMetricsForType(type){delete streamMetrics[type],metricChanged(type)},clearAllCurrentMetrics:function clearAllCurrentMetrics(){streamMetrics={},metricsChanged()},getReadOnlyMetricsFor:function getReadOnlyMetricsFor(type){return streamMetrics.hasOwnProperty(type)?streamMetrics[type]:null},getMetricsFor:getMetricsFor,addHttpRequest:function addHttpRequest(mediaType,tcpid,type,url,actualurl,serviceLocation,range,trequest,tresponse,tfinish,responsecode,mediaduration,responseHeaders,traces){var vo=new _voMetricsHTTPRequest.HTTPRequest;actualurl&&actualurl!==url&&(addHttpRequest(mediaType,null,type,url,null,null,range,trequest,null,null,null,mediaduration,null,null),vo.actualurl=actualurl),vo.tcpid=tcpid,vo.type=type,vo.url=url,vo.range=range,vo.trequest=trequest,vo.tresponse=tresponse,vo.responsecode=responsecode,vo._tfinish=tfinish,vo._stream=mediaType,vo._mediaduration=mediaduration,vo._responseHeaders=responseHeaders,vo._serviceLocation=serviceLocation,traces?traces.forEach((function(trace){!function appendHttpTrace(httpRequest,s,d,b){var vo=new _voMetricsHTTPRequest.HTTPRequestTrace;return vo.s=s,vo.d=d,vo.b=b,httpRequest.trace.push(vo),httpRequest.interval||(httpRequest.interval=0),httpRequest.interval+=d,vo}(vo,trace.s,trace.d,trace.b)})):(delete vo.interval,delete vo.trace),pushAndNotify(mediaType,_constantsMetricsConstants2.default.HTTP_REQUEST,vo)},addRepresentationSwitch:function addRepresentationSwitch(mediaType,t,mt,to,lto){var vo=new _voMetricsRepresentationSwitch2.default;vo.t=t,vo.mt=mt,vo.to=to,lto?vo.lto=lto:delete vo.lto,pushAndNotify(mediaType,_constantsMetricsConstants2.default.TRACK_SWITCH,vo)},addBufferLevel:function addBufferLevel(mediaType,t,level){var vo=new _voMetricsBufferLevel2.default;vo.t=t,vo.level=level,pushAndNotify(mediaType,_constantsMetricsConstants2.default.BUFFER_LEVEL,vo)},addBufferState:function addBufferState(mediaType,state,target){var vo=new _voMetricsBufferState2.default;vo.target=target,vo.state=state,pushAndNotify(mediaType,_constantsMetricsConstants2.default.BUFFER_STATE,vo)},addDVRInfo:function addDVRInfo(mediaType,currentTime,mpd,range){var vo=new _voMetricsDVRInfo2.default;vo.time=currentTime,vo.range=range,vo.manifestInfo=mpd,pushAndNotify(mediaType,_constantsMetricsConstants2.default.DVR_INFO,vo)},addDroppedFrames:function addDroppedFrames(mediaType,quality){var vo=new _voMetricsDroppedFrames2.default,list=getMetricsFor(mediaType).DroppedFrames;vo.time=quality.creationTime,vo.droppedFrames=quality.droppedVideoFrames,list.length>0&&list[list.length-1]==vo||pushAndNotify(mediaType,_constantsMetricsConstants2.default.DROPPED_FRAMES,vo)},addSchedulingInfo:function addSchedulingInfo(mediaType,t,type,startTime,availabilityStartTime,duration,quality,range,state){var vo=new _voMetricsSchedulingInfo2.default;vo.mediaType=mediaType,vo.t=t,vo.type=type,vo.startTime=startTime,vo.availabilityStartTime=availabilityStartTime,vo.duration=duration,vo.quality=quality,vo.range=range,vo.state=state,pushAndNotify(mediaType,_constantsMetricsConstants2.default.SCHEDULING_INFO,vo)},addRequestsQueue:function addRequestsQueue(mediaType,loadingRequests,executedRequests){var vo=new _voMetricsRequestsQueue2.default;vo.loadingRequests=loadingRequests,vo.executedRequests=executedRequests,getMetricsFor(mediaType).RequestsQueue=vo,metricAdded(mediaType,_constantsMetricsConstants2.default.REQUESTS_QUEUE,vo)},addManifestUpdate:function addManifestUpdate(mediaType,type,requestTime,fetchTime,availabilityStartTime,presentationStartTime,clientTimeOffset,currentTime,buffered,latency){var vo=new _voMetricsManifestUpdate.ManifestUpdate;vo.mediaType=mediaType,vo.type=type,vo.requestTime=requestTime,vo.fetchTime=fetchTime,vo.availabilityStartTime=availabilityStartTime,vo.presentationStartTime=presentationStartTime,vo.clientTimeOffset=clientTimeOffset,vo.currentTime=currentTime,vo.buffered=buffered,vo.latency=latency,pushMetrics(_constantsConstants2.default.STREAM,_constantsMetricsConstants2.default.MANIFEST_UPDATE,vo),metricAdded(mediaType,_constantsMetricsConstants2.default.MANIFEST_UPDATE,vo)},updateManifestUpdateInfo:function updateManifestUpdateInfo(manifestUpdate,updatedFields){if(manifestUpdate){for(var field in updatedFields)manifestUpdate[field]=updatedFields[field];metricUpdated(manifestUpdate.mediaType,_constantsMetricsConstants2.default.MANIFEST_UPDATE,manifestUpdate)}},addManifestUpdateStreamInfo:function addManifestUpdateStreamInfo(manifestUpdate,id,index,start,duration){if(manifestUpdate){var vo=new _voMetricsManifestUpdate.ManifestUpdateStreamInfo;vo.id=id,vo.index=index,vo.start=start,vo.duration=duration,manifestUpdate.streamInfo.push(vo),metricUpdated(manifestUpdate.mediaType,_constantsMetricsConstants2.default.MANIFEST_UPDATE_STREAM_INFO,manifestUpdate)}},addManifestUpdateRepresentationInfo:function addManifestUpdateRepresentationInfo(manifestUpdate,id,index,streamIndex,mediaType,presentationTimeOffset,startNumber,fragmentInfoType){if(manifestUpdate){var vo=new _voMetricsManifestUpdate.ManifestUpdateRepresentationInfo;vo.id=id,vo.index=index,vo.streamIndex=streamIndex,vo.mediaType=mediaType,vo.startNumber=startNumber,vo.fragmentInfoType=fragmentInfoType,vo.presentationTimeOffset=presentationTimeOffset,manifestUpdate.representationInfo.push(vo),metricUpdated(manifestUpdate.mediaType,_constantsMetricsConstants2.default.MANIFEST_UPDATE_TRACK_INFO,manifestUpdate)}},addPlayList:function addPlayList(vo){var type=_constantsConstants2.default.STREAM;vo.trace&&Array.isArray(vo.trace)?vo.trace.forEach((function(trace){trace.hasOwnProperty("subreplevel")&&!trace.subreplevel&&delete trace.subreplevel})):delete vo.trace,pushAndNotify(type,_constantsMetricsConstants2.default.PLAY_LIST,vo)},addDVBErrors:function addDVBErrors(vo){pushAndNotify(_constantsConstants2.default.STREAM,_constantsMetricsConstants2.default.DVB_ERRORS,vo)}},function setup(){streamMetrics={}}(),instance}MetricsModel.__dashjs_factory_name="MetricsModel",exports.default=_coreFactoryMaker2.default.getSingletonFactory(MetricsModel),module.exports=exports.default},1551:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function MetricsList(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MetricsList),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]},module.exports=exports.default},1552:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function RepresentationSwitch(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RepresentationSwitch),this.t=null,this.mt=null,this.to=null,this.lto=null},module.exports=exports.default},1553:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function BufferLevel(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BufferLevel),this.t=null,this.level=null},module.exports=exports.default},1554:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _controllersBufferController2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1377));exports.default=function BufferState(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BufferState),this.target=null,this.state=_controllersBufferController2.default.BUFFER_EMPTY},module.exports=exports.default},1555:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function DVRInfo(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DVRInfo),this.time=null,this.range=null,this.manifestInfo=null},module.exports=exports.default},1556:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function DroppedFrames(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DroppedFrames),this.time=null,this.droppedFrames=null},module.exports=exports.default},1557:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});exports.ManifestUpdate=function ManifestUpdate(){_classCallCheck(this,ManifestUpdate),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},exports.ManifestUpdateStreamInfo=function ManifestUpdateStreamInfo(){_classCallCheck(this,ManifestUpdateStreamInfo),this.id=null,this.index=null,this.start=null,this.duration=null},exports.ManifestUpdateRepresentationInfo=function ManifestUpdateRepresentationInfo(){_classCallCheck(this,ManifestUpdateRepresentationInfo),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null}},1558:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function SchedulingInfo(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SchedulingInfo),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},module.exports=exports.default},1559:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function RequestsQueue(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RequestsQueue),this.loadingRequests=[],this.executedRequests=[]},module.exports=exports.default},1560:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369));function VideoModel(){var instance=void 0,logger=void 0,element=void 0,TTMLRenderingDiv=void 0,previousPlaybackRate=void 0,context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),stalledStreams=[];function onPlaybackCanPlay(){element&&(element.playbackRate=previousPlaybackRate||1,element.removeEventListener("canplay",onPlaybackCanPlay))}function setPlaybackRate(value){element&&(element.readyState<=2&&value>0?element.addEventListener("canplay",onPlaybackCanPlay):element.playbackRate=value)}function isStalled(){return stalledStreams.length>0}function removeStalledStream(type){var index=stalledStreams.indexOf(type),event=void 0;null!==type&&(-1!==index&&stalledStreams.splice(index,1),element&&!1===isStalled()&&0===element.playbackRate&&(setPlaybackRate(previousPlaybackRate||1),element.paused||((event=document.createEvent("Event")).initEvent("playing",!0,!1),element.dispatchEvent(event))))}function onPlaying(){if(element&&isStalled()&&0===element.playbackRate){var _event=document.createEvent("Event");_event.initEvent("waiting",!0,!1),element.dispatchEvent(_event)}}function getBufferRange(){return element?element.buffered:null}return instance={initialize:function initialize(){eventBus.on(_coreEventsEvents2.default.PLAYBACK_PLAYING,onPlaying,this)},setCurrentTime:function setCurrentTime(currentTime,stickToBuffered){if(element){if(element.currentTime==currentTime)return;try{currentTime=stickToBuffered?function stickTimeToBuffered(time){var buffered=getBufferRange(),closestTime=time,closestDistance=9999999999;if(buffered)for(var i=0;i<buffered.length;i++){var start=buffered.start(i),end=buffered.end(i),distanceToStart=Math.abs(start-time),distanceToEnd=Math.abs(end-time);if(time>=start&&time<=end)return time;distanceToStart<closestDistance&&(closestDistance=distanceToStart,closestTime=start),distanceToEnd<closestDistance&&(closestDistance=distanceToEnd,closestTime=end)}return closestTime}(currentTime):currentTime,element.currentTime=currentTime}catch(e){0===element.readyState&&e.code===e.INVALID_STATE_ERR&&setTimeout((function(){element.currentTime=currentTime}),400)}}},play:function play(){if(element){element.autoplay=!0;var p=element.play();p&&p.catch&&"undefined"!=typeof Promise&&p.catch((function(e){"NotAllowedError"===e.name&&eventBus.trigger(_coreEventsEvents2.default.PLAYBACK_NOT_ALLOWED),logger.warn("Caught pending play exception - continuing ("+e+")")}))}},isPaused:function isPaused(){return element?element.paused:null},pause:function pause(){element&&(element.pause(),element.autoplay=!1)},isSeeking:function isSeeking(){return element?element.seeking:null},getTime:function getTime(){return element?element.currentTime:null},getPlaybackRate:function getPlaybackRate(){return element?element.playbackRate:null},setPlaybackRate:setPlaybackRate,getPlayedRanges:function getPlayedRanges(){return element?element.played:null},getEnded:function getEnded(){return element?element.ended:null},setStallState:function setStallState(type,state){!function stallStream(type,isStalled){isStalled?function addStalledStream(type){var event=void 0;if(null===type||element.seeking||-1!==stalledStreams.indexOf(type))return;stalledStreams.push(type),element&&1===stalledStreams.length&&((event=document.createEvent("Event")).initEvent("waiting",!0,!1),previousPlaybackRate=element.playbackRate,setPlaybackRate(0),element.dispatchEvent(event))}(type):removeStalledStream(type)}(type,state)},getElement:function getElement(){return element},setElement:function setElement(value){if(!(null==value||value&&/^(VIDEO|AUDIO)$/i.test(value.nodeName)))throw"element is not video or audio DOM type!";(element=value)&&(element.preload="auto")},setSource:function setSource(source){element&&(source?element.src=source:(element.removeAttribute("src"),element.load()))},getSource:function getSource(){return element?element.src:null},getTTMLRenderingDiv:function getTTMLRenderingDiv(){return TTMLRenderingDiv},setTTMLRenderingDiv:function setTTMLRenderingDiv(div){(TTMLRenderingDiv=div).style.position="absolute",TTMLRenderingDiv.style.display="flex",TTMLRenderingDiv.style.overflow="hidden",TTMLRenderingDiv.style.pointerEvents="none",TTMLRenderingDiv.style.top=0,TTMLRenderingDiv.style.left=0},getPlaybackQuality:function getPlaybackQuality(){if(!element)return null;var hasWebKit="webkitDroppedFrameCount"in element&&"webkitDecodedFrameCount"in element,result=null;return"getVideoPlaybackQuality"in element?result=element.getVideoPlaybackQuality():hasWebKit&&(result={droppedVideoFrames:element.webkitDroppedFrameCount,totalVideoFrames:element.webkitDroppedFrameCount+element.webkitDecodedFrameCount,creationTime:new Date}),result},addEventListener:function addEventListener(eventName,eventCallBack){element&&element.addEventListener(eventName,eventCallBack)},removeEventListener:function removeEventListener(eventName,eventCallBack){element&&element.removeEventListener(eventName,eventCallBack)},getReadyState:function getReadyState(){return element?element.readyState:NaN},getBufferRange:getBufferRange,getClientWidth:function getClientWidth(){return element?element.clientWidth:NaN},getClientHeight:function getClientHeight(){return element?element.clientHeight:NaN},getTextTracks:function getTextTracks(){return element?element.textTracks:[]},getTextTrack:function getTextTrack(kind,label,lang,isTTML,isEmbedded){if(element)for(var i=0;i<element.textTracks.length;i++)if(element.textTracks[i].kind===kind&&(!label||element.textTracks[i].label==label)&&element.textTracks[i].language===lang&&element.textTracks[i].isTTML===isTTML&&element.textTracks[i].isEmbedded===isEmbedded)return element.textTracks[i];return null},addTextTrack:function addTextTrack(kind,label,lang){return element?element.addTextTrack(kind,label,lang):null},appendChild:function appendChild(childElement){element&&(element.appendChild(childElement),void 0!==childElement.isTTML&&(element.textTracks[element.textTracks.length-1].isTTML=childElement.isTTML,element.textTracks[element.textTracks.length-1].isEmbedded=childElement.isEmbedded))},removeChild:function removeChild(childElement){element&&element.removeChild(childElement)},getVideoWidth:function getVideoWidth(){return element?element.videoWidth:NaN},getVideoHeight:function getVideoHeight(){return element?element.videoHeight:NaN},getVideoRelativeOffsetTop:function getVideoRelativeOffsetTop(){return element&&element.parentNode?element.getBoundingClientRect().top-element.parentNode.getBoundingClientRect().top:NaN},getVideoRelativeOffsetLeft:function getVideoRelativeOffsetLeft(){return element&&element.parentNode?element.getBoundingClientRect().left-element.parentNode.getBoundingClientRect().left:NaN},reset:function reset(){eventBus.off(_coreEventsEvents2.default.PLAYBACK_PLAYING,onPlaying,this)}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}VideoModel.__dashjs_factory_name="VideoModel",exports.default=_coreFactoryMaker2.default.getSingletonFactory(VideoModel),module.exports=exports.default},1561:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_constantsConstants2=_interopRequireDefault(__webpack_require__(1367)),legacyKeysAndReplacements=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}];function DOMStorage(config){config=config||{};var context=this.context,mediaPlayerModel=config.mediaPlayerModel,instance=void 0,logger=void 0,supported=void 0;function isSupported(type){if(void 0!==supported)return supported;supported=!1;var storage=void 0;try{"undefined"!=typeof window&&(storage=window[type])}catch(error){return logger.warn("DOMStorage access denied: "+error.message),supported}if(!storage||"localStorage"!==type&&"sessionStorage"!==type)return supported;try{storage.setItem("1","1"),storage.removeItem("1"),supported=!0}catch(error){logger.warn("DOMStorage is supported, but cannot be used: "+error.message)}return supported}function getTimestamp(){return 6e5*Math.round((new Date).getTime()/6e5)}function canStore(storageType,key){return isSupported(storageType)&&mediaPlayerModel["get"+key+"CachingInfo"]().enabled}function checkConfig(){if(!mediaPlayerModel||!mediaPlayerModel.hasOwnProperty("getLastMediaSettingsCachingInfo"))throw new Error(_constantsConstants2.default.MISSING_CONFIG_ERROR)}return instance={getSavedBitrateSettings:function getSavedBitrateSettings(type){var savedBitrate=NaN;if(checkConfig(),canStore("localStorage","LastBitrate")){var key="dashjs_?_bitrate".replace(/\?/,type);try{var obj=JSON.parse(localStorage.getItem(key))||{},isExpired=(new Date).getTime()-parseInt(obj.timestamp,10)>=mediaPlayerModel.getLastMediaSettingsCachingInfo().ttl||!1,bitrate=parseFloat(obj.bitrate);isNaN(bitrate)||isExpired?isExpired&&localStorage.removeItem(key):(savedBitrate=bitrate,logger.debug("Last saved bitrate for "+type+" was "+bitrate))}catch(e){return null}}return savedBitrate},setSavedBitrateSettings:function setSavedBitrateSettings(type,bitrate){if(canStore("localStorage","LastBitrate")&&bitrate){var key="dashjs_?_bitrate".replace(/\?/,type);try{localStorage.setItem(key,JSON.stringify({bitrate:bitrate.toFixed(3),timestamp:getTimestamp()}))}catch(e){logger.error(e.message)}}},getSavedMediaSettings:function getSavedMediaSettings(type){if(checkConfig(),!canStore("localStorage","LastMediaSettings"))return null;var settings=null,key="dashjs_?_settings".replace(/\?/,type);try{var obj=JSON.parse(localStorage.getItem(key))||{},isExpired=(new Date).getTime()-parseInt(obj.timestamp,10)>=mediaPlayerModel.getLastMediaSettingsCachingInfo().ttl||!1;settings=obj.settings,isExpired&&(localStorage.removeItem(key),settings=null)}catch(e){return null}return settings},setSavedMediaSettings:function setSavedMediaSettings(type,value){if(canStore("localStorage","LastMediaSettings")){var key="dashjs_?_settings".replace(/\?/,type);try{localStorage.setItem(key,JSON.stringify({settings:value,timestamp:getTimestamp()}))}catch(e){logger.error(e.message)}}}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance),function translateLegacyKeys(){isSupported("localStorage")&&legacyKeysAndReplacements.forEach((function(entry){var value=localStorage.getItem(entry.oldKey);if(value){localStorage.removeItem(entry.oldKey);try{localStorage.setItem(entry.newKey,value)}catch(e){logger.error(e.message)}}}))}()}(),instance}DOMStorage.__dashjs_factory_name="DOMStorage";var factory=_coreFactoryMaker2.default.getSingletonFactory(DOMStorage);exports.default=factory,module.exports=exports.default},1562:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _streamingConstantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_constantsDashConstants2=_interopRequireDefault(__webpack_require__(1374)),_streamingVoRepresentationInfo2=_interopRequireDefault(__webpack_require__(1563)),_streamingVoMediaInfo2=_interopRequireDefault(__webpack_require__(1564)),_streamingVoStreamInfo2=_interopRequireDefault(__webpack_require__(1565)),_streamingVoManifestInfo2=_interopRequireDefault(__webpack_require__(1566)),_voEvent2=_interopRequireDefault(__webpack_require__(1447)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_externalsCea608Parser2=_interopRequireDefault(__webpack_require__(1431)),_streamingUtilsSupervisorTools=__webpack_require__(1383);function DashAdapter(){var instance,dashManifestModel=void 0,voPeriods=void 0,voAdaptations=void 0,currentMediaInfo=void 0;function getRepresentationForRepresentationInfo(representationInfo,representationController){return representationController&&representationInfo?representationController.getRepresentationForQuality(representationInfo.quality):null}function getAdaptationForMediaInfo(mediaInfo){return mediaInfo&&mediaInfo.streamInfo&&void 0!==mediaInfo.streamInfo.id&&voAdaptations[mediaInfo.streamInfo.id]?voAdaptations[mediaInfo.streamInfo.id][mediaInfo.index]:null}function getPeriodForStreamInfo(streamInfo,voPeriodsArray){for(var ln=voPeriodsArray.length,i=0;i<ln;i++){var voPeriod=voPeriodsArray[i];if(streamInfo.id===voPeriod.id)return voPeriod}return null}function convertRepresentationToRepresentationInfo(voRepresentation){var representationInfo=new _streamingVoRepresentationInfo2.default,realAdaptation=voRepresentation.adaptation.period.mpd.manifest.Period_asArray[voRepresentation.adaptation.period.index].AdaptationSet_asArray[voRepresentation.adaptation.index],realRepresentation=dashManifestModel.getRepresentationFor(voRepresentation.index,realAdaptation);return representationInfo.id=voRepresentation.id,representationInfo.quality=voRepresentation.index,representationInfo.bandwidth=dashManifestModel.getBandwidth(realRepresentation),representationInfo.DVRWindow=voRepresentation.segmentAvailabilityRange,representationInfo.fragmentDuration=voRepresentation.segmentDuration||(voRepresentation.segments&&voRepresentation.segments.length>0?voRepresentation.segments[0].duration:NaN),representationInfo.MSETimeOffset=voRepresentation.MSETimeOffset,representationInfo.useCalculatedLiveEdgeTime=voRepresentation.useCalculatedLiveEdgeTime,representationInfo.mediaInfo=convertAdaptationToMediaInfo(voRepresentation.adaptation),representationInfo}function convertAdaptationToMediaInfo(adaptation){var viewpoint,mediaInfo=new _streamingVoMediaInfo2.default,realAdaptation=adaptation.period.mpd.manifest.Period_asArray[adaptation.period.index].AdaptationSet_asArray[adaptation.index];return mediaInfo.id=adaptation.id,mediaInfo.index=adaptation.index,mediaInfo.type=adaptation.type,mediaInfo.streamInfo=convertPeriodToStreamInfo(adaptation.period),mediaInfo.representationCount=dashManifestModel.getRepresentationCount(realAdaptation),mediaInfo.labels=dashManifestModel.getLabelsForAdaptation(realAdaptation),mediaInfo.lang=dashManifestModel.getLanguageForAdaptation(realAdaptation),viewpoint=dashManifestModel.getViewpointForAdaptation(realAdaptation),mediaInfo.viewpoint=viewpoint?viewpoint.value:void 0,mediaInfo.accessibility=dashManifestModel.getAccessibilityForAdaptation(realAdaptation).map((function(accessibility){var accessibilityValue=accessibility.value,accessibilityData=accessibilityValue;return accessibility.schemeIdUri&&accessibility.schemeIdUri.search("cea-608")>=0&&void 0!==_externalsCea608Parser2.default&&(accessibilityData=accessibilityValue?"cea-608:"+accessibilityValue:"cea-608",mediaInfo.embeddedCaptions=!0),accessibilityData})),mediaInfo.audioChannelConfiguration=dashManifestModel.getAudioChannelConfigurationForAdaptation(realAdaptation).map((function(audioChannelConfiguration){return audioChannelConfiguration.value})),mediaInfo.roles=dashManifestModel.getRolesForAdaptation(realAdaptation).map((function(role){return role.value})),mediaInfo.codec=dashManifestModel.getCodec(realAdaptation),mediaInfo.mimeType=dashManifestModel.getMimeType(realAdaptation),mediaInfo.contentProtection=dashManifestModel.getContentProtectionData(realAdaptation),mediaInfo.bitrateList=dashManifestModel.getBitrateListForAdaptation(realAdaptation),mediaInfo.contentProtection&&mediaInfo.contentProtection.forEach((function(item){item.KID=dashManifestModel.getKID(item)})),mediaInfo.isText=dashManifestModel.getIsTextTrack(mediaInfo.mimeType),mediaInfo}function convertVideoInfoToEmbeddedTextInfo(mediaInfo,channel,lang){mediaInfo.id=channel,mediaInfo.index=100+parseInt(channel.substring(2,3)),mediaInfo.type=_streamingConstantsConstants2.default.EMBEDDED_TEXT,mediaInfo.codec="cea-608-in-SEI",mediaInfo.isText=!0,mediaInfo.isEmbedded=!0,mediaInfo.lang=lang,mediaInfo.roles=["caption"]}function convertPeriodToStreamInfo(period){var streamInfo=new _streamingVoStreamInfo2.default;return streamInfo.id=period.id,streamInfo.index=period.index,streamInfo.start=period.start,streamInfo.duration=period.duration,streamInfo.manifestInfo=function convertMpdToManifestInfo(mpd){var manifestInfo=new _streamingVoManifestInfo2.default;return manifestInfo.DVRWindowSize=mpd.timeShiftBufferDepth,manifestInfo.loadedTime=mpd.manifest.loadedTime,manifestInfo.availableFrom=mpd.availabilityStartTime,manifestInfo.minBufferTime=mpd.manifest.minBufferTime,manifestInfo.maxFragmentDuration=mpd.maxSegmentDuration,manifestInfo.duration=dashManifestModel.getDuration(mpd.manifest),manifestInfo.isDynamic=dashManifestModel.getIsDynamic(mpd.manifest),manifestInfo}(period.mpd),streamInfo.isLast=1===period.mpd.manifest.Period_asArray.length||Math.abs(streamInfo.start+streamInfo.duration-streamInfo.manifestInfo.duration)<1,streamInfo}function getAdaptationForType(manifest,periodIndex,type,streamInfo){var adaptation,adaptations=dashManifestModel.getAdaptationsForType(manifest,periodIndex,type);if(!adaptations||0===adaptations.length)return null;if(adaptations.length>1&&streamInfo){var allMediaInfoForType=getAllMediaInfoForType(streamInfo,type);if(currentMediaInfo[streamInfo.id]&&currentMediaInfo[streamInfo.id][type])for(var i=0,ln=adaptations.length;i<ln;i++)if(currentMediaInfo[streamInfo.id][type].isMediaInfoEqual(allMediaInfoForType[i]))return adaptations[i];for(i=0,ln=adaptations.length;i<ln;i++)if(adaptation=adaptations[i],dashManifestModel.getRolesForAdaptation(adaptation).filter((function(role){return role.value===_constantsDashConstants2.default.MAIN}))[0])return adaptations[i]}return adaptations[0]}function getAllMediaInfoForType(streamInfo,type,externalManifest){var ln,voLocalPeriods=voPeriods,manifest=externalManifest,mediaArr=[],data=void 0,media=void 0,idx=void 0,i=void 0,j=void 0;if(manifest){checkSetConfigCall();var mpd=dashManifestModel.getMpd(manifest);voLocalPeriods=dashManifestModel.getRegularPeriods(mpd)}else{if(!(voPeriods.length>0))return mediaArr;manifest=voPeriods[0].mpd.manifest}var selectedVoPeriod=getPeriodForStreamInfo(streamInfo,voLocalPeriods),periodId=selectedVoPeriod.id,adaptationsForType=dashManifestModel.getAdaptationsForType(manifest,streamInfo.index,type!==_streamingConstantsConstants2.default.EMBEDDED_TEXT?type:_streamingConstantsConstants2.default.VIDEO);if(!adaptationsForType)return mediaArr;for(voAdaptations[periodId]=voAdaptations[periodId]||dashManifestModel.getAdaptationsForPeriod(selectedVoPeriod),i=0,ln=adaptationsForType.length;i<ln;i++)if(data=adaptationsForType[i],idx=dashManifestModel.getIndexForAdaptation(data,manifest,streamInfo.index),media=convertAdaptationToMediaInfo(voAdaptations[periodId][idx]),type===_streamingConstantsConstants2.default.EMBEDDED_TEXT){var accessibilityLength=media.accessibility.length;for(j=0;j<accessibilityLength;j++)if(media){var accessibility=media.accessibility[j];if(0===accessibility.indexOf("cea-608:")){var parts=accessibility.substring(8).split(";");if("CC"===parts[0].substring(0,2))for(j=0;j<parts.length;j++)media||(media=convertAdaptationToMediaInfo.call(this,voAdaptations[periodId][idx])),convertVideoInfoToEmbeddedTextInfo(media,parts[j].substring(0,3),parts[j].substring(4)),mediaArr.push(media),media=null;else for(j=0;j<parts.length;j++)media||(media=convertAdaptationToMediaInfo.call(this,voAdaptations[periodId][idx])),convertVideoInfoToEmbeddedTextInfo(media,"CC"+(j+1),parts[j]),mediaArr.push(media),media=null}else 0===accessibility.indexOf("cea-608")&&(convertVideoInfoToEmbeddedTextInfo(media,_streamingConstantsConstants2.default.CC1,"eng"),mediaArr.push(media),media=null)}}else type===_streamingConstantsConstants2.default.IMAGE?(media.type=_streamingConstantsConstants2.default.IMAGE,mediaArr.push(media),media=null):media&&mediaArr.push(media);return mediaArr}function checkSetConfigCall(){if(!dashManifestModel||!dashManifestModel.hasOwnProperty("getMpd")||!dashManifestModel.hasOwnProperty("getRegularPeriods"))throw new Error("setConfig function has to be called previously")}function checkStreamProcessor(streamProcessor){if(!(streamProcessor&&streamProcessor.hasOwnProperty("getRepresentationController")&&streamProcessor.hasOwnProperty("getIndexHandler")&&streamProcessor.hasOwnProperty("getMediaInfo")&&streamProcessor.hasOwnProperty("getType")&&streamProcessor.hasOwnProperty("getStreamInfo")))throw new Error("streamProcessor parameter is missing or malformed!")}function reset(){voPeriods=[],voAdaptations={},currentMediaInfo={}}return instance={convertDataToRepresentationInfo:convertRepresentationToRepresentationInfo,getDataForMedia:getAdaptationForMediaInfo,getStreamsInfo:function getStreamsInfo(externalManifest,maxStreamsInfo){var streams=[],voLocalPeriods=voPeriods;if(externalManifest){checkSetConfigCall();var mpd=dashManifestModel.getMpd(externalManifest);voLocalPeriods=dashManifestModel.getRegularPeriods(mpd)}maxStreamsInfo||(maxStreamsInfo=voLocalPeriods.length);for(var i=0;i<maxStreamsInfo;i++)streams.push(convertPeriodToStreamInfo(voLocalPeriods[i]));return streams},getMediaInfoForType:function getMediaInfoForType(streamInfo,type){if(0===voPeriods.length)return null;var manifest=voPeriods[0].mpd.manifest,realAdaptation=getAdaptationForType(manifest,streamInfo.index,type,streamInfo);if(!realAdaptation)return null;var selectedVoPeriod=getPeriodForStreamInfo(streamInfo,voPeriods),periodId=selectedVoPeriod.id,idx=dashManifestModel.getIndexForAdaptation(realAdaptation,manifest,streamInfo.index);return voAdaptations[periodId]=voAdaptations[periodId]||dashManifestModel.getAdaptationsForPeriod(selectedVoPeriod),convertAdaptationToMediaInfo(voAdaptations[periodId][idx])},getAllMediaInfoForType:getAllMediaInfoForType,getRepresentationInfo:function getRepresentationInfo(representationController,quality){!function checkRepresentationController(representationController){if(!representationController||!representationController.hasOwnProperty("getRepresentationForQuality")||!representationController.hasOwnProperty("getCurrentRepresentation"))throw new Error("representationController parameter is missing or malformed!")}(representationController);var voRepresentation=void 0;return void 0!==quality?((0,_streamingUtilsSupervisorTools.checkInteger)(quality),voRepresentation=representationController.getRepresentationForQuality(quality)):voRepresentation=representationController.getCurrentRepresentation(),voRepresentation?convertRepresentationToRepresentationInfo(voRepresentation):null},getAdaptationForType:getAdaptationForType,updateData:function updateData(streamProcessor){checkStreamProcessor(streamProcessor);var id,selectedVoPeriod=getPeriodForStreamInfo(streamProcessor.getStreamInfo(),voPeriods),mediaInfo=streamProcessor.getMediaInfo(),voAdaptation=getAdaptationForMediaInfo(mediaInfo),type=streamProcessor.getType(),realAdaptation=void 0;id=mediaInfo?mediaInfo.id:null,voPeriods.length>0&&(realAdaptation=id?dashManifestModel.getAdaptationForId(id,voPeriods[0].mpd.manifest,selectedVoPeriod.index):dashManifestModel.getAdaptationForIndex(mediaInfo.index,voPeriods[0].mpd.manifest,selectedVoPeriod.index),streamProcessor.getRepresentationController().updateData(realAdaptation,voAdaptation,type))},getInitRequest:function getInitRequest(streamProcessor,quality){var representation,representationController=void 0,indexHandler=void 0;return checkStreamProcessor(streamProcessor),(0,_streamingUtilsSupervisorTools.checkInteger)(quality),representationController=streamProcessor.getRepresentationController(),indexHandler=streamProcessor.getIndexHandler(),representation=representationController?representationController.getRepresentationForQuality(quality):null,indexHandler?indexHandler.getInitRequest(representation):null},getFragmentRequest:function getFragmentRequest(streamProcessor,representationInfo,time,options){var representation,indexHandler=void 0,fragRequest=null;return checkStreamProcessor(streamProcessor),representation=getRepresentationForRepresentationInfo(representationInfo,streamProcessor.getRepresentationController()),(indexHandler=streamProcessor.getIndexHandler())&&(fragRequest=void 0!==time&&void 0!==options?indexHandler.getSegmentRequestForTime(representation,time,options):indexHandler.getNextSegmentRequest(representation)),fragRequest},getIndexHandlerTime:function getIndexHandlerTime(streamProcessor){checkStreamProcessor(streamProcessor);var indexHandler=streamProcessor.getIndexHandler();return indexHandler?indexHandler.getCurrentTime():NaN},setIndexHandlerTime:function setIndexHandlerTime(streamProcessor,value){checkStreamProcessor(streamProcessor);var indexHandler=streamProcessor.getIndexHandler();indexHandler&&indexHandler.setCurrentTime(value)},getEventsFor:function getEventsFor(info,streamProcessor){var events=[];if(0===voPeriods.length)return events;var manifest=voPeriods[0].mpd.manifest;return info instanceof _streamingVoStreamInfo2.default?events=dashManifestModel.getEventsForPeriod(getPeriodForStreamInfo(info,voPeriods)):info instanceof _streamingVoMediaInfo2.default?events=dashManifestModel.getEventStreamForAdaptationSet(manifest,getAdaptationForMediaInfo(info)):info instanceof _streamingVoRepresentationInfo2.default&&(events=dashManifestModel.getEventStreamForRepresentation(manifest,getRepresentationForRepresentationInfo(info,streamProcessor.getRepresentationController()))),events},getEvent:function getEvent(eventBox,eventStreams,startTime){if(!eventBox||!eventStreams)return null;var event=new _voEvent2.default,schemeIdUri=eventBox.scheme_id_uri,value=eventBox.value,timescale=eventBox.timescale,presentationTimeDelta=eventBox.presentation_time_delta,duration=eventBox.event_duration,id=eventBox.id,messageData=eventBox.message_data,presentationTime=startTime*timescale+presentationTimeDelta;return eventStreams[schemeIdUri+"/"+value]?(event.eventStream=eventStreams[schemeIdUri+"/"+value],event.eventStream.value=value,event.eventStream.timescale=timescale,event.duration=duration,event.id=id,event.presentationTime=presentationTime,event.messageData=messageData,event.presentationTimeDelta=presentationTimeDelta,event):null},setConfig:function setConfig(config){config&&config.dashManifestModel&&(dashManifestModel=config.dashManifestModel)},updatePeriods:function updatePeriods(newManifest){if(!newManifest)return null;checkSetConfigCall();var mpd=dashManifestModel.getMpd(newManifest);voPeriods=dashManifestModel.getRegularPeriods(mpd),voAdaptations={}},reset:reset,resetIndexHandler:function resetIndexHandler(streamProcessor){checkStreamProcessor(streamProcessor);var indexHandler=streamProcessor.getIndexHandler();indexHandler&&indexHandler.resetIndex()},setCurrentMediaInfo:function setCurrentMediaInfo(streamId,type,mediaInfo){currentMediaInfo[streamId]=currentMediaInfo[streamId]||{},currentMediaInfo[streamId][type]=currentMediaInfo[streamId][type]||{},currentMediaInfo[streamId][type]=mediaInfo}},function setup(){reset()}(),instance}DashAdapter.__dashjs_factory_name="DashAdapter",exports.default=_coreFactoryMaker2.default.getSingletonFactory(DashAdapter),module.exports=exports.default},1563:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function RepresentationInfo(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RepresentationInfo),this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},module.exports=exports.default},1564:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var MediaInfo=function(){function MediaInfo(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MediaInfo),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null}return _createClass(MediaInfo,[{key:"isMediaInfoEqual",value:function isMediaInfoEqual(mediaInfo){if(!mediaInfo)return!1;var sameId=this.id===mediaInfo.id,sameViewpoint=this.viewpoint===mediaInfo.viewpoint,sameLang=this.lang===mediaInfo.lang,sameRoles=this.roles.toString()===mediaInfo.roles.toString(),sameAccessibility=this.accessibility.toString()===mediaInfo.accessibility.toString(),sameAudioChannelConfiguration=this.audioChannelConfiguration.toString()===mediaInfo.audioChannelConfiguration.toString();return sameId&&sameViewpoint&&sameLang&&sameRoles&&sameAccessibility&&sameAudioChannelConfiguration}}]),MediaInfo}();exports.default=MediaInfo,module.exports=exports.default},1565:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function StreamInfo(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,StreamInfo),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},module.exports=exports.default},1566:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function ManifestInfo(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ManifestInfo),this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null},module.exports=exports.default},1567:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _streamingConstantsConstants2=_interopRequireDefault(__webpack_require__(1367)),_constantsDashConstants2=_interopRequireDefault(__webpack_require__(1374)),_voRepresentation2=_interopRequireDefault(__webpack_require__(1413)),_voAdaptationSet2=_interopRequireDefault(__webpack_require__(1568)),_voPeriod2=_interopRequireDefault(__webpack_require__(1569)),_voMpd2=_interopRequireDefault(__webpack_require__(1570)),_voUTCTiming2=_interopRequireDefault(__webpack_require__(1445)),_voEvent2=_interopRequireDefault(__webpack_require__(1447)),_voBaseURL2=_interopRequireDefault(__webpack_require__(1441)),_voEventStream2=_interopRequireDefault(__webpack_require__(1571)),_streamingUtilsObjectUtils2=_interopRequireDefault(__webpack_require__(1440)),_streamingUtilsURLUtils2=_interopRequireDefault(__webpack_require__(1376)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_coreDebug2=_interopRequireDefault(__webpack_require__(1369)),_streamingVoDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_coreErrorsErrors2=_interopRequireDefault(__webpack_require__(1372)),_streamingThumbnailThumbnailTracks=__webpack_require__(1437);function DashManifestModel(config){config=config||{};var instance=void 0,logger=void 0,context=this.context,urlUtils=(0,_streamingUtilsURLUtils2.default)(context).getInstance(),timelineConverter=config.timelineConverter,errHandler=config.errHandler,BASE64=config.BASE64,isInteger=Number.isInteger||function(value){return"number"==typeof value&&isFinite(value)&&Math.floor(value)===value};function getIsTypeOf(adaptation,type){var i=void 0,len=void 0,representation=void 0,col=void 0,mimeTypeRegEx=void 0,codecs=void 0,result=!1,found=!1;if(!adaptation)throw new Error("adaptation is not defined");if(!type)throw new Error("type is not defined");if(adaptation.hasOwnProperty("ContentComponent_asArray")&&(col=adaptation.ContentComponent_asArray),mimeTypeRegEx=type!==_streamingConstantsConstants2.default.TEXT?new RegExp(type):new RegExp("(vtt|ttml)"),adaptation.Representation_asArray&&adaptation.Representation_asArray.length&&adaptation.Representation_asArray.length>0){var essentialProperties=getEssentialPropertiesForRepresentation(adaptation.Representation_asArray[0]);if(essentialProperties&&essentialProperties.length>0&&_streamingThumbnailThumbnailTracks.THUMBNAILS_SCHEME_ID_URIS.indexOf(essentialProperties[0].schemeIdUri)>=0)return type===_streamingConstantsConstants2.default.IMAGE;if(adaptation.Representation_asArray[0].hasOwnProperty(_constantsDashConstants2.default.CODECS)&&(0===(codecs=adaptation.Representation_asArray[0].codecs).search(_streamingConstantsConstants2.default.STPP)||0===codecs.search(_streamingConstantsConstants2.default.WVTT)))return type===_streamingConstantsConstants2.default.FRAGMENTED_TEXT}if(col){if(col.length>1)return type===_streamingConstantsConstants2.default.MUXED;col[0]&&col[0].contentType===type&&(result=!0,found=!0)}if(adaptation.hasOwnProperty(_constantsDashConstants2.default.MIME_TYPE)&&(result=mimeTypeRegEx.test(adaptation.mimeType),found=!0),!found)for(i=0,len=adaptation.Representation_asArray&&adaptation.Representation_asArray.length?adaptation.Representation_asArray.length:0;!found&&i<len;)(representation=adaptation.Representation_asArray[i]).hasOwnProperty(_constantsDashConstants2.default.MIME_TYPE)&&(result=mimeTypeRegEx.test(representation.mimeType),found=!0),i++;return result}function getIsAudio(adaptation){return getIsTypeOf(adaptation,_streamingConstantsConstants2.default.AUDIO)}function getIsVideo(adaptation){return getIsTypeOf(adaptation,_streamingConstantsConstants2.default.VIDEO)}function getIsFragmentedText(adaptation){return getIsTypeOf(adaptation,_streamingConstantsConstants2.default.FRAGMENTED_TEXT)}function getIsImage(adaptation){return getIsTypeOf(adaptation,_streamingConstantsConstants2.default.IMAGE)}function getIsTextTrack(type){return"text/vtt"===type||"application/ttml+xml"===type}function getRepresentationSortFunction(){return function(a,b){return a.bandwidth-b.bandwidth}}function processAdaptation(realAdaptation){return realAdaptation&&void 0!==realAdaptation.Representation_asArray&&null!==realAdaptation.Representation_asArray&&realAdaptation.Representation_asArray.sort((function(a,b){return a.bandwidth-b.bandwidth})),realAdaptation}function getRealAdaptations(manifest,periodIndex){return manifest&&manifest.Period_asArray&&isInteger(periodIndex)&&manifest.Period_asArray[periodIndex]?manifest.Period_asArray[periodIndex].AdaptationSet_asArray:[]}function getIsDynamic(manifest){var isDynamic=!1;return manifest&&manifest.hasOwnProperty("type")&&(isDynamic=manifest.type===_constantsDashConstants2.default.DYNAMIC),isDynamic}function getEssentialPropertiesForRepresentation(realRepresentation){return realRepresentation&&realRepresentation.EssentialProperty_asArray&&realRepresentation.EssentialProperty_asArray.length?realRepresentation.EssentialProperty_asArray.map((function(prop){return{schemeIdUri:prop.schemeIdUri,value:prop.value}})):null}function getRealAdaptationFor(voAdaptation){if(voAdaptation&&voAdaptation.period&&isInteger(voAdaptation.period.index)){var periodArray=voAdaptation.period.mpd.manifest.Period_asArray[voAdaptation.period.index];if(periodArray&&periodArray.AdaptationSet_asArray&&isInteger(voAdaptation.index))return processAdaptation(periodArray.AdaptationSet_asArray[voAdaptation.index])}}function isLastRepeatAttributeValid(segmentTimeline){var s=segmentTimeline.S_asArray[segmentTimeline.S_asArray.length-1];return!s.hasOwnProperty("r")||s.r>=0}function getPeriodId(realPeriod,i){if(!realPeriod)throw new Error("Period cannot be null or undefined");var id=_voPeriod2.default.DEFAULT_ID+"_"+i;return realPeriod.hasOwnProperty(_constantsDashConstants2.default.ID)&&realPeriod.id.length>0&&"__proto__"!==realPeriod.id&&(id=realPeriod.id),id}function getEventStreams(inbandStreams,representation){var eventStreams=[],i=void 0;if(!inbandStreams)return eventStreams;for(i=0;i<inbandStreams.length;i++){var eventStream=new _voEventStream2.default;if(eventStream.timescale=1,eventStream.representation=representation,!inbandStreams[i].hasOwnProperty(_streamingConstantsConstants2.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");eventStream.schemeIdUri=inbandStreams[i].schemeIdUri,inbandStreams[i].hasOwnProperty(_constantsDashConstants2.default.TIMESCALE)&&(eventStream.timescale=inbandStreams[i].timescale),inbandStreams[i].hasOwnProperty(_constantsDashConstants2.default.VALUE)&&(eventStream.value=inbandStreams[i].value),eventStreams.push(eventStream)}return eventStreams}function getBaseURLsFromElement(node){var baseUrls=[],entries=node.BaseURL_asArray||[node.baseUri],earlyReturn=!1;return entries.some((function(entry){if(entry){var baseUrl=new _voBaseURL2.default,text=entry.__text||entry;return urlUtils.isRelative(text)&&(earlyReturn=!0,node.baseUri&&(text=urlUtils.resolve(text,node.baseUri))),baseUrl.url=text,entry.hasOwnProperty(_constantsDashConstants2.default.SERVICE_LOCATION)&&entry.serviceLocation.length?baseUrl.serviceLocation=entry.serviceLocation:baseUrl.serviceLocation=text,entry.hasOwnProperty(_constantsDashConstants2.default.DVB_PRIORITY)&&(baseUrl.dvb_priority=entry[_constantsDashConstants2.default.DVB_PRIORITY]),entry.hasOwnProperty(_constantsDashConstants2.default.DVB_WEIGHT)&&(baseUrl.dvb_weight=entry[_constantsDashConstants2.default.DVB_WEIGHT]),entry.hasOwnProperty(_constantsDashConstants2.default.AVAILABILITY_TIME_OFFSET)&&(baseUrl.availabilityTimeOffset=entry[_constantsDashConstants2.default.AVAILABILITY_TIME_OFFSET]),entry.hasOwnProperty(_constantsDashConstants2.default.AVAILABILITY_TIME_COMPLETE)&&(baseUrl.availabilityTimeComplete="false"!==entry[_constantsDashConstants2.default.AVAILABILITY_TIME_COMPLETE]),baseUrls.push(baseUrl),earlyReturn}})),baseUrls}return instance={getIsTypeOf:getIsTypeOf,getIsTextTrack:getIsTextTrack,getLanguageForAdaptation:function getLanguageForAdaptation(adaptation){var lang="";return adaptation&&adaptation.hasOwnProperty(_constantsDashConstants2.default.LANG)&&(lang=adaptation.lang.replace(/[^A-Za-z0-9-]/g,"")),lang},getViewpointForAdaptation:function getViewpointForAdaptation(adaptation){return adaptation&&adaptation.hasOwnProperty(_constantsDashConstants2.default.VIEWPOINT)?adaptation.Viewpoint:null},getRolesForAdaptation:function getRolesForAdaptation(adaptation){return adaptation&&adaptation.hasOwnProperty(_constantsDashConstants2.default.ROLE_ASARRAY)?adaptation.Role_asArray:[]},getAccessibilityForAdaptation:function getAccessibilityForAdaptation(adaptation){return adaptation&&adaptation.hasOwnProperty(_constantsDashConstants2.default.ACCESSIBILITY_ASARRAY)?adaptation.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function getAudioChannelConfigurationForAdaptation(adaptation){return adaptation&&adaptation.hasOwnProperty(_constantsDashConstants2.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?adaptation.AudioChannelConfiguration_asArray:[]},getAdaptationForIndex:function getAdaptationForIndex(index,manifest,periodIndex){var realAdaptations=getRealAdaptations(manifest,periodIndex);return realAdaptations.length>0&&isInteger(index)?realAdaptations[index]:null},getIndexForAdaptation:function getIndexForAdaptation(realAdaptation,manifest,periodIndex){var realAdaptations=getRealAdaptations(manifest,periodIndex),len=realAdaptations.length;if(realAdaptation)for(var i=0;i<len;i++){if((0,_streamingUtilsObjectUtils2.default)(context).getInstance().areEqual(realAdaptations[i],realAdaptation))return i}return-1},getAdaptationForId:function getAdaptationForId(id,manifest,periodIndex){var len,realAdaptations=getRealAdaptations(manifest,periodIndex),i=void 0;for(i=0,len=realAdaptations.length;i<len;i++)if(realAdaptations[i].hasOwnProperty(_constantsDashConstants2.default.ID)&&realAdaptations[i].id===id)return realAdaptations[i];return null},getAdaptationsForType:function getAdaptationsForType(manifest,periodIndex,type){var len,realAdaptations=getRealAdaptations(manifest,periodIndex),i=void 0,adaptations=[];for(i=0,len=realAdaptations.length;i<len;i++)getIsTypeOf(realAdaptations[i],type)&&adaptations.push(processAdaptation(realAdaptations[i]));return adaptations},getCodec:function getCodec(adaptation,representationId,addResolutionInfo){var codec=null;if(adaptation&&adaptation.Representation_asArray&&adaptation.Representation_asArray.length>0){var representation=isInteger(representationId)&&representationId>=0&&representationId<adaptation.Representation_asArray.length?adaptation.Representation_asArray[representationId]:adaptation.Representation_asArray[0];representation&&(codec=representation.mimeType+';codecs="'+representation.codecs+'"',addResolutionInfo&&void 0!==representation.width&&(codec+=';width="'+representation.width+'";height="'+representation.height+'"'))}return codec},getMimeType:function getMimeType(adaptation){return adaptation&&adaptation.Representation_asArray&&adaptation.Representation_asArray.length>0?adaptation.Representation_asArray[0].mimeType:null},getKID:function getKID(adaptation){return adaptation&&adaptation.hasOwnProperty(_constantsDashConstants2.default.CENC_DEFAULT_KID)?adaptation[_constantsDashConstants2.default.CENC_DEFAULT_KID]:null},getLabelsForAdaptation:function getLabelsForAdaptation(adaptation){if(!adaptation.Label_asArray||!adaptation.Label_asArray.length)return[];for(var labelArray=[],i=0;i<adaptation.Label_asArray.length;i++)labelArray.push({lang:adaptation.Label_asArray[i].lang,text:adaptation.Label_asArray[i].__text||adaptation.Label_asArray[i]});return labelArray},getContentProtectionData:function getContentProtectionData(adaptation){return adaptation&&adaptation.hasOwnProperty(_constantsDashConstants2.default.CONTENTPROTECTION_ASARRAY)&&0!==adaptation.ContentProtection_asArray.length?adaptation.ContentProtection_asArray:null},getIsDynamic:getIsDynamic,getIsDVB:function getIsDVB(manifest){return function hasProfile(manifest,profile){var has=!1;return manifest&&manifest.profiles&&manifest.profiles.length>0&&(has=-1!==manifest.profiles.indexOf(profile)),has}(manifest,"urn:dvb:dash:profile:dvb-dash:2014")},getDuration:function getDuration(manifest){return manifest&&manifest.hasOwnProperty(_constantsDashConstants2.default.MEDIA_PRESENTATION_DURATION)?manifest.mediaPresentationDuration:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function getBandwidth(representation){return representation&&representation.bandwidth?representation.bandwidth:NaN},getManifestUpdatePeriod:function getManifestUpdatePeriod(manifest){var latencyOfLastUpdate=arguments.length<=1||void 0===arguments[1]?0:arguments[1],delay=NaN;return manifest&&manifest.hasOwnProperty(_constantsDashConstants2.default.MINIMUM_UPDATE_PERIOD)&&(delay=manifest.minimumUpdatePeriod),isNaN(delay)?delay:Math.max(delay-latencyOfLastUpdate,1)},getRepresentationCount:function getRepresentationCount(adaptation){return adaptation&&adaptation.Representation_asArray&&adaptation.Representation_asArray.length?adaptation.Representation_asArray.length:0},getBitrateListForAdaptation:function getBitrateListForAdaptation(realAdaptation){return realAdaptation&&realAdaptation.Representation_asArray&&realAdaptation.Representation_asArray.length?processAdaptation(realAdaptation).Representation_asArray.map((function(realRepresentation){return{bandwidth:realRepresentation.bandwidth,width:realRepresentation.width||0,height:realRepresentation.height||0,scanType:realRepresentation.scanType||null}})):null},getRepresentationFor:function getRepresentationFor(index,adaptation){return adaptation&&adaptation.Representation_asArray&&adaptation.Representation_asArray.length>0&&isInteger(index)?adaptation.Representation_asArray[index]:null},getRepresentationsForAdaptation:function getRepresentationsForAdaptation(voAdaptation){var voRepresentations=[],processedRealAdaptation=getRealAdaptationFor(voAdaptation),segmentInfo=void 0,baseUrl=void 0;if(voAdaptation&&voAdaptation.period&&isInteger(voAdaptation.period.index)){var baseUrls=getBaseURLsFromElement(voAdaptation.period.mpd.manifest);baseUrls&&(baseUrl=baseUrls[0])}if(processedRealAdaptation&&processedRealAdaptation.Representation_asArray)for(var i=0,len=processedRealAdaptation.Representation_asArray.length;i<len;++i){var realRepresentation=processedRealAdaptation.Representation_asArray[i],voRepresentation=new _voRepresentation2.default;if(voRepresentation.index=i,voRepresentation.adaptation=voAdaptation,realRepresentation.hasOwnProperty(_constantsDashConstants2.default.ID)&&(voRepresentation.id=realRepresentation.id),realRepresentation.hasOwnProperty(_constantsDashConstants2.default.CODECS)&&(voRepresentation.codecs=realRepresentation.codecs),realRepresentation.hasOwnProperty(_constantsDashConstants2.default.CODEC_PRIVATE_DATA)&&(voRepresentation.codecPrivateData=realRepresentation.codecPrivateData),realRepresentation.hasOwnProperty(_constantsDashConstants2.default.BANDWITH)&&(voRepresentation.bandwidth=realRepresentation.bandwidth),realRepresentation.hasOwnProperty(_constantsDashConstants2.default.WIDTH)&&(voRepresentation.width=realRepresentation.width),realRepresentation.hasOwnProperty(_constantsDashConstants2.default.HEIGHT)&&(voRepresentation.height=realRepresentation.height),realRepresentation.hasOwnProperty(_constantsDashConstants2.default.SCAN_TYPE)&&(voRepresentation.scanType=realRepresentation.scanType),realRepresentation.hasOwnProperty(_constantsDashConstants2.default.MAX_PLAYOUT_RATE)&&(voRepresentation.maxPlayoutRate=realRepresentation.maxPlayoutRate),realRepresentation.hasOwnProperty(_constantsDashConstants2.default.SEGMENT_BASE)?(segmentInfo=realRepresentation.SegmentBase,voRepresentation.segmentInfoType=_constantsDashConstants2.default.SEGMENT_BASE):realRepresentation.hasOwnProperty(_constantsDashConstants2.default.SEGMENT_LIST)?(segmentInfo=realRepresentation.SegmentList).hasOwnProperty(_constantsDashConstants2.default.SEGMENT_TIMELINE)?(voRepresentation.segmentInfoType=_constantsDashConstants2.default.SEGMENT_TIMELINE,voRepresentation.useCalculatedLiveEdgeTime=isLastRepeatAttributeValid(segmentInfo.SegmentTimeline)):(voRepresentation.segmentInfoType=_constantsDashConstants2.default.SEGMENT_LIST,voRepresentation.useCalculatedLiveEdgeTime=!0):realRepresentation.hasOwnProperty(_constantsDashConstants2.default.SEGMENT_TEMPLATE)?((segmentInfo=realRepresentation.SegmentTemplate).hasOwnProperty(_constantsDashConstants2.default.SEGMENT_TIMELINE)?(voRepresentation.segmentInfoType=_constantsDashConstants2.default.SEGMENT_TIMELINE,voRepresentation.useCalculatedLiveEdgeTime=isLastRepeatAttributeValid(segmentInfo.SegmentTimeline)):voRepresentation.segmentInfoType=_constantsDashConstants2.default.SEGMENT_TEMPLATE,segmentInfo.hasOwnProperty(_constantsDashConstants2.default.INITIALIZATION_MINUS)&&(voRepresentation.initialization=segmentInfo.initialization.split("$Bandwidth$").join(realRepresentation.bandwidth).split("$RepresentationID$").join(realRepresentation.id))):voRepresentation.segmentInfoType=_constantsDashConstants2.default.BASE_URL,voRepresentation.essentialProperties=getEssentialPropertiesForRepresentation(realRepresentation),segmentInfo){if(segmentInfo.hasOwnProperty(_constantsDashConstants2.default.INITIALIZATION)){var initialization=segmentInfo.Initialization;initialization.hasOwnProperty(_constantsDashConstants2.default.SOURCE_URL)?voRepresentation.initialization=initialization.sourceURL:initialization.hasOwnProperty(_constantsDashConstants2.default.RANGE)&&(voRepresentation.range=initialization.range)}else realRepresentation.hasOwnProperty(_constantsDashConstants2.default.MIME_TYPE)&&getIsTextTrack(realRepresentation.mimeType)&&(voRepresentation.range=0);segmentInfo.hasOwnProperty(_constantsDashConstants2.default.TIMESCALE)&&(voRepresentation.timescale=segmentInfo.timescale),segmentInfo.hasOwnProperty(_constantsDashConstants2.default.DURATION)&&(voRepresentation.segmentDuration=segmentInfo.duration/voRepresentation.timescale),segmentInfo.hasOwnProperty(_constantsDashConstants2.default.MEDIA)&&(voRepresentation.media=segmentInfo.media),segmentInfo.hasOwnProperty(_constantsDashConstants2.default.START_NUMBER)&&(voRepresentation.startNumber=segmentInfo.startNumber),segmentInfo.hasOwnProperty(_constantsDashConstants2.default.INDEX_RANGE)&&(voRepresentation.indexRange=segmentInfo.indexRange),segmentInfo.hasOwnProperty(_constantsDashConstants2.default.PRESENTATION_TIME_OFFSET)&&(voRepresentation.presentationTimeOffset=segmentInfo.presentationTimeOffset/voRepresentation.timescale),segmentInfo.hasOwnProperty(_constantsDashConstants2.default.AVAILABILITY_TIME_OFFSET)?voRepresentation.availabilityTimeOffset=segmentInfo.availabilityTimeOffset:baseUrl&&void 0!==baseUrl.availabilityTimeOffset&&(voRepresentation.availabilityTimeOffset=baseUrl.availabilityTimeOffset),segmentInfo.hasOwnProperty(_constantsDashConstants2.default.AVAILABILITY_TIME_COMPLETE)?voRepresentation.availabilityTimeComplete="false"!==segmentInfo.availabilityTimeComplete:baseUrl&&void 0!==baseUrl.availabilityTimeComplete&&(voRepresentation.availabilityTimeComplete=baseUrl.availabilityTimeComplete)}voRepresentation.MSETimeOffset=timelineConverter.calcMSETimeOffset(voRepresentation),voRepresentation.path=[voAdaptation.period.index,voAdaptation.index,i],voRepresentations.push(voRepresentation)}return voRepresentations},getAdaptationsForPeriod:function getAdaptationsForPeriod(voPeriod){var realPeriod=voPeriod&&isInteger(voPeriod.index)?voPeriod.mpd.manifest.Period_asArray[voPeriod.index]:null,voAdaptations=[],voAdaptationSet=void 0,realAdaptationSet=void 0,i=void 0;if(realPeriod&&realPeriod.AdaptationSet_asArray)for(i=0;i<realPeriod.AdaptationSet_asArray.length;i++)realAdaptationSet=realPeriod.AdaptationSet_asArray[i],voAdaptationSet=new _voAdaptationSet2.default,realAdaptationSet.hasOwnProperty(_constantsDashConstants2.default.ID)&&(voAdaptationSet.id=realAdaptationSet.id),voAdaptationSet.index=i,voAdaptationSet.period=voPeriod,getIsTypeOf(realAdaptationSet,_streamingConstantsConstants2.default.MUXED)?voAdaptationSet.type=_streamingConstantsConstants2.default.MUXED:getIsAudio(realAdaptationSet)?voAdaptationSet.type=_streamingConstantsConstants2.default.AUDIO:getIsVideo(realAdaptationSet)?voAdaptationSet.type=_streamingConstantsConstants2.default.VIDEO:getIsFragmentedText(realAdaptationSet)?voAdaptationSet.type=_streamingConstantsConstants2.default.FRAGMENTED_TEXT:getIsImage(realAdaptationSet)?voAdaptationSet.type=_streamingConstantsConstants2.default.IMAGE:voAdaptationSet.type=_streamingConstantsConstants2.default.TEXT,voAdaptations.push(voAdaptationSet);return voAdaptations},getRegularPeriods:function getRegularPeriods(mpd){var len,isDynamic=!!mpd&&getIsDynamic(mpd.manifest),voPeriods=[],realPreviousPeriod=null,realPeriod=null,voPreviousPeriod=null,voPeriod=null,i=void 0;for(i=0,len=mpd&&mpd.manifest&&mpd.manifest.Period_asArray?mpd.manifest.Period_asArray.length:0;i<len;i++)(realPeriod=mpd.manifest.Period_asArray[i]).hasOwnProperty(_constantsDashConstants2.default.START)?(voPeriod=new _voPeriod2.default).start=realPeriod.start:null!==realPreviousPeriod&&realPreviousPeriod.hasOwnProperty(_constantsDashConstants2.default.DURATION)&&null!==voPreviousPeriod?(voPeriod=new _voPeriod2.default).start=parseFloat((voPreviousPeriod.start+voPreviousPeriod.duration).toFixed(5)):0!==i||isDynamic||((voPeriod=new _voPeriod2.default).start=0),null!==voPreviousPeriod&&isNaN(voPreviousPeriod.duration)&&(null!==voPeriod?voPreviousPeriod.duration=parseFloat((voPeriod.start-voPreviousPeriod.start).toFixed(5)):logger.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==voPeriod&&(voPeriod.id=getPeriodId(realPeriod,i),voPeriod.index=i,voPeriod.mpd=mpd,realPeriod.hasOwnProperty(_constantsDashConstants2.default.DURATION)&&(voPeriod.duration=realPeriod.duration),voPeriods.push(voPeriod),realPreviousPeriod=realPeriod,voPreviousPeriod=voPeriod),realPeriod=null,voPeriod=null;return 0===voPeriods.length?voPeriods:(null!==voPreviousPeriod&&isNaN(voPreviousPeriod.duration)&&(voPreviousPeriod.duration=parseFloat((function getEndTimeForLastPeriod(voPeriod){var isDynamic=getIsDynamic(voPeriod.mpd.manifest),periodEnd=void 0;voPeriod.mpd.manifest.mediaPresentationDuration?periodEnd=voPeriod.mpd.manifest.mediaPresentationDuration:voPeriod.duration?periodEnd=voPeriod.duration:isDynamic?periodEnd=Number.POSITIVE_INFINITY:errHandler.error(new _streamingVoDashJSError2.default(_coreErrorsErrors2.default.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",voPeriod));return periodEnd}(voPreviousPeriod)-voPreviousPeriod.start).toFixed(5))),voPeriods)},getMpd:function getMpd(manifest){var mpd=new _voMpd2.default;return manifest&&(mpd.manifest=manifest,manifest.hasOwnProperty(_constantsDashConstants2.default.AVAILABILITY_START_TIME)?mpd.availabilityStartTime=new Date(manifest.availabilityStartTime.getTime()):mpd.availabilityStartTime=new Date(manifest.loadedTime.getTime()),manifest.hasOwnProperty(_constantsDashConstants2.default.AVAILABILITY_END_TIME)&&(mpd.availabilityEndTime=new Date(manifest.availabilityEndTime.getTime())),manifest.hasOwnProperty(_constantsDashConstants2.default.MINIMUM_UPDATE_PERIOD)&&(mpd.minimumUpdatePeriod=manifest.minimumUpdatePeriod),manifest.hasOwnProperty(_constantsDashConstants2.default.MEDIA_PRESENTATION_DURATION)&&(mpd.mediaPresentationDuration=manifest.mediaPresentationDuration),manifest.hasOwnProperty(_streamingConstantsConstants2.default.SUGGESTED_PRESENTATION_DELAY)&&(mpd.suggestedPresentationDelay=manifest.suggestedPresentationDelay),manifest.hasOwnProperty(_constantsDashConstants2.default.TIMESHIFT_BUFFER_DEPTH)&&(mpd.timeShiftBufferDepth=manifest.timeShiftBufferDepth),manifest.hasOwnProperty(_constantsDashConstants2.default.MAX_SEGMENT_DURATION)&&(mpd.maxSegmentDuration=manifest.maxSegmentDuration)),mpd},getEventsForPeriod:function getEventsForPeriod(period){var manifest=period&&period.mpd&&period.mpd.manifest?period.mpd.manifest:null,periodArray=manifest?manifest.Period_asArray:null,eventStreams=periodArray&&period&&isInteger(period.index)?periodArray[period.index].EventStream_asArray:null,events=[],i=void 0,j=void 0;if(eventStreams)for(i=0;i<eventStreams.length;i++){var eventStream=new _voEventStream2.default;if(eventStream.period=period,eventStream.timescale=1,!eventStreams[i].hasOwnProperty(_streamingConstantsConstants2.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(eventStream.schemeIdUri=eventStreams[i].schemeIdUri,eventStreams[i].hasOwnProperty(_constantsDashConstants2.default.TIMESCALE)&&(eventStream.timescale=eventStreams[i].timescale),eventStreams[i].hasOwnProperty(_constantsDashConstants2.default.VALUE)&&(eventStream.value=eventStreams[i].value),j=0;eventStreams[i].Event_asArray&&j<eventStreams[i].Event_asArray.length;j++){var _event=new _voEvent2.default;_event.presentationTime=0,_event.eventStream=eventStream,eventStreams[i].Event_asArray[j].hasOwnProperty(_constantsDashConstants2.default.PRESENTATION_TIME)&&(_event.presentationTime=eventStreams[i].Event_asArray[j].presentationTime),eventStreams[i].Event_asArray[j].hasOwnProperty(_constantsDashConstants2.default.DURATION)&&(_event.duration=eventStreams[i].Event_asArray[j].duration),eventStreams[i].Event_asArray[j].hasOwnProperty(_constantsDashConstants2.default.ID)&&(_event.id=eventStreams[i].Event_asArray[j].id),eventStreams[i].Event_asArray[j].Signal&&eventStreams[i].Event_asArray[j].Signal.Binary?_event.messageData=BASE64.decodeArray(eventStreams[i].Event_asArray[j].Signal.Binary):_event.messageData=eventStreams[i].Event_asArray[j].messageData||eventStreams[i].Event_asArray[j].__text,events.push(_event)}}return events},getEventStreamForAdaptationSet:function getEventStreamForAdaptationSet(manifest,adaptation){var inbandStreams=void 0,periodArray=void 0,adaptationArray=void 0;return manifest&&manifest.Period_asArray&&adaptation&&adaptation.period&&isInteger(adaptation.period.index)&&(periodArray=manifest.Period_asArray[adaptation.period.index])&&periodArray.AdaptationSet_asArray&&isInteger(adaptation.index)&&(adaptationArray=periodArray.AdaptationSet_asArray[adaptation.index])&&(inbandStreams=adaptationArray.InbandEventStream_asArray),getEventStreams(inbandStreams,null)},getEventStreamForRepresentation:function getEventStreamForRepresentation(manifest,representation){var inbandStreams=void 0,periodArray=void 0,adaptationArray=void 0,representationArray=void 0;return manifest&&manifest.Period_asArray&&representation&&representation.adaptation&&representation.adaptation.period&&isInteger(representation.adaptation.period.index)&&(periodArray=manifest.Period_asArray[representation.adaptation.period.index])&&periodArray.AdaptationSet_asArray&&isInteger(representation.adaptation.index)&&(adaptationArray=periodArray.AdaptationSet_asArray[representation.adaptation.index])&&adaptationArray.Representation_asArray&&isInteger(representation.index)&&(representationArray=adaptationArray.Representation_asArray[representation.index])&&(inbandStreams=representationArray.InbandEventStream_asArray),getEventStreams(inbandStreams,representation)},getUTCTimingSources:function getUTCTimingSources(manifest){var isDynamic=getIsDynamic(manifest),hasAST=!!manifest&&manifest.hasOwnProperty(_constantsDashConstants2.default.AVAILABILITY_START_TIME),utcTimingsArray=manifest?manifest.UTCTiming_asArray:null,utcTimingEntries=[];return(isDynamic||hasAST)&&utcTimingsArray&&utcTimingsArray.forEach((function(utcTiming){var entry=new _voUTCTiming2.default;utcTiming.hasOwnProperty(_streamingConstantsConstants2.default.SCHEME_ID_URI)&&(entry.schemeIdUri=utcTiming.schemeIdUri,utcTiming.hasOwnProperty(_constantsDashConstants2.default.VALUE)&&(entry.value=utcTiming.value.toString(),utcTimingEntries.push(entry)))})),utcTimingEntries},getBaseURLsFromElement:getBaseURLsFromElement,getRepresentationSortFunction:getRepresentationSortFunction,getLocation:function getLocation(manifest){if(manifest&&manifest.hasOwnProperty(_streamingConstantsConstants2.default.LOCATION))return manifest.Location=manifest.Location_asArray[0],manifest.Location},getUseCalculatedLiveEdgeTimeForAdaptation:function getUseCalculatedLiveEdgeTimeForAdaptation(voAdaptation){var realRepresentation=getRealAdaptationFor(voAdaptation).Representation_asArray[0],segmentInfo=void 0;return realRepresentation.hasOwnProperty(_constantsDashConstants2.default.SEGMENT_LIST)?!(segmentInfo=realRepresentation.SegmentList).hasOwnProperty(_constantsDashConstants2.default.SEGMENT_TIMELINE)||isLastRepeatAttributeValid(segmentInfo.SegmentTimeline):!(!realRepresentation.hasOwnProperty(_constantsDashConstants2.default.SEGMENT_TEMPLATE)||!(segmentInfo=realRepresentation.SegmentTemplate).hasOwnProperty(_constantsDashConstants2.default.SEGMENT_TIMELINE))&&isLastRepeatAttributeValid(segmentInfo.SegmentTimeline)}},function setup(){logger=(0,_coreDebug2.default)(context).getInstance().getLogger(instance)}(),instance}DashManifestModel.__dashjs_factory_name="DashManifestModel",exports.default=_coreFactoryMaker2.default.getSingletonFactory(DashManifestModel),module.exports=exports.default},1568:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function AdaptationSet(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AdaptationSet),this.period=null,this.index=-1,this.type=null},module.exports=exports.default},1569:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Period=function Period(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Period),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null};Period.DEFAULT_ID="defaultId",exports.default=Period,module.exports=exports.default},1570:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function Mpd(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Mpd),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN},module.exports=exports.default},1571:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function EventStream(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EventStream),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},module.exports=exports.default},1572:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _streamingVoMetricsHTTPRequest=__webpack_require__(1373),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366)),_streamingConstantsMetricsConstants2=_interopRequireDefault(__webpack_require__(1382)),_utilsRound102=_interopRequireDefault(__webpack_require__(1573));function DashMetrics(config){var dashManifestModel=(config=config||{}).dashManifestModel,manifestModel=config.manifestModel;function getPeriod(periodId){var manifest=manifestModel.getValue();return manifest?manifest.Period_asArray[periodId]:-1}function getLatestBufferLevelVO(metrics){return getCurrent(metrics,_streamingConstantsMetricsConstants2.default.BUFFER_LEVEL)}function getCurrentHttpRequest(metrics){if(!metrics)return null;var httpList=metrics.HttpList,currentHttpList=null,httpListLastIndex=void 0;if(!httpList||httpList.length<=0)return null;for(httpListLastIndex=httpList.length-1;httpListLastIndex>=0;){if(httpList[httpListLastIndex].responsecode){currentHttpList=httpList[httpListLastIndex];break}httpListLastIndex--}return currentHttpList}function getHttpRequests(metrics){return metrics&&metrics.HttpList?metrics.HttpList:[]}function getCurrent(metrics,metricName){if(!metrics)return null;var list=metrics[metricName];return!list||list.length<=0?null:list[list.length-1]}function parseResponseHeaders(headerStr){var headers={};if(!headerStr)return headers;for(var headerPairs=headerStr.trim().split("\r\n"),i=0,ilen=headerPairs.length;i<ilen;i++){var headerPair=headerPairs[i],index=headerPair.indexOf(": ");index>0&&(headers[headerPair.substring(0,index)]=headerPair.substring(index+2))}return headers}function findRepresentation(period,representationId,returnIndex){var adaptationSetArray=void 0,representation=void 0,representationArray=void 0,adaptationSetArrayIndex=void 0,representationArrayIndex=void 0;if(period)for(adaptationSetArray=period.AdaptationSet_asArray,adaptationSetArrayIndex=0;adaptationSetArrayIndex<adaptationSetArray.length;adaptationSetArrayIndex+=1)for(representationArray=adaptationSetArray[adaptationSetArrayIndex].Representation_asArray,representationArrayIndex=0;representationArrayIndex<representationArray.length;representationArrayIndex+=1)if(representationId===(representation=representationArray[representationArrayIndex]).id)return returnIndex?representationArrayIndex:representation;return null}function adaptationIsType(adaptation,bufferType){return dashManifestModel.getIsTypeOf(adaptation,bufferType)}return{getBandwidthForRepresentation:function getBandwidthForRepresentation(representationId,periodId){var representation;return null===(representation=findRepresentation(getPeriod(periodId),representationId))?null:representation.bandwidth},getIndexForRepresentation:function getIndexForRepresentation(representationId,periodIdx){return function findRepresentationIndex(period,representationId){var index=findRepresentation(period,representationId,!0);if(null!==index)return index;return-1}(getPeriod(periodIdx),representationId)},getMaxIndexForBufferType:function getMaxIndexForBufferType(bufferType,periodIdx){return function findMaxBufferIndex(period,bufferType){var adaptationSetArray,adaptationSet=void 0,representationArray=void 0,adaptationSetArrayIndex=void 0;if(!period||!bufferType)return-1;for(adaptationSetArray=period.AdaptationSet_asArray,adaptationSetArrayIndex=0;adaptationSetArrayIndex<adaptationSetArray.length;adaptationSetArrayIndex+=1)if(adaptationSet=adaptationSetArray[adaptationSetArrayIndex],representationArray=adaptationSet.Representation_asArray,adaptationIsType(adaptationSet,bufferType))return representationArray.length;return-1}(getPeriod(periodIdx),bufferType)},getCurrentRepresentationSwitch:function getCurrentRepresentationSwitch(metrics){return getCurrent(metrics,_streamingConstantsMetricsConstants2.default.TRACK_SWITCH)},getLatestBufferLevelVO:getLatestBufferLevelVO,getCurrentBufferLevel:function getCurrentBufferLevel(metrics){var vo=getLatestBufferLevelVO(metrics);return vo?_utilsRound102.default.round10(vo.level/1e3,-3):0},getCurrentHttpRequest:getCurrentHttpRequest,getHttpRequests:getHttpRequests,getCurrentDroppedFrames:function getCurrentDroppedFrames(metrics){return getCurrent(metrics,_streamingConstantsMetricsConstants2.default.DROPPED_FRAMES)},getCurrentSchedulingInfo:function getCurrentSchedulingInfo(metrics){return getCurrent(metrics,_streamingConstantsMetricsConstants2.default.SCHEDULING_INFO)},getCurrentDVRInfo:function getCurrentDVRInfo(metrics){return getCurrent(metrics,_streamingConstantsMetricsConstants2.default.DVR_INFO)},getCurrentManifestUpdate:function getCurrentManifestUpdate(metrics){return getCurrent(metrics,_streamingConstantsMetricsConstants2.default.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function getLatestFragmentRequestHeaderValueByID(metrics,id){var headers={},httpRequest=getCurrentHttpRequest(metrics);return httpRequest&&(headers=parseResponseHeaders(httpRequest._responseHeaders)),void 0===headers[id]?null:headers[id]},getLatestMPDRequestHeaderValueByID:function getLatestMPDRequestHeaderValueByID(metrics,id){var httpRequestList,headers={},httpRequest=void 0,i=void 0;for(i=(httpRequestList=getHttpRequests(metrics)).length-1;i>=0;i--)if((httpRequest=httpRequestList[i]).type===_streamingVoMetricsHTTPRequest.HTTPRequest.MPD_TYPE){headers=parseResponseHeaders(httpRequest._responseHeaders);break}return void 0===headers[id]?null:headers[id]},getRequestsQueue:function getRequestsQueue(metrics){return metrics?metrics.RequestsQueue:null}}}DashMetrics.__dashjs_factory_name="DashMetrics",exports.default=_coreFactoryMaker2.default.getSingletonFactory(DashMetrics),module.exports=exports.default},1573:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var Round10=function(){function Round10(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Round10)}return _createClass(Round10,null,[{key:"round10",value:function round10(value,exp){return function _decimalAdjust(type,value,exp){if(void 0===exp||0==+exp)return Math[type](value);if(exp=+exp,null===(value=+value)||isNaN(value)||!("number"==typeof exp&&exp%1==0))return NaN;return value=value.toString().split("e"),+((value=(value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp)))).toString().split("e"))[0]+"e"+(value[1]?+value[1]+exp:exp))}("round",value,exp)}}]),Round10}();exports.default=Round10,module.exports=exports.default},1574:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _coreEventBus2=_interopRequireDefault(__webpack_require__(1368)),_coreEventsEvents2=_interopRequireDefault(__webpack_require__(1370)),_coreFactoryMaker2=_interopRequireDefault(__webpack_require__(1366));function TimelineConverter(){var context=this.context,eventBus=(0,_coreEventBus2.default)(context).getInstance(),clientServerTimeShift=void 0,isClientServerTimeSyncCompleted=void 0,expectedLiveEdge=void 0;function setClientTimeOffset(value){clientServerTimeShift=value}function calcAvailabilityTimeFromPresentationTime(presentationTime,mpd,isDynamic,calculateEnd){return calculateEnd?isDynamic&&mpd.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(mpd.availabilityStartTime.getTime()+1e3*(presentationTime+mpd.timeShiftBufferDepth)):mpd.availabilityEndTime:isDynamic?new Date(mpd.availabilityStartTime.getTime()+1e3*(presentationTime-clientServerTimeShift)):mpd.availabilityStartTime}function calcPresentationTimeFromWallTime(wallTime,period){return(wallTime.getTime()-period.mpd.availabilityStartTime.getTime()+1e3*clientServerTimeShift)/1e3}function onTimeSyncComplete(e){isClientServerTimeSyncCompleted||void 0!==e.offset&&(setClientTimeOffset(e.offset/1e3),isClientServerTimeSyncCompleted=!0)}function resetInitialSettings(){clientServerTimeShift=0,isClientServerTimeSyncCompleted=!1,expectedLiveEdge=NaN}return{initialize:function initialize(){resetInitialSettings(),eventBus.on(_coreEventsEvents2.default.TIME_SYNCHRONIZATION_COMPLETED,onTimeSyncComplete,this)},isTimeSyncCompleted:function isTimeSyncCompleted(){return isClientServerTimeSyncCompleted},setTimeSyncCompleted:function setTimeSyncCompleted(value){isClientServerTimeSyncCompleted=value},getClientTimeOffset:function getClientTimeOffset(){return clientServerTimeShift},setClientTimeOffset:setClientTimeOffset,getExpectedLiveEdge:function getExpectedLiveEdge(){return expectedLiveEdge},setExpectedLiveEdge:function setExpectedLiveEdge(value){expectedLiveEdge=value},calcAvailabilityStartTimeFromPresentationTime:function calcAvailabilityStartTimeFromPresentationTime(presentationTime,mpd,isDynamic){return calcAvailabilityTimeFromPresentationTime.call(this,presentationTime,mpd,isDynamic)},calcAvailabilityEndTimeFromPresentationTime:function calcAvailabilityEndTimeFromPresentationTime(presentationTime,mpd,isDynamic){return calcAvailabilityTimeFromPresentationTime.call(this,presentationTime,mpd,isDynamic,!0)},calcPresentationTimeFromWallTime:calcPresentationTimeFromWallTime,calcPresentationTimeFromMediaTime:function calcPresentationTimeFromMediaTime(mediaTime,representation){return mediaTime+(representation.adaptation.period.start-representation.presentationTimeOffset)},calcPeriodRelativeTimeFromMpdRelativeTime:function calcPeriodRelativeTimeFromMpdRelativeTime(representation,mpdRelativeTime){return mpdRelativeTime-representation.adaptation.period.start},calcMediaTimeFromPresentationTime:function calcMediaTimeFromPresentationTime(presentationTime,representation){return presentationTime-representation.adaptation.period.start+representation.presentationTimeOffset},calcSegmentAvailabilityRange:function calcSegmentAvailabilityRange(voRepresentation,isDynamic){var voPeriod=voRepresentation.adaptation.period,range={start:voPeriod.start,end:voPeriod.start+voPeriod.duration};if(!isDynamic)return range;if(!isClientServerTimeSyncCompleted&&voRepresentation.segmentAvailabilityRange)return voRepresentation.segmentAvailabilityRange;var d=voRepresentation.segmentDuration||(voRepresentation.segments&&voRepresentation.segments.length?voRepresentation.segments[voRepresentation.segments.length-1].duration:0),now=calcPresentationTimeFromWallTime(new Date,voPeriod),periodEnd=voPeriod.start+voPeriod.duration;range.start=Math.max(now-voPeriod.mpd.timeShiftBufferDepth,voPeriod.start);var endOffset=void 0!==voRepresentation.availabilityTimeOffset&&voRepresentation.availabilityTimeOffset<d?d-voRepresentation.availabilityTimeOffset:d;return range.end=now>=periodEnd&&now-endOffset<periodEnd?periodEnd:now-endOffset,range},calcWallTimeForSegment:function calcWallTimeForSegment(segment,isDynamic){var suggestedPresentationDelay=void 0,displayStartTime=void 0,wallTime=void 0;return isDynamic&&(suggestedPresentationDelay=segment.representation.adaptation.period.mpd.suggestedPresentationDelay,displayStartTime=segment.presentationStartTime+suggestedPresentationDelay,wallTime=new Date(segment.availabilityStartTime.getTime()+1e3*displayStartTime)),wallTime},calcMSETimeOffset:function calcMSETimeOffset(representation){var presentationOffset=representation.presentationTimeOffset;return representation.adaptation.period.start-presentationOffset},reset:function reset(){eventBus.off(_coreEventsEvents2.default.TIME_SYNCHRONIZATION_COMPLETED,onTimeSyncComplete,this),resetInitialSettings()}}}TimelineConverter.__dashjs_factory_name="TimelineConverter",exports.default=_coreFactoryMaker2.default.getSingletonFactory(TimelineConverter),module.exports=exports.default},1575:function(module,exports,__webpack_require__){"use strict";var T,encodeArray,R,decodeArray,ASCII,UTF8={encode:function(s){for(var u=[],i=0;i<s.length;++i){var c=s.charCodeAt(i);c<128?u.push(c):c<2048?(u.push(192|c>>6),u.push(128|63&c)):c<65536?(u.push(224|c>>12),u.push(128|63&c>>6),u.push(128|63&c)):(u.push(240|c>>18),u.push(128|63&c>>12),u.push(128|63&c>>6),u.push(128|63&c))}return u},decode:function(u){for(var a=[],i=0;i<u.length;){var v=u[i++];v<128||(v<224?(v=(31&v)<<6,v|=63&u[i++]):v<240?(v=(15&v)<<12,v|=(63&u[i++])<<6,v|=63&u[i++]):(v=(7&v)<<18,v|=(63&u[i++])<<12,v|=(63&u[i++])<<6,v|=63&u[i++])),a.push(String.fromCharCode(v))}return a.join("")}},BASE64={};T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",encodeArray=function encodeArray(u){for(var i=0,a=[],n=0|u.length/3;0<n--;){var v=(u[i]<<16)+(u[i+1]<<8)+u[i+2];i+=3,a.push(T.charAt(63&v>>18)),a.push(T.charAt(63&v>>12)),a.push(T.charAt(63&v>>6)),a.push(T.charAt(63&v))}return 2==u.length-i?(v=(u[i]<<16)+(u[i+1]<<8),a.push(T.charAt(63&v>>18)),a.push(T.charAt(63&v>>12)),a.push(T.charAt(63&v>>6)),a.push("=")):1==u.length-i&&(v=u[i]<<16,a.push(T.charAt(63&v>>18)),a.push(T.charAt(63&v>>12)),a.push("==")),a.join("")},R=function(){for(var a=[],i=0;i<T.length;++i)a[T.charCodeAt(i)]=i;return a["=".charCodeAt(0)]=0,a}(),decodeArray=function decodeArray(s){for(var i=0,u=[],n=0|s.length/4;0<n--;){var v=(R[s.charCodeAt(i)]<<18)+(R[s.charCodeAt(i+1)]<<12)+(R[s.charCodeAt(i+2)]<<6)+R[s.charCodeAt(i+3)];u.push(255&v>>16),u.push(255&v>>8),u.push(255&v),i+=4}return u&&("="==s.charAt(i-2)?(u.pop(),u.pop()):"="==s.charAt(i-1)&&u.pop()),u},ASCII={encode:function(s){for(var u=[],i=0;i<s.length;++i)u.push(s.charCodeAt(i));return u},decode:function(u){for(var i=0;i<s.length;++i)a[i]=String.fromCharCode(a[i]);return a.join("")}},BASE64.decodeArray=function(s){var u=decodeArray(s);return new Uint8Array(u)},BASE64.encodeASCII=function(s){var u=ASCII.encode(s);return encodeArray(u)},BASE64.decodeASCII=function(s){var a=decodeArray(s);return ASCII.decode(a)},BASE64.encode=function(s){var u=UTF8.encode(s);return encodeArray(u)},BASE64.decode=function(s){var u=decodeArray(s);return UTF8.decode(u)},exports.decode=BASE64.decode,exports.decodeArray=BASE64.decodeArray,exports.encode=BASE64.encode,exports.encodeASCII=BASE64.encodeASCII},1576:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _utilsDVBErrorsTranslator2=_interopRequireDefault(__webpack_require__(1577)),_MetricsReportingEvents2=_interopRequireDefault(__webpack_require__(1399)),_controllersMetricsCollectionController2=_interopRequireDefault(__webpack_require__(1579)),_metricsMetricsHandlerFactory2=_interopRequireDefault(__webpack_require__(1449)),_reportingReportingFactory2=_interopRequireDefault(__webpack_require__(1448));function MetricsReporting(){var context=this.context;return{createMetricsReporting:function createMetricsReporting(config){return(0,_utilsDVBErrorsTranslator2.default)(context).getInstance({eventBus:config.eventBus,metricsModel:config.metricsModel,metricsConstants:config.metricsConstants,events:config.events}),(0,_controllersMetricsCollectionController2.default)(context).create(config)},getReportingFactory:function getReportingFactory(){return(0,_reportingReportingFactory2.default)(context).getInstance()},getMetricsHandlerFactory:function getMetricsHandlerFactory(){return(0,_metricsMetricsHandlerFactory2.default)(context).getInstance()}}}MetricsReporting.__dashjs_factory_name="MetricsReporting";var factory=dashjs.FactoryMaker.getClassFactory(MetricsReporting);factory.events=_MetricsReportingEvents2.default,dashjs.FactoryMaker.updateClassFactory(MetricsReporting.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1577:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _voDVBErrors2=_interopRequireDefault(__webpack_require__(1578)),_MetricsReportingEvents2=_interopRequireDefault(__webpack_require__(1399));function DVBErrorsTranslator(config){var instance=void 0,mpd=void 0,eventBus=(config=config||{}).eventBus,metricModel=config.metricsModel,metricsConstants=config.metricsConstants,Events=config.events;function report(vo){var o=new _voDVBErrors2.default;if(mpd){for(var key in vo)vo.hasOwnProperty(key)&&(o[key]=vo[key]);o.mpdurl||(o.mpdurl=mpd.originalUrl||mpd.url),o.terror||(o.terror=new Date),metricModel.addDVBErrors(o)}}function onManifestUpdate(e){e.error||(mpd=e.manifest)}function onServiceLocationChanged(e){report({errorcode:_voDVBErrors2.default.BASE_URL_CHANGED,servicelocation:e.entry})}function onBecameReporter(){report({errorcode:_voDVBErrors2.default.BECAME_REPORTER})}function onMetricEvent(e){switch(e.metric){case metricsConstants.HTTP_REQUEST:!function handleHttpMetric(vo){(0===vo.responsecode||vo.responsecode>=400||vo.responsecode<100||vo.responsecode>=600)&&report({errorcode:vo.responsecode||_voDVBErrors2.default.CONNECTION_ERROR,url:vo.url,terror:vo.tresponse,servicelocation:vo._serviceLocation})}(e.value)}}function onPlaybackError(e){var errorcode=void 0;switch(e.error?e.error.code:0){case MediaError.MEDIA_ERR_NETWORK:errorcode=_voDVBErrors2.default.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:errorcode=_voDVBErrors2.default.CORRUPT_MEDIA_OTHER;break;default:return}report({errorcode:errorcode})}function initialise(){eventBus.on(Events.MANIFEST_UPDATED,onManifestUpdate,instance),eventBus.on(Events.SERVICE_LOCATION_BLACKLIST_CHANGED,onServiceLocationChanged,instance),eventBus.on(Events.METRIC_ADDED,onMetricEvent,instance),eventBus.on(Events.METRIC_UPDATED,onMetricEvent,instance),eventBus.on(Events.PLAYBACK_ERROR,onPlaybackError,instance),eventBus.on(_MetricsReportingEvents2.default.BECAME_REPORTING_PLAYER,onBecameReporter,instance)}return instance={initialise:initialise,reset:function reset(){eventBus.off(Events.MANIFEST_UPDATED,onManifestUpdate,instance),eventBus.off(Events.SERVICE_LOCATION_BLACKLIST_CHANGED,onServiceLocationChanged,instance),eventBus.off(Events.METRIC_ADDED,onMetricEvent,instance),eventBus.off(Events.METRIC_UPDATED,onMetricEvent,instance),eventBus.off(Events.PLAYBACK_ERROR,onPlaybackError,instance),eventBus.off(_MetricsReportingEvents2.default.BECAME_REPORTING_PLAYER,onBecameReporter,instance)}},initialise(),instance}DVBErrorsTranslator.__dashjs_factory_name="DVBErrorsTranslator",exports.default=dashjs.FactoryMaker.getSingletonFactory(DVBErrorsTranslator),module.exports=exports.default},1578:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DVBErrors=function DVBErrors(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DVBErrors),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};DVBErrors.SSL_CONNECTION_FAILED_PREFIX="SSL",DVBErrors.DNS_RESOLUTION_FAILED="C00",DVBErrors.HOST_UNREACHABLE="C01",DVBErrors.CONNECTION_REFUSED="C02",DVBErrors.CONNECTION_ERROR="C03",DVBErrors.CORRUPT_MEDIA_ISOBMFF="M00",DVBErrors.CORRUPT_MEDIA_OTHER="M01",DVBErrors.BASE_URL_CHANGED="F00",DVBErrors.BECAME_REPORTER="S00",exports.default=DVBErrors,module.exports=exports.default},1579:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _MetricsController2=_interopRequireDefault(__webpack_require__(1580)),_utilsManifestParsing2=_interopRequireDefault(__webpack_require__(1591)),_MetricsReportingEvents2=_interopRequireDefault(__webpack_require__(1399));function MetricsCollectionController(config){config=config||{};var metricsControllers={},context=this.context,eventBus=config.eventBus,events=config.events;function update(e){if(!e.error){var controllersToRemove=Object.keys(metricsControllers);(0,_utilsManifestParsing2.default)(context).getInstance({dashManifestModel:config.dashManifestModel,constants:config.constants}).getMetrics(e.manifest).forEach((function(m){var key=JSON.stringify(m);if(metricsControllers.hasOwnProperty(key))controllersToRemove.splice(key,1);else try{var controller=(0,_MetricsController2.default)(context).create(config);controller.initialize(m),metricsControllers[key]=controller}catch(e){}})),controllersToRemove.forEach((function(c){metricsControllers[c].reset(),delete metricsControllers[c]})),eventBus.trigger(_MetricsReportingEvents2.default.METRICS_INITIALISATION_COMPLETE)}}function resetMetricsControllers(){Object.keys(metricsControllers).forEach((function(key){metricsControllers[key].reset()})),metricsControllers={}}return function setup(){eventBus.on(events.MANIFEST_UPDATED,update),eventBus.on(events.STREAM_TEARDOWN_COMPLETE,resetMetricsControllers)}(),{reset:function reset(){eventBus.off(events.MANIFEST_UPDATED,update),eventBus.off(events.STREAM_TEARDOWN_COMPLETE,resetMetricsControllers)}}}MetricsCollectionController.__dashjs_factory_name="MetricsCollectionController",exports.default=dashjs.FactoryMaker.getClassFactory(MetricsCollectionController),module.exports=exports.default},1580:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _RangeController2=_interopRequireDefault(__webpack_require__(1581)),_ReportingController2=_interopRequireDefault(__webpack_require__(1582)),_MetricsHandlersController2=_interopRequireDefault(__webpack_require__(1586));function MetricsController(config){config=config||{};var metricsHandlersController=void 0,reportingController=void 0,rangeController=void 0,context=this.context;function reset(){metricsHandlersController&&metricsHandlersController.reset(),reportingController&&reportingController.reset(),rangeController&&rangeController.reset()}return{initialize:function initialize(metricsEntry){try{(rangeController=(0,_RangeController2.default)(context).create({mediaElement:config.mediaElement})).initialize(metricsEntry.Range),(reportingController=(0,_ReportingController2.default)(context).create({debug:config.debug,metricsConstants:config.metricsConstants})).initialize(metricsEntry.Reporting,rangeController),(metricsHandlersController=(0,_MetricsHandlersController2.default)(context).create({debug:config.debug,eventBus:config.eventBus,metricsConstants:config.metricsConstants,events:config.events})).initialize(metricsEntry.metrics,reportingController)}catch(e){throw reset(),e}},reset:reset}}MetricsController.__dashjs_factory_name="MetricsController",exports.default=dashjs.FactoryMaker.getClassFactory(MetricsController),module.exports=exports.default},1581:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _utilsCustomTimeRanges2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1424));function RangeController(config){config=config||{};var instance,useWallClockTime=!1,context=this.context,ranges=void 0,mediaElement=config.mediaElement;return instance={initialize:function initialize(rs){rs&&rs.length&&(rs.forEach((function(r){var start=r.starttime,end=start+r.duration;ranges.add(start,end)})),useWallClockTime=!!rs[0]._useWallClockTime)},reset:function reset(){ranges.clear()},isEnabled:function isEnabled(){var time,numRanges=ranges.length;if(!numRanges)return!0;time=useWallClockTime?(new Date).getTime()/1e3:mediaElement.currentTime;for(var i=0;i<numRanges;i+=1){var start=ranges.start(i),end=ranges.end(i);if(start<=time&&time<end)return!0}return!1}},function setup(){ranges=(0,_utilsCustomTimeRanges2.default)(context).create()}(),instance}RangeController.__dashjs_factory_name="RangeController",exports.default=dashjs.FactoryMaker.getClassFactory(RangeController),module.exports=exports.default},1582:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _reportingReportingFactory2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1448));function ReportingController(config){var reporters=[],reportingFactory=(0,_reportingReportingFactory2.default)(this.context).getInstance(config);return{initialize:function initialize(reporting,rangeController){reporting.some((function(r){var reporter=reportingFactory.create(r,rangeController);if(reporter)return reporters.push(reporter),!0}))},reset:function reset(){reporters.forEach((function(r){return r.reset()})),reporters=[]},report:function report(type,vos){reporters.forEach((function(r){return r.report(type,vos)}))}}}ReportingController.__dashjs_factory_name="ReportingController",exports.default=dashjs.FactoryMaker.getClassFactory(ReportingController),module.exports=exports.default},1583:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _utilsMetricSerialiser2=_interopRequireDefault(__webpack_require__(1584)),_utilsRNG2=_interopRequireDefault(__webpack_require__(1585));function DVBReporting(config){config=config||{};var instance,context=this.context,metricSerialiser=void 0,randomNumberGenerator=void 0,reportingPlayerStatusDecided=void 0,isReportingPlayer=void 0,reportingUrl=void 0,rangeController=void 0,pendingRequests=[],metricsConstants=config.metricsConstants;function resetInitialSettings(){reportingPlayerStatusDecided=!1,isReportingPlayer=!1,reportingUrl=null,rangeController=null}return instance={report:function report(type,vos){Array.isArray(vos)||(vos=[vos]),isReportingPlayer&&rangeController.isEnabled()&&vos.forEach((function(vo){var url=metricSerialiser.serialise(vo);type!==metricsConstants.DVB_ERRORS&&(url="metricname="+type+"&"+url),function doGetRequest(url,successCB,failureCB){var req=new XMLHttpRequest,oncomplete=function oncomplete(){var reqIndex=pendingRequests.indexOf(req);-1!==reqIndex&&(pendingRequests.splice(reqIndex,1),req.status>=200&&req.status<300?successCB&&successCB():failureCB&&failureCB())};pendingRequests.push(req);try{req.open("GET",url),req.onloadend=oncomplete,req.onerror=oncomplete,req.send()}catch(e){req.onerror()}}(url=reportingUrl+"?"+url,null,(function(){isReportingPlayer=!1}))}))},initialize:function initialize(entry,rc){var probability=void 0;if(rangeController=rc,!(reportingUrl=entry["dvb:reportingUrl"]))throw new Error("required parameter missing (dvb:reportingUrl)");reportingPlayerStatusDecided||((probability=entry["dvb:probability"]||entry["dvb:priority"]||0)&&(1e3===probability||probability/1e3>=randomNumberGenerator.random())&&(isReportingPlayer=!0),reportingPlayerStatusDecided=!0)},reset:function reset(){resetInitialSettings()}},function setup(){metricSerialiser=(0,_utilsMetricSerialiser2.default)(context).getInstance(),randomNumberGenerator=(0,_utilsRNG2.default)(context).getInstance(),resetInitialSettings()}(),instance}DVBReporting.__dashjs_factory_name="DVBReporting",exports.default=dashjs.FactoryMaker.getClassFactory(DVBReporting),module.exports=exports.default},1584:function(module,exports,__webpack_require__){"use strict";function MetricSerialiser(){return{serialise:function serialise(metric){var pairs=[],obj=[],key=void 0,value=void 0;for(key in metric)if(metric.hasOwnProperty(key)&&0!==key.indexOf("_")){if(null==(value=metric[key])&&(value=""),Array.isArray(value)){if(!value.length)continue;obj=[],value.forEach((function(v){var isBuiltIn="Object"!==Object.prototype.toString.call(v).slice(8,-1);obj.push(isBuiltIn?v:serialise(v))})),value=obj.map(encodeURIComponent).join(",")}else"string"==typeof value?value=encodeURIComponent(value):value instanceof Date?value=value.toISOString():"number"==typeof value&&(value=Math.round(value));pairs.push(key+"="+value)}return pairs.join("&")}}}Object.defineProperty(exports,"__esModule",{value:!0}),MetricSerialiser.__dashjs_factory_name="MetricSerialiser",exports.default=dashjs.FactoryMaker.getSingletonFactory(MetricSerialiser),module.exports=exports.default},1585:function(module,exports,__webpack_require__){"use strict";function RNG(){var instance,crypto=window.crypto||window.msCrypto,ArrayType=Uint32Array,MAX_VALUE=Math.pow(2,8*ArrayType.BYTES_PER_ELEMENT)-1,randomNumbers=void 0,index=void 0;function initialise(){crypto&&(randomNumbers||(randomNumbers=new ArrayType(10)),crypto.getRandomValues(randomNumbers),index=0)}return instance={random:function rand(min,max){var r=void 0;return min||(min=0),max||(max=1),crypto?(index===randomNumbers.length&&initialise(),r=randomNumbers[index]/MAX_VALUE,index+=1):r=Math.random(),r*(max-min)+min}},initialise(),instance}Object.defineProperty(exports,"__esModule",{value:!0}),RNG.__dashjs_factory_name="RNG",exports.default=dashjs.FactoryMaker.getSingletonFactory(RNG),module.exports=exports.default},1586:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _metricsMetricsHandlerFactory2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1449));function MetricsHandlersController(config){config=config||{};var handlers=[],instance=void 0,context=this.context,eventBus=config.eventBus,Events=config.events,metricsHandlerFactory=(0,_metricsMetricsHandlerFactory2.default)(context).getInstance({debug:config.debug,eventBus:config.eventBus,metricsConstants:config.metricsConstants});function handle(e){handlers.forEach((function(handler){handler.handleNewMetric(e.metric,e.value,e.mediaType)}))}return instance={initialize:function initialize(metrics,reportingController){metrics.split(",").forEach((function(m,midx,ms){var handler;if(-1!==m.indexOf("(")&&-1===m.indexOf(")")){var nextm=ms[midx+1];nextm&&-1===nextm.indexOf("(")&&-1!==nextm.indexOf(")")&&(m+=","+nextm,delete ms[midx+1])}(handler=metricsHandlerFactory.create(m,reportingController))&&handlers.push(handler)})),eventBus.on(Events.METRIC_ADDED,handle,instance),eventBus.on(Events.METRIC_UPDATED,handle,instance)},reset:function reset(){eventBus.off(Events.METRIC_ADDED,handle,instance),eventBus.off(Events.METRIC_UPDATED,handle,instance),handlers.forEach((function(handler){return handler.reset()})),handlers=[]}}}MetricsHandlersController.__dashjs_factory_name="MetricsHandlersController",exports.default=dashjs.FactoryMaker.getClassFactory(MetricsHandlersController),module.exports=exports.default},1587:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _utilsHandlerHelpers2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1450));function BufferLevelHandler(config){config=config||{};var reportingController=void 0,n=void 0,name=void 0,interval=void 0,lastReportedTime=void 0,context=this.context,handlerHelpers=(0,_utilsHandlerHelpers2.default)(context).getInstance(),storedVOs=[],metricsConstants=config.metricsConstants;function intervalCallback(){var vo=function getLowestBufferLevelVO(){try{return Object.keys(storedVOs).map((function(key){return storedVOs[key]})).reduce((function(a,b){return a.level<b.level?a:b}))}catch(e){return}}();vo&&lastReportedTime!==vo.t&&(lastReportedTime=vo.t,reportingController.report(name,vo))}return{initialize:function initialize(basename,rc,n_ms){rc&&(n=handlerHelpers.validateN(n_ms),reportingController=rc,name=handlerHelpers.reconstructFullMetricName(basename,n_ms),interval=setInterval(intervalCallback,n))},reset:function reset(){clearInterval(interval),interval=null,n=0,reportingController=null,lastReportedTime=null},handleNewMetric:function handleNewMetric(metric,vo,type){metric===metricsConstants.BUFFER_LEVEL&&(storedVOs[type]=vo)}}}BufferLevelHandler.__dashjs_factory_name="BufferLevelHandler",exports.default=dashjs.FactoryMaker.getClassFactory(BufferLevelHandler),module.exports=exports.default},1588:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _MetricsReportingEvents2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1399));exports.default=dashjs.FactoryMaker.getClassFactory((function DVBErrorsHandler(config){var reportingController=void 0,eventBus=(config=config||{}).eventBus,metricsConstants=config.metricsConstants;function onInitialisationComplete(){eventBus.off(_MetricsReportingEvents2.default.METRICS_INITIALISATION_COMPLETE,onInitialisationComplete,this),eventBus.trigger(_MetricsReportingEvents2.default.BECAME_REPORTING_PLAYER)}return{initialize:function initialize(unused,rc){rc&&(reportingController=rc,eventBus.on(_MetricsReportingEvents2.default.METRICS_INITIALISATION_COMPLETE,onInitialisationComplete,this))},reset:function reset(){reportingController=null},handleNewMetric:function handleNewMetric(metric,vo){metric===metricsConstants.DVB_ERRORS&&reportingController&&reportingController.report(metric,vo)}}})),module.exports=exports.default},1589:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _utilsHandlerHelpers2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1450));function HttpListHandler(config){config=config||{};var reportingController=void 0,n=void 0,type=void 0,name=void 0,interval=void 0,storedVos=[],handlerHelpers=(0,_utilsHandlerHelpers2.default)(this.context).getInstance(),metricsConstants=config.metricsConstants;function intervalCallback(){var vos=storedVos;vos.length&&reportingController&&reportingController.report(name,vos),storedVos=[]}return{initialize:function initialize(basename,rc,n_ms,requestType){rc&&(n=handlerHelpers.validateN(n_ms),reportingController=rc,requestType&&requestType.length&&(type=requestType),name=handlerHelpers.reconstructFullMetricName(basename,n_ms,requestType),interval=setInterval(intervalCallback,n))},reset:function reset(){clearInterval(interval),interval=null,n=null,type=null,storedVos=[],reportingController=null},handleNewMetric:function handleNewMetric(metric,vo){metric===metricsConstants.HTTP_REQUEST&&(type&&type!==vo.type||storedVos.push(vo))}}}HttpListHandler.__dashjs_factory_name="HttpListHandler",exports.default=dashjs.FactoryMaker.getClassFactory(HttpListHandler),module.exports=exports.default},1590:function(module,exports,__webpack_require__){"use strict";function GenericMetricHandler(){var metricName=void 0,reportingController=void 0;return{initialize:function initialize(name,rc){metricName=name,reportingController=rc},reset:function reset(){reportingController=null,metricName=void 0},handleNewMetric:function handleNewMetric(metric,vo){metric===metricName&&reportingController&&reportingController.report(metricName,vo)}}}Object.defineProperty(exports,"__esModule",{value:!0}),GenericMetricHandler.__dashjs_factory_name="GenericMetricHandler",exports.default=dashjs.FactoryMaker.getClassFactory(GenericMetricHandler),module.exports=exports.default},1591:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _voMetrics2=_interopRequireDefault(__webpack_require__(1592)),_voRange2=_interopRequireDefault(__webpack_require__(1593)),_voReporting2=_interopRequireDefault(__webpack_require__(1594));function ManifestParsing(config){var dashManifestModel=(config=config||{}).dashManifestModel,constants=config.constants;return{getMetrics:function getMetrics(manifest){var metrics=[];return manifest.Metrics_asArray&&manifest.Metrics_asArray.forEach((function(metric){var metricEntry=new _voMetrics2.default,isDynamic=dashManifestModel.getIsDynamic(manifest);metric.hasOwnProperty("metrics")&&(metricEntry.metrics=metric.metrics,metric.Range_asArray&&metric.Range_asArray.forEach((function(range){var rangeEntry=new _voRange2.default;rangeEntry.starttime=function getMetricsRangeStartTime(manifest,dynamic,range){var voPeriods,reportingStartTime,mpd=dashManifestModel.getMpd(manifest),presentationStartTime=0;return dynamic?presentationStartTime=mpd.availabilityStartTime.getTime()/1e3:(voPeriods=this.getRegularPeriods(mpd)).length&&(presentationStartTime=voPeriods[0].start),reportingStartTime=presentationStartTime,range&&range.hasOwnProperty(constants.START_TIME)&&(reportingStartTime+=range.starttime),reportingStartTime}(manifest,isDynamic,range),range.hasOwnProperty("duration")?rangeEntry.duration=range.duration:rangeEntry.duration=dashManifestModel.getDuration(manifest),rangeEntry._useWallClockTime=isDynamic,metricEntry.Range.push(rangeEntry)})),metric.Reporting_asArray&&(metric.Reporting_asArray.forEach((function(reporting){var reportingEntry=new _voReporting2.default;if(reporting.hasOwnProperty(constants.SCHEME_ID_URI)){for(var prop in reportingEntry.schemeIdUri=reporting.schemeIdUri,reporting)reporting.hasOwnProperty(prop)&&(reportingEntry[prop]=reporting[prop]);metricEntry.Reporting.push(reportingEntry)}})),metrics.push(metricEntry)))})),metrics}}}ManifestParsing.__dashjs_factory_name="ManifestParsing",exports.default=dashjs.FactoryMaker.getSingletonFactory(ManifestParsing),module.exports=exports.default},1592:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function Metrics(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Metrics),this.metrics="",this.Range=[],this.Reporting=[]},module.exports=exports.default},1593:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function Range(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Range),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1},module.exports=exports.default},1594:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function Reporting(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Reporting),this.schemeIdUri="",this.value=""},module.exports=exports.default},1595:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _controllersProtectionController2=_interopRequireDefault(__webpack_require__(1596)),_controllersProtectionKeyController2=_interopRequireDefault(__webpack_require__(1400)),_ProtectionEvents2=_interopRequireDefault(__webpack_require__(1606)),_errorsProtectionErrors2=_interopRequireDefault(__webpack_require__(1389)),_modelsProtectionModel_21Jan20152=_interopRequireDefault(__webpack_require__(1607)),_modelsProtectionModel_3Feb20142=_interopRequireDefault(__webpack_require__(1608)),_modelsProtectionModel_01b2=_interopRequireDefault(__webpack_require__(1609)),APIS_ProtectionModel_01b=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],APIS_ProtectionModel_3Feb2014=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function Protection(){var instance=void 0,context=this.context;function getAPI(videoElement,apis){for(var i=0;i<apis.length;i++){var api=apis[i];if("function"==typeof videoElement[api[Object.keys(api)[0]]])return api}return null}return instance={createProtectionSystem:function createProtectionSystem(config){var controller=null,protectionKeyController=(0,_controllersProtectionKeyController2.default)(context).getInstance();protectionKeyController.setConfig({debug:config.debug,BASE64:config.BASE64}),protectionKeyController.initialize();var protectionModel=function getProtectionModel(config){var debug=config.debug,logger=debug.getLogger(instance),eventBus=config.eventBus,errHandler=config.errHandler,videoElement=config.videoModel?config.videoModel.getElement():null;return videoElement&&void 0===videoElement.onencrypted||videoElement&&void 0===videoElement.mediaKeys?getAPI(videoElement,APIS_ProtectionModel_3Feb2014)?(logger.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),(0,_modelsProtectionModel_3Feb20142.default)(context).create({debug:debug,eventBus:eventBus,events:config.events,api:getAPI(videoElement,APIS_ProtectionModel_3Feb2014)})):getAPI(videoElement,APIS_ProtectionModel_01b)?(logger.info("EME detected on this user agent! (ProtectionModel_01b)"),(0,_modelsProtectionModel_01b2.default)(context).create({debug:debug,eventBus:eventBus,errHandler:errHandler,events:config.events,api:getAPI(videoElement,APIS_ProtectionModel_01b)})):(logger.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(logger.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),(0,_modelsProtectionModel_21Jan20152.default)(context).create({debug:debug,eventBus:eventBus,events:config.events}))}(config);return!controller&&protectionModel&&(controller=(0,_controllersProtectionController2.default)(context).create({protectionModel:protectionModel,protectionKeyController:protectionKeyController,eventBus:config.eventBus,debug:config.debug,events:config.events,BASE64:config.BASE64,constants:config.constants}),config.capabilities.setEncryptedMediaSupported(!0)),controller}}}Protection.__dashjs_factory_name="Protection";var factory=dashjs.FactoryMaker.getClassFactory(Protection);factory.events=_ProtectionEvents2.default,factory.errors=_errorsProtectionErrors2.default,dashjs.FactoryMaker.updateClassFactory(Protection.__dashjs_factory_name,factory),exports.default=factory,module.exports=exports.default},1596:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _CommonEncryption2=_interopRequireDefault(__webpack_require__(1385)),_voMediaCapability2=_interopRequireDefault(__webpack_require__(1597)),_voKeySystemConfiguration2=_interopRequireDefault(__webpack_require__(1415)),_errorsProtectionErrors2=_interopRequireDefault(__webpack_require__(1389)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371));function ProtectionController(config){var protectionKeyController=(config=config||{}).protectionKeyController,protectionModel=config.protectionModel,eventBus=config.eventBus,events=config.events,debug=config.debug,BASE64=config.BASE64,constants=config.constants,needkeyRetries=[],instance=void 0,logger=void 0,pendingNeedKeyData=void 0,mediaInfoArr=void 0,protDataSet=void 0,sessionType=void 0,robustnessLevel=void 0,keySystem=void 0;function createKeySession(initData,cdmData){var initDataForKS=_CommonEncryption2.default.getPSSHForKeySystem(keySystem,initData),protData=getProtData(keySystem);if(initDataForKS){for(var currentInitData=protectionModel.getAllInitData(),i=0;i<currentInitData.length;i++)if(protectionKeyController.initDataEquals(initDataForKS,currentInitData[i]))return void logger.warn("DRM: Ignoring initData because we have already seen it!");try{protectionModel.createKeySession(initDataForKS,protData,getSessionType(keySystem),cdmData)}catch(error){eventBus.trigger(events.KEY_SESSION_CREATED,{data:null,error:new _voDashJSError2.default(_errorsProtectionErrors2.default.KEY_SESSION_CREATED_ERROR_CODE,_errorsProtectionErrors2.default.KEY_SESSION_CREATED_ERROR_MESSAGE+error.message)})}}else initData?protectionModel.createKeySession(initData,protData,getSessionType(keySystem),cdmData):eventBus.trigger(events.KEY_SESSION_CREATED,{data:null,error:new _voDashJSError2.default(_errorsProtectionErrors2.default.KEY_SESSION_CREATED_ERROR_CODE,_errorsProtectionErrors2.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+keySystem.systemString+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function loadKeySession(sessionID,initData){protectionModel.loadKeySession(sessionID,initData,getSessionType(keySystem))}function setMediaElement(element){element?(protectionModel.setMediaElement(element),eventBus.on(events.NEED_KEY,onNeedKey,this)):null===element&&(protectionModel.setMediaElement(element),eventBus.off(events.NEED_KEY,onNeedKey,this))}function getProtData(keySystem){var protData=null;if(keySystem){var keySystemString=keySystem.systemString;protDataSet&&(protData=keySystemString in protDataSet?protDataSet[keySystemString]:null)}return protData}function getKeySystemConfiguration(keySystem){var protData=getProtData(keySystem),audioCapabilities=[],videoCapabilities=[],audioRobustness=protData&&protData.audioRobustness&&protData.audioRobustness.length>0?protData.audioRobustness:robustnessLevel,videoRobustness=protData&&protData.videoRobustness&&protData.videoRobustness.length>0?protData.videoRobustness:robustnessLevel,ksSessionType=getSessionType(keySystem),distinctiveIdentifier=protData&&protData.distinctiveIdentifier?protData.distinctiveIdentifier:"optional",persistentState=protData&&protData.persistentState?protData.persistentState:"temporary"===ksSessionType?"optional":"required";return mediaInfoArr.forEach((function(media){media.type===constants.AUDIO?audioCapabilities.push(new _voMediaCapability2.default(media.codec,audioRobustness)):media.type===constants.VIDEO&&videoCapabilities.push(new _voMediaCapability2.default(media.codec,videoRobustness))})),new _voKeySystemConfiguration2.default(audioCapabilities,videoCapabilities,distinctiveIdentifier,persistentState,[ksSessionType])}function getSessionType(keySystem){var protData=getProtData(keySystem);return protData&&protData.sessionType?protData.sessionType:sessionType}function selectKeySystem(supportedKS,fromManifest){var self=this,requestedKeySystems=[],ksIdx=void 0;if(keySystem)for(ksIdx=0;ksIdx<supportedKS.length;ksIdx++){if(keySystem===supportedKS[ksIdx].ks)if("break"===function(){requestedKeySystems.push({ks:supportedKS[ksIdx].ks,configs:[getKeySystemConfiguration(keySystem)]});return eventBus.on(events.KEY_SYSTEM_ACCESS_COMPLETE,(function onKeySystemAccessComplete(event){eventBus.off(events.KEY_SYSTEM_ACCESS_COMPLETE,onKeySystemAccessComplete,self),event.error?fromManifest||eventBus.trigger(events.KEY_SYSTEM_SELECTED,{error:new _voDashJSError2.default(_errorsProtectionErrors2.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,_errorsProtectionErrors2.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+event.error)}):(logger.info("DRM: KeySystem Access Granted"),eventBus.trigger(events.KEY_SYSTEM_SELECTED,{data:event.data}),supportedKS[ksIdx].sessionId?loadKeySession(supportedKS[ksIdx].sessionId,supportedKS[ksIdx].initData):supportedKS[ksIdx].initData&&createKeySession(supportedKS[ksIdx].initData,supportedKS[ksIdx].cdmData))}),self),protectionModel.requestKeySystemAccess(requestedKeySystems),"break"}())break}else if(void 0===keySystem){var onKeySystemSelected;!function(){keySystem=null,pendingNeedKeyData.push(supportedKS);for(var i=0;i<supportedKS.length;i++)requestedKeySystems.push({ks:supportedKS[i].ks,configs:[getKeySystemConfiguration(supportedKS[i].ks)]});var keySystemAccess=void 0,onKeySystemAccessComplete=function onKeySystemAccessComplete(event){eventBus.off(events.KEY_SYSTEM_ACCESS_COMPLETE,onKeySystemAccessComplete,self),event.error?(keySystem=void 0,eventBus.off(events.INTERNAL_KEY_SYSTEM_SELECTED,onKeySystemSelected,self),fromManifest||eventBus.trigger(events.KEY_SYSTEM_SELECTED,{data:null,error:new _voDashJSError2.default(_errorsProtectionErrors2.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,_errorsProtectionErrors2.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+event.error)})):(keySystemAccess=event.data,logger.info("DRM: KeySystem Access Granted ("+keySystemAccess.keySystem.systemString+")!  Selecting key system..."),protectionModel.selectKeySystem(keySystemAccess))};onKeySystemSelected=function onKeySystemSelected(event){if(eventBus.off(events.INTERNAL_KEY_SYSTEM_SELECTED,onKeySystemSelected,self),eventBus.off(events.KEY_SYSTEM_ACCESS_COMPLETE,onKeySystemAccessComplete,self),event.error)keySystem=void 0,fromManifest||eventBus.trigger(events.KEY_SYSTEM_SELECTED,{data:null,error:new _voDashJSError2.default(_errorsProtectionErrors2.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,_errorsProtectionErrors2.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+event.error)});else{if(!protectionModel)return;keySystem=protectionModel.getKeySystem(),eventBus.trigger(events.KEY_SYSTEM_SELECTED,{data:keySystemAccess});var protData=getProtData(keySystem);protData&&protData.serverCertificate&&protData.serverCertificate.length>0&&protectionModel.setServerCertificate(BASE64.decodeArray(protData.serverCertificate).buffer);for(var i=0;i<pendingNeedKeyData.length;i++)for(ksIdx=0;ksIdx<pendingNeedKeyData[i].length;ksIdx++)if(keySystem===pendingNeedKeyData[i][ksIdx].ks){if(protectionKeyController.isClearKey(keySystem)&&protData&&protData.hasOwnProperty("clearkeys")){var initData={kids:Object.keys(protData.clearkeys)};pendingNeedKeyData[i][ksIdx].initData=(new TextEncoder).encode(JSON.stringify(initData))}pendingNeedKeyData[i][ksIdx].sessionId?loadKeySession(pendingNeedKeyData[i][ksIdx].sessionId,pendingNeedKeyData[i][ksIdx].initData):null!==pendingNeedKeyData[i][ksIdx].initData&&createKeySession(pendingNeedKeyData[i][ksIdx].initData,pendingNeedKeyData[i][ksIdx].cdmData);break}}},eventBus.on(events.INTERNAL_KEY_SYSTEM_SELECTED,onKeySystemSelected,self),eventBus.on(events.KEY_SYSTEM_ACCESS_COMPLETE,onKeySystemAccessComplete,self),protectionModel.requestKeySystemAccess(requestedKeySystems)}()}else pendingNeedKeyData.push(supportedKS)}function sendLicenseRequestCompleteEvent(data,error){eventBus.trigger(events.LICENSE_REQUEST_COMPLETE,{data:data,error:error})}function onKeyStatusChanged(e){e.error?eventBus.trigger(events.KEY_STATUSES_CHANGED,{data:null,error:e.error}):logger.debug("DRM: key status = "+e.status)}function onKeyMessage(e){logger.debug("DRM: onKeyMessage");var keyMessage=e.data;eventBus.trigger(events.KEY_MESSAGE,{data:keyMessage});var messageType=keyMessage.messageType?keyMessage.messageType:"license-request",message=keyMessage.message,sessionToken=keyMessage.sessionToken,protData=getProtData(keySystem),keySystemString=keySystem?keySystem.systemString:null,licenseServerData=protectionKeyController.getLicenseServer(keySystem,protData,messageType),eventData={sessionToken:sessionToken,messageType:messageType};if(message&&0!==message.byteLength){if(!licenseServerData)return logger.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+sessionToken.getSessionID()),void sendLicenseRequestCompleteEvent(eventData);if(protectionKeyController.isClearKey(keySystem)){var clearkeys=protectionKeyController.processClearKeyLicenseRequest(keySystem,protData,message);if(clearkeys)return logger.debug("DRM: ClearKey license request handled by application!"),sendLicenseRequestCompleteEvent(eventData),void protectionModel.updateKeySession(sessionToken,clearkeys)}var url=null;if(protData&&protData.serverURL){var serverURL=protData.serverURL;"string"==typeof serverURL&&""!==serverURL?url=serverURL:"object"==typeof serverURL&&serverURL.hasOwnProperty(messageType)&&(url=serverURL[messageType])}else protData&&protData.laURL&&""!==protData.laURL?url=protData.laURL:(url=keySystem.getLicenseServerURLFromInitData(_CommonEncryption2.default.getPSSHData(sessionToken.initData)))||(url=e.data.laURL);if(url=licenseServerData.getServerURLFromMessage(url,message,messageType)){var reqHeaders={},withCredentials=!1,updateHeaders=function updateHeaders(headers){if(headers)for(var key in headers)"authorization"===key.toLowerCase()&&(withCredentials=!0),reqHeaders[key]=headers[key]};protData&&updateHeaders(protData.httpRequestHeaders),updateHeaders(keySystem.getRequestHeadersFromMessage(message)),protData&&"boolean"==typeof protData.withCredentials&&(withCredentials=protData.withCredentials);var reportError=function reportError(xhr,eventData,keySystemString,messageType){var errorMsg=xhr.response?licenseServerData.getErrorResponse(xhr.response,keySystemString,messageType):"NONE";sendLicenseRequestCompleteEvent(eventData,new _voDashJSError2.default(_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+keySystemString+' update, XHR complete. status is "'+xhr.statusText+'" ('+xhr.status+"), readyState is "+xhr.readyState+".  Response is "+errorMsg))},reqPayload=keySystem.getLicenseRequestFromMessage(message),reqMethod=licenseServerData.getHTTPMethod(messageType),responseType=licenseServerData.getResponseType(keySystemString,messageType),timeout=protData&&!isNaN(protData.httpTimeout)?protData.httpTimeout:8e3;!function doLicenseRequest(url,headers,method,responseType,withCredentials,payload,retriesCount,timeout,onLoad,onAbort,onError){var xhr=new XMLHttpRequest;xhr.open(method,url,!0),xhr.responseType=responseType,xhr.withCredentials=withCredentials,timeout>0&&(xhr.timeout=timeout);for(var key in headers)xhr.setRequestHeader(key,headers[key]);var retryRequest=function retryRequest(){retriesCount--,setTimeout((function(){doLicenseRequest(url,headers,method,responseType,withCredentials,payload,retriesCount,timeout,onLoad,onAbort,onError)}),1e3)};xhr.onload=function(){200===this.status||retriesCount<=0?onLoad(this):(logger.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+retriesCount),retryRequest())},xhr.ontimeout=xhr.onerror=function(){retriesCount<=0?onError(this):(logger.warn("License request network request failed . Retrying it... Pending retries: "+retriesCount),retryRequest())},xhr.onabort=function(){onAbort(this)},xhr.send(payload)}(url,reqHeaders,reqMethod,responseType,withCredentials,reqPayload,3,timeout,(function onLoad(xhr){if(protectionModel)if(200===xhr.status){var licenseMessage=licenseServerData.getLicenseMessage(xhr.response,keySystemString,messageType);null!==licenseMessage?(sendLicenseRequestCompleteEvent(eventData),protectionModel.updateKeySession(sessionToken,licenseMessage)):reportError(xhr,eventData,keySystemString,messageType)}else reportError(xhr,eventData,keySystemString,messageType)}),(function onAbort(xhr){sendLicenseRequestCompleteEvent(eventData,new _voDashJSError2.default(_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+keySystemString+' update, XHR aborted. status is "'+xhr.statusText+'" ('+xhr.status+"), readyState is "+xhr.readyState))}),(function onError(xhr){sendLicenseRequestCompleteEvent(eventData,new _voDashJSError2.default(_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+keySystemString+' update, XHR error. status is "'+xhr.statusText+'" ('+xhr.status+"), readyState is "+xhr.readyState))}))}else sendLicenseRequestCompleteEvent(eventData,new _voDashJSError2.default(_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}else sendLicenseRequestCompleteEvent(eventData,new _voDashJSError2.default(_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function onNeedKey(event,retry){if(logger.debug("DRM: onNeedKey"),"cenc"===event.key.initDataType)if(0===mediaInfoArr.length&&(logger.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(retry=void 0===retry?1:retry+1)<5))needkeyRetries.push(setTimeout((function(){onNeedKey(event,retry)}),500));else{var abInitData=event.key.initData;if(ArrayBuffer.isView(abInitData)&&(abInitData=abInitData.buffer),keySystem){var initDataForKS=_CommonEncryption2.default.getPSSHForKeySystem(keySystem,abInitData);if(initDataForKS)for(var currentInitData=protectionModel.getAllInitData(),i=0;i<currentInitData.length;i++)if(protectionKeyController.initDataEquals(initDataForKS,currentInitData[i]))return void logger.warn("DRM: Ignoring initData because we have already seen it!")}logger.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(abInitData)));var supportedKS=protectionKeyController.getSupportedKeySystems(abInitData,protDataSet);0!==supportedKS.length?selectKeySystem(supportedKS,!1):logger.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!")}else logger.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+event.key.initDataType)}return instance={initializeForMedia:function initializeForMedia(mediaInfo){if(!mediaInfo)throw new Error("mediaInfo can not be null or undefined");!function checkConfig(){if(!(eventBus&&eventBus.hasOwnProperty("on")&&protectionKeyController&&protectionKeyController.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}(),eventBus.on(events.INTERNAL_KEY_MESSAGE,onKeyMessage,this),eventBus.on(events.INTERNAL_KEY_STATUS_CHANGED,onKeyStatusChanged,this),mediaInfoArr.push(mediaInfo);var supportedKS=protectionKeyController.getSupportedKeySystemsFromContentProtection(mediaInfo.contentProtection);supportedKS&&supportedKS.length>0&&selectKeySystem(supportedKS,!0)},createKeySession:createKeySession,loadKeySession:loadKeySession,removeKeySession:function removeKeySession(sessionToken){protectionModel.removeKeySession(sessionToken)},closeKeySession:function closeKeySession(sessionToken){protectionModel.closeKeySession(sessionToken)},setServerCertificate:function setServerCertificate(serverCertificate){protectionModel.setServerCertificate(serverCertificate)},setMediaElement:setMediaElement,setSessionType:function setSessionType(value){sessionType=value},setRobustnessLevel:function setRobustnessLevel(level){robustnessLevel=level},setProtectionData:function setProtectionData(data){protDataSet=data,protectionKeyController.setProtectionData(data)},getSupportedKeySystemsFromContentProtection:function getSupportedKeySystemsFromContentProtection(cps){return protectionKeyController.getSupportedKeySystemsFromContentProtection(cps)},getKeySystems:function getKeySystems(){return protectionKeyController?protectionKeyController.getKeySystems():[]},stop:function stop(){protectionModel&&protectionModel.stop()},reset:function reset(){eventBus.off(events.INTERNAL_KEY_MESSAGE,onKeyMessage,this),eventBus.off(events.INTERNAL_KEY_STATUS_CHANGED,onKeyStatusChanged,this),setMediaElement(null),keySystem=void 0,protectionModel&&(protectionModel.reset(),protectionModel=null),needkeyRetries.forEach((function(retryTimeout){return clearTimeout(retryTimeout)})),needkeyRetries=[],mediaInfoArr=[]}},function setup(){logger=debug.getLogger(instance),pendingNeedKeyData=[],mediaInfoArr=[],sessionType="temporary",robustnessLevel=""}(),instance}ProtectionController.__dashjs_factory_name="ProtectionController",exports.default=dashjs.FactoryMaker.getClassFactory(ProtectionController),module.exports=exports.default},1597:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function MediaCapability(contentType,robustness){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MediaCapability),this.contentType=contentType,this.robustness=robustness},module.exports=exports.default},1598:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _voKeyPair2=_interopRequireDefault(__webpack_require__(1416)),_voClearKeyKeySet2=_interopRequireDefault(__webpack_require__(1417)),_CommonEncryption2=_interopRequireDefault(__webpack_require__(1385)),_constantsProtectionConstants2=_interopRequireDefault(__webpack_require__(1381)),uuid="e2719d58-a985-b3c9-781a-b030af78d30e",systemString=_constantsProtectionConstants2.default.CLEARKEY_KEYSTEM_STRING;function KeySystemClearKey(config){var BASE64=(config=config||{}).BASE64;return{uuid:uuid,schemeIdURI:"urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e",systemString:systemString,getInitData:function getInitData(cp){return _CommonEncryption2.default.parseInitDataFromContentProtection(cp,BASE64)},getRequestHeadersFromMessage:function getRequestHeadersFromMessage(){return null},getLicenseRequestFromMessage:function getLicenseRequestFromMessage(message){return new Uint8Array(message)},getLicenseServerURLFromInitData:function getLicenseServerURLFromInitData(){return null},getCDMData:function getCDMData(){return null},getSessionId:function getSessionId(){return null},getClearKeysFromProtectionData:function getClearKeysFromProtectionData(protectionData,message){var clearkeySet=null;if(protectionData){for(var jsonMsg=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(message))),keyPairs=[],i=0;i<jsonMsg.kids.length;i++){var clearkeyID=jsonMsg.kids[i],clearkey=protectionData.clearkeys&&protectionData.clearkeys.hasOwnProperty(clearkeyID)?protectionData.clearkeys[clearkeyID]:null;if(!clearkey)throw new Error("DRM: ClearKey keyID ("+clearkeyID+") is not known!");keyPairs.push(new _voKeyPair2.default(clearkeyID,clearkey))}clearkeySet=new _voClearKeyKeySet2.default(keyPairs)}return clearkeySet}}}KeySystemClearKey.__dashjs_factory_name="KeySystemClearKey",exports.default=dashjs.FactoryMaker.getSingletonFactory(KeySystemClearKey),module.exports=exports.default},1599:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _voKeyPair2=_interopRequireDefault(__webpack_require__(1416)),_voClearKeyKeySet2=_interopRequireDefault(__webpack_require__(1417)),_CommonEncryption2=_interopRequireDefault(__webpack_require__(1385)),_constantsProtectionConstants2=_interopRequireDefault(__webpack_require__(1381)),uuid="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString=_constantsProtectionConstants2.default.CLEARKEY_KEYSTEM_STRING;function KeySystemW3CClearKey(config){var instance=void 0,BASE64=config.BASE64,logger=config.debug.getLogger(instance);return instance={uuid:uuid,schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:systemString,getInitData:function getInitData(cp){return _CommonEncryption2.default.parseInitDataFromContentProtection(cp,BASE64)},getRequestHeadersFromMessage:function getRequestHeadersFromMessage(){return null},getLicenseRequestFromMessage:function getLicenseRequestFromMessage(message){return new Uint8Array(message)},getLicenseServerURLFromInitData:function getLicenseServerURLFromInitData(){return null},getCDMData:function getCDMData(){return null},getSessionId:function getSessionId(){return null},getClearKeysFromProtectionData:function getClearKeysFromProtectionData(protectionData,message){var clearkeySet=null;if(protectionData){for(var jsonMsg=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(message))),keyPairs=[],i=0;i<jsonMsg.kids.length;i++){var clearkeyID=jsonMsg.kids[i],clearkey=protectionData.clearkeys&&protectionData.clearkeys.hasOwnProperty(clearkeyID)?protectionData.clearkeys[clearkeyID]:null;if(!clearkey)throw new Error("DRM: ClearKey keyID ("+clearkeyID+") is not known!");keyPairs.push(new _voKeyPair2.default(clearkeyID,clearkey))}clearkeySet=new _voClearKeyKeySet2.default(keyPairs),logger.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return clearkeySet}}}KeySystemW3CClearKey.__dashjs_factory_name="KeySystemW3CClearKey",exports.default=dashjs.FactoryMaker.getSingletonFactory(KeySystemW3CClearKey),module.exports=exports.default},1600:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _CommonEncryption2=_interopRequireDefault(__webpack_require__(1385)),_constantsProtectionConstants2=_interopRequireDefault(__webpack_require__(1381)),uuid="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString=_constantsProtectionConstants2.default.WIDEVINE_KEYSTEM_STRING;function KeySystemWidevine(config){var protData=null,BASE64=(config=config||{}).BASE64;return{uuid:uuid,schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:systemString,init:function init(protectionData){protectionData&&(protData=protectionData)},getInitData:function getInitData(cp){return _CommonEncryption2.default.parseInitDataFromContentProtection(cp,BASE64)},getRequestHeadersFromMessage:function getRequestHeadersFromMessage(){return null},getLicenseRequestFromMessage:function getLicenseRequestFromMessage(message){return new Uint8Array(message)},getLicenseServerURLFromInitData:function getLicenseServerURLFromInitData(){return null},getCDMData:function getCDMData(){return null},getSessionId:function getSessionId(cp){return protData&&protData.sessionId?protData.sessionId:cp&&cp.sessionId?cp.sessionId:null}}}KeySystemWidevine.__dashjs_factory_name="KeySystemWidevine",exports.default=dashjs.FactoryMaker.getSingletonFactory(KeySystemWidevine),module.exports=exports.default},1601:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _CommonEncryption2=_interopRequireDefault(__webpack_require__(1385)),_constantsProtectionConstants2=_interopRequireDefault(__webpack_require__(1381)),uuid="9a04f079-9840-4286-ab92-e65be0885f95",systemString=_constantsProtectionConstants2.default.PLAYREADY_KEYSTEM_STRING,protData=void 0;function KeySystemPlayReady(config){var messageFormat="utf16",BASE64=(config=config||{}).BASE64;function checkConfig(){if(!BASE64||!BASE64.hasOwnProperty("decodeArray")||!BASE64.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:uuid,schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:systemString,getInitData:function getInitData(cpData){var PROSize,PSSHSize,PSSHBoxBuffer,PSSHBoxType=new Uint8Array([112,115,115,104,0,0,0,0]),playreadySystemID=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),byteCursor=0,uint8arraydecodedPROHeader=null,PSSHBox=void 0,PSSHData=void 0;if(checkConfig(),"pssh"in cpData)return _CommonEncryption2.default.parseInitDataFromContentProtection(cpData,BASE64);if("pro"in cpData)uint8arraydecodedPROHeader=BASE64.decodeArray(cpData.pro.__text);else{if(!("prheader"in cpData))return null;uint8arraydecodedPROHeader=BASE64.decodeArray(cpData.prheader.__text)}return PROSize=uint8arraydecodedPROHeader.length,PSSHSize=4+PSSHBoxType.length+playreadySystemID.length+4+PROSize,PSSHBoxBuffer=new ArrayBuffer(PSSHSize),PSSHBox=new Uint8Array(PSSHBoxBuffer),(PSSHData=new DataView(PSSHBoxBuffer)).setUint32(byteCursor,PSSHSize),byteCursor+=4,PSSHBox.set(PSSHBoxType,byteCursor),byteCursor+=PSSHBoxType.length,PSSHBox.set(playreadySystemID,byteCursor),byteCursor+=playreadySystemID.length,PSSHData.setUint32(byteCursor,PROSize),byteCursor+=4,PSSHBox.set(uint8arraydecodedPROHeader,byteCursor),byteCursor+=PROSize,PSSHBox.buffer},getRequestHeadersFromMessage:function getRequestHeadersFromMessage(message){var msg,xmlDoc=void 0,headers={},parser=new DOMParser,dataview="utf16"===messageFormat?new Uint16Array(message):new Uint8Array(message);msg=String.fromCharCode.apply(null,dataview);for(var headerNameList=(xmlDoc=parser.parseFromString(msg,"application/xml")).getElementsByTagName("name"),headerValueList=xmlDoc.getElementsByTagName("value"),i=0;i<headerNameList.length;i++)headers[headerNameList[i].childNodes[0].nodeValue]=headerValueList[i].childNodes[0].nodeValue;return headers.hasOwnProperty("Content")&&(headers["Content-Type"]=headers.Content,delete headers.Content),headers.hasOwnProperty("Content-Type")||(headers["Content-Type"]="text/xml; charset="+messageFormat),headers},getLicenseRequestFromMessage:function getLicenseRequestFromMessage(message){var licenseRequest=null,parser=new DOMParser,dataview="utf16"===messageFormat?new Uint16Array(message):new Uint8Array(message);checkConfig();var msg=String.fromCharCode.apply(null,dataview),xmlDoc=parser.parseFromString(msg,"application/xml");if(xmlDoc.getElementsByTagName("Challenge")[0]){var Challenge=xmlDoc.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;Challenge&&(licenseRequest=BASE64.decode(Challenge))}else if(xmlDoc.getElementsByTagName("parsererror").length)return message;return licenseRequest},getLicenseServerURLFromInitData:function getLicenseServerURLFromInitData(initData){if(initData)for(var data=new DataView(initData),numRecords=data.getUint16(4,!0),offset=6,parser=new DOMParser,i=0;i<numRecords;i++){var recordType=data.getUint16(offset,!0);offset+=2;var recordLength=data.getUint16(offset,!0);if(offset+=2,1===recordType){var recordData=initData.slice(offset,offset+recordLength),record=String.fromCharCode.apply(null,new Uint16Array(recordData)),xmlDoc=parser.parseFromString(record,"application/xml");if(xmlDoc.getElementsByTagName("LA_URL")[0]){var laurl=xmlDoc.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(laurl)return laurl}if(xmlDoc.getElementsByTagName("LUI_URL")[0]){var luiurl=xmlDoc.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(luiurl)return luiurl}}else offset+=recordLength}return null},getCDMData:function getCDMData(){var customData=void 0,cdmData=void 0,cdmDataBytes=void 0,i=void 0;if(checkConfig(),protData&&protData.cdmData){for(customData=[],i=0;i<protData.cdmData.length;++i)customData.push(protData.cdmData.charCodeAt(i)),customData.push(0);for(customData=String.fromCharCode.apply(null,customData),customData=BASE64.encode(customData),cdmData='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",customData),cdmDataBytes=[],i=0;i<cdmData.length;++i)cdmDataBytes.push(cdmData.charCodeAt(i)),cdmDataBytes.push(0);return new Uint8Array(cdmDataBytes).buffer}return null},getSessionId:function getSessionId(cp){return protData&&protData.sessionId?protData.sessionId:cp&&cp.sessionId?cp.sessionId:null},setPlayReadyMessageFormat:function setPlayReadyMessageFormat(format){if("utf8"!==format&&"utf16"!==format)throw new Error("Illegal PlayReady message format! -- "+format);messageFormat=format},init:function init(protectionData){protectionData&&(protData=protectionData)}}}KeySystemPlayReady.__dashjs_factory_name="KeySystemPlayReady",exports.default=dashjs.FactoryMaker.getSingletonFactory(KeySystemPlayReady),module.exports=exports.default},1602:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _constantsProtectionConstants2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1381));function DRMToday(config){var BASE64=(config=config||{}).BASE64,keySystems={};keySystems[_constantsProtectionConstants2.default.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function getLicenseMessage(response){return BASE64.decodeArray(response.license)},getErrorResponse:function getErrorResponse(response){return response}},keySystems[_constantsProtectionConstants2.default.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function getLicenseMessage(response){return response},getErrorResponse:function getErrorResponse(response){return String.fromCharCode.apply(null,new Uint8Array(response))}};return{getServerURLFromMessage:function getServerURLFromMessage(url){return url},getHTTPMethod:function getHTTPMethod(){return"POST"},getResponseType:function getResponseType(keySystemStr){return keySystems[keySystemStr].responseType},getLicenseMessage:function getLicenseMessage(serverResponse,keySystemStr){return function checkConfig(){if(!BASE64||!BASE64.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),keySystems[keySystemStr].getLicenseMessage(serverResponse)},getErrorResponse:function getErrorResponse(serverResponse,keySystemStr){return keySystems[keySystemStr].getErrorResponse(serverResponse)}}}DRMToday.__dashjs_factory_name="DRMToday",exports.default=dashjs.FactoryMaker.getSingletonFactory(DRMToday),module.exports=exports.default},1603:function(module,exports,__webpack_require__){"use strict";function PlayReady(){var soap="http://schemas.xmlsoap.org/soap/envelope/";function uintToString(arrayBuffer){var encodedString=String.fromCharCode.apply(null,new Uint8Array(arrayBuffer));return decodeURIComponent(escape(encodedString))}function parseServerResponse(serverResponse){if(window.DOMParser){var stringResponse=uintToString(serverResponse),xmlDoc=(new window.DOMParser).parseFromString(stringResponse,"text/xml"),envelope=xmlDoc?xmlDoc.getElementsByTagNameNS(soap,"Envelope")[0]:null,body=envelope?envelope.getElementsByTagNameNS(soap,"Body")[0]:null;if(body?body.getElementsByTagNameNS(soap,"Fault")[0]:null)return null}return serverResponse}function parseErrorResponse(serverResponse){var faultstring="",statusCode="",message="",idStart=-1,idEnd=-1;if(window.DOMParser){var stringResponse=uintToString(serverResponse),xmlDoc=(new window.DOMParser).parseFromString(stringResponse,"text/xml"),envelope=xmlDoc?xmlDoc.getElementsByTagNameNS(soap,"Envelope")[0]:null,body=envelope?envelope.getElementsByTagNameNS(soap,"Body")[0]:null,fault=body?body.getElementsByTagNameNS(soap,"Fault")[0]:null,detail=fault?fault.getElementsByTagName("detail")[0]:null,exception=detail?detail.getElementsByTagName("Exception")[0]:null,node=null;if(null===fault)return stringResponse;faultstring=(node=fault.getElementsByTagName("faultstring")[0].firstChild)?node.nodeValue:null,null!==exception&&(statusCode=(node=exception.getElementsByTagName("StatusCode")[0])?node.firstChild.nodeValue:null,idStart=(message=(node=exception.getElementsByTagName("Message")[0])?node.firstChild.nodeValue:null)?message.lastIndexOf("[")+1:-1,idEnd=message?message.indexOf("]"):-1,message=message?message.substring(idStart,idEnd):"")}var errorString="code: "+statusCode+", name: "+faultstring;return message&&(errorString+=", message: "+message),errorString}return{getServerURLFromMessage:function getServerURLFromMessage(url){return url},getHTTPMethod:function getHTTPMethod(){return"POST"},getResponseType:function getResponseType(){return"arraybuffer"},getLicenseMessage:function getLicenseMessage(serverResponse){return parseServerResponse.call(this,serverResponse)},getErrorResponse:function getErrorResponse(serverResponse){return parseErrorResponse.call(this,serverResponse)}}}Object.defineProperty(exports,"__esModule",{value:!0}),PlayReady.__dashjs_factory_name="PlayReady",exports.default=dashjs.FactoryMaker.getSingletonFactory(PlayReady),module.exports=exports.default},1604:function(module,exports,__webpack_require__){"use strict";function Widevine(){return{getServerURLFromMessage:function getServerURLFromMessage(url){return url},getHTTPMethod:function getHTTPMethod(){return"POST"},getResponseType:function getResponseType(){return"arraybuffer"},getLicenseMessage:function getLicenseMessage(serverResponse){return serverResponse},getErrorResponse:function getErrorResponse(serverResponse){return String.fromCharCode.apply(null,new Uint8Array(serverResponse))}}}Object.defineProperty(exports,"__esModule",{value:!0}),Widevine.__dashjs_factory_name="Widevine",exports.default=dashjs.FactoryMaker.getSingletonFactory(Widevine),module.exports=exports.default},1605:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _voKeyPair2=_interopRequireDefault(__webpack_require__(1416)),_voClearKeyKeySet2=_interopRequireDefault(__webpack_require__(1417));function ClearKey(){return{getServerURLFromMessage:function getServerURLFromMessage(url,message){var jsonMsg=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(message)));url+="/?";for(var i=0;i<jsonMsg.kids.length;i++)url+=jsonMsg.kids[i]+"&";return url=url.substring(0,url.length-1)},getHTTPMethod:function getHTTPMethod(){return"GET"},getResponseType:function getResponseType(){return"json"},getLicenseMessage:function getLicenseMessage(serverResponse){if(!serverResponse.hasOwnProperty("keys"))return null;for(var keyPairs=[],i=0;i<serverResponse.keys.length;i++){var keypair=serverResponse.keys[i],keyid=keypair.kid.replace(/=/g,""),key=keypair.k.replace(/=/g,"");keyPairs.push(new _voKeyPair2.default(keyid,key))}return new _voClearKeyKeySet2.default(keyPairs)},getErrorResponse:function getErrorResponse(serverResponse){return String.fromCharCode.apply(null,new Uint8Array(serverResponse))}}}ClearKey.__dashjs_factory_name="ClearKey",exports.default=dashjs.FactoryMaker.getSingletonFactory(ClearKey),module.exports=exports.default},1606:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var protectionEvents=new(function(_EventsBase){function ProtectionEvents(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ProtectionEvents),function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}}(Object.getPrototypeOf(ProtectionEvents.prototype),"constructor",this).call(this),this.INTERNAL_KEY_MESSAGE="internalKeyMessage",this.INTERNAL_KEY_SYSTEM_SELECTED="internalKeySystemSelected",this.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",this.KEY_ADDED="public_keyAdded",this.KEY_ERROR="public_keyError",this.KEY_MESSAGE="public_keyMessage",this.KEY_SESSION_CLOSED="public_keySessionClosed",this.KEY_SESSION_CREATED="public_keySessionCreated",this.KEY_SESSION_REMOVED="public_keySessionRemoved",this.KEY_STATUSES_CHANGED="public_keyStatusesChanged",this.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",this.KEY_SYSTEM_SELECTED="public_keySystemSelected",this.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",this.NEED_KEY="needkey",this.PROTECTION_CREATED="public_protectioncreated",this.PROTECTION_DESTROYED="public_protectiondestroyed",this.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",this.TEARDOWN_COMPLETE="protectionTeardownComplete",this.VIDEO_ELEMENT_SELECTED="videoElementSelected"}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ProtectionEvents,_EventsBase),ProtectionEvents}(function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1391)).default));exports.default=protectionEvents,module.exports=exports.default},1607:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _controllersProtectionKeyController2=_interopRequireDefault(__webpack_require__(1400)),_voNeedKey2=_interopRequireDefault(__webpack_require__(1418)),_errorsProtectionErrors2=_interopRequireDefault(__webpack_require__(1389)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_voKeyMessage2=_interopRequireDefault(__webpack_require__(1419)),_voKeySystemAccess2=_interopRequireDefault(__webpack_require__(1420)),_constantsProtectionConstants2=_interopRequireDefault(__webpack_require__(1381));function ProtectionModel_21Jan2015(config){config=config||{};var context=this.context,eventBus=config.eventBus,events=config.events,debug=config.debug,instance=void 0,logger=void 0,keySystem=void 0,videoElement=void 0,mediaKeys=void 0,sessions=void 0,eventHandler=void 0,protectionKeyController=void 0;function closeKeySessionInternal(sessionToken){var session=sessionToken.session;return session.removeEventListener("keystatuseschange",sessionToken),session.removeEventListener("message",sessionToken),session.close()}function removeSession(token){for(var i=0;i<sessions.length;i++)if(sessions[i]===token){sessions.splice(i,1);break}}function parseKeyStatus(args){var status=void 0,keyId=void 0;return args&&args.length>0&&(args[0]&&("string"==typeof args[0]?status=args[0]:keyId=args[0]),args[1]&&("string"==typeof args[1]?status=args[1]:keyId=args[1])),{status:status,keyId:keyId}}function createSessionToken(session,initData,sessionType,sessionID){var token={session:session,initData:initData,sessionId:sessionID,handleEvent:function handleEvent(event){switch(event.type){case"keystatuseschange":eventBus.trigger(events.KEY_STATUSES_CHANGED,{data:this}),event.target.keyStatuses.forEach((function(){var keyStatus=parseKeyStatus(arguments);switch(keyStatus.status){case"expired":eventBus.trigger(events.INTERNAL_KEY_STATUS_CHANGED,{error:new _voDashJSError2.default(_errorsProtectionErrors2.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,_errorsProtectionErrors2.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)});break;default:eventBus.trigger(events.INTERNAL_KEY_STATUS_CHANGED,keyStatus)}}));break;case"message":var message=ArrayBuffer.isView(event.message)?event.message.buffer:event.message;eventBus.trigger(events.INTERNAL_KEY_MESSAGE,{data:new _voKeyMessage2.default(this,message,void 0,event.messageType)})}},getSessionID:function getSessionID(){return session.sessionId},getExpirationTime:function getExpirationTime(){return session.expiration},getKeyStatuses:function getKeyStatuses(){return session.keyStatuses},getUsable:function getUsable(){var usable=!1;return session.keyStatuses.forEach((function(){var keyStatus=parseKeyStatus(arguments);"usable"===keyStatus.status&&(usable=!0)})),usable},getSessionType:function getSessionType(){return sessionType}};return session.addEventListener("keystatuseschange",token),session.addEventListener("message",token),session.closed.then((function(){removeSession(token),logger.debug("DRM: Session closed.  SessionID = "+token.getSessionID()),eventBus.trigger(events.KEY_SESSION_CLOSED,{data:token.getSessionID()})})),sessions.push(token),token}return instance={getAllInitData:function getAllInitData(){for(var retVal=[],i=0;i<sessions.length;i++)sessions[i].initData&&retVal.push(sessions[i].initData);return retVal},requestKeySystemAccess:function requestKeySystemAccess(ksConfigurations){!function requestKeySystemAccessInternal(ksConfigurations,idx){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess)return void eventBus.trigger(events.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Insecure origins are not allowed"});!function(i){var keySystem=ksConfigurations[i].ks,configs=ksConfigurations[i].configs,systemString=keySystem.systemString;systemString===_constantsProtectionConstants2.default.PLAYREADY_KEYSTEM_STRING&&"required"===configs[0].persistentState&&(systemString+=".recommendation"),navigator.requestMediaKeySystemAccess(systemString,configs).then((function(mediaKeySystemAccess){var configuration="function"==typeof mediaKeySystemAccess.getConfiguration?mediaKeySystemAccess.getConfiguration():null,keySystemAccess=new _voKeySystemAccess2.default(keySystem,configuration);keySystemAccess.mksa=mediaKeySystemAccess,eventBus.trigger(events.KEY_SYSTEM_ACCESS_COMPLETE,{data:keySystemAccess})})).catch((function(error){++i<ksConfigurations.length?requestKeySystemAccessInternal(ksConfigurations,i):eventBus.trigger(events.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! "+error.message})}))}(idx)}(ksConfigurations,0)},getKeySystem:function getKeySystem(){return keySystem},selectKeySystem:function selectKeySystem(keySystemAccess){keySystemAccess.mksa.createMediaKeys().then((function(mkeys){keySystem=keySystemAccess.keySystem,mediaKeys=mkeys,videoElement?videoElement.setMediaKeys(mediaKeys).then((function(){eventBus.trigger(events.INTERNAL_KEY_SYSTEM_SELECTED)})):eventBus.trigger(events.INTERNAL_KEY_SYSTEM_SELECTED)})).catch((function(){eventBus.trigger(events.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+keySystemAccess.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))},setMediaElement:function setMediaElement(mediaElement){videoElement!==mediaElement&&(videoElement&&(videoElement.removeEventListener("encrypted",eventHandler),videoElement.setMediaKeys&&videoElement.setMediaKeys(null)),(videoElement=mediaElement)&&(videoElement.addEventListener("encrypted",eventHandler),videoElement.setMediaKeys&&mediaKeys&&videoElement.setMediaKeys(mediaKeys)))},setServerCertificate:function setServerCertificate(serverCertificate){if(!keySystem||!mediaKeys)throw new Error("Can not set server certificate until you have selected a key system");mediaKeys.setServerCertificate(serverCertificate).then((function(){logger.info("DRM: License server certificate successfully updated."),eventBus.trigger(events.SERVER_CERTIFICATE_UPDATED)})).catch((function(error){eventBus.trigger(events.SERVER_CERTIFICATE_UPDATED,{error:new _voDashJSError2.default(_errorsProtectionErrors2.default.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,_errorsProtectionErrors2.default.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+error.name)})}))},createKeySession:function createKeySession(initData,protData,sessionType){if(!keySystem||!mediaKeys)throw new Error("Can not create sessions until you have selected a key system");var session=mediaKeys.createSession(sessionType),sessionToken=createSessionToken(session,initData,sessionType),dataType=this.getKeySystem().systemString===_constantsProtectionConstants2.default.CLEARKEY_KEYSTEM_STRING&&protData&&protData.clearkeys?"keyids":"cenc";session.generateRequest(dataType,initData).then((function(){logger.debug("DRM: Session created.  SessionID = "+sessionToken.getSessionID()),eventBus.trigger(events.KEY_SESSION_CREATED,{data:sessionToken})})).catch((function(error){removeSession(sessionToken),eventBus.trigger(events.KEY_SESSION_CREATED,{data:null,error:new _voDashJSError2.default(_errorsProtectionErrors2.default.KEY_SESSION_CREATED_ERROR_CODE,_errorsProtectionErrors2.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+error.name)})}))},updateKeySession:function updateKeySession(sessionToken,message){var session=sessionToken.session;protectionKeyController.isClearKey(keySystem)&&(message=message.toJWK()),session.update(message).catch((function(error){eventBus.trigger(events.KEY_ERROR,{data:new _voDashJSError2.default(_errorsProtectionErrors2.default.MEDIA_KEYERR_CODE,"Error sending update() message! "+error.name,sessionToken)})}))},loadKeySession:function loadKeySession(sessionID,initData,sessionType){if(!keySystem||!mediaKeys)throw new Error("Can not load sessions until you have selected a key system");for(var i=0;i<sessions.length;i++)if(sessionID===sessions[i].sessionId)return void logger.warn("DRM: Ignoring session ID because we have already seen it!");var session=mediaKeys.createSession(sessionType),sessionToken=createSessionToken(session,initData,sessionType,sessionID);session.load(sessionID).then((function(success){success?(logger.debug("DRM: Session loaded.  SessionID = "+sessionToken.getSessionID()),eventBus.trigger(events.KEY_SESSION_CREATED,{data:sessionToken})):(removeSession(sessionToken),eventBus.trigger(events.KEY_SESSION_CREATED,{data:null,error:new _voDashJSError2.default(_errorsProtectionErrors2.default.KEY_SESSION_CREATED_ERROR_CODE,_errorsProtectionErrors2.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+sessionID+")")}))})).catch((function(error){removeSession(sessionToken),eventBus.trigger(events.KEY_SESSION_CREATED,{data:null,error:new _voDashJSError2.default(_errorsProtectionErrors2.default.KEY_SESSION_CREATED_ERROR_CODE,_errorsProtectionErrors2.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+sessionID+")! "+error.name)})}))},removeKeySession:function removeKeySession(sessionToken){sessionToken.session.remove().then((function(){logger.debug("DRM: Session removed.  SessionID = "+sessionToken.getSessionID()),eventBus.trigger(events.KEY_SESSION_REMOVED,{data:sessionToken.getSessionID()})}),(function(error){eventBus.trigger(events.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+sessionToken.getSessionID()+"). "+error.name})}))},closeKeySession:function closeKeySession(sessionToken){closeKeySessionInternal(sessionToken).catch((function(error){removeSession(sessionToken),eventBus.trigger(events.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+sessionToken.getSessionID()+") "+error.name})}))},stop:function stop(){for(var session=void 0,i=0;i<sessions.length;i++)(session=sessions[i]).getUsable()||closeKeySessionInternal(session).catch((function(){removeSession(session)}))},reset:function reset(){var numSessions=sessions.length,session=void 0;0!==numSessions?function(){for(var done=function done(session){removeSession(session),0===sessions.length&&(videoElement?(videoElement.removeEventListener("encrypted",eventHandler),videoElement.setMediaKeys(null).then((function(){eventBus.trigger(events.TEARDOWN_COMPLETE)}))):eventBus.trigger(events.TEARDOWN_COMPLETE))},i=0;i<numSessions;i++)!function(s){session.session.closed.then((function(){done(s)})),closeKeySessionInternal(session).catch((function(){done(s)}))}(session=sessions[i])}():eventBus.trigger(events.TEARDOWN_COMPLETE)}},function setup(){logger=debug.getLogger(instance),keySystem=null,videoElement=null,mediaKeys=null,sessions=[],protectionKeyController=(0,_controllersProtectionKeyController2.default)(context).getInstance(),eventHandler=function createEventHandler(){return{handleEvent:function handleEvent(event){switch(event.type){case"encrypted":if(event.initData){var initData=ArrayBuffer.isView(event.initData)?event.initData.buffer:event.initData;eventBus.trigger(events.NEED_KEY,{key:new _voNeedKey2.default(initData,event.initDataType)})}}}}}()}(),instance}ProtectionModel_21Jan2015.__dashjs_factory_name="ProtectionModel_21Jan2015",exports.default=dashjs.FactoryMaker.getClassFactory(ProtectionModel_21Jan2015),module.exports=exports.default},1608:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _controllersProtectionKeyController2=_interopRequireDefault(__webpack_require__(1400)),_voNeedKey2=_interopRequireDefault(__webpack_require__(1418)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_errorsProtectionErrors2=_interopRequireDefault(__webpack_require__(1389)),_voKeyMessage2=_interopRequireDefault(__webpack_require__(1419)),_voKeySystemConfiguration2=_interopRequireDefault(__webpack_require__(1415)),_voKeySystemAccess2=_interopRequireDefault(__webpack_require__(1420));function ProtectionModel_3Feb2014(config){config=config||{};var context=this.context,eventBus=config.eventBus,events=config.events,debug=config.debug,api=config.api,instance=void 0,logger=void 0,videoElement=void 0,keySystem=void 0,mediaKeys=void 0,keySystemAccess=void 0,sessions=void 0,eventHandler=void 0,protectionKeyController=void 0;function reset(){try{for(var i=0;i<sessions.length;i++)closeKeySession(sessions[i]);videoElement&&videoElement.removeEventListener(api.needkey,eventHandler),eventBus.trigger(events.TEARDOWN_COMPLETE)}catch(error){eventBus.trigger(events.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+error.message})}}function closeKeySession(sessionToken){var session=sessionToken.session;session.removeEventListener(api.error,sessionToken),session.removeEventListener(api.message,sessionToken),session.removeEventListener(api.ready,sessionToken),session.removeEventListener(api.close,sessionToken);for(var i=0;i<sessions.length;i++)if(sessions[i]===sessionToken){sessions.splice(i,1);break}session[api.release]()}function setMediaKeys(){var boundDoSetKeys=null,doSetKeys=function doSetKeys(){videoElement.removeEventListener("loadedmetadata",boundDoSetKeys),videoElement[api.setMediaKeys](mediaKeys),eventBus.trigger(events.VIDEO_ELEMENT_SELECTED)};videoElement.readyState>=1?doSetKeys():(boundDoSetKeys=doSetKeys.bind(this),videoElement.addEventListener("loadedmetadata",boundDoSetKeys))}return instance={getAllInitData:function getAllInitData(){for(var retVal=[],i=0;i<sessions.length;i++)retVal.push(sessions[i].initData);return retVal},requestKeySystemAccess:function requestKeySystemAccess(ksConfigurations){for(var found=!1,ksIdx=0;ksIdx<ksConfigurations.length;ksIdx++)for(var systemString=ksConfigurations[ksIdx].ks.systemString,configs=ksConfigurations[ksIdx].configs,supportedAudio=null,supportedVideo=null,configIdx=0;configIdx<configs.length;configIdx++){var audios=configs[configIdx].audioCapabilities,videos=configs[configIdx].videoCapabilities;if(audios&&0!==audios.length){supportedAudio=[];for(var audioIdx=0;audioIdx<audios.length;audioIdx++)window[api.MediaKeys].isTypeSupported(systemString,audios[audioIdx].contentType)&&supportedAudio.push(audios[audioIdx])}if(videos&&0!==videos.length){supportedVideo=[];for(var videoIdx=0;videoIdx<videos.length;videoIdx++)window[api.MediaKeys].isTypeSupported(systemString,videos[videoIdx].contentType)&&supportedVideo.push(videos[videoIdx])}if(!(!supportedAudio&&!supportedVideo||supportedAudio&&0===supportedAudio.length||supportedVideo&&0===supportedVideo.length)){found=!0;var ksConfig=new _voKeySystemConfiguration2.default(supportedAudio,supportedVideo),ks=protectionKeyController.getKeySystemBySystemString(systemString);eventBus.trigger(events.KEY_SYSTEM_ACCESS_COMPLETE,{data:new _voKeySystemAccess2.default(ks,ksConfig)});break}}found||eventBus.trigger(events.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function getKeySystem(){return keySystem},selectKeySystem:function selectKeySystem(ksAccess){try{mediaKeys=ksAccess.mediaKeys=new window[api.MediaKeys](ksAccess.keySystem.systemString),keySystem=ksAccess.keySystem,keySystemAccess=ksAccess,videoElement&&setMediaKeys(),eventBus.trigger(events.INTERNAL_KEY_SYSTEM_SELECTED)}catch(error){eventBus.trigger(events.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+keySystem.systemString+")! Could not create MediaKeys -- TODO"})}},setMediaElement:function setMediaElement(mediaElement){videoElement!==mediaElement&&(videoElement&&videoElement.removeEventListener(api.needkey,eventHandler),(videoElement=mediaElement)&&(videoElement.addEventListener(api.needkey,eventHandler),mediaKeys&&setMediaKeys()))},createKeySession:function createKeySession(initData,protData,sessionType,cdmData){if(!keySystem||!mediaKeys||!keySystemAccess)throw new Error("Can not create sessions until you have selected a key system");var capabilities=null;if(keySystemAccess.ksConfiguration.videoCapabilities&&keySystemAccess.ksConfiguration.videoCapabilities.length>0&&(capabilities=keySystemAccess.ksConfiguration.videoCapabilities[0]),null===capabilities&&keySystemAccess.ksConfiguration.audioCapabilities&&keySystemAccess.ksConfiguration.audioCapabilities.length>0&&(capabilities=keySystemAccess.ksConfiguration.audioCapabilities[0]),null===capabilities)throw new Error("Can not create sessions for unknown content types.");var contentType=capabilities.contentType,session=mediaKeys.createSession(contentType,new Uint8Array(initData),cdmData?new Uint8Array(cdmData):null),sessionToken=function createSessionToken(keySession,initData){return{session:keySession,initData:initData,getSessionID:function getSessionID(){return this.session.sessionId},getExpirationTime:function getExpirationTime(){return NaN},getSessionType:function getSessionType(){return"temporary"},handleEvent:function handleEvent(event){switch(event.type){case api.error:eventBus.trigger(events.KEY_ERROR,{data:new _voDashJSError2.default(_errorsProtectionErrors2.default.MEDIA_KEYERR_CODE,"KeyError",this)});break;case api.message:var message=ArrayBuffer.isView(event.message)?event.message.buffer:event.message;eventBus.trigger(events.INTERNAL_KEY_MESSAGE,{data:new _voKeyMessage2.default(this,message,event.destinationURL)});break;case api.ready:logger.debug("DRM: Key added."),eventBus.trigger(events.KEY_ADDED);break;case api.close:logger.debug("DRM: Session closed.  SessionID = "+this.getSessionID()),eventBus.trigger(events.KEY_SESSION_CLOSED,{data:this.getSessionID()})}}}}(session,initData);session.addEventListener(api.error,sessionToken),session.addEventListener(api.message,sessionToken),session.addEventListener(api.ready,sessionToken),session.addEventListener(api.close,sessionToken),sessions.push(sessionToken),logger.debug("DRM: Session created.  SessionID = "+sessionToken.getSessionID()),eventBus.trigger(events.KEY_SESSION_CREATED,{data:sessionToken})},updateKeySession:function updateKeySession(sessionToken,message){var session=sessionToken.session;protectionKeyController.isClearKey(keySystem)?session.update(new Uint8Array(message.toJWK())):session.update(new Uint8Array(message))},closeKeySession:closeKeySession,setServerCertificate:function setServerCertificate(){},loadKeySession:function loadKeySession(){},removeKeySession:function removeKeySession(){},stop:reset,reset:reset},function setup(){logger=debug.getLogger(instance),videoElement=null,keySystem=null,mediaKeys=null,keySystemAccess=null,sessions=[],protectionKeyController=(0,_controllersProtectionKeyController2.default)(context).getInstance(),eventHandler=function createEventHandler(){return{handleEvent:function handleEvent(event){switch(event.type){case api.needkey:if(event.initData){var initData=ArrayBuffer.isView(event.initData)?event.initData.buffer:event.initData;eventBus.trigger(events.NEED_KEY,{key:new _voNeedKey2.default(initData,"cenc")})}}}}}()}(),instance}ProtectionModel_3Feb2014.__dashjs_factory_name="ProtectionModel_3Feb2014",exports.default=dashjs.FactoryMaker.getClassFactory(ProtectionModel_3Feb2014),module.exports=exports.default},1609:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _controllersProtectionKeyController2=_interopRequireDefault(__webpack_require__(1400)),_voNeedKey2=_interopRequireDefault(__webpack_require__(1418)),_voDashJSError2=_interopRequireDefault(__webpack_require__(1371)),_voKeyMessage2=_interopRequireDefault(__webpack_require__(1419)),_voKeySystemConfiguration2=_interopRequireDefault(__webpack_require__(1415)),_voKeySystemAccess2=_interopRequireDefault(__webpack_require__(1420)),_errorsProtectionErrors2=_interopRequireDefault(__webpack_require__(1389));function ProtectionModel_01b(config){config=config||{};var context=this.context,eventBus=config.eventBus,events=config.events,debug=config.debug,api=config.api,errHandler=config.errHandler,instance=void 0,logger=void 0,videoElement=void 0,keySystem=void 0,protectionKeyController=void 0,pendingSessions=void 0,sessions=void 0,moreSessionsAllowed=void 0,eventHandler=void 0;function reset(){videoElement&&removeEventListeners();for(var i=0;i<sessions.length;i++)closeKeySession(sessions[i]);eventBus.trigger(events.TEARDOWN_COMPLETE)}function closeKeySession(sessionToken){try{videoElement[api.cancelKeyRequest](keySystem.systemString,sessionToken.sessionID)}catch(error){eventBus.trigger(events.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+sessionToken.sessionID+") "+error.message})}}function findSessionByID(sessionArray,sessionID){if(sessionID&&sessionArray){for(var len=sessionArray.length,i=0;i<len;i++)if(sessionArray[i].sessionID==sessionID)return sessionArray[i];return null}return null}function removeEventListeners(){videoElement.removeEventListener(api.keyerror,eventHandler),videoElement.removeEventListener(api.needkey,eventHandler),videoElement.removeEventListener(api.keymessage,eventHandler),videoElement.removeEventListener(api.keyadded,eventHandler)}return instance={getAllInitData:function getAllInitData(){for(var retVal=[],i=0;i<pendingSessions.length;i++)retVal.push(pendingSessions[i].initData);for(i=0;i<sessions.length;i++)retVal.push(sessions[i].initData);return retVal},requestKeySystemAccess:function requestKeySystemAccess(ksConfigurations){var ve=videoElement;ve||(ve=document.createElement("video"));for(var found=!1,ksIdx=0;ksIdx<ksConfigurations.length;ksIdx++)for(var systemString=ksConfigurations[ksIdx].ks.systemString,configs=ksConfigurations[ksIdx].configs,supportedVideo=null,configIdx=0;configIdx<configs.length;configIdx++){var videos=configs[configIdx].videoCapabilities;if(videos&&0!==videos.length){supportedVideo=[];for(var videoIdx=0;videoIdx<videos.length;videoIdx++)""!==ve.canPlayType(videos[videoIdx].contentType,systemString)&&supportedVideo.push(videos[videoIdx])}if(supportedVideo&&(!supportedVideo||0!==supportedVideo.length)){found=!0;var ksConfig=new _voKeySystemConfiguration2.default(null,supportedVideo),ks=protectionKeyController.getKeySystemBySystemString(systemString);eventBus.trigger(events.KEY_SYSTEM_ACCESS_COMPLETE,{data:new _voKeySystemAccess2.default(ks,ksConfig)});break}}found||eventBus.trigger(events.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function getKeySystem(){return keySystem},selectKeySystem:function selectKeySystem(keySystemAccess){keySystem=keySystemAccess.keySystem,eventBus.trigger(events.INTERNAL_KEY_SYSTEM_SELECTED)},setMediaElement:function setMediaElement(mediaElement){if(videoElement!==mediaElement){if(videoElement){removeEventListeners();for(var i=0;i<sessions.length;i++)closeKeySession(sessions[i]);sessions=[]}(videoElement=mediaElement)&&(videoElement.addEventListener(api.keyerror,eventHandler),videoElement.addEventListener(api.needkey,eventHandler),videoElement.addEventListener(api.keymessage,eventHandler),videoElement.addEventListener(api.keyadded,eventHandler),eventBus.trigger(events.VIDEO_ELEMENT_SELECTED))}},createKeySession:function createKeySession(initData){if(!keySystem)throw new Error("Can not create sessions until you have selected a key system");if(moreSessionsAllowed||0===sessions.length){var newSession={sessionID:null,initData:initData,getSessionID:function getSessionID(){return this.sessionID},getExpirationTime:function getExpirationTime(){return NaN},getSessionType:function getSessionType(){return"temporary"}};return pendingSessions.push(newSession),videoElement[api.generateKeyRequest](keySystem.systemString,new Uint8Array(initData)),newSession}throw new Error("Multiple sessions not allowed!")},updateKeySession:function updateKeySession(sessionToken,message){var sessionID=sessionToken.sessionID;if(protectionKeyController.isClearKey(keySystem))for(var i=0;i<message.keyPairs.length;i++)videoElement[api.addKey](keySystem.systemString,message.keyPairs[i].key,message.keyPairs[i].keyID,sessionID);else videoElement[api.addKey](keySystem.systemString,new Uint8Array(message),new Uint8Array(sessionToken.initData),sessionID)},closeKeySession:closeKeySession,setServerCertificate:function setServerCertificate(){},loadKeySession:function loadKeySession(){},removeKeySession:function removeKeySession(){},stop:reset,reset:reset},function setup(){logger=debug.getLogger(instance),videoElement=null,keySystem=null,pendingSessions=[],sessions=[],protectionKeyController=(0,_controllersProtectionKeyController2.default)(context).getInstance(),eventHandler=function createEventHandler(){return{handleEvent:function handleEvent(event){var sessionToken=null;switch(event.type){case api.needkey:var initData=ArrayBuffer.isView(event.initData)?event.initData.buffer:event.initData;eventBus.trigger(events.NEED_KEY,{key:new _voNeedKey2.default(initData,"cenc")});break;case api.keyerror:if((sessionToken=findSessionByID(sessions,event.sessionId))||(sessionToken=findSessionByID(pendingSessions,event.sessionId)),sessionToken){var code=_errorsProtectionErrors2.default.MEDIA_KEYERR_CODE,msg="";switch(event.errorCode.code){case 1:code=_errorsProtectionErrors2.default.MEDIA_KEYERR_UNKNOWN_CODE,msg+="MEDIA_KEYERR_UNKNOWN - "+_errorsProtectionErrors2.default.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:code=_errorsProtectionErrors2.default.MEDIA_KEYERR_CLIENT_CODE,msg+="MEDIA_KEYERR_CLIENT - "+_errorsProtectionErrors2.default.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:code=_errorsProtectionErrors2.default.MEDIA_KEYERR_SERVICE_CODE,msg+="MEDIA_KEYERR_SERVICE - "+_errorsProtectionErrors2.default.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:code=_errorsProtectionErrors2.default.MEDIA_KEYERR_OUTPUT_CODE,msg+="MEDIA_KEYERR_OUTPUT - "+_errorsProtectionErrors2.default.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:code=_errorsProtectionErrors2.default.MEDIA_KEYERR_HARDWARECHANGE_CODE,msg+="MEDIA_KEYERR_HARDWARECHANGE - "+_errorsProtectionErrors2.default.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:code=_errorsProtectionErrors2.default.MEDIA_KEYERR_DOMAIN_CODE,msg+="MEDIA_KEYERR_DOMAIN - "+_errorsProtectionErrors2.default.MEDIA_KEYERR_DOMAIN_MESSAGE}msg+="  System Code = "+event.systemCode,eventBus.trigger(events.KEY_ERROR,{data:new _voDashJSError2.default(code,msg,sessionToken)})}else logger.error("No session token found for key error");break;case api.keyadded:(sessionToken=findSessionByID(sessions,event.sessionId))||(sessionToken=findSessionByID(pendingSessions,event.sessionId)),sessionToken?(logger.debug("DRM: Key added."),eventBus.trigger(events.KEY_ADDED,{data:sessionToken})):logger.debug("No session token found for key added");break;case api.keymessage:if((moreSessionsAllowed=null!==event.sessionId&&void 0!==event.sessionId)?!(sessionToken=findSessionByID(sessions,event.sessionId))&&pendingSessions.length>0&&(sessionToken=pendingSessions.shift(),sessions.push(sessionToken),sessionToken.sessionID=event.sessionId,eventBus.trigger(events.KEY_SESSION_CREATED,{data:sessionToken})):pendingSessions.length>0&&(sessionToken=pendingSessions.shift(),sessions.push(sessionToken),0!==pendingSessions.length&&(errHandler.mediaKeyMessageError(_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_ERROR_MESSAGE),errHandler.error(new _voDashJSError2.default(_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_ERROR_CODE,_errorsProtectionErrors2.default.MEDIA_KEY_MESSAGE_ERROR_MESSAGE)))),sessionToken){var message=ArrayBuffer.isView(event.message)?event.message.buffer:event.message;sessionToken.keyMessage=message,eventBus.trigger(events.INTERNAL_KEY_MESSAGE,{data:new _voKeyMessage2.default(sessionToken,message,event.defaultURL)})}else logger.warn("No session token found for key message")}}}}()}(),instance}ProtectionModel_01b.__dashjs_factory_name="ProtectionModel_01b",exports.default=dashjs.FactoryMaker.getClassFactory(ProtectionModel_01b),module.exports=exports.default},1610:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _MediaPlayer2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(1422));var instance=function MediaPlayerFactory(){var logger=void 0;function create(video,source,context){if(!video||!/^VIDEO$/i.test(video.nodeName))return null;if(video._dashjs_player)return video._dashjs_player;var player=void 0,videoID=video.id||video.name||"video element";if(!(source=source||[].slice.call(video.querySelectorAll("source")).filter((function(s){return"application/dash+xml"==s.type}))[0])&&video.src)(source=document.createElement("source")).src=video.src;else if(!source&&!video.src)return null;return context=context||{},(player=(0,_MediaPlayer2.default)(context).create()).initialize(video,source.src,video.autoplay),logger||(logger=player.getDebug().getLogger()),logger.debug("Converted "+videoID+" to dash.js player and added content: "+source.src),video._dashjs_player=player,player}function findVideo(_x){for(var _again=!0;_again;){var el=_x;if(_again=!1,/^VIDEO$/i.test(el.nodeName))return el;_x=el.parentNode,_again=!0}}return{create:create,createAll:function createAll(selector,scope){var aPlayers=[];selector=selector||"[data-dashjs-player]";for(var videos=(scope=scope||document).querySelectorAll(selector),i=0;i<videos.length;i++){var player=create(videos[i],null);aPlayers.push(player)}var sources=scope.querySelectorAll('source[type="application/dash+xml"]');for(i=0;i<sources.length;i++){player=create(findVideo(sources[i]),null);aPlayers.push(player)}return aPlayers}}}(),loadInterval=void 0;!("undefined"!=typeof window&&window&&window.dashjs&&window.dashjs.skipAutoCreate)&&"undefined"!=typeof window&&window&&window.addEventListener&&("complete"===window.document.readyState?window.dashjs?instance.createAll():loadInterval=window.setInterval((function loadIntervalHandler(){window.dashjs&&(window.clearInterval(loadInterval),instance.createAll())}),500):window.addEventListener("load",(function loadHandler(){window.removeEventListener("load",loadHandler),instance.createAll()}))),exports.default=instance,module.exports=exports.default},1611:function(module,exports,__webpack_require__){(function(global){var doccy,topLevel=void 0!==global?global:"undefined"!=typeof window?window:{},minDoc=__webpack_require__(1612);"undefined"!=typeof document?doccy=document:(doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"])||(doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"]=minDoc),module.exports=doccy}).call(this,__webpack_require__(54))}}]);
//# sourceMappingURL=3.b123f929908ab8ef7178.bundle.js.map